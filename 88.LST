                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for PC-8801mkIISR
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
                                
       CC00                     RUN EQU 0CC00H
       CBF9                     OFFSET  EQU RUN-7
                                
       D006                     BDOS    EQU 0D006H
       ED98                     TABLEAD EQU 0ED98H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0009                     COMS    EQU 9
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0004                     VER_2   EQU 4
       0009                     VER_3   EQU 9
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0149                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 CBF9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 CBF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 CBFA 00CC                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 CBFC F9F1                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 CBFE 07CC                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 CC00 C307CC          10      JP  START
00000A CC03 021D                    DW  MACW
00000C CC05 4901                    DW  VER
                                
       CC07                     START:
00000E CC07 F3               4      DI
00000F CC08 ED5E             8      IM  2
000011 CC0A 3107CC          10      LD  SP,START
000014 CC0D CD1BCC          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 CC10 210000          10      LD  HL,0
00001A CC13 E5              11      PUSH    HL
00001B CC14 C8              11      RET Z
00001C CC15 1159CD          10      LD  DE,AUTOD
00001F CC18 C3FDEF          10      JP  _COMANL
                                
       CC1B                     INIT:
000022 CC1B DB32            11      IN  A,(032H)
000024 CC1D CBA7             8      RES 4,A     ;高速RAMアクセスモード
000026 CC1F D332            11      OUT (032H),A
                                
000028 CC21 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002B CC24 11E880          10      LD  DE,080E8H
00002E CC27 0E20             7      LD  C,' '
000030 CC29 3E19             7      LD  A,25
       CC2B                     TVCL1:
000032 CC2B 0650             7      LD  B,80
       CC2D                     TVCL2:
000034 CC2D 71               7      LD  (HL),C
000035 CC2E 23               6      INC HL
000036 CC2F 10FC            13      DJNZ    TVCL2
000038 CC31 0614             7      LD  B,20
       CC33                     TVCL3:
00003A CC33 72               7      LD  (HL),D
00003B CC34 2C               4      INC L
00003C CC35 73               7      LD  (HL),E
00003D CC36 23               6      INC HL
00003E CC37 10FA            13      DJNZ    TVCL3
000040 CC39 3D               4      DEC A
000041 CC3A 20EF            12      JR  NZ,TVCL1
                                
000043 CC3C DB32            11      IN  A,(032H)
000045 CC3E F610             7      OR  010H        ;高速RAMアクセスモードOFF
000047 CC40 D332            11      OUT (032H),A
                                
000049 CC42 AF               4      XOR A
00004A CC43 32B8EF          13      LD  (WKE6),A
00004D CC46 2F               4      CPL
00004E CC47 32B7EF          13      LD  (WKE4),A
                                
000051 CC4A CD7BDD          17      CALL    INIT_CRTC
       CC4D                     BANK:
000054 CC4D DBE2            11      IN  A,(0E2H)
000056 CC4F 06E3             7      LD  B,0E3H      ;拡張RAM バンク選択
000058 CC51 21007F          10      LD  HL,07F00H
00005B CC54 F3               4      DI
00005C CC55 3E11             7      LD  A,011H
00005E CC57 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000060 CC59 ED69            12      OUT (C),L
000062 CC5B 3A0000          13      LD  A,(0)
000065 CC5E FEEB             7      CP  0EBH
000067 CC60 2005            12      JR  NZ,BANK1
000069 CC62 3E2B             7      LD  A,02BH
00006B CC64 32B2F1          13      LD  (BANKDV),A
       CC67                     BANK1:
00006E CC67 3E11             7      LD  A,011H
000070 CC69 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000072 CC6B ED69            12      OUT (C),L
000074 CC6D 5E               7      LD  E,(HL)
000075 CC6E 7B               4      LD  A,E
000076 CC6F C6A5             7      ADD A,0A5H
000078 CC71 77               7      LD  (HL),A
000079 CC72 BE               7      CP  (HL)
00007A CC73 73               7      LD  (HL),E
00007B CC74 2005            12      JR  NZ,BANK2
00007D CC76 2C               4      INC L
00007E CC77 CB65             8      BIT 4,L
000080 CC79 28EC            12      JR  Z,BANK1
       CC7B                     BANK2:
000082 CC7B AF               4      XOR A
000083 CC7C D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000085 CC7E 7D               4      LD  A,L
000086 CC7F B7               4      OR  A
000087 CC80 2813            12      JR  Z,NOBANK
000089 CC82 2600             7      LD  H,0
00008B CC84 29              11      ADD HL,HL   ;*2
00008C CC85 29              11      ADD HL,HL   ;*4
00008D CC86 29              11      ADD HL,HL   ;*8
00008E CC87 29              11      ADD HL,HL   ;*16
00008F CC88 29              11      ADD HL,HL   ;*32
000090 CC89 2B               6      DEC HL  ;-1
000091 CC8A 2B               6      DEC HL  ;-2
000092 CC8B 2B               6      DEC HL  ;-3
000093 CC8C 22A8F1          16      LD  (BANKCL),HL
000096 CC8F CD49CD          17      CALL    CALC_FATLN
000099 CC92 32A0F1          13      LD  (BANKFL),A
       CC95                     NOBANK:
                                                ;初期化
00009C CC95 AF               4      XOR A       ;イニシャライズ
00009D CC96 CD72EB          17      CALL    PUTCOM
0000A0 CC99 3E16             7      LD  A,16H       ;高速レシーブメモリ
0000A2 CC9B CD72EB          17      CALL    PUTCOM
0000A5 CC9E 3E7C             7      LD  A,DSS/256   ;開始アドレスH
0000A7 CCA0 CD78EB          17      CALL    PUTDAT
0000AA CCA3 AF               4      XOR A       ;開始アドレスL
0000AB CCA4 CD78EB          17      CALL    PUTDAT
0000AE CCA7 01F901          10      LD  BC,AT_DSSE-AT_DSS
0000B1 CCAA CB41             8      BIT 0,C
0000B3 CCAC 2801            12      JR  Z,SUBPG1
0000B5 CCAE 03               6      INC BC      ;偶数にする
       CCAF                     SUBPG1:
0000B6 CCAF 78               4      LD  A,B     ;バイト数H
0000B7 CCB0 CD78EB          17      CALL    PUTDAT
0000BA CCB3 79               4      LD  A,C
0000BB CCB4 CD78EB          17      CALL    PUTDAT
0000BE CCB7 21B8CD          10      LD  HL,AT_DSS
0000C1 CCBA CDBCEB          17      CALL    FPUTDAT
                                
0000C4 CCBD 210000          10      LD  HL,0
0000C7 CCC0 065C             7      LD  B,05CH
0000C9 CCC2 3EFF             7      LD  A,0FFH      ;RST 38H
0000CB CCC4 CDC1DE          17      CALL    FILL_MEMORY
0000CE CCC7 06A4             7      LD  B,0A4H
0000D0 CCC9 AF               4      XOR A
0000D1 CCCA CDC1DE          17      CALL    FILL_MEMORY
                                
0000D4 CCCD 3EC3             7      LD  A,0C3H      ;JP
0000D6 CCCF 2103EF          10      LD  HL,CPM_WBOOT
0000D9 CCD2 320000          13      LD  (00000H),A
0000DC CCD5 220100          16      LD  (00001H),HL ;IPL
                                
0000DF CCD8 21021D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000E2 CCDB 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000E5 CCDE 2106D0          10      LD  HL,BDOS
0000E8 CCE1 320500          13      LD  (00005H),A
0000EB CCE4 220600          16      LD  (00006H),HL ;BDOS
                                
0000EE CCE7 21F4DD          10      LD  HL,BIOS
0000F1 CCEA 321800          13      LD  (00018H),A
0000F4 CCED 221900          16      LD  (00019H),HL ;BIOS-ROM
                                
0000F7 CCF0 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000FA CCF3 323800          13      LD  (00038H),A
0000FD CCF6 223900          16      LD  (00039H),HL ;RST 038H
                                
000100 CCF9 3EEF             7      LD  A,CPM_BOOT/256
000102 CCFB 320B00          13      LD  (0000BH),A
                                
000105 CCFE 3EE9             7      LD  A,0E9H      ;JP (HL)
000107 CD00 320F00          13      LD  (0000FH),A
                                
00010A CD03 3A7DF0          13      LD  A,(_FATBF+1)
00010D CD06 321300          13      LD  (00013H),A
                                
000110 CD09 3A7FF0          13      LD  A,(_DTBUF+1)
000113 CD0C 321700          13      LD  (00017H),A
                                
000116 CD0F 3EFE             7      LD  A,KEYBF/256
000118 CD11 321B00          13      LD  (0001BH),A
                                
00011B CD14 3EFF             7      LD  A,KBUF/256
00011D CD16 321F00          13      LD  (0001FH),A
                                
000120 CD19 214901          10      LD  HL,VER
000123 CD1C 225A00          16      LD  (0005AH),HL
                                
000126 CD1F 2165CD          10      LD  HL,INIMES
000129 CD22 CD2FD6          17      CALL    MSX
       CD25                     INIT1:
00012C CD25 F3               4      DI
00012D CD26 1100FF          10      LD  DE,0FF00H
000130 CD29 0600             7      LD  B,0
000132 CD2B CDD2D3          17      CALL    ZERO_MEMORY_DE
000135 CD2E 21CAFF          10      LD  HL,EXTBIO
000138 CD31 060F             7      LD  B,TRAP38-EXTBIO
00013A CD33 3EFF             7      LD  A,0FFH      ;RST 38H
00013C CD35 CDC1DE          17      CALL    FILL_MEMORY
00013F CD38 2191CD          10      LD  HL,AT_TRAP38
000142 CD3B 11D9FF          10      LD  DE,TRAP38
000145 CD3E 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
000148 CD41 EDB0                    LDIR
                                
00014A CD43 CD1ADD          17      CALL    CHKEY
00014D CD46 FE03             7      CP  3
00014F CD48 C9              10      RET
                                
       CD49                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
000150 CD49 5D               4      LD  E,L
000151 CD4A 54               4      LD  D,H
000152 CD4B 29              11      ADD HL,HL   ;*2
000153 CD4C 19              11      ADD HL,DE   ;*3
000154 CD4D CB3C             8      SRL H   ;/2
000156 CD4F CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
000158 CD51 11FF01          10      LD  DE,511  ;切り上げる
00015B CD54 19              11      ADD HL,DE
00015C CD55 7C               4      LD  A,H
00015D CD56 CB3F             8      SRL A
00015F CD58 C9              10      RET
                                
000160 CD59 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
000169 CD62 413A00              AUTODV: DB  "A:",0
                                
00016C CD65 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
00018C CD85 312E                    DB  030H + VER_1, '.'
00018E CD87 3439                    DB  030H + VER_2 ,030H + VER_3
                                ;   DB  "PR3"
000190 CD89 2047616B750D0A          DB  ' Gaku',0DH,0AH
000197 CD90 00                      DB  0
                                
       CD91                     AT_TRAP38:
000198 FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
000198 FFD9 210000          10      LD  HL,0
00019B FFDC E3              19      EX  (SP),HL
00019C FFDD 3E24             7      LD  A,'$'
00019E FFDF CD20D9          17      CALL    MSG_A
0001A1 FFE2 2B               6      DEC HL
0001A2 FFE3 7C               4      LD  A,H
0001A3 FFE4 CDE8FF          17      CALL    PRHX
0001A6 FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001A7 FFE8 F5              11      PUSH    AF
0001A8 FFE9 07               4      RLCA
0001A9 FFEA 07               4      RLCA
0001AA FFEB 07               4      RLCA
0001AB FFEC 07               4      RLCA
0001AC FFED CDF1FF          17      CALL    PRHX2
0001AF FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001B0 FFF1 E60F             7      AND 00FH
0001B2 FFF3 FE0A             7      CP  10
0001B4 FFF5 3F               4      CCF
0001B5 FFF6 CE30             7      ADC A,'0'
0001B7 FFF8 27               4      DAA
0001B8 FFF9 C320D9          10      JP  MSG_A
0001BB FFFC                         DS  4
0001BF CDB8                         ORG $$+OFFSET   ;$DEPHASE
       CDB8                     AT_TRAPE:
                                
       CDB8                     AT_DSS:
0001BF 7C00                         ORG DSS,AT_DSS-OFFSET
       7C00                     READDISKEX:
0001BF 7C00 CD707C          17      CALL    GETPARAMS
0001C2 7C03 AF               4      XOR A
0001C3 7C04 32347C          13      LD  (RETRY_RDDISK),A
0001C6 7C07 2AF07D          16      LD  HL,(S_PARAMS+2)
0001C9 7C0A 7D               4      LD  A,L
0001CA 7C0B 3D               4      DEC A
0001CB 7C0C B4               4      OR  H
0001CC 7C0D 200C            12      JR  NZ,RDDISK0
0001CE 7C0F 2AF37D          16      LD  HL,(S_PARAMS+5)
0001D1 7C12 7C               4      LD  A,H
0001D2 7C13 BD               4      CP  L
0001D3 7C14 2005            12      JR  NZ,RDDISK0
0001D5 7C16 3E03             7      LD  A,3
0001D7 7C18 32347C          13      LD  (RETRY_RDDISK),A
       7C1B                     RDDISK0:
0001DA 7C1B 3E46             7      LD  A,46H       ;READ DATA
0001DC 7C1D CD7D7C          17      CALL    FDCOMMAND
0001DF 7C20 3834            12      JR  C,FINISH_DISK
0001E1 7C22 CD227D          17      CALL    RDDISK1
       7C25                     WRDISK3:
0001E4 7C25 78               4      LD  A,B
0001E5 7C26 B2               4      OR  D
0001E6 7C27 32F77D          13      LD  (S_LEFT),A
0001E9 7C2A DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
0001EB 7C2C FB               4      EI
0001EC 7C2D 76               4      HALT
0001ED 7C2E CDBD7D          17      CALL    CHECKRESULT
0001F0 7C31 301D            12      JR  NC,FINISH_DISK0
       7C34                     RETRY_RDDISK    EQU $+1
0001F2 7C33 3E00             7      LD  A,0
0001F4 7C35 B7               4      OR  A
0001F5 7C36 2818            12      JR  Z,FINISH_DISK0
0001F7 7C38 3D               4      DEC A
0001F8 7C39 32347C          13      LD  (RETRY_RDDISK),A
0001FB 7C3C 3AF37D          13      LD  A,(S_PARAMS+5)
0001FE 7C3F FE04             7      CP  4
000200 7C41 3003            12      JR  NC,RETRY_RDDISK1
000202 7C43 87               4      ADD A,A
000203 7C44 1802            12      JR  RETRY_RDDISK2
       7C46                     RETRY_RDDISK1:
000205 7C46 3E01             7      LD  A,1
       7C48                     RETRY_RDDISK2:
000207 7C48 67               4      LD  H,A
000208 7C49 6F               4      LD  L,A
000209 7C4A 22F37D          16      LD  (S_PARAMS+5),HL
00020C 7C4D C31B7C          10      JP  RDDISK0
       7C50                     FINISH_DISK0:
00020F 7C50 3AF77D          13      LD  A,(S_LEFT)
000212 7C53 D601             7      SUB 1
000214 7C55 3F               4      CCF
       7C56                     FINISH_DISK:
000215 7C56 9F               4      SBC A,A
000216 7C57 32F67D          13      LD  (S_CMD_STATUS),A
000219 7C5A C32A00          10      JP  MAIN
                                
       7C5D                     WRITEDISKEX:
00021C 7C5D AF               4      XOR A
00021D 7C5E 32347C          13      LD  (RETRY_RDDISK),A
000220 7C61 CD707C          17      CALL    GETPARAMS
000223 7C64 3E45             7      LD  A,45H       ;WRITE DATA
000225 7C66 CD7D7C          17      CALL    FDCOMMAND
000228 7C69 38EB            12      JR  C,FINISH_DISK
00022A 7C6B CD697D          17      CALL    WRDISK1
00022D 7C6E 18B5            12      JR  WRDISK3
                                
       7C70                     GETPARAMS:
00022F 7C70 0608             7      LD  B,8
000231 7C72 E5              11      PUSH    HL
000232 7C73 21EE7D          10      LD  HL,S_PARAMS
       7C76                     GETPARAMS1:
000235 7C76 D7              12      RST 10H
000236 7C77 77               7      LD  (HL),A
000237 7C78 23               6      INC HL
000238 7C79 10FB            13      DJNZ    GETPARAMS1
00023A 7C7B E1              10      POP HL
00023B 7C7C C9              10      RET
                                
       7C7D                     FDCOMMAND:
00023C 7C7D F5              11      PUSH    AF
00023D 7C7E 3AF27D          13      LD  A,(S_PARAMS+4)  ;MFMモード切り替え $FF:2D/2DD $FE:2HD
000240 7C81 1F               4      RRA
000241 7C82 3F               4      CCF
000242 7C83 9F               4      SBC A,A
000243 7C84 F5              11      PUSH    AF
000244 7C85 E605             7      AND 5
000246 7C87 4F               4      LD  C,A
000247 7C88 3AF57D          13      LD  A,(S_PARAMS+7)  ;シリンダ数
00024A 7C8B C6CE             7      ADD A,0-50
00024C 7C8D 9F               4      SBC A,A
00024D 7C8E E604             7      AND 4
00024F 7C90 B1               4      OR  C
000250 7C91 0EFA             7      LD  C,0FFH-5    ;マスク
000252 7C93 47               4      LD  B,A
000253 7C94 3AEE7D          13      LD  A,(S_PARAMS)    ;0:ドライブA 1:ドライブB
000256 7C97 B7               4      OR  A
000257 7C98 2804            12      JR  Z,SET_WKF4
000259 7C9A CB20             8      SLA B
00025B 7C9C CB21             8      SLA C
       7C9E                     SET_WKF4:
00025D 7C9E 3AF87D          13      LD  A,(S_WKF4)
000260 7CA1 A1               4      AND C
000261 7CA2 B0               4      OR  B
000262 7CA3 32F87D          13      LD  (S_WKF4),A
000265 7CA6 F1              10      POP AF
000266 7CA7 F620             7      OR  020H        ;bit5:CLK
000268 7CA9 4F               4      LD  C,A
000269 7CAA 3AF87D          13      LD  A,(S_WKF4)
00026C 7CAD E6DF             7      AND 0FFH-020H   ;20Hのマスク
00026E 7CAF B1               4      OR  C
00026F 7CB0 D3F4            11      OUT (0F4H),A    ;ドライブ制御
000271 7CB2 32F87D          13      LD  (S_WKF4),A
                                
000274 7CB5 ED4BEE7D        20      LD  BC,(S_PARAMS)
000278 7CB9 ED5BF07D        20      LD  DE,(S_PARAMS+2)
00027C 7CBD 7A               4      LD  A,D     ;TRACK
00027D 7CBE CB3F             8      SRL A       ;CYLINDER
00027F 7CC0 C6FF             7      ADD A,0FFH      ;0の場合、CF=0 それ以外CF=1
000281 7CC2 9F               4      SBC A,A
000282 7CC3 E608             7      AND 8       ;SEEK:0FH = 8 | 7
000284 7CC5 F607             7      OR  7       ;RECALIBRATE:7
000286 7CC7 E7              12      RST 20H
000287 7CC8 79               4      LD  A,C     ;DR/HD
000288 7CC9 E7              12      RST 20H
000289 7CCA 7A               4      LD  A,D     ;TRACK
00028A 7CCB CB3F             8      SRL A       ;CYLINDER
00028C 7CCD C42000          17      CALL    NZ,20H      ;SEEKの場合だけ呼ぶ(0シリンダの場合はRECALIBRATEを使う)
00028F 7CD0 FB               4      EI
000290 7CD1 76               4      HALT
000291 7CD2 3E08             7      LD  A,8     ;SENSE
000293 7CD4 E7              12      RST 20H
000294 7CD5 CDE47D          17      CALL    RDFDC       ;ST0
000297 7CD8 CDE47D          17      CALL    RDFDC       ;PCN(CYLINDER)
00029A 7CDB E5              11      PUSH    HL
00029B 7CDC 210040          10      LD  HL,04000H
       7CDF                     WAIT_SEEK:
00029E 7CDF CDDF7D          17      CALL    GETDEVSTAT
0002A1 7CE2 E608             7      AND 8
0002A3 7CE4 2009            12      JR  NZ,SEEK_OK
0002A5 7CE6 2B               6      DEC HL
0002A6 7CE7 7C               4      LD  A,H
0002A7 7CE8 B5               4      OR  L
0002A8 7CE9 20F4            12      JR  NZ,WAIT_SEEK
0002AA 7CEB E1              10      POP HL
0002AB 7CEC F1              10      POP AF
0002AC 7CED 37               4      SCF
0002AD 7CEE C9              10      RET
       7CEF                     SEEK_OK:
0002AE 7CEF E1              10      POP HL
0002AF 7CF0 F1              10      POP AF
0002B0 7CF1 E7              12      RST 20H
0002B1 7CF2 7A               4      LD  A,D     ;HD US1 US0
0002B2 7CF3 E601             7      AND 1
0002B4 7CF5 87               4      ADD A,A
0002B5 7CF6 87               4      ADD A,A
0002B6 7CF7 B1               4      OR  C
0002B7 7CF8 E7              12      RST 20H
0002B8 7CF9 7A               4      LD  A,D     ;C
0002B9 7CFA CB3F             8      SRL A
0002BB 7CFC E7              12      RST 20H
0002BC 7CFD 7A               4      LD  A,D     ;H
0002BD 7CFE E601             7      AND 1
0002BF 7D00 E7              12      RST 20H
0002C0 7D01 7B               4      LD  A,E     ;R
0002C1 7D02 E7              12      RST 20H
0002C2 7D03 3AF37D          13      LD  A,(S_PARAMS+5)  ;N
0002C5 7D06 FE04             7      CP  4
0002C7 7D08 3802            12      JR  C,FDCOMMAND2
                                
0002C9 7D0A 3E03             7      LD  A,3
       7D0C                     FDCOMMAND2:
0002CB 7D0C 1E20             7      LD  E,020H      ;NO SERVICE
0002CD 7D0E E7              12      RST 20H
                                
0002CE 7D0F 210040          10      LD  HL,DSS_DATA ;開始アドレス
0002D1 7D12 78               4      LD  A,B     ;EOT
0002D2 7D13 E7              12      RST 20H
                                
0002D3 7D14 01FB00          10      LD  BC,000FBH   ;B:バイト数L C:FDC μPD765A データレジスタ
0002D6 7D17 3E54             7      LD  A,054H      ;GSL
0002D8 7D19 E7              12      RST 20H
                                
0002D9 7D1A 3AF47D          13      LD  A,(S_PARAMS+6)
0002DC 7D1D 57               4      LD  D,A     ;バイト数H
                                
0002DD 7D1E AF               4      XOR A       ;DTL
0002DE 7D1F E7              12      RST 20H
0002DF 7D20 A7               4      AND A
0002E0 7D21 C9              10      RET
                                
       7D22                     RDDISK1:            ;高速化の為にループ展開x8
0002E1 7D22 FB               4      EI
0002E2 7D23 76               4      HALT
0002E3 7D24 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002E5 7D26 A3               4      AND E       ;NO SERVICE
0002E6 7D27 C8              11      RET Z
0002E7 7D28 EDA2            16      INI
                                
0002E9 7D2A FB               4      EI
0002EA 7D2B 76               4      HALT
0002EB 7D2C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002ED 7D2E A3               4      AND E       ;NO SERVICE
0002EE 7D2F C8              11      RET Z
0002EF 7D30 EDA2            16      INI
                                
0002F1 7D32 FB               4      EI
0002F2 7D33 76               4      HALT
0002F3 7D34 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002F5 7D36 A3               4      AND E       ;NO SERVICE
0002F6 7D37 C8              11      RET Z
0002F7 7D38 EDA2            16      INI
                                
0002F9 7D3A FB               4      EI
0002FA 7D3B 76               4      HALT
0002FB 7D3C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0002FD 7D3E A3               4      AND E       ;NO SERVICE
0002FE 7D3F C8              11      RET Z
0002FF 7D40 EDA2            16      INI
                                
000301 7D42 FB               4      EI
000302 7D43 76               4      HALT
000303 7D44 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000305 7D46 A3               4      AND E       ;NO SERVICE
000306 7D47 C8              11      RET Z
000307 7D48 EDA2            16      INI
                                
000309 7D4A FB               4      EI
00030A 7D4B 76               4      HALT
00030B 7D4C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00030D 7D4E A3               4      AND E       ;NO SERVICE
00030E 7D4F C8              11      RET Z
00030F 7D50 EDA2            16      INI
                                
000311 7D52 FB               4      EI
000312 7D53 76               4      HALT
000313 7D54 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000315 7D56 A3               4      AND E       ;NO SERVICE
000316 7D57 C8              11      RET Z
000317 7D58 EDA2            16      INI
                                
000319 7D5A FB               4      EI
00031A 7D5B 76               4      HALT
00031B 7D5C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00031D 7D5E A3               4      AND E       ;NO SERVICE
00031E 7D5F C8              11      RET Z
00031F 7D60 EDA2            16      INI
                                
000321 7D62 20BE            12      JR  NZ,RDDISK1
000323 7D64 15               4      DEC D
000324 7D65 C2227D          10      JP  NZ,RDDISK1
000327 7D68 C9              10      RET
                                
       7D69                     WRDISK1:            ;高速化の為にループ展開x8
000328 7D69 FB               4      EI
000329 7D6A 76               4      HALT
00032A 7D6B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00032C 7D6D A3               4      AND E
00032D 7D6E C8              11      RET Z
00032E 7D6F EDA3            16      OUTI
                                
000330 7D71 FB               4      EI
000331 7D72 76               4      HALT
000332 7D73 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000334 7D75 A3               4      AND E
000335 7D76 C8              11      RET Z
000336 7D77 EDA3            16      OUTI
                                
000338 7D79 FB               4      EI
000339 7D7A 76               4      HALT
00033A 7D7B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00033C 7D7D A3               4      AND E
00033D 7D7E C8              11      RET Z
00033E 7D7F EDA3            16      OUTI
                                
000340 7D81 FB               4      EI
000341 7D82 76               4      HALT
000342 7D83 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000344 7D85 A3               4      AND E
000345 7D86 C8              11      RET Z
000346 7D87 EDA3            16      OUTI
                                
000348 7D89 FB               4      EI
000349 7D8A 76               4      HALT
00034A 7D8B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00034C 7D8D A3               4      AND E
00034D 7D8E C8              11      RET Z
00034E 7D8F EDA3            16      OUTI
                                
000350 7D91 FB               4      EI
000351 7D92 76               4      HALT
000352 7D93 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000354 7D95 A3               4      AND E
000355 7D96 C8              11      RET Z
000356 7D97 EDA3            16      OUTI
                                
000358 7D99 FB               4      EI
000359 7D9A 76               4      HALT
00035A 7D9B DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
00035C 7D9D A3               4      AND E
00035D 7D9E C8              11      RET Z
00035E 7D9F EDA3            16      OUTI
                                
000360 7DA1 FB               4      EI
000361 7DA2 76               4      HALT
000362 7DA3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000364 7DA5 A3               4      AND E
000365 7DA6 C8              11      RET Z
000366 7DA7 EDA3            16      OUTI
                                
000368 7DA9 20BE            12      JR  NZ,WRDISK1
00036A 7DAB 15               4      DEC D
00036B 7DAC C2697D          10      JP  NZ,WRDISK1
00036E 7DAF C9              10      RET
                                
       7DB0                     RESULTEX:
00036F 7DB0 3AF67D          13      LD  A,(S_CMD_STATUS)
000372 7DB3 3C               4      INC A
000373 7DB4 2803            12      JR  Z,RESULTEX1
000375 7DB6 3AF47D          13      LD  A,(S_PARAMS+6)  ;バイト数H
       7DB9                     RESULTEX1:
000378 7DB9 DF              12      RST 18H
000379 7DBA C32A00          10      JP  MAIN
                                
       7DBD                     CHECKRESULT:
00037C 7DBD C5              11      PUSH    BC
00037D 7DBE CDE47D          17      CALL    RDFDC       ;ST0
000380 7DC1 E6D8             7      AND 0D8H
000382 7DC3 4F               4      LD  C,A
000383 7DC4 CDE47D          17      CALL    RDFDC       ;ST1
000386 7DC7 E6B7             7      AND 0B7H
000388 7DC9 B1               4      OR  C
000389 7DCA 4F               4      LD  C,A
00038A 7DCB CDE47D          17      CALL    RDFDC       ;ST2
00038D 7DCE E673             7      AND 073H
00038F 7DD0 B1               4      OR  C
000390 7DD1 4F               4      LD  C,A
000391 7DD2 0604             7      LD  B,4
       7DD4                     CHECKRESULT1:           ;C H R N
000393 7DD4 CDE47D          17      CALL    RDFDC
000396 7DD7 10FB            13      DJNZ    CHECKRESULT1
000398 7DD9 79               4      LD  A,C
000399 7DDA A7               4      AND A
00039A 7DDB C1              10      POP BC
00039B 7DDC C8              11      RET Z
00039C 7DDD 37               4      SCF
00039D 7DDE C9              10      RET
                                
       7DDF                     GETDEVSTAT:
00039E 7DDF 3E04             7      LD  A,4
0003A0 7DE1 E7              12      RST 20H
0003A1 7DE2 79               4      LD  A,C
0003A2 7DE3 E7              12      RST 20H
                                
       7DE4                     RDFDC:
0003A3 7DE4 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0003A5 7DE6 2F               4      CPL
0003A6 7DE7 E6C0             7      AND 0C0H        ;RQMとDIOが両方1になるまで待つ
0003A8 7DE9 20F9            12      JR  NZ,RDFDC
0003AA 7DEB DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタリード
0003AC 7DED C9              10      RET
                                
       7DEE                     S_PARAMS:
0003AD 7DEE                         DS  8
       7DF6                     S_CMD_STATUS:
0003B5 7DF6 00                      DB  0
       7DF7                     S_LEFT:
0003B6 7DF7 00                      DB  0
       7DF8                     S_WKF4:
0003B7 7DF8 00                      DB  0
                                
0003B8 CFB1                         ORG $$+OFFSET   ;$DEPHASE
       CFB1                     AT_DSSE:
                                
       CFB1                     INITE:
                                ;   ORG BDOS,INITE-OFFSET
0003B8 CFB1                         DS  BDOS-INITE
00040D D006 C3B8D8          10      JP  BDOS_RF
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D009                     WBOOT1:
000410 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000414 D00D DB32            11      IN  A,(032H)
000416 D00F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000418 D011 D332            11      OUT (032H),A
                                
00041A D013 3EEE             7      LD  A,IVRTC/256
00041C D015 ED47             9      LD  I,A
00041E D017 3AB8EF          13      LD  A,(WKE6)
000421 D01A F602             7      OR  2       ;VRTC割り込みマスク
000423 D01C D3E6            11      OUT (0E6H),A    ;割り込みマスク
000425 D01E 32B8EF          13      LD  (WKE6),A
000428 D021 3AB7EF          13      LD  A,(WKE4)
00042B D024 D3E4            11      OUT (0E4H),A    ;割り込みレベル設定 
                                
00042D D026 FB               4      EI
00042E D027 2192EF          10      LD  HL,_KEYD
000431 D02A 3600            10      LD  (HL),0
000433 D02C CD1ADD          17      CALL    CHKEY
000436 D02F CD0DD9          17      CALL    KEYBC_IFBREAK
000439 D032 3E04             7      LD  A,4
00043B D034 CD20D9          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D037                     COMMAND:
00043E D037 CDEAD0          17      CALL    SETDTA1
000441 D03A 3A87EF          13      LD  A,(_DVSW)
000444 D03D C641             7      ADD A,'A'
000446 D03F CD20D9          17      CALL    MSG_A
000449 D042 3E3E             7      LD  A,'>'
00044B D044 CD20D9          17      CALL    MSG_A
00044E D047 3E50             7      LD  A,80
000450 D049 12               7      LD  (DE),A
000451 D04A CD5ED9          17      CALL    _SYS0A      ;(BDOS)文字列入力
000454 D04D CD94D2          17      CALL    LTNL
                                
000457 D050 118200          10      LD  DE,DTA1+2
00045A D053 CDFDEF          17      CALL    _COMANL
00045D D056 30DF            12      JR  NC,COMMAND
00045F D058 1179EF          10      LD  DE,COMERM
000462 D05B CD20D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000465 D05E C7              12      RST 0
                                
       D05F                     COMANL:
000466 D05F CD15DE          17      CALL    FILE
000469 D062 3A19EF          13      LD  A,(FNAME+4)
00046C D065 FE20             7      CP  020H
00046E D067 201C            12      JR  NZ,COMB2
000470 D069 D5              11      PUSH    DE
000471 D06A 1115EF          10      LD  DE,FNAME
000474 D06D 1A               7      LD  A,(DE)
000475 D06E FE20             7      CP  020H
000477 D070 2844            12      JR  Z,SDVSW
000479 D072 1B               6      DEC DE
00047A D073 1A               7      LD  A,(DE)
00047B D074 C6FF             7      ADD A,0FFH
00047D D076 3809            12      JR  C,COMB
00047F D078 13               6      INC DE
                                
000480 D079 2175D5          10      LD  HL,COMTB
000483 D07C 0609             7      LD  B,COMS
000485 D07E CD99E0          17      CALL    CPNAME
       D081                     COMB:
000488 D081 D1              10      POP DE
000489 D082 D20F00          10      JP  NC,JP_HL
       D085                     COMB2:
00048C D085 EB               4      EX  DE,HL
00048D D086 225ED1          16      LD  (COMPAT+1),HL
000490 D089 F5              11      PUSH    AF
000491 D08A CD0AD1          17      CALL    CEXE4
000494 D08D F1              10      POP AF
000495 D08E 2115EF          10      LD  HL,FNAME
000498 D091 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00049B D094 010B00          10      LD  BC,11
00049E D097 EDB0                    LDIR
0004A0 D099 1118D5          10      LD  DE,PATHD
       D09C                     CEX1:
0004A3 D09C 1A               7      LD  A,(DE)
0004A4 D09D FE20             7      CP  020H
0004A6 D09F D8              11      RET C
0004A7 D0A0 CD0ADE          17      CALL    FILEC
0004AA D0A3 D5              11      PUSH    DE
0004AB D0A4 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
0004AE D0A7 1115EF          10      LD  DE,FNAME
0004B1 D0AA 010B00          10      LD  BC,11
0004B4 D0AD EDB0                    LDIR
0004B6 D0AF CD0AD1          17      CALL    CEXE4
0004B9 D0B2 D1              10      POP DE
0004BA D0B3 13               6      INC DE
0004BB D0B4 18E6            12      JR  CEX1
                                
       D0B6                     SDVSW:
0004BD D0B6 F1              10      POP AF
0004BE D0B7 3A14EF          13      LD  A,(FDRV)
0004C1 D0BA 3D               4      DEC A
0004C2 D0BB 5F               4      LD  E,A
0004C3 D0BC 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0004C5 D0BE 1831            12      JR  SYSTEM0
                                
       D0C0                     OPEN1:
0004C7 D0C0 2114EF          10      LD  HL,FDRV
       D0C3                     OPEN:
0004CA D0C3 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0C5                     OPEN3:
0004CC D0C5 D5              11      PUSH    DE
0004CD D0C6 11F3D4          10      LD  DE,DTA_CCP
0004D0 D0C9 CDE7D0          17      CALL    SETDTA
0004D3 D0CC EB               4      EX  DE,HL
0004D4 D0CD CDF1D0          17      CALL    SYSTEM0
0004D7 D0D0 D1              10      POP DE
0004D8 D0D1 C9              10      RET
                                
       D0D2                     OPEN2:
0004D9 D0D2 0E12             7      LD  C,012H
0004DB D0D4 18EF            12      JR  OPEN3
                                
       D0D6                     DEFCB:              ;Z=Ok NZ=Error
0004DD D0D6 11F3D4          10      LD  DE,DTA_CCP
0004E0 D0D9 CDEFD0          17      CALL    SYSC0F
                                
0004E3 D0DC 1114D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004E6 D0DF 0604             7      LD  B,4
0004E8 D0E1 CDD2D3          17      CALL    ZERO_MEMORY_DE
0004EB D0E4 110001          10      LD  DE,00100H
       D0E7                     SETDTA:
0004EE D0E7 C3FAD7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0EA                     SETDTA1:
0004F1 D0EA 118000          10      LD  DE,DTA1
0004F4 D0ED 18F8            12      JR  SETDTA
                                
       D0EF                     SYSC0F:
0004F6 D0EF 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0F1                     SYSTEM0:
0004F8 D0F1 CD0500          17      CALL    SYSTEM
0004FB D0F4 B7               4      OR  A
0004FC D0F5 C9              10      RET
                                
       D0F6                     C_CD:
0004FD D0F6 0E5A             7      LD  C,5AH
0004FF D0F8 18F7            12      JR  SYSTEM0
                                
       D0FA                     S27BUF:
000501 D0FA 3A0700          13      LD  A,(SYSTEM+2)
000504 D0FD 3D               4      DEC A
000505 D0FE E6F8             7      AND 0F8H
000507 D100 67               4      LD  H,A
000508 D101 2E00             7      LD  L,0
       D103                     S27DTA:
00050A D103 11F3D4          10      LD  DE,DTA_CCP
       D106                     S27:
00050D D106 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
00050F D108 18E7            12      JR  SYSTEM0
                                
       D10A                     CEXE4:
000511 D10A 3A14EF          13      LD  A,(FDRV)
000514 D10D 325700          13      LD  (00057H),A
000517 D110 2A22EF          16      LD  HL,(FDRV+14)
00051A D113 225800          16      LD  (00058H),HL
                                
00051D D116 211DEF          10      LD  HL,FNAME+8
000520 D119 7E               7      LD  A,(HL)
000521 D11A FE20             7      CP  020H
000523 D11C 2007            12      JR  NZ,CEXE7
000525 D11E 3E3F             7      LD  A,'?'
000527 D120 77               7      LD  (HL),A
000528 D121 23               6      INC HL
000529 D122 77               7      LD  (HL),A
00052A D123 23               6      INC HL
00052B D124 77               7      LD  (HL),A
       D125                     CEXE7:
00052C D125 CDC0D0          17      CALL    OPEN1
       D128                     CEXE5:
00052F D128 C0              11      RET NZ
000530 D129 2AFDD4          16      LD  HL,(DTA_CCP+1+9)
000533 D12C 7C               4      LD  A,H
000534 D12D CD21E1          17      CALL    CAP
000537 D130 67               4      LD  H,A
000538 D131 7D               4      LD  A,L
000539 D132 CD21E1          17      CALL    CAP
00053C D135 6F               4      LD  L,A
00053D D136 3AFCD4          13      LD  A,(DTA_CCP+1+8)
000540 D139 CD21E1          17      CALL    CAP
000543 D13C D642             7      SUB 'B'
000545 D13E 282C            12      JR  Z,C_BAT
000547 D140 3D               4      DEC A       ;'C'
000548 D141 2805            12      JR  Z,C_EXE
       D143                     CEXE6:
00054A D143 CDD2D0          17      CALL    OPEN2
00054D D146 18E0            12      JR  CEXE5
                                
       D148                     C_EXE:
00054F D148 7C               4      LD  A,H
000550 D149 FE4D             7      CP  'M'
000552 D14B 20F6            12      JR  NZ,CEXE6
                                
000554 D14D CDD6D0          17      CALL    DEFCB
000557 D150 CDFAD0          17      CALL    S27BUF
00055A D153 3D               4      DEC A
00055B D154 37               4      SCF
00055C D155 C0              11      RET NZ
00055D D156 7C               4      LD  A,H
00055E D157 B5               4      OR  L
00055F D158 37               4      SCF
000560 D159 C8              11      RET Z
000561 D15A CDEAD0          17      CALL    SETDTA1
000564 D15D 110000          10  COMPAT: LD  DE,0                ; self-modifying code
000567 D160 ED7B0600        20      LD  SP,(SYSTEM+1)
00056B D164 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
00056C D165 6F               4      LD  L,A
00056D D166 E5              11      PUSH    HL              ; push $0000 (reboot address)
00056E D167 24               4      INC H
00056F D168 E5              11      PUSH    HL              ; push $0100 (TPA address)
000570 D169 C39DD3          10      JP  SETFCB              ; and JP $0100
                                
       D16C                     C_BAT:
000573 D16C 114154          10      LD  DE,'A'+'T'*256
000576 D16F ED52            15      SBC HL,DE
000578 D171 20D0            12      JR  NZ,CEXE6
                                
00057A D173 F1              10      POP AF
00057B D174 F1              10      POP AF
00057C D175 CDD6D0          17      CALL    DEFCB
00057F D178 210002          10      LD  HL,00200H
000582 D17B CD03D1          17      CALL    S27DTA
000585 D17E C6FE             7      ADD A,0FEH
000587 D180 D8              11      RET C
000588 D181 7D               4      LD  A,L
000589 D182 B7               4      OR  A
00058A D183 37               4      SCF
00058B D184 C8              11      RET Z
00058C D185 3C               4      INC A
00058D D186 F5              11      PUSH    AF
                                
00058E D187 CD10D9          17      CALL    KEYBC
000591 D18A 3E06             7      LD  A,6
000593 D18C CD20D9          17      CALL    MSG_A
000596 D18F C1              10      POP BC
000597 D190 210001          10      LD  HL,00100H
       D193                     BAT1:
00059A D193 A7               4      AND A
00059B D194 05               4      DEC B
00059C D195 C8              11      RET Z
00059D D196 7E               7      LD  A,(HL)
00059E D197 FE25             7      CP  '%'
0005A0 D199 280C            12      JR  Z,BAT2
       D19B                     BAT1X:
0005A2 D19B 7E               7      LD  A,(HL)
0005A3 D19C 23               6      INC HL
0005A4 D19D FE1A             7      CP  01AH
0005A6 D19F C8              11      RET Z
0005A7 D1A0 FE0A             7      CP  00AH
0005A9 D1A2 C4F5D8          17      CALL    NZ,KEYBS
0005AC D1A5 18EC            12      JR  BAT1
                                
       D1A7                     BAT2:
0005AE D1A7 23               6      INC HL
0005AF D1A8 7E               7      LD  A,(HL)
0005B0 D1A9 2B               6      DEC HL
0005B1 D1AA D631             7      SUB '1'
0005B3 D1AC 38ED            12      JR  C,BAT1X
0005B5 D1AE FE09             7      CP  9
0005B7 D1B0 30E9            12      JR  NC,BAT1X
0005B9 D1B2 23               6      INC HL
0005BA D1B3 23               6      INC HL
0005BB D1B4 3C               4      INC A
0005BC D1B5 4F               4      LD  C,A
0005BD D1B6 ED5B5ED1        20      LD  DE,(COMPAT+1)
       D1BA                     BAT3:
0005C1 D1BA 1A               7      LD  A,(DE)
0005C2 D1BB B7               4      OR  A
0005C3 D1BC 28D5            12      JR  Z,BAT1
0005C5 D1BE CDECDE          17      CALL    SPCUT
0005C8 D1C1 0D               4      DEC C
0005C9 D1C2 2808            12      JR  Z,BAT5
       D1C4                     BAT4:
0005CB D1C4 1A               7      LD  A,(DE)
0005CC D1C5 FE21             7      CP  021H
0005CE D1C7 38F1            12      JR  C,BAT3
0005D0 D1C9 13               6      INC DE
0005D1 D1CA 18F8            12      JR  BAT4
       D1CC                     BAT5:
0005D3 D1CC 1A               7      LD  A,(DE)
0005D4 D1CD FE21             7      CP  021H
0005D6 D1CF 38C2            12      JR  C,BAT1
0005D8 D1D1 13               6      INC DE
0005D9 D1D2 CDF5D8          17      CALL    KEYBS
0005DC D1D5 18F5            12      JR  BAT5
                                
       D1D7                     C_DEL:
0005DE D1D7 CD9DD3          17      CALL    SETFCB
0005E1 D1DA CD36D9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0005E4 D1DD 0E13             7      LD  C,013H
0005E6 D1DF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1E1                     C_REN:
0005E8 D1E1 CD9DD3          17      CALL    SETFCB
0005EB D1E4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0005ED D1E6 326900          13      LD  (FCB1+13),A ;属性
0005F0 D1E9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1EB                     CDEL1:
0005F2 D1EB 115C00          10      LD  DE,FCB1
0005F5 D1EE CD0500          17      CALL    SYSTEM
0005F8 D1F1 C6FF             7      ADD A,0FFH
0005FA D1F3 C9              10      RET
                                
       D1F4                     C_DIR:
0005FB D1F4 CD0ADE          17      CALL    FILEC
0005FE D1F7 2115EF          10      LD  HL,FDRV+1
000601 D1FA CDE8D4          17      CALL    CWILD1
000604 D1FD 3EF1             7      LD  A,0F1H
000606 D1FF 3221EF          13      LD  (FDRV+13),A
000609 D202 CDC0D0          17      CALL    OPEN1
       D205                     CDIR1:
00060C D205 B7               4      OR  A
00060D D206 2008            12      JR  NZ,PDSKF
00060F D208 CD53D2          17      CALL    P_NAME
000612 D20B CDD2D0          17      CALL    OPEN2
000615 D20E 18F5            12      JR  CDIR1
                                
       D210                     PDSKF:
000617 D210 3A14EF          13      LD  A,(FDRV)
00061A D213 5F               4      LD  E,A
00061B D214 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00061D D216 CD0500          17      CALL    SYSTEM
000620 D219 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000621 D21A C601             7      ADD A,001H
000623 D21C D8              11      RET C       ;Aが0FFHだった場合
000624 D21D 3E06             7      LD  A,8-2
       D21F                     PDS1:               ;HL=未使用クラスタの総数
000626 D21F 3C               4      INC A
000627 D220 CB19             8      RR  C
000629 D222 30FB            12      JR  NC,PDS1
       D224                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00062B D224 3C               4      INC A
00062C D225 CB18             8      RR  B
00062E D227 30FB            12      JR  NC,PDS2
000630 D229 47               4      LD  B,A
                                
000631 D22A 110000          10      LD  DE,0
       D22D                     PDS3:
000634 D22D 29              11      ADD HL,HL
000635 D22E EB               4      EX  DE,HL
000636 D22F ED6A            15      ADC HL,HL
000638 D231 EB               4      EX  DE,HL
000639 D232 10F9            13      DJNZ    PDS3
       D234                     PDSKF1:
00063B D234 CDCCD2          17      CALL    PRDEC_DEHL
00063E D237 1159D5          10      LD  DE,FREE
000641 D23A CD20D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000644 D23D CDBBD2          17      CALL    PUTDRV
000647 D240 3E5C             7      LD  A,05CH      ;\
000649 D242 CD20D9          17      CALL    MSG_A
00064C D245 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
00064F D248 AF               4      XOR A
000650 D249 11FEFF          10      LD  DE,0-2
000653 D24C 19              11      ADD HL,DE
000654 D24D 23               6      INC HL
000655 D24E DCC8D2          17      CALL    C,PRDEC_HL
000658 D251 1841            12      JR  LTNL
                                
       D253                     P_NAME:
00065A D253 3AF4D4          13      LD  A,(DTA_CCP+1)
00065D D256 FE2E             7      CP  '.'
00065F D258 C8              11      RET Z
000660 D259 1171D5          10      LD  DE,DIRHD
000663 D25C CD20D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000666 D25F 3AFFD4          13      LD  A,(DTA_CCP+1+00BH)
000669 D262 F5              11      PUSH    AF
00066A D263 0F               4      RRCA
00066B D264 9F               4      SBC A,A
00066C D265 E60A             7      AND '*'-020H
00066E D267 C620             7      ADD A,020H
000670 D269 CD20D9          17      CALL    MSG_A
000673 D26C CDBBD2          17      CALL    PUTDRV
000676 D26F 21F4D4          10      LD  HL,DTA_CCP+1
000679 D272 CD0CD3          17      CALL    FPRNT
                                
00067C D275 F1              10      POP AF
00067D D276 CB67             8      BIT 4,A
00067F D278 2808            12      JR  Z,DIR3
000681 D27A 1166D5          10      LD  DE,DIRMES
000684 D27D CD20D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000687 D280 180A            12      JR  DIR6
       D282                     DIR3:
000689 D282 ED5B12D5        20      LD  DE,(DTA_CCP+1+01EH)
00068D D286 2A10D5          16      LD  HL,(DTA_CCP+1+01CH)
000690 D289 CDCCD2          17      CALL    PRDEC_DEHL
       D28C                     DIR6:
000693 D28C 3AB1EF          13      LD  A,(_WIDTH)
000696 D28F FE29             7      CP  40+1
000698 D291 D42ED3          17      CALL    NC,PRTTMS
                                
       D294                     LTNL:
00069B D294 1E03             7      LD  E,3
00069D D296 C3CDEF          10      JP  _PRINT
                                
       D299                     C_PATH:
0006A0 D299 CDECDE          17      CALL    SPCUT
0006A3 D29C 2118D5          10      LD  HL,PATHD
0006A6 D29F FE21             7      CP  021H
0006A8 D2A1 300C            12      JR  NC,CPATH0
       D2A3                     CPATHP:
0006AA D2A3 7E               7      LD  A,(HL)
0006AB D2A4 23               6      INC HL
0006AC D2A5 FE20             7      CP  020H
0006AE D2A7 3F               4      CCF
0006AF D2A8 30EA            12      JR  NC,LTNL
0006B1 D2AA CD20D9          17      CALL    MSG_A
0006B4 D2AD 18F4            12      JR  CPATHP
       D2AF                     CPATH0:
0006B6 D2AF FE3B             7      CP  ';'
0006B8 D2B1 2001            12      JR  NZ,CPATH1
0006BA D2B3 13               6      INC DE
       D2B4                     CPATH1:
0006BB D2B4 EB               4      EX  DE,HL
0006BC D2B5 014000          10      LD  BC,PATHX
0006BF D2B8 EDB0                    LDIR
0006C1 D2BA C9              10      RET
                                
       D2BB                     PUTDRV:
0006C2 D2BB 3A14EF          13      LD  A,(FDRV)
0006C5 D2BE C640             7      ADD A,'A'-1
0006C7 D2C0 CD20D9          17      CALL    MSG_A
0006CA D2C3 3E3A             7      LD  A,':'
       D2C5                     MSG_AR:
0006CC D2C5 C320D9          10      JP  MSG_A
                                
       D2C8                     PRDEC_HL:
0006CF D2C8 AF               4      XOR A
       D2C9                     PRDEC_AHL:
0006D0 D2C9 5F               4      LD  E,A
0006D1 D2CA 1600             7      LD  D,0
       D2CC                     PRDEC_DEHL:
0006D3 D2CC D5              11      PUSH    DE
0006D4 D2CD 110FEF          10      LD  DE,DECBF
0006D7 D2D0 0605             7      LD  B,5
0006D9 D2D2 CDD2D3          17      CALL    ZERO_MEMORY_DE  ;A=0
0006DC D2D5 D1              10      POP DE
                                
0006DD D2D6 0E20             7      LD  C,32
       D2D8                     DEC1:
0006DF D2D8 29              11      ADD HL,HL
0006E0 D2D9 EB               4      EX  DE,HL
0006E1 D2DA ED6A            15      ADC HL,HL
0006E3 D2DC EB               4      EX  DE,HL
0006E4 D2DD E5              11      PUSH    HL
0006E5 D2DE 2113EF          10      LD  HL,DECBF+4
0006E8 D2E1 0605             7      LD  B,5
       D2E3                     DEC2:
0006EA D2E3 7E               7      LD  A,(HL)
0006EB D2E4 8F               4      ADC A,A
0006EC D2E5 27               4      DAA
0006ED D2E6 77               7      LD  (HL),A
0006EE D2E7 2B               6      DEC HL
0006EF D2E8 10F9            13      DJNZ    DEC2
0006F1 D2EA E1              10      POP HL
0006F2 D2EB 0D               4      DEC C
0006F3 D2EC 20EA            12      JR  NZ,DEC1
                                
0006F5 D2EE 210FEF          10      LD  HL,DECBF
0006F8 D2F1 3E20             7      LD  A,020H
0006FA D2F3 0604             7      LD  B,4
       D2F5                     DEC3:
0006FC D2F5 CD02D3          17      CALL    DEC4
0006FF D2F8 CD02D3          17      CALL    DEC4
000702 D2FB 23               6      INC HL
000703 D2FC 10F7            13      DJNZ    DEC3
       D2FE                     DECX:
000705 D2FE CD02D3          17      CALL    DEC4
000708 D301 AF               4      XOR A
       D302                     DEC4:
000709 D302 ED6F            18      RLD
00070B D304 FE20             7      CP  020H
00070D D306 2802            12      JR  Z,DEC5
00070F D308 F630             7      OR  030H
       D30A                     DEC5:
000711 D30A 18B9            12      JR  MSG_AR
                                
       D30C                     FPRNT:
000713 D30C 0608             7      LD  B,8
000715 D30E CD1FD3          17      CALL    P_N1
000718 D311 7E               7      LD  A,(HL)
000719 D312 C680             7      ADD A,0A0H-020H
00071B D314 FEA0             7      CP  0A0H
00071D D316 2802            12      JR  Z,FPR1
00071F D318 3E2E             7      LD  A,'.'
       D31A                     FPR1:
000721 D31A CD20D9          17      CALL    MSG_A
000724 D31D 0603             7      LD  B,3
                                
       D31F                     P_N1:
000726 D31F C5              11      PUSH    BC
000727 D320 E5              11      PUSH    HL
000728 D321 7E               7      LD  A,(HL)
000729 D322 CD2DE1          17      CALL    CAP3
00072C D325 CD20D9          17      CALL    MSG_A
00072F D328 E1              10      POP HL
000730 D329 C1              10      POP BC
000731 D32A 23               6      INC HL
000732 D32B 10F2            13      DJNZ    P_N1
000734 D32D C9              10      RET
                                
       D32E                     PRTTMS:
000735 D32E 3E20             7      LD  A,020H
000737 D330 CD20D9          17      CALL    MSG_A
                                
00073A D333 2A0CD5          16      LD  HL,(DTA_CCP+1+24)
00073D D336 7D               4      LD  A,L
00073E D337 B7               4      OR  A
00073F D338 C8              11      RET Z
000740 D339 CB3C             8      SRL H
000742 D33B 17               4      RLA
000743 D33C 17               4      RLA
000744 D33D 17               4      RLA
000745 D33E 17               4      RLA
000746 D33F E60F             7      AND 00FH
000748 D341 57               4      LD  D,A
000749 D342 7C               4      LD  A,H
00074A D343 C650             7      ADD A,80
00074C D345 CD88D3          17      CALL    PRDEC_A
00074F D348 3E2D             7      LD  A,'-'
000751 D34A CD20D9          17      CALL    MSG_A
000754 D34D 7A               4      LD  A,D
000755 D34E CD88D3          17      CALL    PRDEC_A
000758 D351 3E2D             7      LD  A,'-'
00075A D353 CD20D9          17      CALL    MSG_A
00075D D356 7D               4      LD  A,L
00075E D357 E61F             7      AND 01FH
000760 D359 CD88D3          17      CALL    PRDEC_A
                                
000763 D35C 2A0AD5          16      LD  HL,(DTA_CCP+1+22)
                                
000766 D35F 3E20             7      LD  A,020H
000768 D361 CD20D9          17      CALL    MSG_A
00076B D364 7C               4      LD  A,H
00076C D365 65               4      LD  H,L
00076D D366 0603             7      LD  B,3
       D368                     PRTTMS1:
00076F D368 1F               4      RRA
000770 D369 CB1D             8      RR  L
000772 D36B 10FB            13      DJNZ    PRTTMS1
000774 D36D E61F             7      AND 01FH
000776 D36F CD88D3          17      CALL    PRDEC_A
000779 D372 3E3A             7      LD  A,':'
00077B D374 CD20D9          17      CALL    MSG_A
00077E D377 7D               4      LD  A,L
00077F D378 0F               4      RRCA
000780 D379 0F               4      RRCA
000781 D37A E63F             7      AND 03FH
000783 D37C CD88D3          17      CALL    PRDEC_A
000786 D37F 3E3A             7      LD  A,':'
000788 D381 CD20D9          17      CALL    MSG_A
00078B D384 7C               4      LD  A,H
00078C D385 E61F             7      AND 01FH
00078E D387 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D388                     PRDEC_A:
00078F D388 E5              11      PUSH    HL
000790 D389 0608             7      LD  B,8
000792 D38B 4F               4      LD  C,A
000793 D38C AF               4      XOR A
       D38D                     PRTA1:
000794 D38D CB01             4      RLC C
000796 D38F 8F               4      ADC A,A
000797 D390 27               4      DAA
000798 D391 10FA            13      DJNZ    PRTA1
00079A D393 210FEF          10      LD  HL,DECBF
00079D D396 77               7      LD  (HL),A
00079E D397 AF               4      XOR A
00079F D398 CDFED2          17      CALL    DECX
0007A2 D39B E1              10      POP HL
0007A3 D39C C9              10      RET
                                
       D39D                     SETFCB:
0007A4 D39D CDECDE          17      CALL    SPCUT
0007A7 D3A0 1A               7      LD  A,(DE)
0007A8 D3A1 FE20             7      CP  020H
0007AA D3A3 3801            12      JR  C,SETFCBA
0007AC D3A5 1B               6      DEC DE
       D3A6                     SETFCBA:
0007AD D3A6 0624             7      LD  B,36
0007AF D3A8 215C00          10      LD  HL,FCB1
0007B2 D3AB E5              11      PUSH    HL
0007B3 D3AC AF               4      XOR A
0007B4 D3AD CDC1DE          17      CALL    FILL_MEMORY
0007B7 D3B0 E1              10      POP HL
0007B8 D3B1 D5              11      PUSH    DE
0007B9 D3B2 CD60D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007BC D3B5 216C00          10      LD  HL,FCB2
0007BF D3B8 CD60D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007C2 D3BB E1              10      POP HL
0007C3 D3BC 010050          10      LD  BC,05000H
0007C6 D3BF 118100          10      LD  DE,00081H
       D3C2                     SETFCB1:
0007C9 D3C2 7E               7      LD  A,(HL)
0007CA D3C3 23               6      INC HL
0007CB D3C4 FE20             7      CP  020H
0007CD D3C6 3805            12      JR  C,SETFCB2
0007CF D3C8 12               7      LD  (DE),A
0007D0 D3C9 13               6      INC DE
0007D1 D3CA 0C               4      INC C
0007D2 D3CB 10F5            13      DJNZ    SETFCB1
       D3CD                     SETFCB2:
0007D4 D3CD 79               4      LD  A,C
0007D5 D3CE 328000          13      LD  (DTA1),A
0007D8 D3D1 04               4      INC B
       D3D2                     ZERO_MEMORY_DE:
0007D9 D3D2 AF               4      XOR A
       D3D3                     FILL_MEMORY_DE:
0007DA D3D3 12               7      LD  (DE),A
0007DB D3D4 13               6      INC DE
0007DC D3D5 10FC            13      DJNZ    FILL_MEMORY_DE
0007DE D3D7 C9              10      RET
                                
       D3D8                     C_COPY:
0007DF D3D8 CD9DD3          17      CALL    SETFCB
                                
0007E2 D3DB 1161EF          10      LD  DE,ZERO
0007E5 D3DE CD0DDE          17      CALL    FILEC2
0007E8 D3E1 216C00          10      LD  HL,FCB2
0007EB D3E4 CD67D8          17      CALL    S29X1
                                
0007EE D3E7 3E10             7      LD  A,010H
0007F0 D3E9 326900          13      LD  (FCB1+13),A
0007F3 D3EC 216D00          10      LD  HL,FCB2+1
0007F6 D3EF CDE8D4          17      CALL    CWILD1
       D3F2                     COPY0:
0007F9 D3F2 CDE5D4          17      CALL    CWILD
0007FC D3F5 215C00          10      LD  HL,FCB1
0007FF D3F8 CDC3D0          17      CALL    OPEN
000802 D3FB 37               4      SCF
       D3FC                     COPY1:
000803 D3FC C0              11      RET NZ
000804 D3FD CDD6D0          17      CALL    DEFCB
                                
000807 D400 3A00D5          13      LD  A,(DTA_CCP+13)
00080A D403 CB67             8      BIT 4,A
00080C D405 2821            12      JR  Z,COPY1A
                                
00080E D407 215D00          10      LD  HL,FCB1+1
000811 D40A CD50E2          17      CALL    CHKWILD
000814 D40D 3814            12      JR  C,COPY9
                                
000816 D40F 3E20             7      LD  A,020H
000818 D411 325D00          13      LD  (FCB1+1),A
00081B D414 2A0DD5          16      LD  HL,(DTA_CCP+26)
00081E D417 23               6      INC HL
00081F D418 226A00          16      LD  (FCB1+14),HL
000822 D41B 18D5            12      JR  COPY0
                                
       D41D                     COPY8:
000824 D41D CD20D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000827 D420 CD94D2          17      CALL    LTNL
       D423                     COPY9:
00082A D423 CDD2D0          17      CALL    OPEN2
00082D D426 18D4            12      JR  COPY1
                                
       D428                     COPY1A:
00082F D428 216C00          10      LD  HL,FCB2
000832 D42B 1114EF          10      LD  DE,FDRV
000835 D42E 01F5D4          10      LD  BC,DTA_CCP+2
000838 D431 EDA0            16      LDI
00083A D433 3E0B             7      LD  A,11
       D435                     COPY2:
00083C D435 F5              11      PUSH    AF
00083D D436 7E               7      LD  A,(HL)
00083E D437 FE3F             7      CP  '?'
000840 D439 2001            12      JR  NZ,COPY3
000842 D43B 0A               7      LD  A,(BC)
       D43C                     COPY3:
000843 D43C 12               7      LD  (DE),A
000844 D43D 03               6      INC BC
000845 D43E 13               6      INC DE
000846 D43F 23               6      INC HL
000847 D440 F1              10      POP AF
000848 D441 3D               4      DEC A
000849 D442 20F1            12      JR  NZ,COPY2
00084B D444 010500          10      LD  BC,16-11
00084E D447 EDB0                    LDIR
       D449                     PUTNAME:
000850 D449 215D00          10      LD  HL,FCB1+1
000853 D44C CD50E2          17      CALL    CHKWILD
000856 D44F 300B            12      JR  NC,PUTN1
000858 D451 2115EF          10      LD  HL,FDRV+1
00085B D454 CD0CD3          17      CALL    FPRNT
00085E D457 3E20             7      LD  A,020H
000860 D459 CD20D9          17      CALL    MSG_A
       D45C                     PUTN1:
000863 D45C 1114EF          10      LD  DE,FDRV
000866 D45F 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000868 D461 CDF1D0          17      CALL    SYSTEM0
00086B D464 2048            12      JR  NZ,COPYE2
00086D D466 67               4      LD  H,A     ;A=0
00086E D467 6F               4      LD  L,A
00086F D468 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000872 D46B 2237EF          16      LD  (FDRV+35),HL
       D46E                     COPY6:
000875 D46E CDFAD0          17      CALL    S27BUF
000878 D471 47               4      LD  B,A
000879 D472 3C               4      INC A
00087A D473 2831            12      JR  Z,COPYE
00087C D475 7C               4      LD  A,H
00087D D476 B5               4      OR  L
00087E D477 280C            12      JR  Z,COPY7
000880 D479 1114EF          10      LD  DE,FDRV
000883 D47C 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000885 D47E CDF1D0          17      CALL    SYSTEM0
000888 D481 2023            12      JR  NZ,COPYE
00088A D483 10E9            13      DJNZ    COPY6
       D485                     COPY7:
00088C D485 3A00D5          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
00088F D488 3221EF          13      LD  (FDRV+13),A
000892 D48B 2107D5          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000895 D48E 1128EF          10      LD  DE,FDRV+20
000898 D491 010400          10      LD  BC,4
00089B D494 EDB0                    LDIR
                                
00089D D496 1114EF          10      LD  DE,FDRV
0008A0 D499 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0008A2 D49B CDF1D0          17      CALL    SYSTEM0
0008A5 D49E 2006            12      JR  NZ,COPYE
                                
0008A7 D4A0 1171EF          10      LD  DE,OK
0008AA D4A3 C31DD4          10      JP  COPY8
                                
       D4A6                     COPYE:
0008AD D4A6 1114EF          10      LD  DE,FDRV
0008B0 D4A9 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0008B2 D4AB CD0500          17      CALL    SYSTEM
       D4AE                     COPYE2:
0008B5 D4AE 37               4      SCF
0008B6 D4AF C9              10      RET
                                
       D4B0                     C_TYPE:
0008B7 D4B0 CD9DD3          17      CALL    SETFCB
0008BA D4B3 215C00          10      LD  HL,FCB1
0008BD D4B6 CDC3D0          17      CALL    OPEN
0008C0 D4B9 37               4      SCF
       D4BA                     TYPE1:
0008C1 D4BA C0              11      RET NZ
0008C2 D4BB CDD6D0          17      CALL    DEFCB
0008C5 D4BE 3E06             7      LD  A,6
0008C7 D4C0 CD20D9          17      CALL    MSG_A
       D4C3                     TYPE2:
0008CA D4C3 CDFAD0          17      CALL    S27BUF
0008CD D4C6 C6FE             7      ADD A,0FEH
0008CF D4C8 D8              11      RET C
0008D0 D4C9 7C               4      LD  A,H
0008D1 D4CA B5               4      OR  L
0008D2 D4CB 2813            12      JR  Z,TYPEE
0008D4 D4CD 010001          10      LD  BC,00100H
       D4D0                     TYPE3:
0008D7 D4D0 0A               7      LD  A,(BC)
0008D8 D4D1 03               6      INC BC
0008D9 D4D2 FE1A             7      CP  01AH
0008DB D4D4 280A            12      JR  Z,TYPEE
0008DD D4D6 CD20D9          17      CALL    MSG_A
0008E0 D4D9 2B               6      DEC HL
0008E1 D4DA 7C               4      LD  A,H
0008E2 D4DB B5               4      OR  L
0008E3 D4DC 20F2            12      JR  NZ,TYPE3
0008E5 D4DE 18E3            12      JR  TYPE2
       D4E0                     TYPEE:
0008E7 D4E0 CDD2D0          17      CALL    OPEN2
0008EA D4E3 18D5            12      JR  TYPE1
                                
       D4E5                     CWILD:
0008EC D4E5 215D00          10      LD  HL,FCB1+1
       D4E8                     CWILD1:
0008EF D4E8 7E               7      LD  A,(HL)
0008F0 D4E9 FE20             7      CP  020H
0008F2 D4EB C0              11      RET NZ
       D4EC                     CWILD2:
0008F3 D4EC 3E3F             7      LD  A,'?'
0008F5 D4EE 060B             7      LD  B,11
0008F7 D4F0 C3C1DE          10      JP  FILL_MEMORY
                                
       D4F3                     DTA_CCP:
0008FA D4F3                         DS  37
                                
       0040                     PATHX   EQU 64
00091F D518                     PATHD:  DS  PATHX
00095F D558 00                  PATHE:  DB  0
                                
000960 D559 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
00096D D566 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000978 D571 20203A24            DIRHD:  DB  "  :$"
                                
       D575                     COMTB:
00097C D575 44202020                DB  "D   "  ;1
000980 D579 F4D1                    DW  C_DIR
000982 D57B 44495220                DB  "DIR "  ;2
000986 D57F F4D1                    DW  C_DIR
000988 D581 434F5059                DB  "COPY"  ;3
00098C D585 D8D3                    DW  C_COPY
00098E D587 43442020                DB  "CD  "  ;4
000992 D58B F6D0                    DW  C_CD
000994 D58D 44454C20                DB  "DEL "  ;5
000998 D591 D7D1                    DW  C_DEL
00099A D593 50415448                DB  "PATH"  ;6
00099E D597 99D2                    DW  C_PATH
0009A0 D599 52454E20                DB  "REN "  ;7
0009A4 D59D E1D1                    DW  C_REN
0009A6 D59F 54595045                DB  "TYPE"  ;8
0009AA D5A3 B0D4                    DW  C_TYPE
0009AC D5A5 52454D20                DB  "REM "  ;9
0009B0 D5A9 1DD6                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       D5AB                     BDWT:
0009B2 D5AB 3E10             7      LD  A,010H  ;ライト可　リード不可
0009B4 D5AD 1802            12  JR  BRW
                                
       D5AF                     BDRD:
0009B6 D5AF 3E01             7      LD  A,001H  ;ライト不可　リード可
       D5B1                     BRW:
0009B8 D5B1 F3               4      DI
0009B9 D5B2 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0009BB D5B4 ED73EAD5        20      LD  (BANKSP+1),SP
0009BF D5B8 3AEBD5          13      LD  A,(BANKSP+2)
0009C2 D5BB 87               4      ADD A,A
0009C3 D5BC 3803            12      JR  C,BRW1
0009C5 D5BE 3130EE          10      LD  SP,EXTSP
       D5C1                     BRW1:
0009C8 D5C1 C5              11      PUSH    BC
0009C9 D5C2 D5              11      PUSH    DE
0009CA D5C3 EB               4      EX  DE,HL
0009CB D5C4 29              11      ADD HL,HL
0009CC D5C5 29              11      ADD HL,HL
0009CD D5C6 7C               4      LD  A,H
0009CE D5C7 E60F             7      AND 00FH        ;バンク
0009D0 D5C9 D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
0009D2 D5CB 65               4      LD  H,L
0009D3 D5CC CB3C             8      SRL H   ;/2
0009D5 D5CE 2E00             7      LD  L,0
0009D7 D5D0 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009D9 D5D2 0F               4      RRCA
0009DA D5D3 3001            12      JR  NC,BRW2
0009DC D5D5 EB               4      EX  DE,HL
       D5D6                     BRW2:
0009DD D5D6 010002          10      LD  BC,512
0009E0 D5D9 EDB0                    LDIR
                                
0009E2 D5DB DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009E4 D5DD 0F               4      RRCA
0009E5 D5DE 3801            12      JR  C,BRW3
0009E7 D5E0 EB               4      EX  DE,HL
       D5E1                     BRW3:
0009E8 D5E1 D1              10      POP DE
0009E9 D5E2 C1              10      POP BC
0009EA D5E3 13               6      INC DE
0009EB D5E4 10DB            13      DJNZ    BRW1
                                
0009ED D5E6 AF               4      XOR A
0009EE D5E7 D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
0009F0 D5E9 310000          10  BANKSP: LD  SP,0
0009F3 D5EC FB               4      EI
0009F4 D5ED C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D5EE                     BDOS0:
0009F5 D5EE E5              11      PUSH    HL
0009F6 D5EF 79               4      LD  A,C
0009F7 D5F0 FE3C             7      CP  03CH
0009F9 D5F2 3802            12      JR  C,DOS1
0009FB D5F4 3E3C             7      LD  A,03CH
       D5F6                     DOS1:
0009FD D5F6 87               4      ADD A,A
0009FE D5F7 6F               4      LD  L,A
0009FF D5F8 26F0             7      LD  H,STABLE/256
000A01 D5FA 7E               7      LD  A,(HL)
000A02 D5FB 2C               4      INC L
000A03 D5FC 66               7      LD  H,(HL)
000A04 D5FD 6F               4      LD  L,A
000A05 D5FE E3              19      EX  (SP),HL
000A06 D5FF 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000A07 D600 C9              10      RET
       D601                     _DOS2:
000A08 D601 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000A0A D603 CAA4D8          10      JP  Z,_SYS5A
000A0D D606 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000A0F D608 CA60D8          10      JP  Z,_SYS5C
000A12 D60B FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000A14 D60D CA56EB          10      JP  Z,_SYS5F
000A17 D610 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000A19 D612 200A            12      JR  NZ,_ERROR
000A1B D614 011D01          10      LD  BC,011DH
000A1E D617 114901          10      LD  DE,VER
000A21 D61A 210201          10      LD  HL,MACD
       D61D                     C_REM:
000A24 D61D AF               4      XOR A
       D61E                     _ERROR:
000A25 D61E A7               4      AND A
000A26 D61F C9              10      RET
                                
       D620                     _SYS09:     ;文字列出力
000A27 D620 D5              11      PUSH    DE
       D621                     _SX09:
000A28 D621 1A               7      LD  A,(DE)
000A29 D622 13               6      INC DE
000A2A D623 FE24             7      CP  '$'
000A2C D625 2831            12      JR  Z,SX0E2
000A2E D627 CD20D9          17      CALL    MSG_A
000A31 D62A 18F5            12      JR  _SX09
                                
       D62C                     MSX1:
000A33 D62C CD20D9          17      CALL    MSG_A
       D62F                     MSX:
000A36 D62F 7E               7      LD  A,(HL)
000A37 D630 23               6      INC HL
000A38 D631 B7               4      OR  A
000A39 D632 20F8            12      JR  NZ,MSX1
000A3B D634 C9              10      RET
                                
       D635                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000A3C D635 212200          10      LD  HL,00022H
000A3F D638 7D               4      LD  A,L
000A40 D639 C9              10      RET
                                
       D63A                     _SYS0D:     ;(BDOS)ディスクリセット
000A41 D63A CDDFEF          17      CALL    _FFLUSH
000A44 D63D E5              11      PUSH    HL
000A45 D63E 218000          10      LD  HL,00080H
000A48 D641 228AEF          16      LD  (_DTA),HL
000A4B D644 E1              10      POP HL
000A4C D645 D5              11      PUSH    DE
000A4D D646 1E00             7      LD  E,0
000A4F D648 3E                      DB  03EH
                                
       D649                     _SYS0E:     ;(BDOS)カレントドライブの設定
000A50 D649 D5              11      PUSH    DE
000A51 D64A 7B               4      LD  A,E
000A52 D64B DDE5            15      PUSH    IX
000A54 D64D CDDCEF          17      CALL    _GETDPB
000A57 D650 DDE1            14      POP IX
000A59 D652 3804            12      JR  C,SX0E2
000A5B D654 7B               4      LD  A,E
000A5C D655 3287EF          13      LD  (_DVSW),A
       D658                     SX0E2:
000A5F D658 3E08             7      LD  A,8
000A61 D65A D1              10      POP DE
000A62 D65B C9              10      RET
                                
       D65C                     _SYS0F:     ;(BDOS)ファイルのオープン
000A63 D65C CDFEDE          17      CALL    SETDRV
000A66 D65F FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000A69 D662 C602             7      ADD A,002H      ;Write
000A6B D664 2848            12      JR  Z,FEND0F
000A6D D666 CD4CE2          17      CALL    CHKWILDX
                                
000A70 D669 D41EDF          17      CALL    NC,SOPENX
       D66C                     _S16XX:
000A73 D66C 3840            12      JR  C,FEND0F
                                                ;Directory location
000A75 D66E 3A9FEF          13      LD  A,(_FILEN)
000A78 D671 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000A7B D674 3AA0EF          13      LD  A,(_DIRF)
000A7E D677 FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000A81 D67A FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000A84 D67D FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000A87 D680 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000A8B D684 FDE5            15      PUSH    IY
000A8D D686 D1              10      POP DE
000A8E D687 13               6      INC DE
000A8F D688 010B00          10      LD  BC,11
000A92 D68B EDB0                    LDIR
                                ;               Attribute
000A94 D68D 7E               7      LD  A,(HL)
000A95 D68E FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000A98 D691 110B00          10      LD  DE,11       ;Reserved
000A9B D694 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000A9C D695 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
000A9F D698 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D69A                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000AA1 D69A 1A               7      LD  A,(DE)
000AA2 D69B 13               6      INC DE
000AA3 D69C 32A3D6          13      LD  (S16PAT+2),A
000AA6 D69F 7E               7      LD  A,(HL)
000AA7 D6A0 23               6      INC HL
000AA8 D6A1 FD7700          19  S16PAT: LD  (IY+0),A
000AAB D6A4 10F4            13      DJNZ    S16LOOP
                                
000AAD D6A6 AF               4      XOR A
000AAE D6A7 FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000AB1 D6AA FD2252D7        20      LD  (OFCB+1),IY
       D6AE                     FEND0F:
000AB5 D6AE 1845            12      JR  FEND10
                                
       D6B0                     _SYS10:     ;(BDOS)ファイルのクローズ
000AB7 D6B0 CDFEDE          17      CALL    SETDRV
000ABA D6B3 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000ABD D6B6 D6FE             7      SUB 0FEH
000ABF D6B8 37               4      SCF
000AC0 D6B9 3F               4      CCF
000AC1 D6BA 2039            12      JR  NZ,FEND10
       D6BC                     _S10A:              ;Write
000AC3 D6BC FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000AC6 D6BF FD770F          19      LD  (IY+15),A
                                
000AC9 D6C2 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000ACC D6C5 CD44E3          17      CALL    SETTMS
                                
000ACF D6C8 FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000AD2 D6CB 32A0EF          13      LD  (_DIRF),A
000AD5 D6CE E67F             7      AND 07FH
000AD7 D6D0 328DE8          13      LD  (_SECPS+1),A
000ADA D6D3 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000ADD D6D6 FD561F          19      LD  D,(IY+31)
000AE0 D6D9 CD52E0          17      CALL    READ_DIR
000AE3 D6DC 3817            12      JR  C,FEND10
                                
000AE5 D6DE 3A7CDF          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000AE8 D6E1 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000AE9 D6E2 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000AEC D6E5 6F               4      LD  L,A
000AED D6E6 2600             7      LD  H,0
000AEF D6E8 29              11      ADD HL,HL       ;*2
000AF0 D6E9 29              11      ADD HL,HL       ;*4
000AF1 D6EA 29              11      ADD HL,HL       ;*8
000AF2 D6EB 29              11      ADD HL,HL       ;*16
000AF3 D6EC 29              11      ADD HL,HL       ;*32
000AF4 D6ED ED4B7EF0        20      LD  BC,(_DTBUF)
000AF8 D6F1 09              11      ADD HL,BC
                                
000AF9 D6F2 CD5CE2          17      CALL    SDIRENT
       D6F5                     FEND10:
000AFC D6F5 1842            12      JR  FEND
                                
       D6F7                     _SYS11:     ;(BDOS)最初のファイルの検索
000AFE D6F7 CDFEDE          17      CALL    SETDRV
000B01 D6FA CD4BDF          17      CALL    SOPEN
       D6FD                     _S12X1:
000B04 D6FD 383A            12      JR  C,FEND
000B06 D6FF CDEBDF          17      CALL    SOPENE2
000B09 D702 ED5B8AEF        20      LD  DE,(_DTA)
000B0D D706 3A88EF          13      LD  A,(_DRV)
000B10 D709 3C               4      INC A
000B11 D70A 12               7      LD  (DE),A
000B12 D70B D5              11      PUSH    DE
000B13 D70C 13               6      INC DE
000B14 D70D 012000          10      LD  BC,32
000B17 D710 EDB0                    LDIR
000B19 D712 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000B1C D715 FD660F          19      LD  H,(IY+15)
000B1F D718 22F4F0          16      LD  (SCDIR),HL
000B22 D71B 2A9AEF          16      LD  HL,(_FBPS)
000B25 D71E 22F6F0          16      LD  (SFBPS),HL
000B28 D721 2A9FEF          16      LD  HL,(_FILEN)
000B2B D724 7C               4      LD  A,H
000B2C D725 B7               4      OR  A
000B2D D726 2806            12      JR  Z,_S12DIR
000B2F D728 3A8DE8          13      LD  A,(_SECPS+1)
000B32 D72B F680             7      OR  080H
000B34 D72D 67               4      LD  H,A
       D72E                     _S12DIR:
000B35 D72E 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000B38 D731 E1              10      POP HL
000B39 D732 1139EF          10      LD  DE,SFILE
000B3C D735 0E21             7      LD  C,33
       D737                     _S11B:
000B3E D737 EDB0                    LDIR
       D739                     FEND:
000B40 D739 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D73A                     FENDE:
000B41 D73A FDE1            14      POP IY
000B43 D73C C1              10      POP BC
000B44 D73D D1              10      POP DE
000B45 D73E E1              10      POP HL
000B46 D73F C9              10      RET
                                
       D740                     _SYS12:     ;(BDOS)次のファイルの検索
000B47 D740 E5              11      PUSH    HL
000B48 D741 D5              11      PUSH    DE
000B49 D742 C5              11      PUSH    BC
000B4A D743 FDE5            15      PUSH    IY
000B4C D745 CDAFDF          17      CALL    NOPEN
000B4F D748 18B3            12      JR  _S12X1
                                
       D74A                     _S16K:
000B51 D74A FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000B54 D74D FEFD             7      CP  0FDH        ;Device(0FDH)
000B56 D74F 37               4      SCF
000B57 D750 C8              11      RET Z
                                
000B58 D751 110000          10  OFCB:   LD  DE,0
000B5B D754 D5              11      PUSH    DE
000B5C D755 061A             7      LD  B,26        ;First cluster
       D757                     S16K1:
000B5E D757 13               6      INC DE
000B5F D758 23               6      INC HL
000B60 D759 10FC            13      DJNZ    S16K1
                                
000B62 D75B 1A               7      LD  A,(DE)
000B63 D75C BE               7      CP  (HL)
000B64 D75D 2013            12      JR  NZ,S16K2
000B66 D75F 13               6      INC DE
000B67 D760 23               6      INC HL
000B68 D761 1A               7      LD  A,(DE)
000B69 D762 BE               7      CP  (HL)
000B6A D763 200D            12      JR  NZ,S16K2
                                
000B6C D765 E1              10      POP HL
000B6D D766 FDE5            15      PUSH    IY
000B6F D768 D1              10      POP DE
000B70 D769 1A               7      LD  A,(DE)      ;Drive
000B71 D76A BE               7      CP  (HL)
000B72 D76B 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000B74 D76D ED52            15      SBC HL,DE       ;CP HL,DE
000B76 D76F 37               4      SCF
000B77 D770 C0              11      RET NZ
000B78 D771 E5              11      PUSH    HL
       D772                     S16K2:
000B79 D772 E1              10      POP HL
       D773                     S16K3:
000B7A D773 FDE5            15      PUSH    IY
000B7C D775 D1              10      POP DE
       D776                     _SYS13:     ;(BDOS)ファイルの削除
000B7D D776 CDFEDE          17      CALL    SETDRV
000B80 D779 CD7CE1          17      CALL    KILL
       D77C                     FEND13:
000B83 D77C 18BB            12      JR  FEND
                                
       D77E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000B85 D77E CDFEDE          17      CALL    SETDRV
000B88 D781 CDB0E3          17      CALL    INIT_SEQ
       D784                     SREAD:
000B8B D784 CDFAE3          17      CALL    RB_READ
                                
000B8E D787 C601             7      ADD A,001H
000B90 D789 38AE            12      JR  C,FEND
                                
000B92 D78B 7D               4      LD  A,L
000B93 D78C D601             7      SUB 001H
       D78E                     FENDX:
000B95 D78E 9F               4      SBC A,A
000B96 D78F E603             7      AND 3
000B98 D791 1F               4      RRA
000B99 D792 18A6            12      JR  FENDE
                                
       D794                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000B9B D794 CDFEDE          17      CALL    SETDRV
000B9E D797 CDB0E3          17      CALL    INIT_SEQ
       D79A                     SWRITE:
000BA1 D79A CDF3E3          17      CALL    RB_WRITE
                                
000BA4 D79D C6FF             7      ADD A,0FFH
000BA6 D79F 18ED            12      JR  FENDX
                                
       D7A1                     _SYS17:     ;(BDOS)ファイル名の変更
000BA8 D7A1 CDFEDE          17      CALL    SETDRV
000BAB D7A4 CDD2E1          17      CALL    NAME
000BAE D7A7 18D3            12      JR  FEND13
                                
       D7A9                     _SYS16:     ;(BDOS)ファイルの作成
000BB0 D7A9 CDFEDE          17      CALL    SETDRV
                                
000BB3 D7AC CD4CE2          17      CALL    CHKWILDX
000BB6 D7AF 38CB            12      JR  C,FEND13
000BB8 D7B1 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000BBB D7B4 FE05             7      CP  5
000BBD D7B6 2805            12      JR  Z,_S16X2
000BBF D7B8 FE21             7      CP  021H
000BC1 D7BA DA7CD7          10      JP  C,FEND13
       D7BD                     _S16X2:
                                ;               Clear FCB
000BC4 D7BD FDE5            15      PUSH    IY
000BC6 D7BF E1              10      POP HL
000BC7 D7C0 011000          10      LD  BC,16
000BCA D7C3 09              11      ADD HL,BC
       D7C4                     _S16X1:
000BCB D7C4 70               7      LD  (HL),B      ;B=0
000BCC D7C5 23               6      INC HL
000BCD D7C6 0D               4      DEC C
000BCE D7C7 20FB            12      JR  NZ,_S16X1
                                
000BD0 D7C9 CD49E3          17      CALL    SETTMSX
000BD3 D7CC FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000BD7 D7D0 CD1EDF          17      CALL    SOPENX
000BDA D7D3 3F               4      CCF
000BDB D7D4 CC4AD7          17      CALL    Z,_S16K
000BDE D7D7 D4FCDF          17      CALL    NC,COPEN
000BE1 D7DA D45CE2          17      CALL    NC,SDIRENT
000BE4 D7DD C36CD6          10      JP  _S16XX
                                
       D7E0                     _SYS21:     ;(BDOS)ランダムな読み出し
000BE7 D7E0 CDFEDE          17      CALL    SETDRV
000BEA D7E3 CD94E3          17      CALL    INIT_RND
000BED D7E6 189C            12      JR  SREAD
                                
       D7E8                     _SYS22:     ;(BDOS)ランダムな書き込み
       D7E8                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000BEF D7E8 CDFEDE          17      CALL    SETDRV
000BF2 D7EB CD94E3          17      CALL    INIT_RND
000BF5 D7EE 18AA            12      JR  SWRITE
                                
       D7F0                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000BF7 D7F0 21FF00          10      LD  HL,000FFH
000BFA D7F3 AF               4      XOR A
000BFB D7F4 C9              10      RET
                                
       D7F5                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000BFC D7F5 3A87EF          13      LD  A,(_DVSW)
000BFF D7F8 A7               4      AND A
000C00 D7F9 C9              10      RET
                                
       D7FA                     _SYS1A:     ;(BDOS)DTAの設定
000C01 D7FA ED538AEF        20      LD  (_DTA),DE
000C05 D7FE AF               4      XOR A
000C06 D7FF C9              10      RET
                                
       D800                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000C07 D800 7B               4      LD  A,E
000C08 D801 CD11DF          17      CALL    GETDRV
000C0B D804 CDDCEF          17      CALL    _GETDPB
000C0E D807 D4E2EF          17      CALL    NC,_RDFATX
000C11 D80A 210000          10      LD  HL,0
000C14 D80D D422E3          17      CALL    NC,DSKF
                                
000C17 D810 ED5B23E3        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000C1B D814 1B               6      DEC DE      ;DE←クラスタの総数
000C1C D815 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000C20 D819 9F               4      SBC A,A
000C21 D81A D8              11      RET C
000C22 D81B 4F               4      LD  C,A     ;C=0
000C23 D81C DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000C26 D81F E60F             7      AND 00FH
000C28 D821 47               4      LD  B,A
000C29 D822 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000C2C D825 C9              10      RET
                                
       D826                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000C2D D826 AF               4      XOR A
000C2E D827 67               4      LD  H,A
000C2F D828 6F               4      LD  L,A
000C30 D829 C9              10      RET
                                
       D82A                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000C31 D82A 2100F1          10      LD  HL,DEVICE
000C34 D82D 7B               4      LD  A,E
000C35 D82E C3DCEF          10      JP  _GETDPB
                                
       D831                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000C38 D831 E5              11      PUSH    HL
000C39 D832 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000C3C D835 CD0F00          17      CALL    JP_HL
000C3F D838 381B            12      JR  C,_S23X1
                                
000C41 D83A D5              11      PUSH    DE      ;EX DE,IY
000C42 D83B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C44 D83D FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000C47 D840 FD6E11          19      LD  L,(IY+17)   ;
000C4A D843 FD6612          19      LD  H,(IY+18)   ;
000C4D D846 C5              11      PUSH    BC      ;
000C4E D847 FD4613          19      LD  B,(IY+19)   ;
000C51 D84A CD86E3          17      CALL    GET_CPM_R_SIZE
000C54 D84D C1              10      POP BC
       D84E                     _S24X1:
000C55 D84E CDA6E3          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000C58 D851 FDE3            23      EX  (SP),IY     ;
000C5A D853 D1              10      POP DE      ;
                                
000C5B D854 AF               4      XOR A
       D855                     _S23X1:
000C5C D855 E1              10      POP HL
000C5D D856 C9              10      RET
                                
       D857                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000C5E D857 E5              11      PUSH    HL
000C5F D858 D5              11      PUSH    DE      ;EX DE,IY
000C60 D859 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C62 D85B CDB8E3          17      CALL    GETSEQ
000C65 D85E 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D860                     _SYS5C:     ;(BDOS)ファイル名の解析
000C67 D860 C5              11      PUSH    BC
000C68 D861 E5              11      PUSH    HL
000C69 D862 CD15DE          17      CALL    FILE
000C6C D865 E1              10      POP HL
000C6D D866 C1              10      POP BC
       D867                     S29X1:
000C6E D867 C5              11      PUSH    BC
000C6F D868 D5              11      PUSH    DE
000C70 D869 E5              11      PUSH    HL
000C71 D86A EB               4      EX  DE,HL
000C72 D86B 2114EF          10      LD  HL,FDRV
000C75 D86E 010D00          10      LD  BC,13
000C78 D871 EDB0                    LDIR
000C7A D873 70               7      LD  (HL),B      ;B=0
000C7B D874 0E03             7      LD  C,3
000C7D D876 EDB0                    LDIR
000C7F D878 E1              10      POP HL
000C80 D879 D1              10      POP DE
000C81 D87A C1              10      POP BC
000C82 D87B AF               4      XOR A
000C83 D87C C9              10      RET
                                
       D87D                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000C84 D87D C5              11      PUSH    BC
000C85 D87E 01FAE9          10      LD  BC,DWT24B
000C88 D881 1804            12      JR  S2FX
       D883                     _SYS2F:
000C8A D883 C5              11      PUSH    BC
000C8B D884 01EAE9          10      LD  BC,DRD24B
       D887                     S2FX:
000C8E D887 ED439DD8        20      LD  (S2FPAT+1),BC
000C92 D88B CDDFEF          17      CALL    _FFLUSH
                                
000C95 D88E D5              11      PUSH    DE
000C96 D88F E5              11      PUSH    HL
000C97 D890 7D               4      LD  A,L     ;Drive
000C98 D891 CDD9EF          17      CALL    _CHGDRV
000C9B D894 3809            12      JR  C,S30X2
000C9D D896 44               4      LD  B,H     ;Number of clusters
000C9E D897 2A8AEF          16      LD  HL,(_DTA)
                                
000CA1 D89A 0E00             7      LD  C,0
000CA3 D89C CDEAE9          17  S2FPAT: CALL    DRD24B
       D89F                     S30X2:
000CA6 D89F E1              10      POP HL
000CA7 D8A0 D1              10      POP DE
000CA8 D8A1 C1              10      POP BC
000CA9 D8A2 9F               4      SBC A,A
000CAA D8A3 C9              10      RET
                                
       D8A4                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000CAB D8A4 C5              11      PUSH    BC
000CAC D8A5 D5              11      PUSH    DE
000CAD D8A6 E5              11      PUSH    HL
000CAE D8A7 CD0ADE          17      CALL    FILEC
000CB1 D8AA 210000          10      LD  HL,0
000CB4 D8AD 1114EF          10      LD  DE,FDRV
000CB7 D8B0 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000CBA D8B3 CD0F00          17      CALL    JP_HL
000CBD D8B6 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                
       D61E                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D61E                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D61E                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D61E                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D61E                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D61E                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D8B8                     BDOS_RF:
000CBF D8B8 DB32            11      IN  A,(032H)
000CC1 D8BA F610             7      OR  010H        ;高速RAMアクセスモードOFF
000CC3 D8BC D332            11      OUT (032H),A
000CC5 D8BE C3EED5          10      JP  BDOS0
                                
       D8C1                     INTVRTC:
000CC8 D8C1 F3               4      DI
000CC9 D8C2 F5              11      PUSH    AF
000CCA D8C3 CD1ADD          17      CALL    CHKEY
       D8C7                     KEYDT   EQU $+1
000CCD D8C6 FE00             7      CP  0
000CCF D8C8 201F            12      JR  NZ,SETKEY1
       D8CB                     KEYAR   EQU $+1
000CD1 D8CA 3E00             7      LD  A,0
000CD3 D8CC B7               4      OR  A
000CD4 D8CD 2014            12      JR  NZ,ARWKEY
       D8CF                     SETKEY:
000CD6 D8CF 32CBD8          13      LD  (KEYAR),A
000CD9 D8D2 3A92EF          13      LD  A,(_KEYD)
000CDC D8D5 32C7D8          13      LD  (KEYDT),A
000CDF D8D8 CDF5D8          17      CALL    KEYSET
       D8DB                     ENDKEY:
000CE2 D8DB 3AB7EF          13      LD  A,(WKE4)
000CE5 D8DE D3E4            11      OUT (0E4H),A
000CE7 D8E0 F1              10      POP AF
000CE8 D8E1 FB               4      EI
000CE9 D8E2 C9              10      RET
       D8E3                     ARWKEY:
000CEA D8E3 3D               4      DEC A
000CEB D8E4 32CBD8          13      LD  (KEYAR),A
000CEE D8E7 18F2            12      JR  ENDKEY
       D8E9                     SETKEY1:
000CF0 D8E9 3E10             7      LD  A,16
000CF2 D8EB 18E2            12      JR  SETKEY
                                
       D8ED                     INTE88:
000CF4 D8ED F5              11      PUSH    AF
000CF5 D8EE 3AB7EF          13      LD  A,(WKE4)
000CF8 D8F1 D3E4            11      OUT (0E4H),A
000CFA D8F3 F1              10      POP AF
000CFB D8F4 C9              10      RET
       D8F5                     KEYSET:
       D8F5                     KEYBS:
000CFC D8F5 B7               4      OR  A
000CFD D8F6 C8              11      RET Z
       D8F7                     KEYBS1:
000CFE D8F7 CD0DD9          17      CALL    KEYBC_IFBREAK
000D01 D8FA E5              11      PUSH    HL
000D02 D8FB F5              11      PUSH    AF
000D03 D8FC 2A90EF          16      LD  HL,(_KEYPS)
000D06 D8FF 2C               4      INC L
000D07 D900 7D               4      LD  A,L
000D08 D901 BC               4      CP  H
000D09 D902 2815            12      JR  Z,POP_AF_HL_SCF_RET
000D0B D904 3290EF          13      LD  (_KEYPS),A
000D0E D907 26FE             7      LD  H,KEYBF/256
000D10 D909 F1              10      POP AF
000D11 D90A 77               7      LD  (HL),A
000D12 D90B E1              10      POP HL
000D13 D90C C9              10      RET
       D90D                     KEYBC_IFBREAK:
000D14 D90D FE03             7      CP  3
000D16 D90F C0              11      RET NZ
       D910                     KEYBC:
000D17 D910 E5              11      PUSH    HL
000D18 D911 210000          10      LD  HL,0
000D1B D914 2290EF          16      LD  (_KEYPS),HL
000D1E D917 E1              10      POP HL
000D1F D918 C9              10      RET
                                
       D919                     POP_AF_HL_SCF_RET:
000D20 D919 F1              10      POP AF
000D21 D91A E1              10      POP HL
000D22 D91B 37               4      SCF
000D23 D91C C9              10      RET
                                
       D91D                     _SYS01:     ;(BDOS)コンソール入力
000D24 D91D CD09EF          17      CALL    _SYS07
       D920                     MSG_A:
000D27 D920 F5              11      PUSH    AF
000D28 D921 D5              11      PUSH    DE
000D29 D922 5F               4      LD  E,A
000D2A D923 CD29D9          17      CALL    _SYS02
000D2D D926 D1              10      POP DE
000D2E D927 F1              10      POP AF
000D2F D928 C9              10      RET
                                
       D929                     _SYS02:     ;(BDOS)コンソール出力
000D30 D929 CD3BD9          17      CALL    BREAK
000D33 D92C 1805            12      JR  PRINTX
                                
       D92E                     _SYS06:     ;(BDOS)コンソール直接入出力
000D35 D92E 7B               4      LD  A,E
000D36 D92F 3C               4      INC A
000D37 D930 CACAEF          10      JP  Z,_INKEY
       D933                     PRINTX:
000D3A D933 C3CDEF          10      JP  _PRINT
                                
       D936                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D3D D936 CD09EF          17      CALL    _SYS07
000D40 D939 1804            12      JR  BREAK1
       D93B                     BREAK:
000D42 D93B FB               4      EI
000D43 D93C 3A92EF          13      LD  A,(_KEYD)
       D93F                     BREAK1:
000D46 D93F FE03             7      CP  3       ;CTRL+C
000D48 D941 CA00EF          10      JP  Z,CPM_BOOT
000D4B D944 FE13             7      CP  013H        ;CTRL+S
000D4D D946 C0              11      RET NZ
                                
       D947                     PAUSE:
000D4E D947 CD10D9          17      CALL    KEYBC
                                
       D94A                     FLGET:
000D51 D94A CDDFEF          17      CALL    _FFLUSH
000D54 D94D E5              11      PUSH    HL
000D55 D94E 2A8EEF          16      LD  HL,(_TXADR)
000D58 D951 CDDBDB          17      CALL    CURSOR_ON
       D954                     FLGET1:
000D5B D954 CDCAEF          17      CALL    _INKEY
000D5E D957 28FB            12      JR  Z,FLGET1
000D60 D959 CDECDB          17      CALL    CURSOR_OFF
000D63 D95C E1              10      POP HL
000D64 D95D C9              10      RET
                                
       D95E                     _SYS0A:     ;(BDOS)文字列入力
000D65 D95E C5              11      PUSH    BC
000D66 D95F E5              11      PUSH    HL
000D67 D960 D5              11      PUSH    DE
000D68 D961 CDABDC          17      CALL    GETL
000D6B D964 1100FF          10      LD  DE,KBUF
000D6E D967 E1              10      POP HL
000D6F D968 E5              11      PUSH    HL
000D70 D969 0E00             7      LD  C,0
000D72 D96B 3004            12      JR  NC,SAX0
000D74 D96D 23               6      INC HL
000D75 D96E 23               6      INC HL
000D76 D96F 1808            12      JR  SAX4
       D971                     SAX0:
000D78 D971 46               7      LD  B,(HL)
000D79 D972 23               6      INC HL
       D973                     SAX1:
000D7A D973 23               6      INC HL
000D7B D974 1A               7      LD  A,(DE)
000D7C D975 13               6      INC DE
000D7D D976 B7               4      OR  A
000D7E D977 2004            12      JR  NZ,SAX2
       D979                     SAX4:
000D80 D979 360D            10      LD  (HL),00DH
000D82 D97B 1804            12      JR  SAX3
       D97D                     SAX2:
000D84 D97D 77               7      LD  (HL),A
000D85 D97E 0C               4      INC C
000D86 D97F 10F2            13      DJNZ    SAX1
       D981                     SAX3:
000D88 D981 D1              10      POP DE
000D89 D982 79               4      LD  A,C
000D8A D983 13               6      INC DE
000D8B D984 12               7      LD  (DE),A
000D8C D985 1B               6      DEC DE
000D8D D986 E1              10      POP HL
000D8E D987 C1              10      POP BC
000D8F D988 A7               4      AND A
000D90 D989 C9              10      RET
                                
       D98A                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000D91 D98A CD3BD9          17      CALL    BREAK
000D94 D98D 3A92EF          13      LD  A,(_KEYD)
000D97 D990 B7               4      OR  A
000D98 D991 C8              11      RET Z
       D992                     CONSTX:
000D99 D992 CDDFEF          17      CALL    _FFLUSH
000D9C D995 E5              11      PUSH    HL
000D9D D996 2A90EF          16      LD  HL,(_KEYPS)
000DA0 D999 7C               4      LD  A,H
000DA1 D99A AD               4      XOR L
000DA2 D99B E1              10      POP HL
000DA3 D99C C6FF             7      ADD A,0FFH
000DA5 D99E 9F               4      SBC A,A
000DA6 D99F C9              10      RET
                                
       D9A0                     _SYS2A:     ;(BDOS)日付の獲得
000DA7 D9A0 C5              11      PUSH    BC
000DA8 D9A1 CDE0D9          17      CALL    RTCREAD
000DAB D9A4 3A62EF          13      LD  A,(RTC_YY)
000DAE D9A7 CD43DA          17      CALL    BCD
000DB1 D9AA 6F               4      LD  L,A
000DB2 D9AB 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000DB4 D9AD 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       D9B0                     RDDATE1:
000DB7 D9B0 19              11      ADD HL,DE
000DB8 D9B1 3A63EF          13      LD  A,(RTC_MW)
000DBB D9B4 57               4      LD  D,A
000DBC D9B5 3A64EF          13      LD  A,(RTC_DD)
000DBF D9B8 CD43DA          17      CALL    BCD
000DC2 D9BB 5F               4      LD  E,A
000DC3 D9BC 7A               4      LD  A,D
000DC4 D9BD 0604             7      LD  B,4
       D9BF                     RDDATE2:
000DC6 D9BF CB3A             8      SRL D
000DC8 D9C1 10FC            13      DJNZ    RDDATE2
000DCA D9C3 C1              10      POP BC
000DCB D9C4 E607             7      AND 7
000DCD D9C6 C9              10      RET
                                
       D9C7                     _SYS2C:     ;(BDOS)時刻の獲得
000DCE D9C7 C5              11      PUSH    BC
000DCF D9C8 CDE0D9          17      CALL    RTCREAD
000DD2 D9CB 3A65EF          13      LD  A,(RTC_TT)
000DD5 D9CE CD43DA          17      CALL    BCD
000DD8 D9D1 67               4      LD  H,A
000DD9 D9D2 3A66EF          13      LD  A,(RTC_MM)
000DDC D9D5 CD43DA          17      CALL    BCD
000DDF D9D8 6F               4      LD  L,A
000DE0 D9D9 3A67EF          13      LD  A,(RTC_SS)
000DE3 D9DC 57               4      LD  D,A
000DE4 D9DD C1              10      POP BC
000DE5 D9DE AF               4      XOR A
000DE6 D9DF C9              10      RET
                                
       D9E0                     RTCREAD:
000DE7 D9E0 0EF9             7      LD  C,0F9H
000DE9 D9E2 3AB9EF          13      LD  A,(WK40)
000DEC D9E5 5F               4      LD  E,A
000DED D9E6 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000DEF D9E8 CD12DA          17      CALL    RTCCMD
000DF2 D9EB 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000DF4 D9ED CD12DA          17      CALL    RTCCMD
000DF7 D9F0 0606             7      LD  B,6
000DF9 D9F2 2167EF          10      LD  HL,RTC_SS
       D9F5                     RTCREAD1:
000DFC D9F5 C5              11      PUSH    BC
000DFD D9F6 0608             7      LD  B,8
       D9F8                     RTCREAD2:
000DFF D9F8 DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
000E01 D9FA 87               4      ADD A,A
000E02 D9FB 87               4      ADD A,A
000E03 D9FC 87               4      ADD A,A
000E04 D9FD 87               4      ADD A,A
000E05 D9FE CB1E            15      RR  (HL)
000E07 DA00 CD37DA          17      CALL    RTCCLK
000E0A DA03 10F3            13      DJNZ    RTCREAD2
000E0C DA05 C1              10      POP BC
000E0D DA06 2B               6      DEC HL
000E0E DA07 10EC            13      DJNZ    RTCREAD1
000E10 DA09 AF               4      XOR A
000E11 DA0A CD12DA          17      CALL    RTCCMD
000E14 DA0D 7B               4      LD  A,E
000E15 DA0E 32B9EF          13      LD  (WK40),A
000E18 DA11 C9              10      RET
                                
       DA12                     RTCCMD:
000E19 DA12 0604             7      LD  B,4
000E1B DA14 07               4      RLCA
000E1C DA15 07               4      RLCA
000E1D DA16 07               4      RLCA
       DA17                     RTCCMD1:
000E1E DA17 F5              11      PUSH    AF
000E1F DA18 F607             7      OR  7
000E21 DA1A D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E23 DA1C CD37DA          17      CALL    RTCCLK
000E26 DA1F F1              10      POP AF
000E27 DA20 0F               4      RRCA
000E28 DA21 10F4            13      DJNZ    RTCCMD1
000E2A DA23 3E07             7      LD  A,7
000E2C DA25 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E2E DA27 7B               4      LD  A,E
000E2F DA28 A1               4      AND C
000E30 DA29 F602             7      OR  2
000E32 DA2B D340            11      OUT (40H),A     ;ストローブポート
000E34 DA2D A1               4      AND C
000E35 DA2E 00               4      NOP
000E36 DA2F D340            11      OUT (40H),A     ;ストローブポート
000E38 DA31 5F               4      LD  E,A
000E39 DA32 060D             7      LD  B,13
       DA34                     RTCCMD3:
000E3B DA34 10FE            13      DJNZ    RTCCMD3
000E3D DA36 C9              10      RET
                                
       DA37                     RTCCLK:
000E3E DA37 7B               4      LD  A,E
000E3F DA38 A1               4      AND C
000E40 DA39 F604             7      OR  04H
000E42 DA3B D340            11      OUT (40H),A
000E44 DA3D A1               4      AND C
000E45 DA3E 00               4      NOP
000E46 DA3F D340            11      OUT (40H),A
000E48 DA41 5F               4      LD  E,A
000E49 DA42 C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       DA43                     BCD:
000E4A DA43 4F               4      LD  C,A
000E4B DA44 E6F0             7      AND 0F0H    ;10の位
000E4D DA46 0F               4      RRCA
000E4E DA47 47               4      LD  B,A
000E4F DA48 0F               4      RRCA
000E50 DA49 0F               4      RRCA
000E51 DA4A 80               4      ADD A,B
000E52 DA4B 47               4      LD  B,A
000E53 DA4C 79               4      LD  A,C
000E54 DA4D E60F             7      AND 00FH    ;1の位
000E56 DA4F 80               4      ADD A,B
000E57 DA50 C9              10      RET
                                
       DA51                     ESC1:
000E58 DA51 7B               4      LD  A,E
000E59 DA52 FE41             7      CP  'A'
000E5B DA54 CA36DB          10      JP  Z,CTRL1E
000E5E DA57 FE42             7      CP  'B'
000E60 DA59 CA55DC          10      JP  Z,CTRL1F
000E63 DA5C FE43             7      CP  'C'
000E65 DA5E CAFCDA          10      JP  Z,CTRL1C
000E68 DA61 FE44             7      CP  'D'
000E6A DA63 CA21DB          10      JP  Z,CTRL1D
000E6D DA66 FE45             7      CP  'E'
000E6F DA68 2802            12      JR  Z,CT0CX
000E71 DA6A FE6A             7      CP  'j'
       DA6C                     CT0CX:
000E73 DA6C CA22DC          10      JP  Z,CTRL0C
000E76 DA6F FE48             7      CP  'H'
000E78 DA71 CAA1DB          10      JP  Z,CTRL0B
000E7B DA74 FE4A             7      CP  'J'
000E7D DA76 CA25DC          10      JP  Z,CTRL06
000E80 DA79 FE4B             7      CP  'K'
000E82 DA7B CA75DB          10      JP  Z,CTRL05
000E85 DA7E FE4C             7      CP  'L'
000E87 DA80 CA5CDC          10      JP  Z,CTRL0E
000E8A DA83 FE54             7      CP  'T'
000E8C DA85 CA75DB          10      JP  Z,CTRL05
000E8F DA88 FE78             7      CP  'x'
000E91 DA8A 2804            12      JR  Z,ESC1X
000E93 DA8C FE79             7      CP  'y'
000E95 DA8E 2002            12      JR  NZ,ESC1Y
       DA90                     ESC1X:
000E97 DA90 3601            10      LD  (HL),1
       DA92                     ESC1Y:
000E99 DA92 FE3D             7      CP  '='
000E9B DA94 2804            12      JR  Z,ESC1W
000E9D DA96 FE59             7      CP  'Y'
000E9F DA98 2002            12      JR  NZ,ESC1Z
       DA9A                     ESC1W:
000EA1 DA9A 3602            10      LD  (HL),2
       DA9C                     ESC1Z:
000EA3 DA9C FE20             7      CP  020H
000EA5 DA9E 3802            12      JR  C,ESC1C
000EA7 DAA0 87               4      ADD A,A
000EA8 DAA1 D0              11      RET NC
       DAA2                     ESC1C:
000EA9 DAA2 E1              10      POP HL
000EAA DAA3 1832            12      JR  ANK
                                
       DAA5                     ESC:
000EAC DAA5 21E8DA          10      LD  HL,PRINTE5
000EAF DAA8 E5              11      PUSH    HL
000EB0 DAA9 21CBDA          10      LD  HL,ESCFLG
000EB3 DAAC 3600            10      LD  (HL),0
000EB5 DAAE 3D               4      DEC A
000EB6 DAAF 28A0            12      JR  Z,ESC1
000EB8 DAB1 3D               4      DEC A
000EB9 DAB2 2009            12      JR  NZ,ESC2
000EBB DAB4 3603            10      LD  (HL),3
000EBD DAB6 7B               4      LD  A,E
000EBE DAB7 D620             7      SUB 020H
000EC0 DAB9 32C0DA          13      LD  (ESCYP+1),A
000EC3 DABC C9              10      RET
       DABD                     ESC2:
000EC4 DABD 3D               4      DEC A
000EC5 DABE C0              11      RET NZ
000EC6 DABF 2600             7  ESCYP:  LD  H,0
000EC8 DAC1 7B               4      LD  A,E
000EC9 DAC2 D620             7      SUB 020H
000ECB DAC4 6F               4      LD  L,A
000ECC DAC5 C3D6EF          10      JP  _LOC
                                
       DAC8                     PRINT:
000ECF DAC8 C5              11      PUSH    BC
000ED0 DAC9 E5              11      PUSH    HL
       DACB                     ESCFLG  EQU $+1
000ED1 DACA 3E00             7      LD  A,000H      ;自己書き換え
000ED3 DACC B7               4      OR  A
000ED4 DACD 20D6            12      JR  NZ,ESC
                                
000ED6 DACF 3E1F             7      LD  A,01FH
000ED8 DAD1 BB               4      CP  E
000ED9 DAD2 3018            12      JR  NC,CTRL
       DAD4                     INSFLG  EQU $
000EDB DAD4 0104DC          10      LD  BC,INSERT   ;自己書き換え
       DAD7                     ANK:
000EDE DAD7 CDAEDB          17      CALL    LOC0
000EE1 DADA DB32            11      IN  A,(032H)
000EE3 DADC F5              11      PUSH    AF
000EE4 DADD E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000EE6 DADF D332            11      OUT (032H),A
000EE8 DAE1 73               7      LD  (HL),E
000EE9 DAE2 F1              10      POP AF
000EEA DAE3 D332            11      OUT (032H),A
000EEC DAE5 CDFCDA          17      CALL    CTRL1C
       DAE8                     PRINTE5:
000EEF DAE8 E1              10      POP HL
000EF0 DAE9 C1              10      POP BC
000EF1 DAEA AF               4      XOR A
000EF2 DAEB C9              10      RET
                                
       DAEC                     CTRL:
000EF3 DAEC 7B               4      LD  A,E
000EF4 DAED 87               4      ADD A,A
000EF5 DAEE F680             7      OR  080H
000EF7 DAF0 6F               4      LD  L,A
000EF8 DAF1 26F0             7      LD  H,CTRLTB/256
000EFA DAF3 7E               7      LD  A,(HL)
000EFB DAF4 2C               4      INC L
000EFC DAF5 66               7      LD  H,(HL)
000EFD DAF6 6F               4      LD  L,A
000EFE DAF7 CD0F00          17      CALL    JP_HL
000F01 DAFA 18EC            12      JR  PRINTE5
                                
       DAFC                     CTRL1C:
000F03 DAFC 2A8EEF          16      LD  HL,(_TXADR)
000F06 DAFF 2C               4      INC L
       DB00                     PRINTE3:
000F07 DB00 3AB1EF          13      LD  A,(_WIDTH)
000F0A DB03 3D               4      DEC A
000F0B DB04 BD               4      CP  L
000F0C DB05 3009            12      JR  NC,SET_TXADR_HL
000F0E DB07 2E00             7      LD  L,0
000F10 DB09 24               4      INC H
       DB0A                     PRINTE8:
000F11 DB0A 3A97EF          13      LD  A,(_LINE)
000F14 DB0D BC               4      CP  H
000F15 DB0E 2804            12      JR  Z,PRINT2
       DB10                     LOC:
       DB10                     SET_TXADR_HL:
000F17 DB10 228EEF          16      LD  (_TXADR),HL
       DB13                     CTRL00:
000F1A DB13 C9              10      RET
                                
       DB14                     PRINT2:
000F1B DB14 CD62DC          17      CALL    SCR
000F1E DB17 25               4      DEC H
000F1F DB18 18F6            12      JR  SET_TXADR_HL
                                
       DB1A                     CTRL08:
000F21 DB1A 3AD4DA          13      LD  A,(INSFLG)
000F24 DB1D FECD             7      CP  0CDH        ;CALL ????
000F26 DB1F 2829            12      JR  Z,CTRL02
       DB21                     CTRL1D:
000F28 DB21 2A8EEF          16      LD  HL,(_TXADR)
000F2B DB24 7C               4      LD  A,H
000F2C DB25 B5               4      OR  L
000F2D DB26 C8              11      RET Z
000F2E DB27 7D               4      LD  A,L
000F2F DB28 B7               4      OR  A
000F30 DB29 2803            12      JR  Z,CTRL1DX1
000F32 DB2B 2D               4      DEC L
000F33 DB2C 18E2            12      JR  SET_TXADR_HL
       DB2E                     CTRL1DX1:
000F35 DB2E 3AB1EF          13      LD  A,(_WIDTH)
000F38 DB31 3D               4      DEC A
000F39 DB32 6F               4      LD  L,A
000F3A DB33 25               4      DEC H
000F3B DB34 18DA            12      JR  SET_TXADR_HL
       DB36                     CTRL1E:
000F3D DB36 2A8EEF          16      LD  HL,(_TXADR)
000F40 DB39 7C               4      LD  A,H
000F41 DB3A B7               4      OR  A
000F42 DB3B C8              11      RET Z
000F43 DB3C 25               4      DEC H
000F44 DB3D 18D1            12      JR  SET_TXADR_HL
                                
       DB3F                     CTRL09:
000F46 DB3F 2A8EEF          16      LD  HL,(_TXADR)
000F49 DB42 7D               4      LD  A,L
000F4A DB43 E6F8             7      AND 0F8H
000F4C DB45 C608             7      ADD A,8
000F4E DB47 6F               4      LD  L,A
000F4F DB48 18B6            12      JR  PRINTE3
                                
       DB4A                     CTRL02:
000F51 DB4A 3A8EEF          13      LD  A,(_TXADR)
000F54 DB4D B7               4      OR  A
000F55 DB4E 28D1            12      JR  Z,CTRL1D
000F57 DB50 CD21DB          17      CALL    CTRL1D
000F5A DB53 2A8EEF          16      LD  HL,(_TXADR)
000F5D DB56 3AB1EF          13      LD  A,(_WIDTH)
000F60 DB59 4F               4      LD  C,A
000F61 DB5A 95               4      SUB L
000F62 DB5B 47               4      LD  B,A
000F63 DB5C 79               4      LD  A,C
000F64 DB5D 3D               4      DEC A
000F65 DB5E 6F               4      LD  L,A
000F66 DB5F CDB1DB          17      CALL    LOC1
                                
000F69 DB62 DB32            11      IN  A,(032H)
000F6B DB64 F5              11      PUSH    AF
000F6C DB65 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F6E DB67 D332            11      OUT (032H),A
                                
000F70 DB69 3E20             7      LD  A,020H
       DB6B                     C8X1:
000F72 DB6B 4E               7      LD  C,(HL)
000F73 DB6C 77               7      LD  (HL),A
000F74 DB6D 2B               6      DEC HL
000F75 DB6E 79               4      LD  A,C
000F76 DB6F 10FA            13      DJNZ    C8X1
                                
000F78 DB71 F1              10      POP AF
000F79 DB72 D332            11      OUT (032H),A
000F7B DB74 C9              10      RET
                                
       DB75                     CTRL05:
000F7C DB75 CDD3EF          17      CALL    _POS
000F7F DB78 2A8EEF          16      LD  HL,(_TXADR)
000F82 DB7B 3AB1EF          13      LD  A,(_WIDTH)
000F85 DB7E 95               4      SUB L
000F86 DB7F 47               4      LD  B,A
000F87 DB80 CDAEDB          17      CALL    LOC0
       DB83                     CLLINE:
000F8A DB83 DB32            11      IN  A,(032H)
000F8C DB85 F5              11      PUSH    AF
000F8D DB86 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F8F DB88 D332            11      OUT (032H),A
000F91 DB8A 3E20             7      LD  A,020H
       DB8C                     CLLINE1:
000F93 DB8C 77               7      LD  (HL),A
000F94 DB8D 23               6      INC HL
000F95 DB8E 10FC            13      DJNZ    CLLINE1
                                
000F97 DB90 F1              10      POP AF
000F98 DB91 D332            11      OUT (032H),A
000F9A DB93 C9              10      RET
                                
       DB94                     CTRL0D:
000F9B DB94 AF               4      XOR A
000F9C DB95 328EEF          13      LD  (_TXADR),A
000F9F DB98 C9              10      RET
                                
       DB99                     CTRL12:
000FA0 DB99 21D4DA          10      LD  HL,INSFLG
000FA3 DB9C 7E               7      LD  A,(HL)
000FA4 DB9D EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000FA6 DB9F 77               7      LD  (HL),A
000FA7 DBA0 C9              10      RET
                                
       DBA1                     CTRL0B:
000FA8 DBA1 210000          10      LD  HL,0
000FAB DBA4 228EEF          16      LD  (_TXADR),HL
000FAE DBA7 C9              10      RET
                                
       DBA8                     CTRL1B:
000FAF DBA8 3E01             7      LD  A,1
000FB1 DBAA 32CBDA          13      LD  (ESCFLG),A
000FB4 DBAD C9              10      RET
       DBAE                     LOC0:
000FB5 DBAE 2A8EEF          16      LD  HL,(_TXADR)
       DBB1                     LOC1:
000FB8 DBB1 D5              11      PUSH    DE
000FB9 DBB2 E5              11      PUSH    HL
000FBA DBB3 6C               4      LD  L,H ;Y
000FBB DBB4 5C               4      LD  E,H
000FBC DBB5 2600             7      LD  H,0
000FBE DBB7 54               4      LD  D,H
000FBF DBB8 29              11      ADD HL,HL   ;*2
000FC0 DBB9 29              11      ADD HL,HL   ;*4
000FC1 DBBA 29              11      ADD HL,HL   ;*8
000FC2 DBBB 29              11      ADD HL,HL   ;*16
000FC3 DBBC ED52            15      SBC HL,DE   ;*15
000FC5 DBBE 29              11      ADD HL,HL   ;*30
000FC6 DBBF 29              11      ADD HL,HL   ;*60
000FC7 DBC0 29              11      ADD HL,HL   ;*120
000FC8 DBC1 D1              10      POP DE
000FC9 DBC2 1600             7      LD  D,0
000FCB DBC4 19              11      ADD HL,DE   ;X
000FCC DBC5 ED5BB2EF        20      LD  DE,(TVRAMTOP)
000FD0 DBC9 19              11      ADD HL,DE
000FD1 DBCA D1              10      POP DE
000FD2 DBCB C9              10      RET
                                
       DBCC                     CONOUT1:
000FD3 DBCC 59               4      LD  E,C
000FD4 DBCD CDCDEF          17      CALL    _PRINT
000FD7 DBD0 7B               4      LD  A,E
000FD8 DBD1 FE0A             7      CP  00AH
000FDA DBD3 2006            12      JR  NZ,CURSOR_ON
000FDC DBD5 CD94DB          17      CALL    CTRL0D
000FDF DBD8 CD75DB          17      CALL    CTRL05
       DBDB                     CURSOR_ON:
000FE2 DBDB F5              11      PUSH    AF
000FE3 DBDC 3E81             7      LD  A,081H
       DBDE                     CURSOR0:
000FE5 DBDE D351            11      OUT (051H),A
000FE7 DBE0 3A8EEF          13      LD  A,(_TXADR)
000FEA DBE3 D350            11      OUT (050H),A
000FEC DBE5 3A8FEF          13      LD  A,(_TXADR+1)
000FEF DBE8 D350            11      OUT (050H),A
000FF1 DBEA F1              10      POP AF
000FF2 DBEB C9              10      RET
       DBEC                     CURSOR_OFF:
000FF3 DBEC F5              11      PUSH    AF
000FF4 DBED 3E80             7      LD  A,080H
000FF6 DBEF 18ED            12      JR  CURSOR0
                                
       DBF1                     CTRL07:
000FF8 DBF1 3AB9EF          13      LD  A,(WK40)
000FFB DBF4 F5              11      PUSH    AF
000FFC DBF5 F620             7      OR  20H
000FFE DBF7 D340            11      OUT (040H),A
001000 DBF9 0610             7      LD  B,16
       DBFB                     C07X1:
001002 DBFB CD6CDD          17      CALL    VBLANK
001005 DBFE 10FB            13      DJNZ    C07X1
001007 DC00 F1              10      POP AF
001008 DC01 D340            11      OUT (040H),A
00100A DC03 C9              10      RET
                                
       DC04                     INSERT:
00100B DC04 2A8EEF          16      LD  HL,(_TXADR)
00100E DC07 3AB1EF          13      LD  A,(_WIDTH)
001011 DC0A 95               4      SUB L
001012 DC0B 47               4      LD  B,A
                                
001013 DC0C CDAEDB          17      CALL    LOC0
                                
001016 DC0F DB32            11      IN  A,(032H)
001018 DC11 F5              11      PUSH    AF
001019 DC12 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
00101B DC14 D332            11      OUT (032H),A
                                
00101D DC16 3E20             7      LD  A,020H
       DC18                     INS1:
00101F DC18 4E               7      LD  C,(HL)
001020 DC19 77               7      LD  (HL),A
001021 DC1A 79               4      LD  A,C
001022 DC1B 23               6      INC HL
001023 DC1C 10FA            13      DJNZ    INS1
                                
001025 DC1E F1              10      POP AF
001026 DC1F D332            11      OUT (032H),A
001028 DC21 C9              10      RET
                                
       DC22                     CTRL0C:
001029 DC22 CDA1DB          17      CALL    CTRL0B
       DC25                     CTRL06:
00102C DC25 2A8EEF          16      LD  HL,(_TXADR)
       DC28                     CLS1:
00102F DC28 DB32            11      IN  A,(032H)
001031 DC2A F5              11      PUSH    AF
001032 DC2B E6EF             7      AND 0EFH        ;高速RAMアクセスモード
001034 DC2D D332            11      OUT (032H),A
       DC2F                     CLS2:
001036 DC2F E5              11      PUSH    HL
001037 DC30 3AB1EF          13      LD  A,(_WIDTH)
00103A DC33 95               4      SUB L
00103B DC34 47               4      LD  B,A
00103C DC35 CDB1DB          17      CALL    LOC1
00103F DC38 3E20             7      LD  A,020H
       DC3A                     CLS3:
001041 DC3A 77               7      LD  (HL),A
001042 DC3B 23               6      INC HL
001043 DC3C 10FC            13      DJNZ    CLS3
001045 DC3E E1              10      POP HL
001046 DC3F 2E00             7      LD  L,0
001048 DC41 24               4      INC H
001049 DC42 3A97EF          13      LD  A,(_LINE)
00104C DC45 BC               4      CP  H
00104D DC46 20E7            12      JR  NZ,CLS2
00104F DC48 F1              10      POP AF
001050 DC49 D332            11      OUT (032H),A
001052 DC4B C9              10      RET
                                
       DC4C                     CTRL04:
001053 DC4C CDD3EF          17      CALL    _POS
001056 DC4F 7D               4      LD  A,L
001057 DC50 B7               4      OR  A
001058 DC51 C8              11      RET Z
       DC52                     CTRL03:
001059 DC52 CD94DB          17      CALL    CTRL0D
       DC55                     CTRL0A:
       DC55                     CTRL1F:
00105C DC55 2A8EEF          16      LD  HL,(_TXADR)
00105F DC58 24               4      INC H
001060 DC59 C30ADB          10      JP  PRINTE8
                                
       DC5C                     CTRL0E:
001063 DC5C CDD3EF          17      CALL    _POS
001066 DC5F 7C               4      LD  A,H
001067 DC60 1804            12      JR  SCR1
       DC62                     SCR:
001069 DC62 3A97EF          13      LD  A,(_LINE)
00106C DC65 3D               4      DEC A
       DC66                     SCR1:
00106D DC66 C5              11      PUSH    BC
00106E DC67 D5              11      PUSH    DE
00106F DC68 E5              11      PUSH    HL
001070 DC69 F5              11      PUSH    AF
001071 DC6A 210000          10      LD  HL,0
001074 DC6D CDB1DB          17      CALL    LOC1
001077 DC70 EB               4      EX  DE,HL
001078 DC71 210001          10      LD  HL,0100H
00107B DC74 CDB1DB          17      CALL    LOC1
00107E DC77 C1              10      POP BC
00107F DC78 DB32            11      IN  A,(032H)
001081 DC7A F5              11      PUSH    AF
001082 DC7B E6EF             7      AND 0EFH        ;高速RAMアクセスモード
001084 DC7D D332            11      OUT (032H),A
001086 DC7F 78               4      LD  A,B
001087 DC80 B7               4      OR  A
       DC81                     SCRUP1:
001088 DC81 2815            12      JR  Z,SCRCL
00108A DC83 E5              11      PUSH    HL
00108B DC84 D5              11      PUSH    DE
00108C DC85 0608             7      LD  B,8
00108E DC87 5F               4      LD  E,A
00108F DC88 210078          10      LD  HL,120*256
001092 DC8B 55               4      LD  D,L
       DC8C                     SCRH2:
001093 DC8C 29              11      ADD HL,HL
001094 DC8D 3001            12      JR  NC,SCRH3
001096 DC8F 19              11      ADD HL,DE
       DC90                     SCRH3:
001097 DC90 10FA            13      DJNZ    SCRH2
001099 DC92 4D               4      LD  C,L
00109A DC93 44               4      LD  B,H
00109B DC94 D1              10      POP DE
00109C DC95 E1              10      POP HL
00109D DC96 EDB0                    LDIR
                                
       DC98                     SCRCL:
00109F DC98 F1              10      POP AF
0010A0 DC99 D332            11      OUT (032H),A
                                
0010A2 DC9B 3AB1EF          13      LD  A,(_WIDTH)
0010A5 DC9E 47               4      LD  B,A
0010A6 DC9F EB               4      EX  DE,HL
0010A7 DCA0 CD83DB          17      CALL    CLLINE
0010AA DCA3 E1              10      POP HL
0010AB DCA4 D1              10      POP DE
0010AC DCA5 C1              10      POP BC
0010AD DCA6 C9              10      RET
       DCA7                     POS:
0010AE DCA7 2A8EEF          16      LD  HL,(_TXADR)
0010B1 DCAA C9              10      RET
                                
       DCAB                     GETL:
0010B2 DCAB CDD3EF          17      CALL    _POS
0010B5 DCAE E5              11      PUSH    HL
0010B6 DCAF 3ECD             7      LD  A,0CDH      ;CALL ????
0010B8 DCB1 32D4DA          13      LD  (INSFLG),A
       DCB4                     GETL1:
0010BB DCB4 CD36D9          17      CALL    _SYS08
0010BE DCB7 FE09             7      CP  9
0010C0 DCB9 2008            12      JR  NZ,GETL1V
0010C2 DCBB 2100FF          10      LD  HL,KBUF
0010C5 DCBE CD2FD6          17      CALL    MSX
0010C8 DCC1 18F1            12      JR  GETL1
       DCC3                     GETL1V:
0010CA DCC3 5F               4      LD  E,A
0010CB DCC4 CDCDEF          17      CALL    _PRINT
                                
0010CE DCC7 7B               4      LD  A,E
0010CF DCC8 FE0D             7      CP  00DH
0010D1 DCCA 20E8            12      JR  NZ,GETL1
0010D3 DCCC 3E01             7      LD  A,1     ;LD BC,????
0010D5 DCCE 32D4DA          13      LD  (INSFLG),A
0010D8 DCD1 1100FF          10      LD  DE,KBUF
0010DB DCD4 3AB1EF          13      LD  A,(_WIDTH)
0010DE DCD7 47               4      LD  B,A
0010DF DCD8 CDD2D3          17      CALL    ZERO_MEMORY_DE
                                
0010E2 DCDB D1              10      POP DE
0010E3 DCDC CDD3EF          17      CALL    _POS
0010E6 DCDF 6B               4      LD  L,E
0010E7 DCE0 3AB1EF          13      LD  A,(_WIDTH)
0010EA DCE3 95               4      SUB L
0010EB DCE4 57               4      LD  D,A
0010EC DCE5 CDB1DB          17      CALL    LOC1
0010EF DCE8 4D               4      LD  C,L
0010F0 DCE9 7C               4      LD  A,H
0010F1 DCEA F630             7      OR  030H
0010F3 DCEC 47               4      LD  B,A
0010F4 DCED 5A               4      LD  E,D
0010F5 DCEE 2100FF          10      LD  HL,KBUF
       DCF1                     GETL2:
0010F8 DCF1 CDD0EF          17      CALL    _SCRN
0010FB DCF4 03               6      INC BC
0010FC DCF5 77               7      LD  (HL),A
0010FD DCF6 23               6      INC HL
0010FE DCF7 1D               4      DEC E
0010FF DCF8 20F7            12      JR  NZ,GETL2
       DCFA                     GETL3:
001101 DCFA 2B               6      DEC HL
001102 DCFB 7E               7      LD  A,(HL)
001103 DCFC FE21             7      CP  021H
001105 DCFE D0              11      RET NC
001106 DCFF 3600            10      LD  (HL),0
001108 DD01 15               4      DEC D
001109 DD02 20F6            12      JR  NZ,GETL3
00110B DD04 C9              10      RET
                                
       DD05                     INKEY:
00110C DD05 FB               4      EI
00110D DD06 E5              11      PUSH    HL
00110E DD07 2A90EF          16      LD  HL,(_KEYPS)
001111 DD0A 7C               4      LD  A,H
001112 DD0B AD               4      XOR L
001113 DD0C 2809            12      JR  Z,INKEY1
001115 DD0E 7C               4      LD  A,H
001116 DD0F 3C               4      INC A
001117 DD10 3291EF          13      LD  (_KEYPS+1),A
00111A DD13 6F               4      LD  L,A
00111B DD14 26FE             7      LD  H,KEYBF/256
00111D DD16 7E               7      LD  A,(HL)
       DD17                     INKEY1:
00111E DD17 E1              10      POP HL
00111F DD18 B7               4      OR  A
001120 DD19 C9              10      RET
                                
       DD1A                     CHKEY:
001121 DD1A C5              11      PUSH    BC
001122 DD1B DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
001124 DD1D 4F               4      LD  C,A
001125 DD1E 3A0E00          13      LD  A,(00EH)
001128 DD21 CB5F             8      BIT 3,A
00112A DD23 2002            12      JR  NZ,CHKEYRSHIFT
00112C DD25 CBB1             8      RES 6,C
       DD27                     CHKEYRSHIFT:
00112E DD27 79               4      LD  A,C
00112F DD28 3293EF          13      LD  (_KEYD+1),A
001132 DD2B E5              11      PUSH    HL
001133 DD2C 0E00             7      LD  C,0
001135 DD2E 2198ED          10      LD  HL,KEY_TABLE
001138 DD31 CB77             8      BIT 6,A
00113A DD33 2003            12      JR  NZ,CHKEY0
00113C DD35 2130EE          10      LD  HL,SHIFT_TABLE
       DD38                     CHKEY0:
00113F DD38 CB7F             8      BIT 7,A
001141 DD3A 2003            12      JR  NZ,CHKEY1
001143 DD3C 2198EE          10      LD  HL,CTRL_TABLE
       DD3F                     CHKEY1:
001146 DD3F ED78            12      IN  A,(C)
001148 DD41 0608             7      LD  B,8
       DD43                     CHKEY2:
00114A DD43 0F               4      RRCA
00114B DD44 300B            12      JR  NC,CHKEY4
       DD46                     CHKEY3:
00114D DD46 23               6      INC HL
00114E DD47 10FA            13      DJNZ    CHKEY2
001150 DD49 0C               4      INC C
001151 DD4A 79               4      LD  A,C
001152 DD4B D60D             7      SUB 00DH
001154 DD4D 20F0            12      JR  NZ,CHKEY1
001156 DD4F 1804            12      JR  CHKEY5
       DD51                     CHKEY4:
001158 DD51 7E               7      LD  A,(HL)
001159 DD52 B7               4      OR  A
00115A DD53 28F1            12      JR  Z,CHKEY3
       DD55                     CHKEY5:
00115C DD55 E1              10      POP HL
00115D DD56 C1              10      POP BC
00115E DD57 B7               4      OR  A
00115F DD58 3292EF          13      LD  (_KEYD),A
001162 DD5B C9              10      RET
                                
       DD5C                     SCRN:
001163 DD5C E5              11      PUSH    HL
001164 DD5D DB32            11      IN  A,(032H)
001166 DD5F 67               4      LD  H,A
001167 DD60 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
001169 DD62 D332            11      OUT (032H),A
00116B DD64 0A               7      LD  A,(BC)
00116C DD65 6F               4      LD  L,A
00116D DD66 7C               4      LD  A,H
00116E DD67 D332            11      OUT (032H),A
001170 DD69 7D               4      LD  A,L
001171 DD6A E1              10      POP HL
001172 DD6B C9              10      RET
                                
       DD6C                     VBLANK:
001173 DD6C F5              11      PUSH    AF
       DD6D                     VBLANK0:
001174 DD6D DB40            11      IN  A,(040H)
001176 DD6F E620             7      AND 020H
001178 DD71 20FA            12      JR  NZ,VBLANK0
       DD73                     VBLANK1:
00117A DD73 DB40            11      IN  A,(040H)
00117C DD75 E620             7      AND 020H
00117E DD77 28FA            12      JR  Z,VBLANK1
001180 DD79 F1              10      POP AF
001181 DD7A C9              10      RET
                                
       DD7B                     INIT_CRTC:
001182 DD7B 3E03             7      LD  A,3     ;80桁
001184 DD7D D330            11      OUT (030H),A
001186 DD7F 32BEEF          13      LD  (WK30),A
                                
001189 DD82 3E22             7      LD  A,022H      ;25行 64K RAM
00118B DD84 D331            11      OUT (031H),A
00118D DD86 32BFEF          13      LD  (WK31),A
                                
001190 DD89 3EFF             7      LD  A,0FFH
001192 DD8B D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
001194 DD8D 32B7EF          13      LD  (WKE4),A
001197 DD90 3E00             7      LD  A,0
001199 DD92 D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
00119B DD94 3E19             7      LD  A,019H
00119D DD96 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
00119F DD98 32B9EF          13      LD  (WK40),A
0011A2 DD9B CD6CDD          17      CALL    VBLANK
                                
0011A5 DD9E AF               4      XOR A
0011A6 DD9F D351            11      OUT (051H),A    ;Reset CRTC
0011A8 DDA1 3EA0             7      LD  A,0A0H
0011AA DDA3 D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
0011AC DDA5 21C8F3          10      LD  HL,0F3C8H
0011AF DDA8 22B2EF          16      LD  (TVRAMTOP),HL
0011B2 DDAB 0E64             7      LD  C,064H
0011B4 DDAD ED69            12      OUT (C),L       ;TVRAM LOW
0011B6 DDAF ED61            12      OUT (C),H       ;TVRAM HIGH
0011B8 DDB1 21B78B          10      LD  HL,08000H+120*25-1
0011BB DDB4 0C               4      INC C       ;65H
0011BC DDB5 ED69            12      OUT (C),L
0011BE DDB7 ED61            12      OUT (C),H
0011C0 DDB9 3ECE             7      LD  A,080H+80-2
0011C2 DDBB D350            11      OUT (050H),A
0011C4 DDBD 3E98             7      LD  A,080H+25-1
0011C6 DDBF D350            11      OUT (050H),A
0011C8 DDC1 DB40            11      IN  A,(040H)
0011CA DDC3 CB4F             8      BIT 1,A
0011CC DDC5 21DE67          10      LD  HL,067DEH
0011CF DDC8 2003            12      JR  NZ,RESO1
0011D1 DDCA 21586F          10      LD  HL,06F58H
       DDCD                     RESO1:
0011D4 DDCD 0E50             7      LD  C,050H
0011D6 DDCF ED61            12      OUT (C),H
0011D8 DDD1 ED69            12      OUT (C),L
                                
0011DA DDD3 3E53             7      LD  A,053H
0011DC DDD5 D350            11      OUT (050H),A
                                
0011DE DDD7 3E43             7      LD  A,043H
0011E0 DDD9 D351            11      OUT (051H),A
                                
0011E2 DDDB 3EE4             7      LD  A,0E4H
0011E4 DDDD D368            11      OUT (068H),A
                                
0011E6 DDDF 3E20             7      LD  A,020H
0011E8 DDE1 D351            11      OUT (051H),A
                                
0011EA DDE3 CD6CDD          17      CALL    VBLANK
       DDE6                     IVBL1:
0011ED DDE6 DB40            11      IN  A,(040H)
0011EF DDE8 CB6F             8      BIT 5,A
0011F1 DDEA 20FA            12      JR  NZ,IVBL1
                                
0011F3 DDEC 3E11             7      LD  A,011H
0011F5 DDEE D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
0011F7 DDF0 32B9EF          13      LD  (WK40),A
0011FA DDF3 C9              10      RET
                                
       DDF4                     BIOS:
0011FB DDF4 F3               4      DI
0011FC DDF5 F5              11      PUSH    AF
0011FD DDF6 3ABFEF          13      LD  A,(WK31)
001200 DDF9 CB8F             8      RES 1,A
001202 DDFB D331            11      OUT (031H),A
001204 DDFD F1              10      POP AF
001205 DDFE CD2FE4          17      CALL    JP_BC
001208 DE01 F5              11      PUSH    AF
001209 DE02 3ABFEF          13      LD  A,(WK31)
00120C DE05 D331            11      OUT (031H),A
00120E DE07 F1              10      POP AF
00120F DE08 FB               4      EI
001210 DE09 C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DE0A                     FILEC:
001211 DE0A CD15DE          17      CALL    FILE
       DE0D                     FILEC2:
001214 DE0D 3A15EF          13      LD  A,(FDRV+1)
001217 DE10 FE20             7      CP  020H
001219 DE12 C8              11      RET Z
00121A DE13 1839            12      JR  SETDIR1
                                
       DE15                     FILE:
00121C DE15 AF               4      XOR A
00121D DE16 3214EF          13      LD  (FDRV),A
001220 DE19 67               4      LD  H,A
001221 DE1A 6F               4      LD  L,A
001222 DE1B 2222EF          16      LD  (FDRV+14),HL
001225 DE1E CDECDE          17      CALL    SPCUT
001228 DE21 CDD1DE          17      CALL    CCHK3
00122B DE24 2812            12      JR  Z,DEVI1
00122D DE26 13               6      INC DE
00122E DE27 1A               7      LD  A,(DE)
00122F DE28 1B               6      DEC DE
001230 DE29 FE3A             7      CP  ':'
001232 DE2B 200B            12      JR  NZ,DEVI1
001234 DE2D 1A               7      LD  A,(DE)      ;DRIVE
001235 DE2E CD21E1          17      CALL    CAP
001238 DE31 D640             7      SUB '@'
00123A DE33 13               6      INC DE
00123B DE34 13               6      INC DE
00123C DE35 3214EF          13      LD  (FDRV),A
       DE38                     DEVI1:
00123F DE38 1A               7      LD  A,(DE)
001240 DE39 D65C             7      SUB 05CH        ;\
001242 DE3B 2009            12      JR  NZ,NOROOT
001244 DE3D 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
001245 DE3E 222EEF          16      LD  (FDRV+26),HL
001248 DE41 2C               4      INC L
001249 DE42 2222EF          16      LD  (FDRV+14),HL
00124C DE45 13               6      INC DE
       DE46                     NOROOT:
                                
       DE46                     SETDIR:
00124D DE46 CD72DE          17      CALL    FILED
001250 DE49 1A               7      LD  A,(DE)
001251 DE4A FE5C             7      CP  05CH        ;\
001253 DE4C C0              11      RET NZ
001254 DE4D 13               6      INC DE
       DE4E                     SETDIR1:
001255 DE4E 3E10             7      LD  A,010H      ;Directory
001257 DE50 3221EF          13      LD  (FDRV+13),A
00125A DE53 D5              11      PUSH    DE
00125B DE54 1114EF          10      LD  DE,FDRV
00125E DE57 2A1EF0          16      LD  HL,(STABLE+2*00FH)
001261 DE5A CD0F00          17      CALL    JP_HL
001264 DE5D D1              10      POP DE
001265 DE5E B7               4      OR  A
001266 DE5F C0              11      RET NZ
                                
001267 DE60 3A21EF          13      LD  A,(FDRV+13)
00126A DE63 CB67             8      BIT 4,A
00126C DE65 C8              11      RET Z
                                
00126D DE66 CDB9DE          17      CALL    FILEI
001270 DE69 2A2EEF          16      LD  HL,(FDRV+26)
001273 DE6C 23               6      INC HL
001274 DE6D 2222EF          16      LD  (FDRV+14),HL
001277 DE70 18D4            12      JR  SETDIR
                                
       DE72                     FILED:
001279 DE72 CDB9DE          17      CALL    FILEI
00127C DE75 2115EF          10      LD  HL,FNAME
                                
00127F DE78 0608             7      LD  B,8
       DE7A                     FILE2:
001281 DE7A CDC6DE          17      CALL    CCHKF
001284 DE7D C8              11      RET Z
001285 DE7E FE2A             7      CP  '*'
001287 DE80 282E            12      JR  Z,FILE9
001289 DE82 FE2E             7      CP  '.'
00128B DE84 280C            12      JR  Z,FILE4
00128D DE86 77               7      LD  (HL),A
00128E DE87 23               6      INC HL
00128F DE88 10F0            13      DJNZ    FILE2
                                
       DE8A                     FILE3:
001291 DE8A CDC6DE          17      CALL    CCHKF
001294 DE8D C8              11      RET Z
001295 DE8E FE2E             7      CP  '.'
001297 DE90 20F8            12      JR  NZ,FILE3
                                
       DE92                     FILE4:
001299 DE92 211DEF          10      LD  HL,FNAME+8
00129C DE95 0603             7      LD  B,3
                                
       DE97                     FILE4L:
00129E DE97 CDC6DE          17      CALL    CCHKF
0012A1 DE9A C8              11      RET Z
0012A2 DE9B FE2E             7      CP  '.'
0012A4 DE9D 2008            12      JR  NZ,FILE12
0012A6 DE9F 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
0012A9 DEA2 3216EF          13      LD  (FNAME+1),A
0012AC DEA5 3E20             7      LD  A,020H
       DEA7                     FILE12:
0012AE DEA7 FE2A             7      CP  '*'
0012B0 DEA9 280A            12      JR  Z,FILE10
0012B2 DEAB 77               7      LD  (HL),A
0012B3 DEAC 23               6      INC HL
0012B4 DEAD 10E8            13      DJNZ    FILE4L
0012B6 DEAF C9              10      RET
                                
       DEB0                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0012B7 DEB0 CDB5DE          17      CALL    FILE10
0012BA DEB3 18D5            12      JR  FILE3
                                
       DEB5                     FILE10:
0012BC DEB5 3E3F             7      LD  A,'?'
0012BE DEB7 1808            12      JR  FILL_MEMORY
       DEB9                     FILEI:              ;名前＋拡張子をスペースで初期化
0012C0 DEB9 3E20             7      LD  A,020H
0012C2 DEBB 01000B          10      LD  BC,11*256   ;C=0にしておく
0012C5 DEBE 2115EF          10      LD  HL,FNAME
       DEC1                     FILL_MEMORY:            ;HLからBバイトAで埋める
0012C8 DEC1 77               7      LD  (HL),A
0012C9 DEC2 23               6      INC HL
0012CA DEC3 10FC            13      DJNZ    FILL_MEMORY
0012CC DEC5 C9              10      RET
                                
       DEC6                     CCHKF:
0012CD DEC6 1A               7      LD  A,(DE)
0012CE DEC7 CDCEDE          17      CALL    CCHK2
0012D1 DECA C8              11      RET Z
0012D2 DECB C339E2          10      JP  FKAN
                                
       DECE                     CCHK2:
0012D5 DECE 0C               4      INC C
0012D6 DECF 0D               4      DEC C
0012D7 DED0 C0              11      RET NZ
       DED1                     CCHK3:              ;ZF=1 で使えない文字
0012D8 DED1 FE2B             7      CP  '+'
0012DA DED3 C8              11      RET Z
0012DB DED4 FE2C             7      CP  ','
0012DD DED6 C8              11      RET Z
0012DE DED7 FE2F             7      CP  '/'
0012E0 DED9 C8              11      RET Z
0012E1 DEDA FE3A             7      CP  ':'
0012E3 DEDC C8              11      RET Z
0012E4 DEDD FE3B             7      CP  ';'
0012E6 DEDF C8              11      RET Z
0012E7 DEE0 FE3D             7      CP  '='
0012E9 DEE2 C8              11      RET Z
0012EA DEE3 FE5C             7      CP  05CH    ;\
0012EC DEE5 C8              11      RET Z
0012ED DEE6 FE20             7      CP  020H
0012EF DEE8 D0              11      RET NC
0012F0 DEE9 BF               4      CP  A       ;Z=1
0012F1 DEEA C9              10      RET
                                
       DEEB                     SS1:
0012F2 DEEB 13               6      INC DE
       DEEC                     SPCUT:              ;スペースをカット
0012F3 DEEC 1A               7      LD  A,(DE)
0012F4 DEED FE20             7      CP  020H
0012F6 DEEF 28FA            12      JR  Z,SS1
0012F8 DEF1 C9              10      RET
                                
       DEF2                     SETDRVF:
0012F9 DEF2 1114EF          10      LD  DE,FDRV
       DEF5                     SETDRV0:
0012FC DEF5 CDFEDE          17      CALL    SETDRV
0012FF DEF8 FDE1            14      POP IY
001301 DEFA C1              10      POP BC
001302 DEFB D1              10      POP DE
001303 DEFC E1              10      POP HL
001304 DEFD C9              10      RET
                                
       DEFE                     SETDRV:
001305 DEFE E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
001306 DEFF D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
001307 DF00 C5              11      PUSH    BC
001308 DF01 1A               7      LD  A,(DE)
001309 DF02 D5              11      PUSH    DE
00130A DF03 FDE3            23      EX  (SP),IY
                                
00130C DF05 CD11DF          17      CALL    GETDRV
00130F DF08 3C               4      INC A
001310 DF09 FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001313 DF0C 3D               4      DEC A
001314 DF0D CDD9EF          17      CALL    _CHGDRV
                                
001317 DF10 E9               4      JP  (HL)
                                
       DF11                     GETDRV:
001318 DF11 E67F             7      AND 07FH
00131A DF13 D601             7      SUB 001H
00131C DF15 3003            12      JR  NC,GETDRV1
00131E DF17 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DF1A                     GETDRV1:
001321 DF1A 3288EF          13      LD  (_DRV),A
001324 DF1D C9              10      RET
                                
       DF1E                     SOPENX:
001325 DF1E 1139EF          10      LD  DE,SFILE
001328 DF21 1A               7      LD  A,(DE)
001329 DF22 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
00132C DF25 2024            12      JR  NZ,SOPEN
00132E DF27 13               6      INC DE
00132F DF28 FDE5            15      PUSH    IY
001331 DF2A E1              10      POP HL
001332 DF2B 23               6      INC HL
001333 DF2C CDB9E0          17      CALL    CPFILE
001336 DF2F 201A            12      JR  NZ,SOPEN
                                
001338 DF31 2AF4F0          16      LD  HL,(SCDIR)
00133B DF34 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00133E DF37 FD740F          19      LD  (IY+15),H
                                
001341 DF3A 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001344 DF3D 229FEF          16      LD  (_FILEN),HL
                                
001347 DF40 ED5BF6F0        20      LD  DE,(SFBPS)
00134B DF44 2139EF          10      LD  HL,SFILE
00134E DF47 36FF            10      LD  (HL),0FFH
001350 DF49 23               6      INC HL
001351 DF4A C9              10      RET
       DF4B                     SOPEN:
001352 DF4B 2161E0          10      LD  HL,FILESE
       DF4E                     SOPENC:
001355 DF4E 2287DF          16      LD  (OPENPAT+1),HL
                                
001358 DF51 CDE2EF          17      CALL    _RDFATX     ;Detect Media
00135B DF54 3856            12      JR  C,RDDERR
                                
00135D DF56 AF               4      XOR A
00135E DF57 329FEF          13      LD  (_FILEN),A
001361 DF5A CD66E1          17      CALL    LDDIRX1     ;A=0で呼び出す
001364 DF5D 2818            12      JR  Z,SDIRX1
                                
001366 DF5F CD52E0          17      CALL    READ_DIR    ;Sub Directory
001369 DF62 3808            12      JR  C,SDIRX0
00136B DF64 2A7EF0          16      LD  HL,(_DTBUF)
00136E DF67 7E               7      LD  A,(HL)
00136F DF68 FE2E             7      CP  '.'
001371 DF6A 280F            12      JR  Z,SOPEN1
       DF6C                     SDIRX0:
001373 DF6C AF               4      XOR A
001374 DF6D 32A0EF          13      LD  (_DIRF),A
001377 DF70 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
00137B DF74 FD770F          19      LD  (IY+15),A
       DF77                     SDIRX1:
00137E DF77 ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DF7B                     SOPEN1:
001382 DF7B 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DF7D                     SOPEN1X:
001384 DF7D CD52E0          17      CALL    READ_DIR    ;FILE SEARCH
001387 DF80 382A            12      JR  C,RDDERR
001389 DF82 2A7EF0          16      LD  HL,(_DTBUF)
       DF85                     SOPEN2:
00138C DF85 D5              11      PUSH    DE
00138D DF86 CD61E0          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
001390 DF89 D1              10      POP DE
001391 DF8A 386E            12      JR  C,SOPENE
001393 DF8C 281B            12      JR  Z,SCF_FF_RET
       DF8E                     SOPEN3:
001395 DF8E 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001398 DF91 B7               4      OR  A
001399 DF92 200C            12      JR  NZ,SOPEN5
00139B DF94 13               6      INC DE      ;ルートディレクトリ
00139C DF95 E5              11      PUSH    HL
00139D DF96 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0013A0 DF99 ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0013A2 DF9B E1              10      POP HL
0013A3 DF9C 20DD            12      JR  NZ,SOPEN1
0013A5 DF9E 1807            12      JR  SOPEN6
       DFA0                     SOPEN5:
0013A7 DFA0 CD95E8          17      CALL    GNCLX       ;END DIR
0013AA DFA3 D8              11      RET C
0013AB DFA4 CD19E1          17      CALL    ENDCL
       DFA7                     SOPEN6:
0013AE DFA7 38D2            12      JR  C,SOPEN1
       DFA9                     SCF_FF_RET:
0013B0 DFA9 37               4      SCF         ;CF=1
0013B1 DFAA 9F               4      SBC A,A     ;A=0FFH
0013B2 DFAB C9              10      RET
                                
       DFAC                     RDDERR:
0013B3 DFAC BF               4      CP  A       ;READ ERR CF=1 ZF=1
0013B4 DFAD 37               4      SCF
0013B5 DFAE C9              10      RET
                                
       DFAF                     NOPEN:
0013B6 DFAF 2161E0          10      LD  HL,FILESE
0013B9 DFB2 2287DF          16      LD  (OPENPAT+1),HL
0013BC DFB5 FD2A98EF        20      LD  IY,(_FCB)
0013C0 DFB9 CD4CE2          17      CALL    CHKWILDX
0013C3 DFBC 30EB            12      JR  NC,SCF_FF_RET
0013C5 DFBE FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
0013C8 DFC1 3D               4      DEC A
0013C9 DFC2 3288EF          13      LD  (_DRV),A
0013CC DFC5 CDD9EF          17      CALL    _CHGDRV
0013CF DFC8 D8              11      RET C
0013D0 DFC9 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0013D3 DFCC 229FEF          16      LD  (_FILEN),HL
                                
0013D6 DFCF CD61E1          17      CALL    LDDIRX
0013D9 DFD2 ED5B9AEF        20      LD  DE,(_FBPS)
0013DD DFD6 CD52E0          17      CALL    READ_DIR
0013E0 DFD9 38D1            12      JR  C,RDDERR
0013E2 DFDB 3A9EEF          13      LD  A,(_FBCNT)
0013E5 DFDE 3D               4      DEC A
0013E6 DFDF 28AD            12      JR  Z,SOPEN3
       DFE1                     NOPEN2:
0013E8 DFE1 2A9CEF          16      LD  HL,(_FBAD)
0013EB DFE4 012000          10      LD  BC,020H
0013EE DFE7 09              11      ADD HL,BC
0013EF DFE8 4F               4      LD  C,A
0013F0 DFE9 189A            12      JR  SOPEN2
                                
       DFEB                     SOPENE2:
0013F2 DFEB 229CEF          16      LD  (_FBAD),HL
0013F5 DFEE 79               4      LD  A,C
0013F6 DFEF 329EEF          13      LD  (_FBCNT),A
0013F9 DFF2 ED539AEF        20      LD  (_FBPS),DE
0013FD DFF6 FD2298EF        20      LD  (_FCB),IY
       DFFA                     SOPENE:
001401 DFFA AF               4      XOR A
001402 DFFB C9              10      RET
                                
       DFFC                     COPEN:
001403 DFFC FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
001407 E000 217EE0          10      LD  HL,NEXTSE
00140A E003 CD4EDF          17      CALL    SOPENC
00140D E006 D0              11      RET NC
00140E E007 C8              11      RET Z
00140F E008 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001412 E00B B7               4      OR  A
001413 E00C 37               4      SCF
001414 E00D C8              11      RET Z       ;ルートディレクトリ
001415 E00E 0601             7      LD  B,1
001417 E010 CDAAE2          17      CALL    WRDF
00141A E013 D8              11      RET C
00141B E014 ED5BFEF0        20      LD  DE,(_CLPS)
00141F E018 D5              11      PUSH    DE
001420 E019 CDE2E0          17      CALL    DCPAT
001423 E01C CD20E7          17      CALL    DRDNX
001426 E01F 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
001429 E022 3A1EE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
00142C E025 47               4      LD  B,A
00142D E026 AF               4      XOR A
00142E E027 4F               4      LD  C,A
       E028                     COPENCL:
00142F E028 77               7      LD  (HL),A
001430 E029 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001432 E02B EA28E0          10      JP  PE,COPENCL
                                
001435 E02E 3A00E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
001438 E031 3D               4      DEC A
001439 E032 2819            12      JR  Z,COPENE
00143B E034 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
00143D E036 328DE8          13      LD  (_SECPS+1),A
001440 E039 D1              10      POP DE      ;DE=(_CLPS)
001441 E03A D5              11      PUSH    DE
       E03B                     COPEN1:
001442 E03B D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001443 E03C C5              11      PUSH    BC
001444 E03D 2A7EF0          16      LD  HL,(_DTBUF)
001447 E040 CDFCE0          17      CALL    CLUSTX
00144A E043 CDF8E9          17      CALL    DWT24
00144D E046 C1              10      POP BC
00144E E047 D1              10      POP DE
00144F E048 CD8CE8          17      CALL    NEXTX
001452 E04B 20EE            12      JR  NZ,COPEN1
       E04D                     COPENE:
001454 E04D 2A7EF0          16      LD  HL,(_DTBUF)
001457 E050 D1              10      POP DE
001458 E051 C9              10      RET
                                
       E052                     READ_DIR:
001459 E052 ED53FEF0        20      LD  (_CLPS),DE
00145D E056 C5              11      PUSH    BC
00145E E057 D5              11      PUSH    DE
00145F E058 CDE2E0          17      CALL    DCPAT
001462 E05B CD00E7          17      CALL    DRDX
001465 E05E D1              10      POP DE
001466 E05F C1              10      POP BC
001467 E060 C9              10      RET
                                
       E061                     FILESE:
001468 E061 7E               7      LD  A,(HL)
001469 E062 B7               4      OR  A
00146A E063 C8              11      RET Z       ;END:ZF=1 CF=0
00146B E064 FEE5             7      CP  0E5H
00146D E066 280E            12      JR  Z,FILESE1
00146F E068 FDE5            15      PUSH    IY
001471 E06A D1              10      POP DE
001472 E06B 13               6      INC DE
001473 E06C E5              11      PUSH    HL
001474 E06D CDB9E0          17      CALL    CPFILE
001477 E070 CCDAE0          17      CALL    Z,CPFILE2
00147A E073 E1              10      POP HL
00147B E074 37               4      SCF
00147C E075 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       E076                     FILESE1:
00147D E076 CD8DE0          17      CALL    FNEXT
001480 E079 20E6            12      JR  NZ,FILESE
       E07B                     ZF0_CF0_AFF_RET:
001482 E07B F6FF             7      OR  0FFH        ;ZF=0 CF=0
001484 E07D C9              10      RET
                                
       E07E                     NEXTSE:
001485 E07E 7E               7      LD  A,(HL)
001486 E07F B7               4      OR  A
001487 E080 37               4      SCF
001488 E081 C8              11      RET Z       ;!!!:ZF=1 CF=1
001489 E082 FEE5             7      CP  0E5H
00148B E084 37               4      SCF
00148C E085 C8              11      RET Z       ;!!!:(ZF=1) CF=1
00148D E086 CD8DE0          17      CALL    FNEXT
001490 E089 20F3            12      JR  NZ,NEXTSE
001492 E08B 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       E08D                     FNEXT:
001494 E08D E5              11      PUSH    HL
001495 E08E 219FEF          10      LD  HL,_FILEN
001498 E091 34              11      INC (HL)
001499 E092 E1              10      POP HL
00149A E093 112000          10      LD  DE,020H
00149D E096 19              11      ADD HL,DE
00149E E097 0D               4      DEC C
00149F E098 C9              10      RET
                                
       E099                     CPNAME:
0014A0 E099 C5              11      PUSH    BC
0014A1 E09A D5              11      PUSH    DE
0014A2 E09B E5              11      PUSH    HL
0014A3 E09C CDB3E0          17      CALL    CPFILE4
0014A6 E09F E1              10      POP HL
0014A7 E0A0 23               6      INC HL
0014A8 E0A1 23               6      INC HL
0014A9 E0A2 23               6      INC HL
0014AA E0A3 23               6      INC HL
0014AB E0A4 D1              10      POP DE
0014AC E0A5 C1              10      POP BC
0014AD E0A6 2005            12      JR  NZ,CPNAME1
0014AF E0A8 7E               7      LD  A,(HL)
0014B0 E0A9 23               6      INC HL
0014B1 E0AA 66               7      LD  H,(HL)
0014B2 E0AB 6F               4      LD  L,A
0014B3 E0AC C9              10      RET
       E0AD                     CPNAME1:
0014B4 E0AD 23               6      INC HL
0014B5 E0AE 23               6      INC HL
0014B6 E0AF 10E8            13      DJNZ    CPNAME
0014B8 E0B1 37               4      SCF
0014B9 E0B2 C9              10      RET
                                
       E0B3                     CPFILE4:
0014BA E0B3 C5              11      PUSH    BC
0014BB E0B4 010004          10      LD  BC,00400H
0014BE E0B7 1804            12      JR  CPSTR1
       E0B9                     CPFILE:
0014C0 E0B9 C5              11      PUSH    BC
0014C1 E0BA 01000B          10      LD  BC,00B00H
       E0BD                     CPSTR1:
0014C4 E0BD 1A               7      LD  A,(DE)
0014C5 E0BE FE3F             7      CP  '?'     ;Wild card
0014C7 E0C0 2812            12      JR  Z,CPSTR2
0014C9 E0C2 7E               7      LD  A,(HL)
0014CA E0C3 CD32E2          17      CALL    FKANC
0014CD E0C6 E5              11      PUSH    HL
0014CE E0C7 67               4      LD  H,A
0014CF E0C8 1A               7      LD  A,(DE)
0014D0 E0C9 CB01             4      RLC C
0014D2 E0CB CD32E2          17      CALL    FKANC
0014D5 E0CE CB09             4      RRC C
0014D7 E0D0 BC               4      CP  H       ;CP (HL),(DE)
0014D8 E0D1 E1              10      POP HL
0014D9 E0D2 2004            12      JR  NZ,CPSTR3
       E0D4                     CPSTR2:
0014DB E0D4 13               6      INC DE
0014DC E0D5 23               6      INC HL
0014DD E0D6 10E5            13      DJNZ    CPSTR1
       E0D8                     CPSTR3:
0014DF E0D8 C1              10      POP BC
0014E0 E0D9 C9              10      RET
                                
       E0DA                     CPFILE2:
0014E1 E0DA FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0014E4 E0DD F6E1             7      OR  0E1H
0014E6 E0DF 2F               4      CPL
0014E7 E0E0 A6               7      AND (HL)
0014E8 E0E1 C9              10      RET
                                
       E0E2                     DCPAT:
0014E9 E0E2 0E00             7      LD  C,0
0014EB E0E4 2A7EF0          16      LD  HL,(_DTBUF)
0014EE E0E7 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0014F1 E0EA B7               4      OR  A
0014F2 E0EB C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0014F3 E0EC 3A00E1          13      LD  A,(SPCPAT+1)
0014F6 E0EF 4F               4      LD  C,A
0014F7 E0F0 3A8DE8          13      LD  A,(_SECPS+1)
0014FA E0F3 B9               4      CP  C
0014FB E0F4 3801            12      JR  C,DC1
0014FD E0F6 AF               4      XOR A
       E0F7                     DC1:
0014FE E0F7 F680             7      OR  080H
001500 E0F9 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E0FC                     CLUSTX:
001503 E0FC E5              11      PUSH    HL
001504 E0FD EB               4      EX  DE,HL
001505 E0FE AF               4      XOR A
001506 E0FF 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E101                     L_CLDBL:
001508 E101 CB19             8      RR  C       ;->CF
00150A E103 3804            12      JR  C,E_CLDBL
00150C E105 29              11      ADD HL,HL       ;*2
00150D E106 8F               4      ADC A,A
00150E E107 18F8            12      JR  L_CLDBL
       E109                     E_CLDBL:
001510 E109 4F               4      LD  C,A
001511 E10A 3A8DE8          13      LD  A,(_SECPS+1)
001514 E10D B5               4      OR  L
001515 E10E 6F               4      LD  L,A
001516 E10F 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
001519 E112 AF               4      XOR A
00151A E113 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00151B E114 89               4      ADC A,C
00151C E115 4F               4      LD  C,A
00151D E116 EB               4      EX  DE,HL
00151E E117 E1              10      POP HL
00151F E118 C9              10      RET
                                
       E119                     ENDCL:
001520 E119 7A               4      LD  A,D ;END CLUSTER
001521 E11A FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001523 E11C C0              11      RET NZ
001524 E11D 7B               4      LD  A,E
001525 E11E FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
001527 E120 C9              10      RET
                                
       E121                     CAP:
001528 E121 FE61             7      CP  'a'
00152A E123 D8              11      RET C
00152B E124 FE7B             7      CP  'z'+1
00152D E126 D0              11      RET NC
00152E E127 D620             7      SUB 020H
001530 E129 C9              10      RET
       E12A                     CAP2:
001531 E12A CD21E1          17      CALL    CAP
       E12D                     CAP3:
001534 E12D CD36E1          17      CALL    CAP4
001537 E130 FE21             7      CP  021H
001539 E132 D0              11      RET NC
00153A E133 3EA0             7      LD  A,0A0H
00153C E135 C9              10      RET
       E136                     CAP4:
00153D E136 FE05             7      CP  5
00153F E138 C0              11      RET NZ
001540 E139 3EE5             7      LD  A,0E5H
001542 E13B C9              10      RET
                                
       E13C                     CHDIR:
001543 E13C CD26EB          17      CALL    GETDPBD
001546 E13F 381D            12      JR  C,CHDIR2
001548 E141 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
00154B E144 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
00154E E147 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E149                     LDDIR:
001550 E149 CD26EB          17      CALL    GETDPBD
001553 E14C DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
001556 E14F DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
001559 E152 13               6      INC DE
00155A E153 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
00155D E156 FD720F          19      LD  (IY+15),D
001560 E159 1B               6      DEC DE
001561 E15A AF               4      XOR A
001562 E15B 32A0EF          13      LD  (_DIRF),A
       E15E                     CHDIR2:
001565 E15E DDE1            14      POP IX
001567 E160 C9              10      RET
                                
       E161                     LDDIRX:
001568 E161 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00156B E164 E67F             7      AND 07FH
       E166                     LDDIRX1:
00156D E166 328DE8          13      LD  (_SECPS+1),A
001570 E169 FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001573 E16C FD560F          19      LD  D,(IY+15)
001576 E16F 1B               6      DEC DE
001577 E170 CD19E1          17      CALL    ENDCL
00157A E173 D449E1          17      CALL    NC,LDDIR
       E176                     LDDIRS:
00157D E176 7A               4      LD  A,D
00157E E177 B3               4      OR  E
00157F E178 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
001582 E17B C9              10      RET
                                
       E17C                     KILL:
001583 E17C CD4CE2          17      CALL    CHKWILDX
001586 E17F 3834            12      JR  C,KILLW
001588 E181 CD1EDF          17      CALL    SOPENX
       E184                     KILLS:
00158B E184 3E1F             7      LD  A,01FH
00158D E186 D4C8E1          17      CALL    NC,CHKATT
001590 E189 D8              11      RET C
       E18A                     KILLSX:
001591 E18A 36E5            10      LD  (HL),0E5H   ;DIR
001593 E18C CD26E2          17      CALL    WTDB
001596 E18F 111A00          10      LD  DE,01AH
001599 E192 19              11      ADD HL,DE
00159A E193 5E               7      LD  E,(HL)
00159B E194 23               6      INC HL
00159C E195 56               7      LD  D,(HL)
       E196                     KILLS1:
00159D E196 CD19E1          17      CALL    ENDCL
0015A0 E199 D0              11      RET NC      ;CF=0
0015A1 E19A 21FEFF          10      LD  HL,0-2
0015A4 E19D 19              11      ADD HL,DE
0015A5 E19E D0              11      RET NC      ;DE= 0 or 1
0015A6 E19F D5              11      PUSH    DE
0015A7 E1A0 CDF7EF          17      CALL    _GNCL
0015AA E1A3 ED53FEF0        20      LD  (_CLPS),DE
0015AE E1A7 D1              10      POP DE
0015AF E1A8 210000          10      LD  HL,0
0015B2 E1AB D4FAEF          17      CALL    NC,_SNCL
0015B5 E1AE D8              11      RET C
0015B6 E1AF ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
0015BA E1B3 18E1            12      JR  KILLS1
                                
       E1B5                     KILLW:
0015BC E1B5 CD4BDF          17      CALL    SOPEN
       E1B8                     KILLW1:
0015BF E1B8 380B            12      JR  C,KILLW2
0015C1 E1BA CDEBDF          17      CALL    SOPENE2
0015C4 E1BD CD84E1          17      CALL    KILLS
0015C7 E1C0 CDAFDF          17      CALL    NOPEN
0015CA E1C3 18F3            12      JR  KILLW1
       E1C5                     KILLW2:
0015CC E1C5 C8              11      RET Z
0015CD E1C6 3F               4      CCF
0015CE E1C7 C9              10      RET
                                
       E1C8                     CHKATT:
0015CF E1C8 E5              11      PUSH    HL
0015D0 E1C9 110B00          10      LD  DE,00BH
0015D3 E1CC 19              11      ADD HL,DE
0015D4 E1CD A6               7      AND (HL)
0015D5 E1CE E1              10      POP HL
0015D6 E1CF C8              11      RET Z
0015D7 E1D0 37               4      SCF
0015D8 E1D1 C9              10      RET
                                
       E1D2                     NAME:
0015D9 E1D2 CD4CE2          17      CALL    CHKWILDX
0015DC E1D5 D8              11      RET C
0015DD E1D6 110400          10      LD  DE,4
0015E0 E1D9 19              11      ADD HL,DE
0015E1 E1DA 22F2E1          16      LD  (NAMEP+2),HL
0015E4 E1DD 23               6      INC HL
0015E5 E1DE CD50E2          17      CALL    CHKWILD
0015E8 E1E1 D8              11      RET C
                                
0015E9 E1E2 CD1EDF          17      CALL    SOPENX
0015EC E1E5 3E0F             7      LD  A,00FH
0015EE E1E7 D4C8E1          17      CALL    NC,CHKATT
0015F1 E1EA D8              11      RET C
                                
0015F2 E1EB FD7E00          19      LD  A,(IY+0)
0015F5 E1EE FDE5            15      PUSH    IY
0015F7 E1F0 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
0015FB E1F4 FD7700          19      LD  (IY+0),A
0015FE E1F7 CD1EDF          17      CALL    SOPENX
001601 E1FA FDE3            23      EX  (SP),IY
001603 E1FC 3F               4      CCF
001604 E1FD D44BDF          17      CALL    NC,SOPEN
001607 E200 EB               4      EX  DE,HL
001608 E201 E1              10      POP HL
001609 E202 D8              11      RET C
                                
       E203                     SETNAME:
00160A E203 01000B          10      LD  BC,11*256
00160D E206 23               6      INC HL
00160E E207 7E               7      LD  A,(HL)
00160F E208 FEE5             7      CP  0E5H
001611 E20A 2004            12      JR  NZ,SNAME1
001613 E20C 3E05             7      LD  A,5
001615 E20E 180E            12      JR  SNAME3
       E210                     SNAME1:
001617 E210 7E               7      LD  A,(HL)
001618 E211 0C               4      INC C
001619 E212 0D               4      DEC C
00161A E213 2009            12      JR  NZ,SNAME3
00161C E215 CD21E1          17      CALL    CAP
00161F E218 FEA0             7      CP  0A0H
001621 E21A 2002            12      JR  NZ,SNAME3
001623 E21C 3E20             7      LD  A,020H
       E21E                     SNAME3:
001625 E21E 12               7      LD  (DE),A
001626 E21F 7E               7      LD  A,(HL)
001627 E220 23               6      INC HL
001628 E221 CD39E2          17      CALL    FKAN
00162B E224 10EA            13      DJNZ    SNAME1
       E226                     WTDB:
00162D E226 3EFF             7      LD  A,0FFH
00162F E228 3239EF          13      LD  (SFILE),A
       E22B                     SWTDBF:
001632 E22B 3E01             7      LD  A,1
001634 E22D 32A4EF          13      LD  (_WTDBF),A
001637 E230 AF               4      XOR A
001638 E231 C9              10      RET
                                
       E232                     FKANC:
001639 E232 CB41             8      BIT 0,C
00163B E234 CC2AE1          17      CALL    Z,CAP2
00163E E237 1801            12      JR  FKANX
       E239                     FKAN:           ;漢字チェック
001640 E239 13               6      INC DE
       E23A                     FKANX:
001641 E23A CB41             8      BIT 0,C
001643 E23C CB81             8      RES 0,C
001645 E23E C0              11      RET NZ
001646 E23F FE80             7      CP  080H
001648 E241 D8              11      RET C
001649 E242 FEA0             7      CP  0A0H
00164B E244 3803            12      JR  C,FKAN1
00164D E246 FEE0             7      CP  0E0H
00164F E248 D8              11      RET C
       E249                     FKAN1:
001650 E249 0C               4      INC C
001651 E24A A7               4      AND A
001652 E24B C9              10      RET
                                
       E24C                     CHKWILDX:
001653 E24C FDE5            15      PUSH    IY
001655 E24E E1              10      POP HL
001656 E24F 23               6      INC HL
       E250                     CHKWILD:
001657 E250 060B             7      LD  B,11
001659 E252 3E3F             7      LD  A,'?'
       E254                     CHKWIL1:
00165B E254 BE               7      CP  (HL)
00165C E255 23               6      INC HL
00165D E256 37               4      SCF
00165E E257 C8              11      RET Z
00165F E258 10FA            13      DJNZ    CHKWIL1
001661 E25A AF               4      XOR A
001662 E25B C9              10      RET
                                
       E25C                     SDIRENT:        ;IY=FCB HL=DIR
001663 E25C D5              11      PUSH    DE
001664 E25D E5              11      PUSH    HL
001665 E25E FDE5            15      PUSH    IY
001667 E260 D1              10      POP DE
001668 E261 EB               4      EX  DE,HL
001669 E262 CD03E2          17      CALL    SETNAME
                                ;               Attribute
00166C E265 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
00166F E268 12               7      LD  (DE),A
001670 E269 13               6      INC DE
                                ;               Reserved
001671 E26A AF               4      XOR A
001672 E26B 060A             7      LD  B,10
       E26D                     SDE1:
001674 E26D 12               7      LD  (DE),A
001675 E26E 13               6      INC DE
001676 E26F 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
001678 E271 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
00167B E274 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E276                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
00167D E276 7E               7      LD  A,(HL)
00167E E277 23               6      INC HL
00167F E278 327DE2          13      LD  (SDPAT+2),A
001682 E27B FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001685 E27E 12               7      LD  (DE),A
001686 E27F 13               6      INC DE
001687 E280 10F4            13      DJNZ    SDLOOP
                                
001689 E282 AF               4      XOR A
00168A E283 E1              10      POP HL
00168B E284 D1              10      POP DE
00168C E285 C9              10      RET
                                
       E286                     WOPEN:
00168D E286 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001690 E289 E61F             7      AND 01FH
001692 E28B 37               4      SCF
001693 E28C C0              11      RET NZ
001694 E28D FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E291                     TOPEN2:
001698 E291 AF               4      XOR A
       E292                     TOPEN:              ;Initializes the time stamp
001699 E292 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
00169D E296 C9              10      RET
                                
       E297                     WRDFX:
00169E E297 3A00E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E29A                     L_WRFX:
0016A1 E29A 1F               4      RRA         ;->CF
0016A2 E29B 3806            12      JR  C,E_WRFX
0016A4 E29D CB39             8      SRL C
0016A6 E29F CB1C             8      RR  H       ;CH=CH/2
0016A8 E2A1 18F7            12      JR  L_WRFX
       E2A3                     E_WRFX:
0016AA E2A3 44               4      LD  B,H
0016AB E2A4 04               4      INC B
0016AC E2A5 3E37             7      LD  A,037H      ;SCF
0016AE E2A7 321DE7          13      LD  (DRDN1),A
                                
       E2AA                     WRDF:               ;Bクラスタ分FATを確保する
0016B1 E2AA 110200          10      LD  DE,2
0016B4 E2AD AF               4      XOR A
0016B5 E2AE 328DE8          13      LD  (_SECPS+1),A
       E2B1                     WRDF1:
0016B8 E2B1 C5              11      PUSH    BC
0016B9 E2B2 D5              11      PUSH    DE
0016BA E2B3 CDF7EF          17      CALL    _GNCL
0016BD E2B6 381C            12      JR  C,WRDF3
0016BF E2B8 7A               4      LD  A,D     ;空いているかチェック
0016C0 E2B9 B3               4      OR  E
0016C1 E2BA 2027            12      JR  NZ,WRDF4
0016C3 E2BC E1              10      POP HL      ;HL=空いているクラスタ
0016C4 E2BD E5              11      PUSH    HL
0016C5 E2BE ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0016C9 E2C2 22FEF0          16      LD  (_CLPS),HL
0016CC E2C5 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0016CD E2C6 B3               4      OR  E
0016CE E2C7 2008            12      JR  NZ,WRDF2
0016D0 E2C9 FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0016D3 E2CC FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0016D6 E2CF 1803            12      JR  WRDF3
       E2D1                     WRDF2:
0016D8 E2D1 CDFAEF          17      CALL    _SNCL
       E2D4                     WRDF3:
0016DB E2D4 D1              10      POP DE
0016DC E2D5 C1              10      POP BC
0016DD E2D6 D8              11      RET C
0016DE E2D7 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
0016E0 E2D9 ED5BFEF0        20      LD  DE,(_CLPS)
0016E4 E2DD 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0016E7 E2E0 C3FAEF          10      JP  _SNCL
                                
       E2E3                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0016EA E2E3 D1              10      POP DE
0016EB E2E4 C1              10      POP BC
       E2E5                     WRDF5:
0016EC E2E5 13               6      INC DE
0016ED E2E6 CD19E1          17      CALL    ENDCL
0016F0 E2E9 38C6            12      JR  C,WRDF1
0016F2 E2EB 37               4      SCF
0016F3 E2EC C9              10      RET
                                
       E2ED                     RWXR:
0016F4 E2ED 3A1EE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E2F0                     L_RWX:
0016F7 E2F0 1F               4      RRA     ;->CF
0016F8 E2F1 3808            12      JR  C,E_RWX
0016FA E2F3 CB38             8      SRL B   ;BCH=BCH/2
0016FC E2F5 CB19             8      RR  C   ;
0016FE E2F7 CB1C             8      RR  H   ;
001700 E2F9 18F5            12      JR  L_RWX
       E2FB                     E_RWX:
001702 E2FB FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001705 E2FE FD561B          19      LD  D,(IY+27)
001708 E301 AF               4      XOR A
001709 E302 328DE8          13      LD  (_SECPS+1),A
       E305                     RWX1:
00170C E305 ED53FEF0        20      LD  (_CLPS),DE
001710 E309 7A               4      LD  A,D
001711 E30A B3               4      OR  E
001712 E30B 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001714 E30D 78               4      LD  A,B
001715 E30E B1               4      OR  C
001716 E30F B4               4      OR  H
001717 E310 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
001718 E311 CD95E8          17      CALL    GNCLX
00171B E314 D8              11      RET C
00171C E315 7C               4      LD  A,H     ;
00171D E316 25               4      DEC H       ;
00171E E317 B7               4      OR  A       ;DEC BCH
00171F E318 2001            12      JR  NZ,RWX2     ;
001721 E31A 0B               6      DEC BC      ;
       E31B                     RWX2:
001722 E31B CD19E1          17      CALL    ENDCL
001725 E31E 38E5            12      JR  C,RWX1
       E320                     SCF_RET:
001727 E320 37               4      SCF
001728 E321 C9              10      RET
                                
       E322                     DSKF:
001729 E322 110000          10  MAXCLP: LD  DE,0
00172C E325 2AACEF          16      LD  HL,(_FAKEFREE)
00172F E328 7C               4      LD  A,H
001730 E329 B5               4      OR  L
001731 E32A 2803            12      JR  Z,DSKF1
001733 E32C 110100          10      LD  DE,1
       E32F                     DSKF1:
001736 E32F D5              11      PUSH    DE
001737 E330 CDF7EF          17      CALL    _GNCL
00173A E333 380C            12      JR  C,POPSCF
00173C E335 7A               4      LD  A,D
00173D E336 B3               4      OR  E
00173E E337 2001            12      JR  NZ,DSKF2
001740 E339 23               6      INC HL
       E33A                     DSKF2:
001741 E33A D1              10      POP DE
001742 E33B 1B               6      DEC DE
001743 E33C 7A               4      LD  A,D
001744 E33D B3               4      OR  E
001745 E33E 20EF            12      JR  NZ,DSKF1
001747 E340 C9              10      RET
                                
       E341                     POPSCF:
001748 E341 F1              10      POP AF
001749 E342 37               4      SCF
00174A E343 C9              10      RET
                                
       E344                     SETTMS:
00174B E344 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
00174E E347 3C               4      INC A
00174F E348 C0              11      RET NZ      ;ファイルが更新されていない
       E349                     SETTMSX:            ;FCBに日付時刻をセットする
001750 E349 CDC7D9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001753 E34C CB25             8      SLA L       ;   *2
001755 E34E CB25             8      SLA L       ;   *4
001757 E350 29              11      ADD HL,HL       ;*2 *8
001758 E351 29              11      ADD HL,HL       ;*4 *16
001759 E352 29              11      ADD HL,HL       ;*8 *32
00175A E353 7A               4      LD  A,D
00175B E354 0F               4      RRCA            ;bit.0->7->->->0->C
00175C E355 E61F             7      AND 01FH
00175E E357 B5               4      OR  L
00175F E358 FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001762 E35B FD7417          19      LD  (IY+23),H
                                
001765 E35E CDA0D9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
001768 E361 0144F8          10      LD  BC,0-1980
00176B E364 09              11      ADD HL,BC
00176C E365 65               4      LD  H,L
                                
00176D E366 7A               4      LD  A,D
00176E E367 87               4      ADD A,A     ;*2
00176F E368 87               4      ADD A,A     ;*4
001770 E369 87               4      ADD A,A     ;*8
001771 E36A 87               4      ADD A,A     ;*16
001772 E36B 6F               4      LD  L,A
001773 E36C 29              11      ADD HL,HL       ;*32
001774 E36D 7D               4      LD  A,L
001775 E36E B3               4      OR  E
001776 E36F FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
001779 E372 FD7415          19      LD  (IY+21),H
00177C E375 C9              10      RET
                                
       E376                     PUSHRR:
00177D E376 3215E4          13      LD  (SETSEQ_SWC_RND),A
001780 E379 2227E4          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001783 E37C CD9CE3          17      CALL    GET_RR_AHL
001786 E37F 225AEF          16      LD  (HLBUF),HL
001789 E382 325CEF          13      LD  (HLBUF+2),A
00178C E385 C9              10      RET
                                
       E386                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
00178D E386 87               4      ADD A,A     ;in BHLA => out AHL
00178E E387 ED6A            15      ADC HL,HL
001790 E389 CB18             8      RR  B
001792 E38B B7               4      OR  A
001793 E38C 78               4      LD  A,B     ;ここでフラグは変化しない
001794 E38D C8              11      RET Z
001795 E38E 2C               4      INC L       ;INC AHL
001796 E38F C0              11      RET NZ      ;
001797 E390 24               4      INC H       ;
001798 E391 C0              11      RET NZ      ;
001799 E392 3C               4      INC A       ;
00179A E393 C9              10      RET
                                
       E394                     INIT_RND:
00179B E394 3ECD             7      LD  A,0CDH      ;CALL ????
00179D E396 21E5E3          10      LD  HL,POPRR
0017A0 E399 CD76E3          17      CALL    PUSHRR
       E39C                     GET_RR_AHL:
0017A3 E39C FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0017A6 E39F FD6622          19      LD  H,(IY+34)   ;
0017A9 E3A2 FD7E23          19      LD  A,(IY+35)   ;
0017AC E3A5 C9              10      RET
       E3A6                     SET_RR_AHL:
0017AD E3A6 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0017B0 E3A9 FD7422          19      LD  (IY+34),H
0017B3 E3AC FD7723          19      LD  (IY+35),A
0017B6 E3AF C9              10      RET
       E3B0                     INIT_SEQ:
0017B7 E3B0 3E01             7      LD  A,1     ;LD BC,????
0017B9 E3B2 21E2E3          10      LD  HL,SETSEQ
0017BC E3B5 CD76E3          17      CALL    PUSHRR
       E3B8                     GETSEQ:
0017BF E3B8 FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0017C2 E3BB FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0017C5 E3BE AF               4      XOR A
                                
0017C6 E3BF CB25             8      SLA L   ;L=L*2
                                
0017C8 E3C1 CB3C             8      SRL H   ;HL=HL/2
0017CA E3C3 CB1D             8      RR  L   ;
0017CC E3C5 C9              10      RET
                                
       E3C6                     SETSEQ1:
0017CD E3C6 F5              11      PUSH    AF      
0017CE E3C7 E5              11      PUSH    HL      ;AHL=Random record
0017CF E3C8 FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
0017D2 E3CB FD6E22          19      LD  L,(IY+34)
0017D5 E3CE FD6623          19      LD  H,(IY+35)
0017D8 E3D1 0600             7      LD  B,0
                                
0017DA E3D3 CD86E3          17      CALL    GET_CPM_R_SIZE
                                
0017DD E3D6 29              11      ADD HL,HL
0017DE E3D7 CB3D             8      SRL L       ;L=L/2
0017E0 E3D9 FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0017E3 E3DC FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0017E6 E3DF E1              10      POP HL
0017E7 E3E0 F1              10      POP AF
0017E8 E3E1 C9              10      RET
       E3E2                     SETSEQ:
0017E9 E3E2 CDC6E3          17      CALL    SETSEQ1
       E3E5                     POPRR:
0017EC E3E5 F5              11      PUSH    AF
0017ED E3E6 E5              11      PUSH    HL
0017EE E3E7 2A5AEF          16      LD  HL,(HLBUF)
0017F1 E3EA 3A5CEF          13      LD  A,(HLBUF+2)
0017F4 E3ED CDA6E3          17      CALL    SET_RR_AHL
0017F7 E3F0 E1              10      POP HL
0017F8 E3F1 F1              10      POP AF
0017F9 E3F2 C9              10      RET
                                
       E3F3                     RB_WRITE:
0017FA E3F3 C5              11      PUSH    BC
0017FB E3F4 ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
0017FF E3F8 1805            12      JR  RBRW
       E3FA                     RB_READ:
001801 E3FA C5              11      PUSH    BC
001802 E3FB ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E3FF                     RBRW:
001806 E3FF CB3F             8      SRL A   ;AHLA' = HL*128
001808 E401 CB1C             8      RR  H   ;AHL=AHL/2
00180A E403 CB1D             8      RR  L   ;
00180C E405 3E00             7      LD  A,0
00180E E407 1F               4      RRA     ;A'HLA
00180F E408 FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001812 E40B FD7522          19      LD  (IY+34),L
001815 E40E FD7423          19      LD  (IY+35),H
001818 E411 218000          10      LD  HL,128
00181B E414 C5              11      PUSH    BC
       E415                     SETSEQ_SWC_RND:
00181C E415 CDC6E3          17      CALL    SETSEQ1
00181F E418 C1              10      POP BC
001820 E419 FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001824 E41D FDE5            15      PUSH    IY
001826 E41F D1              10      POP DE
001827 E420 D5              11      PUSH    DE
001828 E421 CD2FE4          17      CALL    JP_BC
00182B E424 FDE1            14      POP IY
       E427                     SETSEQ_SWC_SEQ_RR   EQU $+1
00182D E426 CDE2E3          17      CALL    SETSEQ
001830 E429 FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001834 E42D C1              10      POP BC
001835 E42E C9              10      RET
       E42F                     JP_BC:
001836 E42F C5              11      PUSH    BC
001837 E430 C9              10      RET
                                
       DFA9                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DFA9                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DFA9                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DFA9                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DFA9                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E431                     _SYS26:     ;(BDOS)ランダムブロック書き込み
001838 E431 AF               4      XOR A
001839 E432 321DE7          13      LD  (DRDN1),A   ;NOP
00183C E435 2261E6          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
00183F E438 225DEF          16      LD  (LEFTX),HL
001842 E43B CDFEDE          17      CALL    SETDRV
                                
001845 E43E CDB8E5          17      CALL    RBX0
001848 E441 DADBE4          10      JP  C,RBWERR
00184B E444 CD86E2          17      CALL    WOPEN
00184E E447 DADBE4          10      JP  C,RBWERR
001851 E44A 7C               4      LD  A,H
001852 E44B B5               4      OR  L
001853 E44C CAD4E4          10      JP  Z,RBW1
                                
001856 E44F 2B               6      DEC HL
                                
001857 E450 CD83E6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00185A E453 19              11      ADD HL,DE       ;BCHL=HL+BCDE
00185B E454 3001            12      JR  NC,S26X1    ;
00185D E456 03               6      INC BC      ;
       E457                     S26X1:
00185E E457 CDEDE2          17      CALL    RWXR
001861 E45A DC97E2          17      CALL    C,WRDFX
001864 E45D DADBE4          10      JP  C,RBWERR
                                
001867 E460 CDE7E5          17      CALL    RBX2
00186A E463 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
00186C E465 CD06E6          17      CALL    RBXA
00186F E468 3871            12      JR  C,RBWERR
001871 E46A EB               4      EX  DE,HL
001872 E46B C5              11      PUSH    BC
001873 E46C EDB0                    LDIR
001875 E46E 225FEF          16      LD  (DTAX),HL
                                
001878 E471 CD2BE2          17      CALL    SWTDBF      ;バッファデータは更新された
                                
00187B E474 2A5DEF          16      LD  HL,(LEFTX)
00187E E477 D1              10      POP DE
00187F E478 ED52            15      SBC HL,DE
001881 E47A 225DEF          16      LD  (LEFTX),HL
001884 E47D 2833            12      JR  Z,RBWEND
                                
       E47F                     RBWB:
001886 E47F CD3CE6          17      CALL    RBXB
001889 E482 2816            12      JR  Z,RBWC
       E484                     RBWB1:
00188B E484 C5              11      PUSH    BC
00188C E485 D5              11      PUSH    DE
00188D E486 CDFCE0          17      CALL    CLUSTX
001890 E489 CD97E6          17      CALL    DWTC
001893 E48C D1              10      POP DE
001894 E48D C1              10      POP BC
001895 E48E 384B            12      JR  C,RBWERR
001897 E490 CD95E8          17      CALL    GNCLX
00189A E493 3846            12      JR  C,RBWERR
00189C E495 10ED            13      DJNZ    RBWB1
00189E E497 CDE7E6          17      CALL    DRW_FLUSH
       E49A                     RBWC:
0018A1 E49A CD54E6          17      CALL    RBXC
0018A4 E49D 2813            12      JR  Z,RBWEND
0018A6 E49F C5              11      PUSH    BC
0018A7 E4A0 CDFCE0          17      CALL    CLUSTX
0018AA E4A3 CD1CE7          17      CALL    DRDN
0018AD E4A6 C1              10      POP BC
0018AE E4A7 3832            12      JR  C,RBWERR
0018B0 E4A9 ED5B7EF0        20      LD  DE,(_DTBUF)
0018B4 E4AD EDB0                    LDIR
0018B6 E4AF CD2BE2          17      CALL    SWTDBF      ;バッファデータは更新された
       E4B2                     RBWEND:
0018B9 E4B2 CD60E6          17      CALL    RBXEND
                                
0018BC E4B5 CDC7E5          17      CALL    RBX1
0018BF E4B8 301A            12      JR  NC,RBW1
0018C1 E4BA 2A61E6          16      LD  HL,(LEFT+1)
0018C4 E4BD FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0018C7 E4C0 FD5611          19      LD  D,(IY+17)   ;DE=File size
0018CA E4C3 19              11      ADD HL,DE
0018CB E4C4 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
0018CE E4C7 FD7411          19      LD  (IY+17),H
0018D1 E4CA 3008            12      JR  NC,RBW1
0018D3 E4CC FD3412          23      INC (IY+18)
0018D6 E4CF 2003            12      JR  NZ,RBW1
0018D8 E4D1 FD3413          23      INC (IY+19)
       E4D4                     RBW1:
0018DB E4D4 FDE1            14      POP IY
0018DD E4D6 C1              10      POP BC
0018DE E4D7 D1              10      POP DE
0018DF E4D8 E1              10      POP HL
       E4D9                     DD_NUL:
0018E0 E4D9 AF               4      XOR A
       E4DA                     DRDF0:
       E4DA                     DWTF0:
0018E1 E4DA C9              10      RET
                                
       E4DB                     RBWERR:
0018E2 E4DB FDE5            15      PUSH    IY
0018E4 E4DD D1              10      POP DE
0018E5 E4DE 2A20F0          16      LD  HL,(STABLE+2*010H)
0018E8 E4E1 CD0F00          17      CALL    JP_HL
       E4E4                     RBRERR1:
0018EB E4E4 3E01             7      LD  A,001H
       E4E6                     RBRERR2:
0018ED E4E6 FDE1            14      POP IY
0018EF E4E8 C1              10      POP BC
0018F0 E4E9 D1              10      POP DE
0018F1 E4EA E1              10      POP HL
0018F2 E4EB 37               4      SCF
0018F3 E4EC 210000          10      LD  HL,0
0018F6 E4EF C9              10      RET
                                
       E4F0                     RBRERR:
0018F7 E4F0 3EFF             7      LD  A,0FFH
0018F9 E4F2 18F2            12      JR  RBRERR2
                                
       E4F4                     RBRFL:
0018FB E4F4 3E00             7  RBRFLP: LD  A,000H
0018FD E4F6 FE0D             7      CP  00DH
0018FF E4F8 2005            12      JR  NZ,RBRFL1
001901 E4FA D5              11      PUSH    DE
001902 E4FB 1E0A             7      LD  E,00AH
001904 E4FD 1805            12      JR  RBRFL2
       E4FF                     RBRFL1:
001906 E4FF D5              11      PUSH    DE
001907 E500 CD09EF          17      CALL    _SYS07
00190A E503 5F               4      LD  E,A
       E504                     RBRFL2:
00190B E504 CDCDEF          17      CALL    _PRINT
00190E E507 7B               4      LD  A,E
00190F E508 D1              10      POP DE
001910 E509 32F5E4          13      LD  (RBRFLP+1),A
001913 E50C C9              10      RET
       E50D                     DDX:
001914 E50D FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
001917 E510 CD21E1          17      CALL    CAP
00191A E513 FE41             7      CP  'A'
00191C E515 C9              10      RET
                                
                                                ;Read random block
       E516                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00191D E516 225DEF          16      LD  (LEFTX),HL
001920 E519 CDFEDE          17      CALL    SETDRV
                                
001923 E51C FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
001927 E520 C2A6E5          10      JP  NZ,RBRDIR   ;ディレクトリ
00192A E523 CDB8E5          17      CALL    RBX0
00192D E526 DAF0E4          10      JP  C,RBRERR
001930 E529 CDC7E5          17      CALL    RBX1
001933 E52C DAE4E4          10      JP  C,RBRERR1
001936 E52F EB               4      EX  DE,HL
001937 E530 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
001939 E532 19              11      ADD HL,DE
00193A E533 79               4      LD  A,C
00193B E534 DE00             7      SBC A,0
00193D E536 78               4      LD  A,B
00193E E537 DE00             7      SBC A,0
001940 E539 3801            12      JR  C,RBR1
001942 E53B EB               4      EX  DE,HL
       E53C                     RBR1:
001943 E53C 9F               4      SBC A,A
001944 E53D E601             7      AND 1
001946 E53F 32A4E5          13      LD  (RBRAP+1),A
                                
001949 E542 7C               4      LD  A,H
00194A E543 B5               4      OR  L
00194B E544 2857            12      JR  Z,RBREND0
                                
00194D E546 2261E6          16      LD  (LEFT+1),HL ;Read record byte
001950 E549 225DEF          16      LD  (LEFTX),HL
                                
001953 E54C CDE7E5          17      CALL    RBX2
001956 E54F 2819            12      JR  Z,RBRB
001958 E551 CD06E6          17      CALL    RBXA
00195B E554 DAF0E4          10      JP  C,RBRERR
00195E E557 C5              11      PUSH    BC
00195F E558 EDB0                    LDIR
001961 E55A ED535FEF        20      LD  (DTAX),DE
001965 E55E 2A5DEF          16      LD  HL,(LEFTX)
001968 E561 D1              10      POP DE
001969 E562 A7               4      AND A
00196A E563 ED52            15      SBC HL,DE
00196C E565 225DEF          16      LD  (LEFTX),HL
00196F E568 2830            12      JR  Z,RBREND
                                
       E56A                     RBRB:
001971 E56A CD3CE6          17      CALL    RBXB
001974 E56D 2815            12      JR  Z,RBRC
       E56F                     RBRB1:
001976 E56F C5              11      PUSH    BC
001977 E570 D5              11      PUSH    DE
001978 E571 CDFCE0          17      CALL    CLUSTX
00197B E574 CD9DE6          17      CALL    DRDC
00197E E577 D1              10      POP DE
00197F E578 C1              10      POP BC
001980 E579 D495E8          17      CALL    NC,GNCLX
001983 E57C DAF0E4          10      JP  C,RBRERR
001986 E57F 10EE            13      DJNZ    RBRB1
001988 E581 CDE7E6          17      CALL    DRW_FLUSH
       E584                     RBRC:
00198B E584 CD54E6          17      CALL    RBXC
00198E E587 2811            12      JR  Z,RBREND
001990 E589 C5              11      PUSH    BC
001991 E58A CDFCE0          17      CALL    CLUSTX
001994 E58D CD00E7          17      CALL    DRDX
001997 E590 C1              10      POP BC
001998 E591 DAF0E4          10      JP  C,RBRERR
00199B E594 EB               4      EX  DE,HL
00199C E595 2A7EF0          16      LD  HL,(_DTBUF)
00199F E598 EDB0                    LDIR
       E59A                     RBREND:
0019A1 E59A CD60E6          17      CALL    RBXEND
       E59D                     RBREND0:
0019A4 E59D FDE1            14      POP IY
0019A6 E59F C1              10      POP BC
0019A7 E5A0 D1              10      POP DE
0019A8 E5A1 F1              10      POP AF  ;(HL)
0019A9 E5A2 AF               4      XOR A
0019AA E5A3 3E00             7  RBRAP:  LD  A,000H
0019AC E5A5 C9              10      RET
                                
       E5A6                     RBRDIR:
0019AD E5A6 FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0019B0 E5A9 FD661B          19      LD  H,(IY+27)
0019B3 E5AC CD3CE1          17      CALL    CHDIR
0019B6 E5AF AF               4      XOR A
0019B7 E5B0 67               4      LD  H,A
0019B8 E5B1 6F               4      LD  L,A
0019B9 E5B2 3C               4      INC A
0019BA E5B3 32A4E5          13      LD  (RBRAP+1),A
0019BD E5B6 18E5            12      JR  RBREND0
                                
       E5B8                     RBX0:
0019BF E5B8 2A8AEF          16      LD  HL,(_DTA)
0019C2 E5BB 225FEF          16      LD  (DTAX),HL
0019C5 E5BE 2A5DEF          16      LD  HL,(LEFTX)
0019C8 E5C1 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0019CB E5C4 D6FD             7      SUB 0FDH
0019CD E5C6 C9              10      RET
                                
       E5C7                     RBX1:
0019CE E5C7 E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0019CF E5C8 FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0019D2 E5CB FD6611          19      LD  H,(IY+17)   ;
0019D5 E5CE FD7E12          19      LD  A,(IY+18)   ;
                                
0019D8 E5D1 CD83E6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0019DB E5D4 A7               4      AND A
0019DC E5D5 ED52            15      SBC HL,DE
0019DE E5D7 99               4      SBC A,C
0019DF E5D8 4F               4      LD  C,A
0019E0 E5D9 FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0019E3 E5DC 98               4      SBC A,B
0019E4 E5DD D1              10      POP DE
                                
0019E5 E5DE D8              11      RET C
0019E6 E5DF 47               4      LD  B,A
0019E7 E5E0 B1               4      OR  C
0019E8 E5E1 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0019E9 E5E2 B2               4      OR  D
0019EA E5E3 B3               4      OR  E
0019EB E5E4 C0              11      RET NZ
0019EC E5E5 37               4      SCF
0019ED E5E6 C9              10      RET
                                
       E5E7                     RBX2:               ;Cluster settings
0019EE E5E7 FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0019F1 E5EA FD4E23          19      LD  C,(IY+35)
0019F4 E5ED 0600             7      LD  B,0
0019F6 E5EF FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0019FA E5F3 2003            12      JR  NZ,RBX3
0019FC E5F5 FD4624          19      LD  B,(IY+36)
       E5F8                     RBX3:
0019FF E5F8 CDEDE2          17      CALL    RWXR
001A02 E5FB 3A1EE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A05 E5FE 3D               4      DEC A
001A06 E5FF FDA622          19      AND (IY+34)
001A09 E602 FDB621          19      OR  (IY+33)
001A0C E605 C9              10      RET
                                
       E606                     RBXA:
001A0D E606 C5              11      PUSH    BC
001A0E E607 D5              11      PUSH    DE
001A0F E608 CDFCE0          17      CALL    CLUSTX
001A12 E60B CD00E7          17      CALL    DRDX
001A15 E60E D1              10      POP DE
001A16 E60F C1              10      POP BC
001A17 E610 D8              11      RET C
001A18 E611 CD95E8          17      CALL    GNCLX
001A1B E614 D8              11      RET C
001A1C E615 ED53FEF0        20      LD  (_CLPS),DE
                                
001A20 E619 FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001A23 E61C 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001A26 E61F 7C               4      LD  A,H
001A27 E620 3D               4      DEC A       ;1024=3 / 512=1
001A28 E621 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001A2B E624 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001A2C E625 ED42            15      SBC HL,BC       ;残りを計算
                                
001A2E E627 ED5B5DEF        20      LD  DE,(LEFTX)
001A32 E62B ED52            15      SBC HL,DE       ;CP HL,DE
001A34 E62D 19              11      ADD HL,DE       ;
001A35 E62E 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001A37 E630 EB               4      EX  DE,HL
       E631                     RBXA1:
001A38 E631 E5              11      PUSH    HL
001A39 E632 2A7EF0          16      LD  HL,(_DTBUF)
001A3C E635 09              11      ADD HL,BC
001A3D E636 ED5B5FEF        20      LD  DE,(DTAX)
001A41 E63A C1              10      POP BC
001A42 E63B C9              10      RET
                                
       E63C                     RBXB:
001A43 E63C 2A5FEF          16      LD  HL,(DTAX)
001A46 E63F ED5BFEF0        20      LD  DE,(_CLPS)
001A4A E643 3A5EEF          13      LD  A,(LEFTX+1)
001A4D E646 47               4      LD  B,A
001A4E E647 3A1EE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E64A                     RBXB1:
001A51 E64A 1F               4      RRA     ;->CF
001A52 E64B 3804            12      JR  C,RBXB2
001A54 E64D CB38             8      SRL B   ;B=B/2
001A56 E64F 18F9            12      JR  RBXB1
       E651                     RBXB2:
001A58 E651 78               4      LD  A,B
001A59 E652 B7               4      OR  A
001A5A E653 C9              10      RET
                                
       E654                     RBXC:
001A5B E654 ED4B5DEF        20      LD  BC,(LEFTX)
001A5F E658 3A1EE6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A62 E65B 3D               4      DEC A
001A63 E65C A0               4      AND B
001A64 E65D 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001A65 E65E B1               4      OR  C
001A66 E65F C9              10      RET
                                
       E660                     RBXEND:
001A67 E660 110000          10  LEFT:   LD  DE,0
001A6A E663 AF               4      XOR A
001A6B E664 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
001A6E E667 FD6622          19      LD  H,(IY+34)
001A71 E66A 19              11      ADD HL,DE
001A72 E66B FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
001A75 E66E FD7422          19      LD  (IY+34),H
001A78 E671 300E            12      JR  NC,RBXEND1
001A7A E673 FD3423          23      INC (IY+35)
001A7D E676 2009            12      JR  NZ,RBXEND1
001A7F E678 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A83 E67C 2003            12      JR  NZ,RBXEND1
001A85 E67E FD3424          23      INC (IY+36)
       E681                     RBXEND1:
001A88 E681 EB               4      EX  DE,HL       ;HL=Read byte
001A89 E682 C9              10      RET
                                
       E683                     GET_RR_BCDE:            ;BCDE=Random record
001A8A E683 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001A8D E686 FD5622          19      LD  D,(IY+34)
001A90 E689 FD4E23          19      LD  C,(IY+35)
001A93 E68C FD4624          19      LD  B,(IY+36)
001A96 E68F FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A9A E693 C8              11      RET Z
001A9B E694 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001A9D E696 C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E697                     DWTC:
001A9E E697 E5              11      PUSH    HL
001A9F E698 21FAE9          10      LD  HL,DWT24B
001AA2 E69B 1804            12      JR  DWTC1
       E69D                     DRDC:
001AA4 E69D E5              11      PUSH    HL
001AA5 E69E 21EAE9          10      LD  HL,DRD24B
       E6A1                     DWTC1:
001AA8 E6A1 22FBE6          16      LD  (DRWF_MODE),HL
001AAB E6A4 E1              10      POP HL
001AAC E6A5 3AEBE6          13      LD  A,(DRWF_B)
001AAF E6A8 B7               4      OR  A
001AB0 E6A9 200F            12      JR  NZ,DRDC1
       E6AB                     SAVE_DRWC:
001AB2 E6AB 0601             7      LD  B,1
001AB4 E6AD ED43EAE6        20      LD  (DRWF_C),BC
001AB8 E6B1 ED53F1E6        20      LD  (DRWF_E),DE
001ABC E6B5 22F4E6          16      LD  (DRWF_HL),HL
001ABF E6B8 1820            12      JR  INC_HL_DRWC
       E6BA                     DRDC1:
001AC1 E6BA E5              11      PUSH    HL
001AC2 E6BB 21F1E6          10      LD  HL,DRWF_E
001AC5 E6BE 86               7      ADD A,(HL)
001AC6 E6BF F5              11      PUSH    AF
001AC7 E6C0 BB               4      CP  E
001AC8 E6C1 201D            12      JR  NZ,DRDC2
001ACA E6C3 F1              10      POP AF
001ACB E6C4 23               6      INC HL
001ACC E6C5 7E               7      LD  A,(HL)
001ACD E6C6 CE00             7      ADC A,0
001ACF E6C8 F5              11      PUSH    AF
001AD0 E6C9 BA               4      CP  D
001AD1 E6CA 2014            12      JR  NZ,DRDC2
001AD3 E6CC F1              10      POP AF
001AD4 E6CD 3AEAE6          13      LD  A,(DRWF_C)
001AD7 E6D0 CE00             7      ADC A,0
001AD9 E6D2 B9               4      CP  C
001ADA E6D3 200C            12      JR  NZ,DRDC3
001ADC E6D5 21EBE6          10      LD  HL,DRWF_B
001ADF E6D8 34              11      INC (HL)
001AE0 E6D9 E1              10      POP HL
       E6DA                     INC_HL_DRWC:
001AE1 E6DA 3A1EE6          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001AE4 E6DD 84               4      ADD A,H
001AE5 E6DE 67               4      LD  H,A
001AE6 E6DF C9              10      RET
       E6E0                     DRDC2:
001AE7 E6E0 F1              10      POP AF
       E6E1                     DRDC3:
001AE8 E6E1 CDE7E6          17      CALL    DRW_FLUSH
001AEB E6E4 E1              10      POP HL
001AEC E6E5 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E6E7                     DRW_FLUSH:
001AEE E6E7 C5              11      PUSH    BC
001AEF E6E8 D5              11      PUSH    DE
       E6EA                     DRWF_C  EQU $+1
       E6EB                     DRWF_B  EQU $+2
001AF0 E6E9 010000          10      LD  BC,0
001AF3 E6EC 78               4      LD  A,B
001AF4 E6ED B7               4      OR  A
001AF5 E6EE 280D            12      JR  Z,DRDF1
       E6F1                     DRWF_E  EQU $+1
       E6F2                     DRWF_D  EQU $+2
001AF7 E6F0 110000          10      LD  DE,0
       E6F4                     DRWF_HL EQU $+1
001AFA E6F3 210000          10      LD  HL,0
001AFD E6F6 AF               4      XOR A
001AFE E6F7 32EBE6          13      LD  (DRWF_B),A
       E6FB                     DRWF_MODE   EQU $+1
001B01 E6FA CDEAE9          17      CALL    DRD24B
       E6FD                     DRDF1:
001B04 E6FD D1              10      POP DE
001B05 E6FE C1              10      POP BC
001B06 E6FF C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E700                     DRDX:
001B07 E700 CD3EE7          17      CALL    DRDY
001B0A E703 C8              11      RET Z
001B0B E704 CD24E7          17      CALL    DRDX1       ;データバッファの情報を保存
001B0E E707 D8              11      RET C
001B0F E708 E5              11      PUSH    HL
001B10 E709 C5              11      PUSH    BC
001B11 E70A D5              11      PUSH    DE
001B12 E70B 2A7EF0          16      LD  HL,(_DTBUF)
001B15 E70E 3A67E7          13      LD  A,(_DBS24+1)
001B18 E711 4F               4      LD  C,A
001B19 E712 CDE8E9          17      CALL    DRD24
001B1C E715 DC39E7          17      CALL    C,DRDNE
       E718                     POP_DE_BC_HL_RET:
001B1F E718 D1              10      POP DE
001B20 E719 C1              10      POP BC
001B21 E71A E1              10      POP HL
001B22 E71B C9              10      RET
                                
                                ;   CDE:セクタ番号
       E71C                     DRDN:
001B23 E71C AF               4      XOR A
001B24 E71D 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001B25 E71E 30E0            12      JR  NC,DRDX
       E720                     DRDNX:
001B27 E720 CD3EE7          17      CALL    DRDY
001B2A E723 C8              11      RET Z
       E724                     DRDX1:
001B2B E724 CD54E7          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001B2E E727 ED53A6EF        20      LD  (_DBSEC),DE
001B32 E72B 79               4      LD  A,C
001B33 E72C 3267E7          13      LD  (_DBS24+1),A
                                
001B36 E72F 3A88EF          13      LD  A,(_DRV)
001B39 E732 32A5EF          13      LD  (_DBDRV),A
001B3C E735 CDD9EF          17      CALL    _CHGDRV
001B3F E738 D0              11      RET NC
       E739                     DRDNE:
001B40 E739 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001B41 E73A 32A5EF          13      LD  (_DBDRV),A
001B44 E73D C9              10      RET
                                
                                ;   CDE:セクタ番号
       E73E                     DRDY:
001B45 E73E 3A67E7          13      LD  A,(_DBS24+1)
001B48 E741 B9               4      CP  C
001B49 E742 C0              11      RET NZ
                                
001B4A E743 E5              11      PUSH    HL
001B4B E744 3A88EF          13      LD  A,(_DRV)
001B4E E747 21A5EF          10      LD  HL,_DBDRV
001B51 E74A AE               7      XOR (HL)
001B52 E74B 2005            12      JR  NZ,POP_HL_RET
                                
001B54 E74D 2AA6EF          16      LD  HL,(_DBSEC)
001B57 E750 ED52            15      SBC HL,DE       ;CF=0
       E752                     POP_HL_RET:
001B59 E752 E1              10      POP HL
001B5A E753 C9              10      RET
                                
       E754                     DWTX:
001B5B E754 3AA4EF          13      LD  A,(_WTDBF)
001B5E E757 B7               4      OR  A
001B5F E758 C8              11      RET Z
001B60 E759 AF               4      XOR A
001B61 E75A 32A4EF          13      LD  (_WTDBF),A
                                
001B64 E75D E5              11      PUSH    HL
001B65 E75E C5              11      PUSH    BC
001B66 E75F D5              11      PUSH    DE
001B67 E760 3AA5EF          13      LD  A,(_DBDRV)
001B6A E763 CDD9EF          17      CALL    _CHGDRV
001B6D E766 0E00             7  _DBS24: LD  C,0
001B6F E768 ED5BA6EF        20      LD  DE,(_DBSEC)
001B73 E76C 2A7EF0          16      LD  HL,(_DTBUF)
001B76 E76F D4F8E9          17      CALL    NC,DWT24
       E772                     POP_DE_BC_HL_RET2:
001B79 E772 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E774                     RDFATX:
001B7B E774 E5              11      PUSH    HL
001B7C E775 3A88EF          13      LD  A,(_DRV)
001B7F E778 21AAEF          10      LD  HL,_FATDRV
001B82 E77B AE               7      XOR (HL)
001B83 E77C 28D4            12      JR  Z,POP_HL_RET
                                
001B85 E77E C5              11      PUSH    BC
001B86 E77F D5              11      PUSH    DE
001B87 E780 DDE5            15      PUSH    IX
001B89 E782 CD9EE7          17      CALL    WTFATX
001B8C E785 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001B8E E787 AF               4      XOR A
001B8F E788 32ABEF          13      LD  (_FATIX),A
001B92 E78B 3A88EF          13      LD  A,(_DRV)
001B95 E78E 32AAEF          13      LD  (_FATDRV),A
001B98 E791 CDE5EF          17      CALL    _RDFAT
       E794                     RDFATE2:
001B9B E794 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001B9D E796 9F               4      SBC A,A     ;A=0xFF
001B9E E797 32AAEF          13      LD  (_FATDRV),A
       E79A                     POP_IX_DE_BC_HL_RET:
001BA1 E79A DDE1            14      POP IX
001BA3 E79C 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E79E                     WTFATX:
001BA5 E79E 3AA2EF          13      LD  A,(_WTFATF)
001BA8 E7A1 B7               4      OR  A
001BA9 E7A2 C8              11      RET Z
001BAA E7A3 E5              11      PUSH    HL
001BAB E7A4 3AAAEF          13      LD  A,(_FATDRV)
001BAE E7A7 21A5EF          10      LD  HL,_DBDRV
001BB1 E7AA AE               7      XOR (HL)
001BB2 E7AB CC54E7          17      CALL    Z,DWTX
001BB5 E7AE 38A2            12      JR  C,POP_HL_RET
001BB7 E7B0 C5              11      PUSH    BC
001BB8 E7B1 D5              11      PUSH    DE
001BB9 E7B2 DDE5            15      PUSH    IX
001BBB E7B4 CD05EA          17      CALL    WTFAT
001BBE E7B7 AF               4      XOR A
001BBF E7B8 32A2EF          13      LD  (_WTFATF),A
001BC2 E7BB 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E7BD                     NCL1:
001BC4 E7BD 7A               4      LD  A,D
001BC5 E7BE B3               4      OR  E
001BC6 E7BF 37               4      SCF
001BC7 E7C0 C8              11      RET Z
                                
001BC8 E7C1 7A               4      LD  A,D
001BC9 E7C2 CB3F             8      SRL A   ;/2
001BCB E7C4 CB3F             8      SRL A   ;/2
                                
001BCD E7C6 E5              11      PUSH    HL
001BCE E7C7 32E6E7          13      LD  (NCLPAT+2),A    ;_FATIX
001BD1 E7CA 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001BD4 E7CD BC               4      CP  H
001BD5 E7CE 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001BD8 E7D1 32E5E7          13      LD  (NCLPAT+1),A    ;_FATDRV
001BDB E7D4 2005            12      JR  NZ,NCL2     ;FATIXが違う
001BDD E7D6 BD               4      CP  L
001BDE E7D7 2002            12      JR  NZ,NCL2     ;ドライブが違う
001BE0 E7D9 E1              10      POP HL
001BE1 E7DA C9              10      RET
       E7DB                     NCL2:
001BE2 E7DB C5              11      PUSH    BC
001BE3 E7DC D5              11      PUSH    DE
001BE4 E7DD DDE5            15      PUSH    IX
001BE6 E7DF CD9EE7          17      CALL    WTFATX
001BE9 E7E2 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001BEB E7E4 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001BEE E7E7 ED43AAEF        20      LD  (_FATDRV),BC
001BF2 E7EB CDDAE9          17      CALL    RDFATS
001BF5 E7EE 18A4            12      JR  RDFATE2
                                
       E7F0                     NCL3:
001BF7 E7F0 CB9A             8      RES 3,D
001BF9 E7F2 CB92             8      RES 2,D
001BFB E7F4 6B               4      LD  L,E
001BFC E7F5 62               4      LD  H,D
001BFD E7F6 CB3C             8      SRL H   ;
001BFF E7F8 CB1D             8      RR  L   ;HLA=HLA/2
001C01 E7FA 1F               4      RRA     ;
001C02 E7FB F5              11      PUSH    AF
001C03 E7FC 3AABEF          13      LD  A,(_FATIX)
001C06 E7FF 0F               4      RRCA
001C07 E800 300B            12      JR  NC,NCL3X1
001C09 E802 3A1EE6          13      LD  A,(SECSZ+2)
001C0C E805 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001C0E E807 2004            12      JR  NZ,NCL3X1
001C10 E809 010002          10      LD  BC,512
001C13 E80C 09              11      ADD HL,BC
       E80D                     NCL3X1:
001C14 E80D F1              10      POP AF
001C15 E80E ED4B7CF0        20      LD  BC,(_FATBF)
001C19 E812 19              11      ADD HL,DE
001C1A E813 09              11      ADD HL,BC
001C1B E814 17               4      RLA
001C1C E815 C9              10      RET
                                
       E816                     GNCL:
001C1D E816 CDBDE7          17      CALL    NCL1        ;GET NEXT CLUSTER
001C20 E819 D8              11      RET C
001C21 E81A C5              11      PUSH    BC
001C22 E81B E5              11      PUSH    HL
001C23 E81C CDF0E7          17      CALL    NCL3
001C26 E81F 3809            12      JR  C,GNC1
001C28 E821 5E               7      LD  E,(HL)
001C29 E822 23               6      INC HL
001C2A E823 7E               7      LD  A,(HL)
001C2B E824 E60F             7      AND 00FH
001C2D E826 57               4      LD  D,A
001C2E E827 E1              10      POP HL
001C2F E828 C1              10      POP BC
001C30 E829 C9              10      RET
       E82A                     GNC1:
001C31 E82A 7E               7      LD  A,(HL)
001C32 E82B 23               6      INC HL
001C33 E82C 56               7      LD  D,(HL)
001C34 E82D 0604             7      LD  B,4
       E82F                     GNC1L:
001C36 E82F CB3A             8      SRL D   ;DA=DA/2
001C38 E831 1F               4      RRA     ;
001C39 E832 10FB            13      DJNZ    GNC1L
                                
001C3B E834 5F               4      LD  E,A
001C3C E835 E1              10      POP HL
001C3D E836 C1              10      POP BC
001C3E E837 A7               4      AND A
001C3F E838 C9              10      RET
                                
       E839                     SNCL:
001C40 E839 CDBDE7          17      CALL    NCL1
001C43 E83C D8              11      RET C
                                ;               SET NEXT CLUSTER
001C44 E83D E5              11      PUSH    HL
001C45 E83E C5              11      PUSH    BC
001C46 E83F D5              11      PUSH    DE
001C47 E840 E5              11      PUSH    HL
001C48 E841 CDF0E7          17      CALL    NCL3
001C4B E844 D1              10      POP DE
                                ;CF=ODD
001C4C E845 7E               7      LD  A,(HL)
001C4D E846 73               7      LD  (HL),E
001C4E E847 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001C50 E849 23               6      INC HL
001C51 E84A ED67            18      RRD     ;M={A[3:0],E[3:0]}
001C53 E84C 7A               4      LD  A,D
001C54 E84D 1804            12      JR  SNC11
       E84F                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001C56 E84F ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001C58 E851 23               6      INC HL
001C59 E852 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E853                     SNC11:
001C5A E853 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001C5C E855 B7               4      OR  A
001C5D E856 D1              10      POP DE
001C5E E857 C1              10      POP BC
001C5F E858 E1              10      POP HL
       E859                     FAT_CHANGED:
001C60 E859 3E01             7      LD  A,1
001C62 E85B 32A2EF          13      LD  (_WTFATF),A
001C65 E85E C9              10      RET
                                
       E85F                     N16CL3:
001C66 E85F C5              11      PUSH    BC
001C67 E860 6B               4      LD  L,E
001C68 E861 7A               4      LD  A,D
001C69 E862 E603             7      AND 3
001C6B E864 67               4      LD  H,A
001C6C E865 29              11      ADD HL,HL
001C6D E866 ED4B7CF0        20      LD  BC,(_FATBF)
001C71 E86A 09              11      ADD HL,BC
001C72 E86B C1              10      POP BC
001C73 E86C C9              10      RET
                                
       E86D                     GNCL16:
001C74 E86D CDBDE7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C77 E870 D8              11      RET C
001C78 E871 E5              11      PUSH    HL
001C79 E872 CD5FE8          17      CALL    N16CL3
001C7C E875 5E               7      LD  E,(HL)
001C7D E876 23               6      INC HL
001C7E E877 56               7      LD  D,(HL)
001C7F E878 E1              10      POP HL
001C80 E879 C9              10      RET
                                
       E87A                     SNCL16:
001C81 E87A CDBDE7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C84 E87D D8              11      RET C
001C85 E87E D5              11      PUSH    DE
001C86 E87F E5              11      PUSH    HL
001C87 E880 CD5FE8          17      CALL    N16CL3
001C8A E883 D1              10      POP DE      ;HL
001C8B E884 73               7      LD  (HL),E
001C8C E885 23               6      INC HL
001C8D E886 72               7      LD  (HL),D
001C8E E887 6B               4      LD  L,E
001C8F E888 62               4      LD  H,D
001C90 E889 D1              10      POP DE
001C91 E88A 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E88C                     NEXTX:
001C93 E88C 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001C95 E88E 3C               4      INC A
001C96 E88F E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001C98 E891 328DE8          13      LD  (_SECPS+1),A
001C9B E894 C9              10      RET
                                
       E895                     GNCLX:
001C9C E895 CD8CE8          17      CALL    NEXTX
001C9F E898 C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001CA0 E899 C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E89C                     RDFAT:
001CA3 E89C 3E80             7      LD  A,080H
001CA5 E89E 3270EF          13      LD  (CHECK),A
       E8A1                     RDFAT1:
001CA8 E8A1 3A88EF          13      LD  A,(_DRV)
001CAB E8A4 CD2FEB          17      CALL    CHGDRVR
001CAE E8A7 D8              11      RET C
001CAF E8A8 DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001CB2 E8AB CB6F             8      BIT 5,A
001CB4 E8AD 2843            12      JR  Z,RDFAT0X
001CB6 E8AF 2170EF          10      LD  HL,CHECK
001CB9 E8B2 A6               7      AND (HL)
001CBA E8B3 77               7      LD  (HL),A
001CBB E8B4 110000          10      LD  DE,0        ;BPB
001CBE E8B7 2A7CF0          16      LD  HL,(_FATBF)
001CC1 E8BA CDE6E9          17      CALL    DRD16
001CC4 E8BD 3024            12      JR  NC,GETBPB
001CC6 E8BF 2170EF          10      LD  HL,CHECK
001CC9 E8C2 CB06            15      RLC (HL)
001CCB E8C4 3F               4      CCF
001CCC E8C5 D8              11      RET C
001CCD E8C6 DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001CD1 E8CA 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001CD2 E8CB DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001CD6 E8CF 3EFF             7      LD  A,0FFH
001CD8 E8D1 3289EF          13      LD  (_DSK),A
001CDB E8D4 3A84EF          13      LD  A,(_DRIVE)
001CDE E8D7 E603             7      AND 3
001CE0 E8D9 F680             7      OR  080H
001CE2 E8DB 6F               4      LD  L,A
001CE3 E8DC 26EF             7      LD  H,_CYL0/256
001CE5 E8DE 3EFF             7      LD  A,0FFH
001CE7 E8E0 77               7      LD  (HL),A
001CE8 E8E1 18BE            12      JR  RDFAT1
       E8E3                     GETBPB:
001CEA E8E3 FDE5            15      PUSH    IY
001CEC E8E5 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001CF0 E8E9 CDF1EF          17      CALL    _BPB2DPB
001CF3 E8EC FDE1            14      POP IY
001CF5 E8EE D8              11      RET C
001CF6 E8EF CD8EEA          17      CALL    CHGDRV2
       E8F2                     RDFAT0X:
001CF9 E8F2 CDDAE9          17      CALL    RDFATS
001CFC E8F5 D8              11      RET C
001CFD E8F6 DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001D00 E8F9 C8              11      RET Z
001D01 E8FA DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001D05 E8FE C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001D06 E8FF 37               4      SCF
001D07 E900 C9              10      RET
                                
       E901                     BPB2DPB:
001D08 E901 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001D0B E904 B7               4      OR  A
001D0C E905 37               4      SCF
001D0D E906 C0              11      RET NZ
       E907                     BPBOK:
001D0E E907 FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001D11 E90A DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001D14 E90D FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001D17 E910 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001D1A E913 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001D1D E916 DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001D20 E919 FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001D23 E91C FD660F          19      LD  H,(IY+15)
001D26 E91F DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001D29 E922 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001D2C E925 FD5617          19      LD  D,(IY+23)
001D2F E928 FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E92B                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001D32 E92B 19              11      ADD HL,DE
001D33 E92C 10FD            13      DJNZ    BPBDP1
       E92E                     BPBDP2:
001D35 E92E DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001D38 E931 DD7411          19      LD  (IX+011H),H
001D3B E934 E5              11      PUSH    HL
                                
001D3C E935 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001D3F E938 FD6612          19      LD  H,(IY+18)
001D42 E93B FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001D45 E93E B7               4      OR  A
001D46 E93F 37               4      SCF
001D47 E940 C8              11      RET Z
001D48 E941 0606             7      LD  B,6
       E943                     BPBBPS1:
001D4A E943 05               4      DEC B
001D4B E944 0F               4      RRCA
001D4C E945 30FC            12      JR  NC,BPBBPS1
       E947                     BPBDE1:
001D4E E947 29              11      ADD HL,HL
001D4F E948 10FD            13      DJNZ    BPBDE1
                                
001D51 E94A 7C               4      LD  A,H
001D52 E94B DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001D55 E94E D1              10      POP DE      ;DPB_10_DIRPS
001D56 E94F 6C               4      LD  L,H
001D57 E950 2600             7      LD  H,0
001D59 E952 19              11      ADD HL,DE       ;MAXDIR
001D5A E953 E5              11      PUSH    HL
001D5B E954 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001D5E E957 CB21             8      SLA C       ;*2
001D60 E959 AF               4      XOR A
001D61 E95A 47               4      LD  B,A
001D62 E95B ED42            15      SBC HL,BC
001D64 E95D DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001D67 E960 DD7415          19      LD  (IX+015H),H
                                
001D6A E963 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001D6B E964 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001D6E E967 FD6614          19      LD  H,(IY+20)
                                
001D71 E96A DDCB0A7E        20      BIT 7,(IX+00AH) ;DPB_0A_FDMODE
001D75 E96E 2817            12      JR  Z,NOT_FD
001D77 E970 E5              11      PUSH    HL
001D78 E971 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001D7B E974 DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001D7E E977 AF               4      XOR A
001D7F E978 47               4      LD  B,A
001D80 E979 CB21             8      SLA C       ;両面なのでセクタ数を２倍
001D82 E97B 2B               6      DEC HL
       E97C                     CNTSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001D83 E97C 3C               4      INC A
001D84 E97D 2804            12      JR  Z,CNTSECE
001D86 E97F ED42            15      SBC HL,BC
001D88 E981 30F9            12      JR  NC,CNTSEC
       E983                     CNTSECE:
001D8A E983 DD770C          19      LD  (IX+00CH),A ;DPB_0C_MAXCYL
001D8D E986 E1              10      POP HL  ;ここまでフロッピー専用
       E987                     NOT_FD:
001D8E E987 7C               4      LD  A,H
001D8F E988 B5               4      OR  L
001D90 E989 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001D92 E98B 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001D94 E98D FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001D97 E990 B7               4      OR  A
001D98 E991 37               4      SCF
001D99 E992 C0              11      RET NZ
001D9A E993 FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001D9D E996 FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001DA0 E999 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001DA3 E99C A7               4      AND A       ;CF=0
       E99D                     BPB16BIT:
001DA4 E99D ED52            15      SBC HL,DE
001DA6 E99F DE00             7      SBC A,0
001DA8 E9A1 FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E9A4                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001DAB E9A4 CB18             8      RR  B       ;->CY
001DAD E9A6 3808            12      JR  C,BPBTC2
001DAF E9A8 CB3F             8      SRL A
001DB1 E9AA CB1C             8      RR  H       ;AHL=AHL/2
001DB3 E9AC CB1D             8      RR  L
001DB5 E9AE 18F4            12      JR  BPBTC1
       E9B0                     BPBTC2:
001DB7 E9B0 B7               4      OR  A
001DB8 E9B1 37               4      SCF
001DB9 E9B2 C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001DBA E9B3 23               6      INC HL
001DBB E9B4 23               6      INC HL
001DBC E9B5 DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001DBF E9B8 DD7409          19      LD  (IX+9),H
                                
001DC2 E9BB FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001DC5 E9BE DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001DC8 E9C1 FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001DCB E9C4 C6FE             7      ADD A,0-2       ;>2:CF=1
001DCD E9C6 FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001DD0 E9C9 6F               4      LD  L,A
001DD1 E9CA 3002            12      JR  NC,BPBFAT1
001DD3 E9CC F680             7      OR  080H
       E9CE                     BPBFAT1:
001DD5 E9CE DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001DD8 E9D1 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001DD9 E9D2 C8              11      RET Z       ;1セクタ256バイト
001DDA E9D3 2D               4      DEC L
001DDB E9D4 C8              11      RET Z       ;1セクタ512バイト
001DDC E9D5 2D               4      DEC L
001DDD E9D6 2D               4      DEC L
001DDE E9D7 C8              11      RET Z       ;1セクタ1024バイト
001DDF E9D8 37               4      SCF
001DE0 E9D9 C9              10      RET
                                
       E9DA                     RDFATS:
001DE1 E9DA CD20EA          17      CALL    FATSETUP
001DE4 E9DD D8              11      RET C
001DE5 E9DE CDEAE9          17      CALL    DRD24B
001DE8 E9E1 2A7CF0          16      LD  HL,(_FATBF)
001DEB E9E4 7E               7      LD  A,(HL)
001DEC E9E5 C9              10      RET
                                
       E9E6                     DRD16:
001DED E9E6 0E00             7      LD  C,0
       E9E8                     DRD24:
001DEF E9E8 0601             7      LD  B,1
       E9EA                     DRD24B:
001DF1 E9EA DDE5            15      PUSH    IX
001DF3 E9EC DD2AA8EF        20      LD  IX,(_DPB)
001DF7 E9F0 CDC4EC          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E9F3                     POP_IX_RET:
001DFA E9F3 DDE1            14      POP IX
001DFC E9F5 C9              10      RET
                                
       E9F6                     DWT16:
001DFD E9F6 0E00             7      LD  C,0
       E9F8                     DWT24:
001DFF E9F8 0601             7      LD  B,1
       E9FA                     DWT24B:
001E01 E9FA DDE5            15      PUSH    IX
001E03 E9FC DD2AA8EF        20      LD  IX,(_DPB)
001E07 EA00 CD28EC          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001E0A EA03 18EE            12      JR  POP_IX_RET
                                
       EA05                     WTFAT:
001E0C EA05 CD20EA          17      CALL    FATSETUP
001E0F EA08 D4FAE9          17      CALL    NC,DWT24B
001E12 EA0B D8              11      RET C
001E13 EA0C DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001E17 EA10 C8              11      RET Z       ;予備FATが無い
001E18 EA11 CD27EA          17      CALL    FATS2
001E1B EA14 E5              11      PUSH    HL      ;予備FAT
001E1C EA15 DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001E1F EA18 DD6601          19      LD  H,(IX+1)
001E22 EA1B 19              11      ADD HL,DE
001E23 EA1C EB               4      EX  DE,HL
001E24 EA1D E1              10      POP HL
001E25 EA1E 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       EA20                     FATSETUP:
001E27 EA20 3AAAEF          13      LD  A,(_FATDRV)
001E2A EA23 CD2FEB          17      CALL    CHGDRVR     ;ドライブ切り替え
001E2D EA26 D8              11      RET C
       EA27                     FATS2:
001E2E EA27 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001E31 EA2A 0F               4      RRCA
001E32 EA2B CD54EA          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001E35 EA2E 210000          10      LD  HL,0
001E38 EA31 4A               4      LD  C,D
001E39 EA32 54               4      LD  D,H
001E3A EA33 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001E3D EA36 47               4      LD  B,A
001E3E EA37 04               4      INC B
001E3F EA38 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       EA3B                     FAT_SKP:
001E42 EA3B 05               4      DEC B
001E43 EA3C 2805            12      JR  Z,FAT1
001E45 EA3E 19              11      ADD HL,DE
001E46 EA3F 93               4      SUB E
001E47 EA40 30F9            12      JR  NC,FAT_SKP
001E49 EA42 C9              10      RET
       EA43                     FAT1:
001E4A EA43 EB               4      EX  DE,HL
001E4B EA44 B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001E4C EA45 3801            12      JR  C,FAT2
001E4E EA47 79               4      LD  A,C
       EA48                     FAT2:
001E4F EA48 47               4      LD  B,A
                                
001E50 EA49 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001E53 EA4C 19              11      ADD HL,DE
001E54 EA4D EB               4      EX  DE,HL
001E55 EA4E 2A7CF0          16      LD  HL,(_FATBF)
001E58 EA51 AF               4      XOR A       ;CF=0
001E59 EA52 4F               4      LD  C,A
001E5A EA53 C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       EA54                     FATSETUP12:
001E5B EA54 110606          10      LD  DE,0606H    ;256
001E5E EA57 D8              11      RET C
001E5F EA58 110303          10      LD  DE,0303H    ;512
001E62 EA5B 0F               4      RRCA
001E63 EA5C D8              11      RET C
001E64 EA5D 110102          10      LD  DE,0201H    ;1024
001E67 EA60 C9              10      RET
                                
       EA61                     FATSETUP16:
001E68 EA61 110808          10      LD  DE,0808H    ;256
001E6B EA64 D8              11      RET C
001E6C EA65 110404          10      LD  DE,0404H
001E6F EA68 0F               4      RRCA            ;512
001E70 EA69 D8              11      RET C
001E71 EA6A 110202          10      LD  DE,0202H    ;1024
001E74 EA6D C9              10      RET
                                
       EA6E                     CHGDRV:
001E75 EA6E E5              11      PUSH    HL
001E76 EA6F 2189EF          10      LD  HL,_DSK
001E79 EA72 BE               7      CP  (HL)
001E7A EA73 280A            12      JR  Z,CHGDRVE
       EA75                     CHGDRV1:
001E7C EA75 DDE5            15      PUSH    IX
001E7E EA77 CD81EA          17      CALL    CHGDRV0
001E81 EA7A 3A89EF          13      LD  A,(_DSK)
001E84 EA7D DDE1            14      POP IX
       EA7F                     CHGDRVE:
001E86 EA7F E1              10      POP HL
001E87 EA80 C9              10      RET
                                
       EA81                     CHGDRV0:
001E88 EA81 6F               4      LD  L,A
001E89 EA82 CDDCEF          17      CALL    _GETDPB
001E8C EA85 D8              11      RET C
001E8D EA86 DD22A8EF        20      LD  (_DPB),IX
001E91 EA8A 7D               4      LD  A,L
001E92 EA8B 3289EF          13      LD  (_DSK),A
       EA8E                     CHGDRV2:
001E95 EA8E C5              11      PUSH    BC
001E96 EA8F D5              11      PUSH    DE
001E97 EA90 ED73E5EA        20      LD  (SPPAT2+1),SP
001E9B EA94 F3               4      DI
001E9C EA95 DDF9            10      LD  SP,IX
                                
001E9E EA97 E1              10      POP HL      ;DPB_00_FATLN
001E9F EA98 E1              10      POP HL      ;DPB_02_DRD
001EA0 EA99 22F1E9          16      LD  (DRDPAT+1),HL
                                
001EA3 EA9C E1              10      POP HL
001EA4 EA9D 2201EA          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001EA7 EAA0 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001EA8 EAA1 7C               4      LD  A,H
001EA9 EAA2 3200E1          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001EAC EAA5 3D               4      DEC A
001EAD EAA6 3290E8          13      LD  (NCPAT+1),A
                                
001EB0 EAA9 E1              10      POP HL      ;DPB_08_MAXCL
001EB1 EAAA 7D               4      LD  A,L
001EB2 EAAB 321FE1          13      LD  (CLPAT2+1),A
001EB5 EAAE 7C               4      LD  A,H
001EB6 EAAF 321BE1          13      LD  (CLPAT1+1),A
001EB9 EAB2 2B               6      DEC HL
001EBA EAB3 2223E3          16      LD  (MAXCLP+1),HL
                                
001EBD EAB6 E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001EBE EAB7 7D               4      LD  A,L
001EBF EAB8 F6FE             7      OR  0FEH
001EC1 EABA 32F3EC          13      LD  (FDMODE+1),A
001EC4 EABD 07               4      RLCA
001EC5 EABE E603             7      AND 3
001EC7 EAC0 326BEF          13      LD  (FSPAT+1),A
001ECA EAC3 4C               4      LD  C,H
                                
001ECB EAC4 E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001ECC EAC5 E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001ECD EAC6 7C               4      LD  A,H     ;DPB_0F_BPS
001ECE EAC7 E607             7      AND 7
001ED0 EAC9 321EE6          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001ED3 EACC 87               4      ADD A,A     ;8  4   2
001ED4 EACD 87               4      ADD A,A     ;010H   8   4
001ED5 EACE 87               4      ADD A,A     ;020H   010H    8
001ED6 EACF 327CDF          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001ED9 EAD2 2600             7      LD  H,0
001EDB EAD4 22FAF0          16      LD  (_FATPS),HL
                                
001EDE EAD7 E1              10      POP HL      ;DPB_10_DIRPS
001EDF EAD8 22FCF0          16      LD  (_DIRPS),HL
                                
001EE2 EADB E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001EE3 EADC 7C               4      LD  A,H
001EE4 EADD 3284EF          13      LD  (_DRIVE),A
                                
001EE7 EAE0 E1              10      POP HL      ;DPB_14_ADDCL16
001EE8 EAE1 2210E1          16      LD  (CLSPAT+1),HL
                                
001EEB EAE4 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001EEE EAE7 FB               4      EI
001EEF EAE8 2AFCF0          16      LD  HL,(_DIRPS)
001EF2 EAEB 0600             7      LD  B,0
001EF4 EAED 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001EF5 EAEE 2297DF          16      LD  (MD_PAT+1),HL
                                
001EF8 EAF1 2A23E3          16      LD  HL,(MAXCLP+1);
001EFB EAF4 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001EFE EAF7 ED52            15      SBC HL,DE       ;CF=0のはず
001F00 EAF9 300F            12      JR  NC,SETFAT16
001F02 EAFB 2116E8          10      LD  HL,GNCL     ;FAT12
001F05 EAFE 1139E8          10      LD  DE,SNCL
001F08 EB01 0154EA          10      LD  BC,FATSETUP12
001F0B EB04 DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001F0F EB08 180D            12      JR  EXTRA1
       EB0A                     SETFAT16:
001F11 EB0A 216DE8          10      LD  HL,GNCL16   ;FAT16
001F14 EB0D 117AE8          10      LD  DE,SNCL16
001F17 EB10 0161EA          10      LD  BC,FATSETUP16
001F1A EB13 DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       EB17                     EXTRA1:
001F1E EB17 22F8EF          16      LD  (GNCPAT+1),HL
001F21 EB1A ED53FBEF        20      LD  (SNCPAT+1),DE
001F25 EB1E ED432CEA        20      LD  (FATSX+1),BC
001F29 EB22 D1              10      POP DE
001F2A EB23 C1              10      POP BC
001F2B EB24 AF               4      XOR A
001F2C EB25 C9              10      RET
                                
       EB26                     GETDPBD:
001F2D EB26 DDE3            23      EX  (SP),IX
001F2F EB28 DDE5            15      PUSH    IX
001F31 EB2A 3A88EF          13      LD  A,(_DRV)
001F34 EB2D 1807            12      JR  GETDPB1
                                
       EB2F                     CHGDRVR:
001F36 EB2F CDD9EF          17      CALL    _CHGDRV
001F39 EB32 D8              11      RET C
001F3A EB33 3A89EF          13      LD  A,(_DSK)
       EB36                     GETDPB1:
001F3D EB36 C3DCEF          10      JP  _GETDPB
                                
       EB39                     GETDPB:
001F40 EB39 FE08             7      CP  8
001F42 EB3B 3F               4      CCF
001F43 EB3C D8              11      RET C
001F44 EB3D 0F               4      RRCA
001F45 EB3E 0F               4      RRCA
001F46 EB3F 0F               4      RRCA
001F47 EB40 DD                      DB  0DDH        ;Z80未定義命令
001F48 EB41 6F               4      LD  L,A     ;LD IXL,A
001F49 EB42 DD                      DB  0DDH        ;Z80未定義命令
001F4A EB43 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001F4C EB45 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001F4F EB48 A7               4      AND A       ;CF=0の為
001F50 EB49 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001F54 EB4D C0              11      RET NZ      ;FAT16
001F55 EB4E DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001F59 EB52 C0              11      RET NZ      ;BPB
001F5A EB53 FE01             7      CP  001H        ;A=0 THEN CF=1
001F5C EB55 C9              10      RET
                                
       EB56                     _SYS5F:
001F5D EB56 AF               4      XOR A
       EB57                     FFLUSH:
001F5E EB57 F5              11      PUSH    AF
001F5F EB58 3EFF             7      LD  A,0FFH
001F61 EB5A 3239EF          13      LD  (SFILE),A
001F64 EB5D CD54E7          17      CALL    DWTX
001F67 EB60 3EFF             7      LD  A,0FFH
001F69 EB62 32A5EF          13      LD  (_DBDRV),A
001F6C EB65 CD9EE7          17      CALL    WTFATX
001F6F EB68 AF               4      XOR A
001F70 EB69 32ABEF          13      LD  (_FATIX),A
001F73 EB6C 2F               4      CPL         ;0FFH
001F74 EB6D 32AAEF          13      LD  (_FATDRV),A
001F77 EB70 F1              10      POP AF
001F78 EB71 C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
                                ;   コマンド送信
       EB72                     PUTCOM:
001F79 EB72 F5              11      PUSH    AF
001F7A EB73 3E0F             7      LD  A,00FH
001F7C EB75 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F7E EB77 F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EB78                     PUTDAT:
001F7F EB78 F5              11      PUSH    AF
       EB79                     PUTDAT1:
001F80 EB79 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F82 EB7B E602             7      AND 2       ;RFD
001F84 EB7D 28FA            12      JR  Z,PUTDAT1
001F86 EB7F 3E0E             7      LD  A,00EH      ;ATN=0
001F88 EB81 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F8A EB83 F1              10      POP AF
001F8B EB84 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
001F8D EB86 F5              11      PUSH    AF
001F8E EB87 3E09             7      LD  A,9     ;DAV=1
001F90 EB89 D3FF            11      OUT (0FFH),A
       EB8B                     PUTDAT2:
001F92 EB8B DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F94 EB8D E604             7      AND 4       ;DAC
001F96 EB8F 28FA            12      JR  Z,PUTDAT2
                                
001F98 EB91 3E08             7      LD  A,8     ;DAV=0
001F9A EB93 D3FF            11      OUT (0FFH),A
       EB95                     PUTDAT3:
001F9C EB95 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F9E EB97 E604             7      AND 4       ;DAC
001FA0 EB99 20FA            12      JR  NZ,PUTDAT3
001FA2 EB9B F1              10      POP AF
001FA3 EB9C C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EB9D                     GETDAT:
001FA4 EB9D 3E0B             7      LD  A,00BH      ;RFD=1
001FA6 EB9F D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBA1                     GETDAT1:
001FA8 EBA1 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FAA EBA3 0F               4      RRCA            ;DAV
001FAB EBA4 30FB            12      JR  NC,GETDAT1
                                    
001FAD EBA6 3E0A             7      LD  A,00AH      ;RFD=0
001FAF EBA8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001FB1 EBAA DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FB3 EBAC F5              11      PUSH    AF
001FB4 EBAD 3E0D             7      LD  A,00DH      ;DAC=1
001FB6 EBAF D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EBB1                     GETDAT2:
001FB8 EBB1 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FBA EBB3 0F               4      RRCA            ;DAV
001FBB EBB4 38FB            12      JR  C,GETDAT2
                                
001FBD EBB6 3E0C             7      LD  A,00CH      ;DAC=0
001FBF EBB8 D3FF            11      OUT (0FFH),A
001FC1 EBBA F1              10      POP AF
001FC2 EBBB C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBBC                     FPUTDAT:
       EBBC                     FPUTDAT1:
001FC3 EBBC DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FC5 EBBE E602             7      AND 2       ;RFD
001FC7 EBC0 28FA            12      JR  Z,FPUTDAT1
001FC9 EBC2 3E0E             7      LD  A,00EH      ;ATN=0
001FCB EBC4 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001FCD EBC6 7E               7      LD  A,(HL)
001FCE EBC7 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FD0 EBC9 3E09             7      LD  A,9     ;DAV=1
001FD2 EBCB D3FF            11      OUT (0FFH),A
001FD4 EBCD 23               6      INC HL
001FD5 EBCE 0B               6      DEC BC
       EBCF                     FPUTDAT2:
001FD6 EBCF DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FD8 EBD1 E604             7      AND 4       ;DAC
001FDA EBD3 28FA            12      JR  Z,FPUTDAT2
                                
001FDC EBD5 7E               7      LD  A,(HL)
001FDD EBD6 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FDF EBD8 3E08             7      LD  A,8     ;DAV=0
001FE1 EBDA D3FF            11      OUT (0FFH),A
       EBDC                     FPUTDAT3:
001FE3 EBDC DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FE5 EBDE E604             7      AND 4       ;DAC
001FE7 EBE0 20FA            12      JR  NZ,FPUTDAT3
                                
001FE9 EBE2 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001FEB EBE4 EABCEB          10      JP  PE,FPUTDAT
001FEE EBE7 C9              10      RET
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBE8                     FGETDAT:
001FEF EBE8 3E0B             7      LD  A,00BH      ;RFD=1
001FF1 EBEA D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBEC                     FGETDAT1:
001FF3 EBEC DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FF5 EBEE 0F               4      RRCA            ;DAV
001FF6 EBEF 30FB            12      JR  NC,FGETDAT1
                                    
001FF8 EBF1 3E0A             7      LD  A,00AH      ;RFD=0
001FFA EBF3 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001FFC EBF5 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FFE EBF7 77               7      LD  (HL),A
                                
001FFF EBF8 3E0D             7      LD  A,00DH      ;DAC=1
002001 EBFA D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
002003 EBFC 23               6      INC HL
002004 EBFD 0B               6      DEC BC
       EBFE                     FGETDAT2:
002005 EBFE DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
002007 EC00 0F               4      RRCA            ;DAV
002008 EC01 38FB            12      JR  C,FGETDAT2
                                
00200A EC03 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
00200C EC05 77               7      LD  (HL),A
                                
00200D EC06 3E0C             7      LD  A,00CH      ;DAC=0
00200F EC08 D3FF            11      OUT (0FFH),A
                                
002011 EC0A EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
002013 EC0C EAE8EB          10      JP  PE,FGETDAT
002016 EC0F C9              10      RET
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in 
                                ;   DE:論理セクタ
       EC10                     CALC_SECTOR:
002017 EC10 C5              11      PUSH    BC
002018 EC11 DD4E0D          19      LD  C,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
00201B EC14 0610             7      LD  B,16
00201D EC16 AF               4      XOR A
00201E EC17 EB               4      EX  DE,HL
       EC18                     DIV1:
00201F EC18 29              11      ADD HL,HL
002020 EC19 8F               4      ADC A,A
002021 EC1A B9               4      CP  C
002022 EC1B 3802            12      JR  C,DIV2
002024 EC1D 91               4      SUB C
002025 EC1E 2C               4      INC L
       EC1F                     DIV2:
002026 EC1F 10F7            13      DJNZ    DIV1
                                
002028 EC21 3C               4      INC A   ;最小のセクタは１固定
002029 EC22 55               4      LD  D,L ;TRACK
       EC23                     DIV3:
00202A EC23 5F               4      LD  E,A ;SECTOR
00202B EC24 C1              10      POP BC
00202C EC25 C9              10      RET
                                
       EC26                     WTTRK:
00202D EC26 37               4      SCF
00202E EC27 C9              10      RET
       EC28                     FDWT:
00202F EC28 E5              11      PUSH    HL
002030 EC29 D5              11      PUSH    DE
002031 EC2A CD10EC          17      CALL    CALC_SECTOR
002034 EC2D 7A               4      LD  A,D     ;トラック
002035 EC2E 328EEC          13      LD  (FDWT_TRACK),A
002038 EC31 7B               4      LD  A,E     ;セクタ
002039 EC32 3289EC          13      LD  (FDWT_SECTOR),A
00203C EC35 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
00203F EC38 93               4      SUB E
002040 EC39 3C               4      INC A
002041 EC3A 67               4      LD  H,A
002042 EC3B D1              10      POP DE
002043 EC3C 3A1EE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
002046 EC3F 4F               4      LD  C,A
002047 EC40 AF               4      XOR A
       EC41                     FDWT2:
002048 EC41 81               4      ADD A,C
002049 EC42 13               6      INC DE
00204A EC43 05               4      DEC B
00204B EC44 2807            12      JR  Z,FDWT3
00204D EC46 25               4      DEC H       ;トラック、ヘッドを跨がない
00204E EC47 2804            12      JR  Z,FDWT3
002050 EC49 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
002052 EC4B 38F4            12      JR  C,FDWT2
       EC4D                     FDWT3:
002054 EC4D 4F               4      LD  C,A
002055 EC4E E1              10      POP HL
002056 EC4F 3E16             7      LD  A,16H       ;高速レシーブメモリ
002058 EC51 CD72EB          17      CALL    PUTCOM
00205B EC54 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
00205D EC56 CD78EB          17      CALL    PUTDAT
002060 EC59 AF               4      XOR A       ;開始アドレスL
002061 EC5A CD78EB          17      CALL    PUTDAT
002064 EC5D 79               4      LD  A,C     ;バイト数H
002065 EC5E CD78EB          17      CALL    PUTDAT
002068 EC61 AF               4      XOR A       ;バイト数L
002069 EC62 CD78EB          17      CALL    PUTDAT
00206C EC65 C5              11      PUSH    BC
00206D EC66 41               4      LD  B,C
00206E EC67 0E00             7      LD  C,0
002070 EC69 CDBCEB          17      CALL    FPUTDAT
002073 EC6C C1              10      POP BC
002074 EC6D 3E0D             7      LD  A,0DH       ;エグゼキュート
002076 EC6F CD72EB          17      CALL    PUTCOM
002079 EC72 3E7C             7      LD  A,WRITEDISKEX/256
00207B EC74 CD78EB          17      CALL    PUTDAT
00207E EC77 3E5D             7      LD  A,WRITEDISKEX%256
002080 EC79 CD78EB          17      CALL    PUTDAT
002083 EC7C DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
002086 EC7F CD78EB          17      CALL    PUTDAT
002089 EC82 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
00208C EC85 CD78EB          17      CALL    PUTDAT
       EC89                     FDWT_SECTOR EQU $+1
00208F EC88 3E00             7      LD  A,0     ;セクタ
002091 EC8A CD78EB          17      CALL    PUTDAT
       EC8E                     FDWT_TRACK  EQU $+1
002094 EC8D 3E00             7      LD  A,0     ;トラック
002096 EC8F CD78EB          17      CALL    PUTDAT
002099 EC92 3AF3EC          13      LD  A,(FDMODE+1)    ;フロッピーディスクのモード(DPB_0A_FDMODE)
00209C EC95 CD78EB          17      CALL    PUTDAT
00209F EC98 3A1EE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
0020A2 EC9B CD78EB          17      CALL    PUTDAT
0020A5 EC9E 79               4      LD  A,C
0020A6 EC9F CD78EB          17      CALL    PUTDAT      ;バイト数H
0020A9 ECA2 DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
0020AC ECA5 CD78EB          17      CALL    PUTDAT
                                
0020AF ECA8 3E0D             7      LD  A,0DH       ;エグゼキュート
0020B1 ECAA CD72EB          17      CALL    PUTCOM
0020B4 ECAD 3E7D             7      LD  A,RESULTEX/256
0020B6 ECAF CD78EB          17      CALL    PUTDAT
0020B9 ECB2 3EB0             7      LD  A,RESULTEX%256
0020BB ECB4 CD78EB          17      CALL    PUTDAT
                                
0020BE ECB7 CD9DEB          17      CALL    GETDAT
0020C1 ECBA 4F               4      LD  C,A
0020C2 ECBB FE01             7      CP  1
0020C4 ECBD D8              11      RET C
                                
0020C5 ECBE 78               4      LD  A,B
0020C6 ECBF B7               4      OR  A
0020C7 ECC0 C228EC          10      JP  NZ,FDWT
0020CA ECC3 C9              10      RET
                                
       ECC4                     FDRD:
0020CB ECC4 3E0D             7      LD  A,0DH       ;エグゼキュート
0020CD ECC6 CD72EB          17      CALL    PUTCOM
0020D0 ECC9 3E7C             7      LD  A,READDISKEX/256
0020D2 ECCB CD78EB          17      CALL    PUTDAT
0020D5 ECCE AF               4      XOR A
0020D6 ECCF CD78EB          17      CALL    PUTDAT
0020D9 ECD2 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
0020DC ECD5 CD78EB          17      CALL    PUTDAT
0020DF ECD8 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020E2 ECDB CD78EB          17      CALL    PUTDAT
0020E5 ECDE E5              11      PUSH    HL
0020E6 ECDF D5              11      PUSH    DE
0020E7 ECE0 CD10EC          17      CALL    CALC_SECTOR
0020EA ECE3 7B               4      LD  A,E     ;セクタ
0020EB ECE4 CD78EB          17      CALL    PUTDAT
0020EE ECE7 7A               4      LD  A,D     ;トラック
0020EF ECE8 CD78EB          17      CALL    PUTDAT
0020F2 ECEB DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020F5 ECEE 93               4      SUB E
0020F6 ECEF 3C               4      INC A
0020F7 ECF0 67               4      LD  H,A
0020F8 ECF1 D1              10      POP DE
0020F9 ECF2 3EFF             7  FDMODE: LD  A,0FFH      ;フロッピーディスクのモード(DPB_0A_FDMODE)
0020FB ECF4 CD78EB          17      CALL    PUTDAT
0020FE ECF7 3A1EE6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
002101 ECFA CD78EB          17      CALL    PUTDAT
002104 ECFD 4F               4      LD  C,A
002105 ECFE AF               4      XOR A
       ECFF                     FDRD2:
002106 ECFF 81               4      ADD A,C
002107 ED00 13               6      INC DE
002108 ED01 05               4      DEC B
002109 ED02 2807            12      JR  Z,FDRD3
00210B ED04 25               4      DEC H       ;トラック、ヘッドを跨がない
00210C ED05 2804            12      JR  Z,FDRD3
00210E ED07 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
002110 ED09 38F4            12      JR  C,FDRD2
       ED0B                     FDRD3:
002112 ED0B E1              10      POP HL
002113 ED0C 4F               4      LD  C,A
002114 ED0D CD78EB          17      CALL    PUTDAT      ;バイト数H
002117 ED10 DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
00211A ED13 CD78EB          17      CALL    PUTDAT
                                
00211D ED16 3E0D             7      LD  A,0DH       ;エグゼキュート
00211F ED18 CD72EB          17      CALL    PUTCOM
002122 ED1B 3E7D             7      LD  A,RESULTEX/256
002124 ED1D CD78EB          17      CALL    PUTDAT
002127 ED20 3EB0             7      LD  A,RESULTEX%256
002129 ED22 CD78EB          17      CALL    PUTDAT
                                
00212C ED25 CD9DEB          17      CALL    GETDAT
00212F ED28 4F               4      LD  C,A
002130 ED29 FE01             7      CP  1
002132 ED2B D8              11      RET C
                                
002133 ED2C 3E15             7      LD  A,15H       ;高速センドメモリ
002135 ED2E CD72EB          17      CALL    PUTCOM
002138 ED31 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
00213A ED33 CD78EB          17      CALL    PUTDAT
00213D ED36 AF               4      XOR A       ;開始アドレスL
00213E ED37 CD78EB          17      CALL    PUTDAT
002141 ED3A 79               4      LD  A,C     ;バイト数H
002142 ED3B CD78EB          17      CALL    PUTDAT
002145 ED3E AF               4      XOR A       ;バイト数L
002146 ED3F CD78EB          17      CALL    PUTDAT
002149 ED42 C5              11      PUSH    BC
00214A ED43 41               4      LD  B,C
00214B ED44 0E00             7      LD  C,0
00214D ED46 CDE8EB          17      CALL    FGETDAT
002150 ED49 C1              10      POP BC
002151 ED4A 78               4      LD  A,B
002152 ED4B B7               4      OR  A
002153 ED4C C2C4EC          10      JP  NZ,FDRD
002156 ED4F C9              10      RET
                                
       EF6A                     FSPAT   EQU BEEPD+9
                                
[EOF:88DISK.ASM:UTF_8]
                                
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       ED50                     AT_TABLE:
002157 ED50                         DS  TABLEAD-AT_TABLE
                                
       ED98                     KEY_TABLE:
00219F ED98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0021A7 EDA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0021AF EDA8 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
0021B7 EDB0 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
0021BF EDB8 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
0021C7 EDC0 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
0021CF EDC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0021D7 EDD0 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
0021DF EDD8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0021E7 EDE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0021EF EDE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0021F7 EDF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0021FF EDF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                ;
                                ;   割り込みベクタ:アドレス下位1バイトが0になるように
                                ;
002207 EE00 EDD8                I232C:  DW  INTE88
002209 EE02 C1D8                IVRTC:  DW  INTVRTC
00220B EE04 EDD8                I1D600: DW  INTE88
00220D EE06 EDD8                    DW  INTE88
00220F EE08 EDD8                    DW  INTE88
002211 EE0A                     IFM:    DS  030H-10
       EE30                     EXTSP:
                                
       EE30                     SHIFT_TABLE:
002237 EE30 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
00223F EE38 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
002247 EE40 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
00224F EE48 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
002257 EE50 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
00225F EE58 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
002267 EE60 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
00226F EE68 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
002277 EE70 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
00227F EE78 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
002287 EE80 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
00228F EE88 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
002297 EE90 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE98                     CTRL_TABLE:
00229F EE98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0022A7 EEA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0022AF EEA8 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0022B7 EEB0 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0022BF EEB8 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0022C7 EEC0 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0022CF EEC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0022D7 EED0 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
0022DF EED8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0022E7 EEE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0022EF EEE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0022F7 EEF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0022FF EEF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
002307 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
002307 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00230A EF03 C309D0          10      JP  WBOOT1
       EF06                     CPM_CONST:
00230D EF06 C392D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
002310 EF09 C34AD9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
002313 EF0C C3CCDB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
002316 EF0F                         DS  5
00231B EF14 00                  FDRV    DB  0
00231C EF15                     FNAME   DS  36
002340 EF39                     SFILE:  DS  33      ;DRV FILENAME
002361 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002364 EF5D 0000                LEFTX:  DW  0
002366 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002368 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002370 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002377 EF70 00                  CHECK:  DB  0
                                
002378 EF71 4F4B24              OK: DB  "OK$"
00237B EF74                         DS  5
002380 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002387 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002388 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002389 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00238A EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
00238B EF84 00                  _DRIVE: DB  0   ;unit number
00238C EF85 00                  _SEEKSP:DB  0   ;Seek speed
00238D EF86 FF                  _ISEEK: DB  0FFH    ;
00238E EF87 00                  _DVSW:  DB  0
00238F EF88 00                  _DRV:   DB  0
002390 EF89 FF                  _DSK:   DB  0FFH
002391 EF8A 8000                _DTA:   DW  00080H
002393 EF8C 0000                _CTC:   DW  0
002395 EF8E 0000                _TXADR: DW  0
002397 EF90 0000                _KEYPS: DW  0
002399 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00239B EF94 C210                _KEYSP: DW  010C2H
00239D EF96 00                  _COLORF:DB  COLORF  ;色
00239E EF97 18                  _LINE:  DB  LINE
                                
00239F EF98 0000                _FCB:   DW  0
0023A1 EF9A 0000                _FBPS:  DW  0   ;SEARCH FILES
0023A3 EF9C 0000                _FBAD:  DW  0   ;    //
0023A5 EF9E 00                  _FBCNT: DB  0   ;    //
0023A6 EF9F 00                  _FILEN: DB  0
0023A7 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
0023A8 EFA1                         DS  1
0023A9 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
0023AA EFA3                         DS  1
0023AB EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
0023AC EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
0023AD EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
0023AF EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
0023B1 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
0023B2 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
0023B3 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
0023B5 EFAE                         DS  2
                                
       EFB0                     CRTCD:  
0023B7 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
0023B8 EFB1 50                      DB  WIDTH
       EFB2                     TVRAMTOP:
0023B9 EFB2 5938                    DB  059H,038H
0023BB EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
0023BD EFB6 19                      DB  019H
       EFB7                     WKE4:
0023BE EFB7 1C                      DB  01CH
       EFB8                     WKE6:
0023BF EFB8 00                      DB  000H
       EFB9                     WK40:
0023C0 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
0023C1 EFBA 80F8                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
0023C3 EFBC B0FF                    DW  0-WIDTH
       EFBE                     WK30:
0023C5 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
0023C6 EFBF 20                      DB  020H
                                
0023C7 EFC0 0000                CTC0:   DW  INTCTCE
0023C9 EFC2 0000                CTC1:   DW  INTCTCE
0023CB EFC4 0000                CTC2:   DW  INTCTC2
0023CD EFC6 0000                CTC3:   DW  INTCTCE
0023CF EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
0023D1 EFCA C305DD          10  _INKEY: JP  INKEY
0023D4 EFCD C3C8DA          10  _PRINT: JP  PRINT
0023D7 EFD0 C35CDD          10  _SCRN:  JP  SCRN
0023DA EFD3 C3A7DC          10  _POS:   JP  POS
0023DD EFD6 C310DB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
0023E0 EFD9 C36EEA          10      JP  CHGDRV
       EFDC                     _GETDPB:
0023E3 EFDC C339EB          10      JP  GETDPB
       EFDF                     _FFLUSH:
0023E6 EFDF C357EB          10      JP  FFLUSH
       EFE2                     _RDFATX:
0023E9 EFE2 C374E7          10      JP  RDFATX
0023EC EFE5 C39CE8          10  _RDFAT: JP  RDFAT
0023EF EFE8 C326EC          10  _WTTRK: JP  WTTRK
0023F2 EFEB C3C4EC          10  _FDRD:  JP  FDRD
0023F5 EFEE C328EC          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
0023F8 EFF1 C301E9          10      JP  BPB2DPB
0023FB EFF4                         DS  3
       EFF7                     _GNCL:
0023FE EFF7 C316E8          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002401 EFFA C339E8          10  SNCPAT: JP  SNCL        ; self-modifying code
002404 EFFD C35FD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
002407 F000 03EF1DD929D9A9DF        DW  _SYS00,_SYS01,_SYS02,_SYS03
00240F F008 1ED61ED62ED909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
002417 F010 36D920D65ED98AD9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00241F F018 35D63AD649D65CD6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
002427 F020 B0D6F7D640D776D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
00242F F028 7ED794D7A9D7A1D7        DW  _SYS14,_SYS15,_SYS16,_SYS17
002437 F030 F0D7F5D7FAD700D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
00243F F038 1ED626D81ED62AD8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002447 F040 1ED6E0D7E8D731D8        DW  _SYS20,_SYS21,_SYS22,_SYS23
00244F F048 57D81ED631E416E5        DW  _SYS24,_ERROR,_SYS26,_SYS27
002457 F050 E8D760D8A0D9A9DF        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
00245F F058 C7D9A9DF1ED683D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002467 F060 7DD81ED61ED61ED6        DW  _SYS30,_ERROR,_ERROR,_ERROR
00246F F068 1ED61ED61ED61ED6        DW  _ERROR,_ERROR,_ERROR,_ERROR
002477 F070 1ED6A9DFA9DFA4D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00247F F078 01D6                    DW  _DOS2
                                
002481 F07A                         DS  2
002483 F07C 00F2                _FATBF: DW  FATBF
002485 F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002487 F080 13DB13DB4ADB52DC        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00248F F088 4CDC75DB25DCF1DB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002497 F090 1ADB3FDB55DCA1DB        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00249F F098 22DC94DB5CDC13DB        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
0024A7 F0A0 13DB13DB99DB13DB        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
0024AF F0A8 13DB13DB13DB13DB        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
0024B7 F0B0 13DB13DB22DCA8DB        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
0024BF F0B8 FCDA21DB36DB55DC        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
0024C7 F0C0                         DS  02AH
                                
0024F1 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024F3 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024F5 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024F7 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
0024FB F0F4                     SCDIR:  DS  2       ;+14 +15
0024FD F0F6                     SFBPS:  DS  2       ;FBPS
0024FF F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002501 F0FA 0000                _FATPS: DW  0
002503 F0FC 0000                _DIRPS: DW  0
002505 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
002507 F100 0200                    DW  2   ;DPB_00_FATLN
002509 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
00250B F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
00250D F106 FD                      DB  0FDH    ;DPB_06_FATID
00250E F107 02                      DB  2   ;DPB_07_SECPCL
00250F F108 6401                    DW  356 ;DPB_08_MAXCL
002511 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002512 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
002513 F10C 28                      DB  40  ;DPB_0C_MAXCYL
002514 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002515 F10E 01                      DB  1   ;DPB_0E_FATPS
002516 F10F 82                      DB  082H    ;DPB_0F_BPS
002517 F110 0500                    DW  5   ;DPB_10_DIRPS
002519 F112 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00251A F113 00                      DB  0   ;DPB_13_UNITNO
00251B F114 0800                    DW  8   ;DPB_14_ADDCL16
00251D F116 0000                    DW  0   ;DPB_16
00251F F118 0000                    DW  0   ;DPB_18
002521 F11A 0000                    DW  0   ;DPB_1A_SDIR
002523 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
002527 F120 0200                    DW  2   ;DPB_00_FATLN
002529 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
00252B F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
00252D F126 FD                      DB  0FDH    ;DPB_06_FATID
00252E F127 02                      DB  2   ;DPB_07_SECPCL
00252F F128 6401                    DW  356 ;DPB_08_MAXCL
002531 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002532 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
002533 F12C 28                      DB  40  ;DPB_0C_MAXCYL
002534 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002535 F12E 01                      DB  1   ;DPB_0E_FATPS
002536 F12F 82                      DB  082H    ;DPB_0F_BPS
002537 F130 0500                    DW  5   ;DPB_10_DIRPS
002539 F132 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00253A F133 01                      DB  1   ;DPB_13_UNITNO
00253B F134 0800                    DW  8   ;DPB_14_ADDCL16
00253D F136 0000                    DW  0   ;DPB_16
00253F F138 0000                    DW  0   ;DPB_18
002541 F13A 0000                    DW  0   ;DPB_1A_SDIR
002543 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
002547 F140                         DS  32
                                
                                ;   D:
                                
002567 F160                         DS  32
                                
                                ;   E:
                                
002587 F180                         DS  32
                                
                                ;   F:
                                
0025A7 F1A0 0000                BANKFL: DW  0   ;DPB_00_FATLN
0025A9 F1A2 AFD5                    DW  BDRD    ;DPB_02_DRD
0025AB F1A4 ABD5                    DW  BDWT    ;DPB_04_DWT
0025AD F1A6 F9                      DB  0F9H    ;DPB_06_FATID
0025AE F1A7 02                      DB  2   ;DPB_07_SECPCL
0025AF F1A8 0000                BANKCL: DW  0   ;DPB_08_MAXCL
0025B1 F1AA 00                      DB  0   ;DPB_0A_FDMODE
0025B2 F1AB 08                      DB  8   ;DPB_0B_DIRSCNT
0025B3 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
0025B4 F1AD 01                      DB  1   ;DPB_0D_MAXSEC
0025B5 F1AE 00                      DB  0   ;DPB_0E_FATPS
0025B6 F1AF 02                      DB  2   ;DPB_0F_BPS
0025B7 F1B0 0200                    DW  2   ;DPB_10_DIRPS
0025B9 F1B2 0B                  BANKDV: DB  00BH    ;DPB_12_DEVICE
0025BA F1B3 00                      DB  0   ;DPB_13_UNITNO
0025BB F1B4 0600                    DW  6   ;DPB_14_ADDCL16
0025BD F1B6 0000                    DW  0   ;DPB_16
0025BF F1B8 0000                    DW  0   ;DPB_18
0025C1 F1BA 0000                    DW  0   ;DPB_1A_SDIR
0025C3 F1BC 454D454D                DB  "EMEM"  ;DPB_1C_NAME
                                
                                ;   G:
                                
0025C7 F1C0                         DS  32
                                
                                ;   H:
0025E7 F1E0                         DS  32-8
0025FF F1F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F1F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
