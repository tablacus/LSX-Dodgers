                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   LSX-Dodgers for PC-8801mkIISR
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "88DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   PC-8001mkIISR
                                
       0002                     MAC EQU 2   ;PC-8001mkIISR
       0001                     DEV EQU 1
                                
                                
       CC00                     RUN EQU 0CC00H
       CBF9                     OFFSET  EQU RUN-7
                                
       D006                     BDOS    EQU 0D006H
       ED98                     TABLEAD EQU 0ED98H
       EF00                     WORKAD  EQU 0EF00H
       F200                     FATBF   EQU 0F200H
       FA00                     DTBUF   EQU 0FA00H
       FE00                     KEYBF   EQU 0FE00H
       FF00                     KBUF    EQU 0FF00H
       FFD9                     TRAP38  EQU 0FFD9H
       0050                     WIDTH   EQU 80
       0018                     LINE    EQU 24
       0000                     COLORF  EQU 0
       0010                     KEYSP_H EQU 16
       0000                     KEYSP_L EQU 0
       0009                     COMS    EQU 9
                                
                                ; ディスクサブシステム
       002A                     MAIN        EQU 0002AH
                                
       4000                     DSS_DATA    EQU 04000H
                                
       7C00                     DSS     EQU 07C00H
[EOF:88DEF.ASM:SHIFT_JIS]
                                    INCLUDE "LDDEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                
       0001                     VER_1   EQU 1
       0005                     VER_2   EQU 5
       0000                     VER_3   EQU 0
       1D02                     MACW    EQU MAC + 01D00H    ;機種フラグとLD判別フラグ
       0102                     MACD    EQU MAC + DEV * 256 ;機種フラグとデバイスフラグ
       0150                     VER EQU VER_1 * 256 + VER_2 * 16 + VER_3
                                
       0005                     SYSTEM  EQU 00005H
       000F                     JP_HL   EQU 0000FH
       005C                     FCB1    EQU 0005CH
       006C                     FCB2    EQU 0006CH
       005D                     FCB1FN  EQU FCB1+1
       006D                     FCB2FN  EQU FCB2+1
       0080                     DTA1    EQU 00080H
                                
       FFCA                     EXTBIO  EQU 0FFCAH
                                
[EOF:LDDEF.ASM:SHIFT_JIS]
                                
000000 CBF9                         ORG OFFSET
                                
                                ;   MSX BINARY HEADER
000000 CBF9 FE                      DB  0FEH
                                ;   MSX BINARY START ADDRESS
000001 CBFA 00CC                    DW  RUN
                                ;   MSX BINARY END ADDRESS
000003 CBFC F9F1                    DW  LAST_ADR
                                ;   MSX BINARY EXEC ADDRESS
000005 CBFE 07CC                    DW  START
                                
                                    INCLUDE "88INIT.ASM"
                                
                                ;   LSX-Dodgers INIT
                                ;   PC-8801mkIISR
                                
000007 CC00 C307CC          10      JP  START
00000A CC03 021D                    DW  MACW
00000C CC05 5001                    DW  VER
                                
       CC07                     START:
00000E CC07 F3               4      DI
00000F CC08 ED5E             8      IM  2
000011 CC0A 3107CC          10      LD  SP,START
000014 CC0D CD1BCC          17      CALL    INIT        ;NZならAUTOEXECを実行
000017 CC10 210000          10      LD  HL,0
00001A CC13 E5              11      PUSH    HL
00001B CC14 C8              11      RET Z
00001C CC15 115CCD          10      LD  DE,AUTOD
00001F CC18 C3FDEF          10      JP  _COMANL
                                
       CC1B                     INIT:
000022 CC1B DB32            11      IN  A,(032H)
000024 CC1D CBA7             8      RES 4,A     ;高速RAMアクセスモード
000026 CC1F D332            11      OUT (032H),A
                                
000028 CC21 21C8F3          10      LD  HL,0F3C8H   ;テキストをクリア
00002B CC24 11E880          10      LD  DE,080E8H
00002E CC27 0E20             7      LD  C,' '
000030 CC29 3E19             7      LD  A,25
       CC2B                     TVCL1:
000032 CC2B 0650             7      LD  B,80
       CC2D                     TVCL2:
000034 CC2D 71               7      LD  (HL),C
000035 CC2E 23               6      INC HL
000036 CC2F 10FC            13      DJNZ    TVCL2
000038 CC31 0614             7      LD  B,20
       CC33                     TVCL3:
00003A CC33 72               7      LD  (HL),D
00003B CC34 2C               4      INC L
00003C CC35 73               7      LD  (HL),E
00003D CC36 23               6      INC HL
00003E CC37 10FA            13      DJNZ    TVCL3
000040 CC39 3D               4      DEC A
000041 CC3A 20EF            12      JR  NZ,TVCL1
                                
000043 CC3C DB32            11      IN  A,(032H)
000045 CC3E F610             7      OR  010H        ;高速RAMアクセスモードOFF
000047 CC40 D332            11      OUT (032H),A
                                
000049 CC42 AF               4      XOR A
00004A CC43 32B8EF          13      LD  (WKE6),A
00004D CC46 2F               4      CPL
00004E CC47 32B7EF          13      LD  (WKE4),A
                                
000051 CC4A CD7FDD          17      CALL    INIT_CRTC
       CC4D                     BANK:
000054 CC4D DBE2            11      IN  A,(0E2H)
000056 CC4F 06E3             7      LD  B,0E3H      ;拡張RAM バンク選択
000058 CC51 21007F          10      LD  HL,07F00H
00005B CC54 F3               4      DI
00005C CC55 3E11             7      LD  A,011H
00005E CC57 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000060 CC59 ED69            12      OUT (C),L
000062 CC5B 3A0000          13      LD  A,(0)
000065 CC5E FEEB             7      CP  0EBH
000067 CC60 2005            12      JR  NZ,BANK1
000069 CC62 3E2B             7      LD  A,02BH
00006B CC64 32B2F1          13      LD  (BANKDV),A
       CC67                     BANK1:
00006E CC67 3E11             7      LD  A,011H
000070 CC69 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000072 CC6B ED69            12      OUT (C),L
000074 CC6D 5E               7      LD  E,(HL)
000075 CC6E 7B               4      LD  A,E
000076 CC6F C6A5             7      ADD A,0A5H
000078 CC71 77               7      LD  (HL),A
000079 CC72 BE               7      CP  (HL)
00007A CC73 73               7      LD  (HL),E
00007B CC74 2005            12      JR  NZ,BANK2
00007D CC76 2C               4      INC L
00007E CC77 CB65             8      BIT 4,L
000080 CC79 28EC            12      JR  Z,BANK1
       CC7B                     BANK2:
000082 CC7B AF               4      XOR A
000083 CC7C D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
000085 CC7E 7D               4      LD  A,L
000086 CC7F B7               4      OR  A
000087 CC80 2813            12      JR  Z,NOBANK
000089 CC82 2600             7      LD  H,0
00008B CC84 29              11      ADD HL,HL   ;*2
00008C CC85 29              11      ADD HL,HL   ;*4
00008D CC86 29              11      ADD HL,HL   ;*8
00008E CC87 29              11      ADD HL,HL   ;*16
00008F CC88 29              11      ADD HL,HL   ;*32
000090 CC89 2B               6      DEC HL  ;-1
000091 CC8A 2B               6      DEC HL  ;-2
000092 CC8B 2B               6      DEC HL  ;-3
000093 CC8C 22A8F1          16      LD  (BANKCL),HL
000096 CC8F CD4CCD          17      CALL    CALC_FATLN
000099 CC92 32A0F1          13      LD  (BANKFL),A
       CC95                     NOBANK:
                                                ;初期化
00009C CC95 AF               4      XOR A       ;イニシャライズ
00009D CC96 CD7BEB          17      CALL    PUTCOM
0000A0 CC99 3E16             7      LD  A,16H       ;高速レシーブメモリ
0000A2 CC9B CD7BEB          17      CALL    PUTCOM
0000A5 CC9E 3E7C             7      LD  A,DSS/256   ;開始アドレスH
0000A7 CCA0 CD81EB          17      CALL    PUTDAT
0000AA CCA3 AF               4      XOR A       ;開始アドレスL
0000AB CCA4 CD81EB          17      CALL    PUTDAT
0000AE CCA7 013902          10      LD  BC,AT_DSSE-AT_DSS
0000B1 CCAA CB41             8      BIT 0,C
0000B3 CCAC 2801            12      JR  Z,SUBPG1
0000B5 CCAE 03               6      INC BC      ;偶数にする
       CCAF                     SUBPG1:
0000B6 CCAF 78               4      LD  A,B     ;バイト数H
0000B7 CCB0 CD81EB          17      CALL    PUTDAT
0000BA CCB3 79               4      LD  A,C
0000BB CCB4 CD81EB          17      CALL    PUTDAT
0000BE CCB7 21BCCD          10      LD  HL,AT_DSS
0000C1 CCBA CDC5EB          17      CALL    FPUTDAT
                                
0000C4 CCBD 210000          10      LD  HL,0
0000C7 CCC0 065C             7      LD  B,05CH
0000C9 CCC2 3EFF             7      LD  A,0FFH      ;RST 38H
0000CB CCC4 CDC5DE          17      CALL    FILL_MEMORY
0000CE CCC7 06A4             7      LD  B,0A4H
0000D0 CCC9 AF               4      XOR A
0000D1 CCCA CDC5DE          17      CALL    FILL_MEMORY
                                
0000D4 CCCD 3EC3             7      LD  A,0C3H      ;JP
0000D6 CCCF 2103EF          10      LD  HL,CPM_WBOOT
0000D9 CCD2 320000          13      LD  (00000H),A
0000DC CCD5 220100          16      LD  (00001H),HL ;IPL
                                
0000DF CCD8 21021D          10      LD  HL,MACW     ;3 bit7  DPB Compatible LA(1)
0000E2 CCDB 220300          16      LD  (00003H),HL ;  bit6-0 Machine
                                ;               ;4 LSX-Dodgers(01DH)
0000E5 CCDE 2106D0          10      LD  HL,BDOS
0000E8 CCE1 320500          13      LD  (00005H),A
0000EB CCE4 220600          16      LD  (00006H),HL ;BDOS
                                
0000EE CCE7 21F8DD          10      LD  HL,BIOS
0000F1 CCEA 321800          13      LD  (00018H),A
0000F4 CCED 221900          16      LD  (00019H),HL ;BIOS-ROM
                                
0000F7 CCF0 21D9FF          10      LD  HL,TRAP38   ;TRAP38
0000FA CCF3 323800          13      LD  (00038H),A
0000FD CCF6 223900          16      LD  (00039H),HL ;RST 038H
                                
000100 CCF9 3EEF             7      LD  A,CPM_BOOT/256
000102 CCFB 320B00          13      LD  (0000BH),A
                                
000105 CCFE 3EE9             7      LD  A,0E9H      ;JP (HL)
000107 CD00 320F00          13      LD  (0000FH),A
                                
00010A CD03 3A7DF0          13      LD  A,(_FATBF+1)
00010D CD06 321300          13      LD  (00013H),A
                                
000110 CD09 3A7FF0          13      LD  A,(_DTBUF+1)
000113 CD0C 321700          13      LD  (00017H),A
                                
000116 CD0F 3EFE             7      LD  A,KEYBF/256
000118 CD11 321B00          13      LD  (0001BH),A
                                
00011B CD14 3EFF             7      LD  A,KBUF/256
00011D CD16 321F00          13      LD  (0001FH),A
                                
000120 CD19 215001          10      LD  HL,VER
000123 CD1C 225A00          16      LD  (0005AH),HL
                                
000126 CD1F 2168CD          10      LD  HL,INIMES
000129 CD22 CD32D6          17      CALL    MSX
       CD25                     INIT1:
00012C CD25 F3               4      DI
00012D CD26 1100FF          10      LD  DE,0FF00H
000130 CD29 0600             7      LD  B,0
000132 CD2B CDD2D3          17      CALL    ZERO_MEMORY_DE
000135 CD2E 21CAFF          10      LD  HL,EXTBIO
000138 CD31 36C9            10      LD  (HL),0C9H   ;RET
00013A CD33 23               6      INC HL
00013B CD34 060E             7      LD  B,TRAP38-EXTBIO-1
00013D CD36 3EFF             7      LD  A,0FFH      ;RST 38H
00013F CD38 CDC5DE          17      CALL    FILL_MEMORY
000142 CD3B 2195CD          10      LD  HL,AT_TRAP38
000145 CD3E 11D9FF          10      LD  DE,TRAP38
000148 CD41 012700          10      LD  BC,AT_TRAPE-AT_TRAP38
00014B CD44 EDB0                    LDIR
                                
00014D CD46 CD1EDD          17      CALL    CHKEY
000150 CD49 FE03             7      CP  3
000152 CD4B C9              10      RET
                                
       CD4C                     CALC_FATLN: ;FAT12のクラスタ数から必要なFATサイズを求める(セクタサイズ512)
000153 CD4C 5D               4      LD  E,L
000154 CD4D 54               4      LD  D,H
000155 CD4E 29              11      ADD HL,HL   ;*2
000156 CD4F 19              11      ADD HL,DE   ;*3
000157 CD50 CB3C             8      SRL H   ;/2
000159 CD52 CB1D             8      RR  L   ;1クラスタ辺り1.5バイト必要
00015B CD54 11FF01          10      LD  DE,511  ;切り上げる
00015E CD57 19              11      ADD HL,DE
00015F CD58 7C               4      LD  A,H
000160 CD59 CB3F             8      SRL A
000162 CD5B C9              10      RET
                                
000163 CD5C 4155544F45584543    AUTOD:  DB  "AUTOEXEC "
            20                  
00016C CD65 413A00              AUTODV: DB  "A:",0
                                
00016F CD68 0C4C53582D446F64    INIMES: DB  00CH,"LSX-Dodgers for PC-8801mkIISR v"
            6765727320666F72    
            2050432D38383031    
            6D6B494953522076    
00018F CD88 312E                    DB  030H + VER_1, '.'
000191 CD8A 3530                    DB  030H + VER_2 ,030H + VER_3
000193 CD8C 61                      DB  "a"
000194 CD8D 2047616B750D0A          DB  ' Gaku',0DH,0AH
00019B CD94 00                      DB  0
                                
       CD95                     AT_TRAP38:
00019C FFD9                         ORG TRAP38,AT_TRAP38-OFFSET
00019C FFD9 210000          10      LD  HL,0
00019F FFDC E3              19      EX  (SP),HL
0001A0 FFDD 3E24             7      LD  A,'$'
0001A2 FFDF CD24D9          17      CALL    MSG_A
0001A5 FFE2 2B               6      DEC HL
0001A6 FFE3 7C               4      LD  A,H
0001A7 FFE4 CDE8FF          17      CALL    PRHX
0001AA FFE7 7D               4      LD  A,L
       FFE8                     PRHX:
0001AB FFE8 F5              11      PUSH    AF
0001AC FFE9 07               4      RLCA
0001AD FFEA 07               4      RLCA
0001AE FFEB 07               4      RLCA
0001AF FFEC 07               4      RLCA
0001B0 FFED CDF1FF          17      CALL    PRHX2
0001B3 FFF0 F1              10      POP AF
       FFF1                     PRHX2:
0001B4 FFF1 E60F             7      AND 00FH
0001B6 FFF3 FE0A             7      CP  10
0001B8 FFF5 3F               4      CCF
0001B9 FFF6 CE30             7      ADC A,'0'
0001BB FFF8 27               4      DAA
0001BC FFF9 C324D9          10      JP  MSG_A
0001BF FFFC                         DS  4
0001C3 CDBC                         ORG $$+OFFSET   ;$DEPHASE
       CDBC                     AT_TRAPE:
[EOF:88INIT.ASM:SHIFT_JIS]
                                    INCLUDE "88SUB.ASM"
                                
                                ;   LSX-Dodgers SUB DISK SYSTEM
                                ;   PC-8801mkIISR
                                
       CDBC                     AT_DSS:
0001C3 7C00                         ORG DSS,AT_DSS-OFFSET
0001C3 7C00 C3187C          10      JP  READDISKEX
0001C6 7C03 C3787C          10      JP  WRITEDISKEX
0001C9 7C06 C3907C          10      JP  GETPARAMS_N
0001CC 7C09 C39B7C          10      JP  SEEK
0001CF 7C0C C3297D          10      JP  FDCOMMAND
0001D2 7C0F C3F57D          10      JP  CHECKRESULT
0001D5 7C12 C3177E          10      JP  GETDEVSTAT
0001D8 7C15 C31C7E          10      JP  RDFDC
                                
       7C18                     READDISKEX:
0001DB 7C18 CD8E7C          17      CALL    GETPARAMS
0001DE 7C1B AF               4      XOR A
0001DF 7C1C 324F7C          13      LD  (RETRY_RDDISK),A
0001E2 7C1F 2A287E          16      LD  HL,(S_PARAMS+2)
0001E5 7C22 7D               4      LD  A,L
0001E6 7C23 3D               4      DEC A
0001E7 7C24 B4               4      OR  H
0001E8 7C25 200C            12      JR  NZ,RDDISK0
0001EA 7C27 2A2B7E          16      LD  HL,(S_PARAMS+5)
0001ED 7C2A 7C               4      LD  A,H
0001EE 7C2B BD               4      CP  L
0001EF 7C2C 2005            12      JR  NZ,RDDISK0
0001F1 7C2E 3E03             7      LD  A,3
0001F3 7C30 324F7C          13      LD  (RETRY_RDDISK),A
       7C33                     RDDISK0:
0001F6 7C33 CD9B7C          17      CALL    SEEK
0001F9 7C36 3E46             7      LD  A,46H       ;READ DATA
0001FB 7C38 CD297D          17      CALL    FDCOMMAND
0001FE 7C3B 3834            12      JR  C,FINISH_DISK
000200 7C3D CD5A7D          17      CALL    RDDISK1
       7C40                     WRDISK3:
000203 7C40 78               4      LD  A,B
000204 7C41 B2               4      OR  D
000205 7C42 32377E          13      LD  (S_LEFT),A
000208 7C45 DBF8            11      IN  A,(0F8H)    ;FDC μPD765A TC入力
00020A 7C47 FB               4      EI
00020B 7C48 76               4      HALT
00020C 7C49 CDF57D          17      CALL    CHECKRESULT
00020F 7C4C 301D            12      JR  NC,FINISH_DISK0
       7C4F                     RETRY_RDDISK    EQU $+1
000211 7C4E 3E00             7      LD  A,0
000213 7C50 B7               4      OR  A
000214 7C51 2818            12      JR  Z,FINISH_DISK0
000216 7C53 3D               4      DEC A
000217 7C54 324F7C          13      LD  (RETRY_RDDISK),A
00021A 7C57 3A2B7E          13      LD  A,(S_PARAMS+5)
00021D 7C5A FE04             7      CP  4
00021F 7C5C 3003            12      JR  NC,RETRY_RDDISK1
000221 7C5E 87               4      ADD A,A
000222 7C5F 1802            12      JR  RETRY_RDDISK2
       7C61                     RETRY_RDDISK1:
000224 7C61 3E01             7      LD  A,1
       7C63                     RETRY_RDDISK2:
000226 7C63 67               4      LD  H,A
000227 7C64 6F               4      LD  L,A
000228 7C65 222B7E          16      LD  (S_PARAMS+5),HL
00022B 7C68 C3337C          10      JP  RDDISK0
       7C6B                     FINISH_DISK0:
00022E 7C6B 3A377E          13      LD  A,(S_LEFT)
000231 7C6E D601             7      SUB 1
000233 7C70 3F               4      CCF
       7C71                     FINISH_DISK:
000234 7C71 9F               4      SBC A,A
000235 7C72 32367E          13      LD  (S_CMD_STATUS),A
000238 7C75 C32A00          10      JP  MAIN
                                
       7C78                     WRITEDISKEX:
00023B 7C78 AF               4      XOR A
00023C 7C79 324F7C          13      LD  (RETRY_RDDISK),A
00023F 7C7C CD8E7C          17      CALL    GETPARAMS
000242 7C7F CD9B7C          17      CALL    SEEK
000245 7C82 3E45             7      LD  A,45H       ;WRITE DATA
000247 7C84 CD297D          17      CALL    FDCOMMAND
00024A 7C87 38E8            12      JR  C,FINISH_DISK
00024C 7C89 CDA17D          17      CALL    WRDISK1
00024F 7C8C 18B2            12      JR  WRDISK3
                                
       7C8E                     GETPARAMS:
000251 7C8E 0608             7      LD  B,8
       7C90                     GETPARAMS_N:
000253 7C90 E5              11      PUSH    HL
000254 7C91 21267E          10      LD  HL,S_PARAMS
       7C94                     GETPARAMS1:
000257 7C94 D7              12      RST 10H
000258 7C95 77               7      LD  (HL),A
000259 7C96 23               6      INC HL
00025A 7C97 10FB            13      DJNZ    GETPARAMS1
00025C 7C99 E1              10      POP HL
00025D 7C9A C9              10      RET
                                
       7C9B                     SEEK:
00025E 7C9B E5              11      PUSH    HL
00025F 7C9C 3A2A7E          13      LD  A,(S_PARAMS+4)  ;MFMモード切り替え $FF:2D/2DD $FE:2HD
000262 7C9F 1F               4      RRA
000263 7CA0 3F               4      CCF
000264 7CA1 9F               4      SBC A,A
000265 7CA2 F5              11      PUSH    AF
000266 7CA3 E605             7      AND 5
000268 7CA5 4F               4      LD  C,A
000269 7CA6 3A2D7E          13      LD  A,(S_PARAMS+7)  ;シリンダ数
00026C 7CA9 C6D3             7      ADD A,0-45      ;オーバートラックを考慮して40+α
00026E 7CAB 9F               4      SBC A,A
00026F 7CAC E604             7      AND 4
000271 7CAE B1               4      OR  C
000272 7CAF 0EFA             7      LD  C,0FFH-5    ;マスク
000274 7CB1 47               4      LD  B,A
000275 7CB2 3A267E          13      LD  A,(S_PARAMS)    ;0:ドライブA 1:ドライブB
000278 7CB5 B7               4      OR  A
000279 7CB6 2804            12      JR  Z,SET_WKF4
00027B 7CB8 CB20             8      SLA B
00027D 7CBA CB01             4      RLC C
       7CBC                     SET_WKF4:
00027F 7CBC 3A387E          13      LD  A,(S_WKF4)
000282 7CBF A1               4      AND C
000283 7CC0 B0               4      OR  B
000284 7CC1 4F               4      LD  C,A
000285 7CC2 D3F4            11      OUT (0F4H),A    ;ドライブ制御
000287 7CC4 E6DF             7      AND 0FFH-020H   ;CLKの分は抜いておく
000289 7CC6 47               4      LD  B,A
00028A 7CC7 F1              10      POP AF
00028B 7CC8 E620             7      AND 020H        ;bit5:CLK
00028D 7CCA B0               4      OR  B
00028E 7CCB D3F4            11      OUT (0F4H),A    ;ドライブ制御
000290 7CCD 32387E          13      LD  (S_WKF4),A
000293 7CD0 47               4      LD  B,A
000294 7CD1 A9               4      XOR C
000295 7CD2 E620             7      AND 020H        ;CLKが変化したら一定時間待つ
000297 7CD4 2808            12      JR  Z,NOCHGCLK
000299 7CD6 2160F0          10      LD  HL,0F060H
       7CD9                     WAIT_CLK:
00029C 7CD9 2B               6      DEC HL
00029D 7CDA 7C               4      LD  A,H
00029E 7CDB B5               4      OR  L
00029F 7CDC 20FB            12      JR  NZ,WAIT_CLK
       7CDE                     NOCHGCLK:
0002A1 7CDE 78               4      LD  A,B
0002A2 7CDF E620             7      AND 020H
0002A4 7CE1 2805            12      JR  Z,SPECIFY2D
0002A6 7CE3 1131DF          10      LD  DE,0DF31H   ;SPECIFY 2HD / SRT:13 HUT:15 HLT:24 NON-DMA
0002A9 7CE6 1803            12      JR  SPECIFYOK
       7CE8                     SPECIFY2D:
0002AB 7CE8 1119DA          10      LD  DE,0DA19H   ;SPECIFY 2D/2DD / SRT:13 HUT 10 HLT:12 NON-DMA
       7CEB                     SPECIFYOK:
0002AE 7CEB 3E03             7      LD  A,3     ;SPECIFY
0002B0 7CED E7              12      RST 20H
0002B1 7CEE 7A               4      LD  A,D
0002B2 7CEF E7              12      RST 20H
0002B3 7CF0 7B               4      LD  A,E
0002B4 7CF1 E7              12      RST 20H
       7CF2                     NOSPECIFY:
0002B5 7CF2 ED4B267E        20      LD  BC,(S_PARAMS)
0002B9 7CF6 ED5B287E        20      LD  DE,(S_PARAMS+2)
0002BD 7CFA 7A               4      LD  A,D     ;TRACK
0002BE 7CFB CB3F             8      SRL A       ;CYLINDER
0002C0 7CFD 3E0F             7      LD  A,00FH      ;SEEK
0002C2 7CFF 2002            12      JR  NZ,SEEK1    ;0シリンダの場合はRECALIBRATE、それ以外はSEEKを使う
0002C4 7D01 3E07             7      LD  A,7     ;RECALIBRATE
       7D03                     SEEK1:
0002C6 7D03 E7              12      RST 20H
0002C7 7D04 79               4      LD  A,C     ;DR/HD
0002C8 7D05 E7              12      RST 20H
0002C9 7D06 7A               4      LD  A,D     ;TRACK
0002CA 7D07 CB3F             8      SRL A       ;CYLINDER
0002CC 7D09 C42000          17      CALL    NZ,20H      ;SEEKの場合だけ呼ぶ(0シリンダの場合はRECALIBRATEを使うのでシリンダの設定は不要)
0002CF 7D0C FB               4      EI
0002D0 7D0D 76               4      HALT
0002D1 7D0E 3E08             7      LD  A,8     ;SENSE
0002D3 7D10 E7              12      RST 20H
0002D4 7D11 CD1C7E          17      CALL    RDFDC       ;ST0
0002D7 7D14 CD1C7E          17      CALL    RDFDC       ;PCN(CYLINDER)
0002DA 7D17 210040          10      LD  HL,04000H
       7D1A                     WAIT_SEEK:
0002DD 7D1A CD177E          17      CALL    GETDEVSTAT
0002E0 7D1D E608             7      AND 8
0002E2 7D1F 2006            12      JR  NZ,SEEK_OK
0002E4 7D21 2B               6      DEC HL
0002E5 7D22 7C               4      LD  A,H
0002E6 7D23 B5               4      OR  L
0002E7 7D24 20F4            12      JR  NZ,WAIT_SEEK
0002E9 7D26 37               4      SCF
       7D27                     SEEK_OK:
0002EA 7D27 E1              10      POP HL
0002EB 7D28 C9              10      RET
                                
       7D29                     FDCOMMAND:
0002EC 7D29 E7              12      RST 20H
0002ED 7D2A 7A               4      LD  A,D     ;HD US1 US0
0002EE 7D2B E601             7      AND 1
0002F0 7D2D 87               4      ADD A,A
0002F1 7D2E 87               4      ADD A,A
0002F2 7D2F B1               4      OR  C
0002F3 7D30 E7              12      RST 20H
0002F4 7D31 7A               4      LD  A,D     ;C
0002F5 7D32 CB3F             8      SRL A
0002F7 7D34 E7              12      RST 20H
0002F8 7D35 7A               4      LD  A,D     ;H
0002F9 7D36 E601             7      AND 1
0002FB 7D38 E7              12      RST 20H
0002FC 7D39 7B               4      LD  A,E     ;R
0002FD 7D3A E7              12      RST 20H
0002FE 7D3B 3A2B7E          13      LD  A,(S_PARAMS+5)  ;N
000301 7D3E FE04             7      CP  4
000303 7D40 3802            12      JR  C,FDCOMMAND2
                                
000305 7D42 3E03             7      LD  A,3
       7D44                     FDCOMMAND2:
000307 7D44 1E20             7      LD  E,020H      ;NO SERVICE
000309 7D46 E7              12      RST 20H
                                
00030A 7D47 210040          10      LD  HL,DSS_DATA ;開始アドレス
00030D 7D4A 78               4      LD  A,B     ;EOT
00030E 7D4B E7              12      RST 20H
                                
00030F 7D4C 01FB00          10      LD  BC,000FBH   ;B:バイト数L C:FDC μPD765A データレジスタ
000312 7D4F 3E54             7      LD  A,054H      ;GSL
000314 7D51 E7              12      RST 20H
                                
000315 7D52 3A2C7E          13      LD  A,(S_PARAMS+6)
000318 7D55 57               4      LD  D,A     ;バイト数H
                                
000319 7D56 AF               4      XOR A       ;DTL
00031A 7D57 E7              12      RST 20H
00031B 7D58 A7               4      AND A
00031C 7D59 C9              10      RET
                                
       7D5A                     RDDISK1:            ;高速化の為にループ展開x8
00031D 7D5A FB               4      EI
00031E 7D5B 76               4      HALT
00031F 7D5C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000321 7D5E A3               4      AND E       ;NO SERVICE
000322 7D5F C8              11      RET Z
000323 7D60 EDA2            16      INI
                                
000325 7D62 FB               4      EI
000326 7D63 76               4      HALT
000327 7D64 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000329 7D66 A3               4      AND E       ;NO SERVICE
00032A 7D67 C8              11      RET Z
00032B 7D68 EDA2            16      INI
                                
00032D 7D6A FB               4      EI
00032E 7D6B 76               4      HALT
00032F 7D6C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000331 7D6E A3               4      AND E       ;NO SERVICE
000332 7D6F C8              11      RET Z
000333 7D70 EDA2            16      INI
                                
000335 7D72 FB               4      EI
000336 7D73 76               4      HALT
000337 7D74 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000339 7D76 A3               4      AND E       ;NO SERVICE
00033A 7D77 C8              11      RET Z
00033B 7D78 EDA2            16      INI
                                
00033D 7D7A FB               4      EI
00033E 7D7B 76               4      HALT
00033F 7D7C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000341 7D7E A3               4      AND E       ;NO SERVICE
000342 7D7F C8              11      RET Z
000343 7D80 EDA2            16      INI
                                
000345 7D82 FB               4      EI
000346 7D83 76               4      HALT
000347 7D84 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000349 7D86 A3               4      AND E       ;NO SERVICE
00034A 7D87 C8              11      RET Z
00034B 7D88 EDA2            16      INI
                                
00034D 7D8A FB               4      EI
00034E 7D8B 76               4      HALT
00034F 7D8C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000351 7D8E A3               4      AND E       ;NO SERVICE
000352 7D8F C8              11      RET Z
000353 7D90 EDA2            16      INI
                                
000355 7D92 FB               4      EI
000356 7D93 76               4      HALT
000357 7D94 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000359 7D96 A3               4      AND E       ;NO SERVICE
00035A 7D97 C8              11      RET Z
00035B 7D98 EDA2            16      INI
                                
00035D 7D9A 20BE            12      JR  NZ,RDDISK1
00035F 7D9C 15               4      DEC D
000360 7D9D C25A7D          10      JP  NZ,RDDISK1
000363 7DA0 C9              10      RET
                                
       7DA1                     WRDISK1:            ;高速化の為にループ展開x8
000364 7DA1 FB               4      EI
000365 7DA2 76               4      HALT
000366 7DA3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000368 7DA5 A3               4      AND E
000369 7DA6 C8              11      RET Z
00036A 7DA7 EDA3            16      OUTI
                                
00036C 7DA9 FB               4      EI
00036D 7DAA 76               4      HALT
00036E 7DAB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000370 7DAD A3               4      AND E
000371 7DAE C8              11      RET Z
000372 7DAF EDA3            16      OUTI
                                
000374 7DB1 FB               4      EI
000375 7DB2 76               4      HALT
000376 7DB3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000378 7DB5 A3               4      AND E
000379 7DB6 C8              11      RET Z
00037A 7DB7 EDA3            16      OUTI
                                
00037C 7DB9 FB               4      EI
00037D 7DBA 76               4      HALT
00037E 7DBB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000380 7DBD A3               4      AND E
000381 7DBE C8              11      RET Z
000382 7DBF EDA3            16      OUTI
                                
000384 7DC1 FB               4      EI
000385 7DC2 76               4      HALT
000386 7DC3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000388 7DC5 A3               4      AND E
000389 7DC6 C8              11      RET Z
00038A 7DC7 EDA3            16      OUTI
                                
00038C 7DC9 FB               4      EI
00038D 7DCA 76               4      HALT
00038E 7DCB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000390 7DCD A3               4      AND E
000391 7DCE C8              11      RET Z
000392 7DCF EDA3            16      OUTI
                                
000394 7DD1 FB               4      EI
000395 7DD2 76               4      HALT
000396 7DD3 DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
000398 7DD5 A3               4      AND E
000399 7DD6 C8              11      RET Z
00039A 7DD7 EDA3            16      OUTI
                                
00039C 7DD9 FB               4      EI
00039D 7DDA 76               4      HALT
00039E 7DDB DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0003A0 7DDD A3               4      AND E
0003A1 7DDE C8              11      RET Z
0003A2 7DDF EDA3            16      OUTI
                                
0003A4 7DE1 20BE            12      JR  NZ,WRDISK1
0003A6 7DE3 15               4      DEC D
0003A7 7DE4 C2A17D          10      JP  NZ,WRDISK1
0003AA 7DE7 C9              10      RET
                                
       7DE8                     RESULTEX:
0003AB 7DE8 3A367E          13      LD  A,(S_CMD_STATUS)
0003AE 7DEB 3C               4      INC A
0003AF 7DEC 2803            12      JR  Z,RESULTEX1
0003B1 7DEE 3A2C7E          13      LD  A,(S_PARAMS+6)  ;バイト数H
       7DF1                     RESULTEX1:
0003B4 7DF1 DF              12      RST 18H
0003B5 7DF2 C32A00          10      JP  MAIN
                                
       7DF5                     CHECKRESULT:
0003B8 7DF5 C5              11      PUSH    BC
0003B9 7DF6 CD1C7E          17      CALL    RDFDC       ;ST0
0003BC 7DF9 E6D8             7      AND 0D8H
0003BE 7DFB 4F               4      LD  C,A
0003BF 7DFC CD1C7E          17      CALL    RDFDC       ;ST1
0003C2 7DFF E6B7             7      AND 0B7H
0003C4 7E01 B1               4      OR  C
0003C5 7E02 4F               4      LD  C,A
0003C6 7E03 CD1C7E          17      CALL    RDFDC       ;ST2
0003C9 7E06 E673             7      AND 073H
0003CB 7E08 B1               4      OR  C
0003CC 7E09 4F               4      LD  C,A
0003CD 7E0A 0604             7      LD  B,4
       7E0C                     CHECKRESULT1:           ;C H R N
0003CF 7E0C CD1C7E          17      CALL    RDFDC
0003D2 7E0F 10FB            13      DJNZ    CHECKRESULT1
0003D4 7E11 79               4      LD  A,C
0003D5 7E12 A7               4      AND A
0003D6 7E13 C1              10      POP BC
0003D7 7E14 C8              11      RET Z
0003D8 7E15 37               4      SCF
0003D9 7E16 C9              10      RET
                                
       7E17                     GETDEVSTAT:
0003DA 7E17 3E04             7      LD  A,4
0003DC 7E19 E7              12      RST 20H
0003DD 7E1A 79               4      LD  A,C
0003DE 7E1B E7              12      RST 20H
                                
       7E1C                     RDFDC:
0003DF 7E1C DBFA            11      IN  A,(0FAH)    ;FDC μPD765A ステータスレジスタリード
0003E1 7E1E 2F               4      CPL
0003E2 7E1F E6C0             7      AND 0C0H        ;RQMとDIOが両方1になるまで待つ
0003E4 7E21 20F9            12      JR  NZ,RDFDC
0003E6 7E23 DBFB            11      IN  A,(0FBH)    ;FDC μPD765A データレジスタリード
0003E8 7E25 C9              10      RET
                                
       7E26                     S_PARAMS:
0003E9 7E26                         DS  16
       7E36                     S_CMD_STATUS:
0003F9 7E36 00                      DB  0
       7E37                     S_LEFT:
0003FA 7E37 00                      DB  0
       7E38                     S_WKF4:
0003FB 7E38 00                      DB  0
                                
0003FC CFF5                         ORG $$+OFFSET   ;$DEPHASE
       CFF5                     AT_DSSE:
       CFF5                     INITE:
0003FC CFF5                         DS  BDOS-INITE
00040D D006 C3BBD8          10      JP  BDOS_RF
[EOF:88SUB.ASM:SHIFT_JIS]
                                    INCLUDE "88CCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                ;   PC-8801mkIISR
                                
       D009                     WBOOT1:
000410 D009 ED7B0600        20      LD  SP,(SYSTEM+1)
000414 D00D DB32            11      IN  A,(032H)
000416 D00F F610             7      OR  10H     ;高速RAMアクセスモードOFF
000418 D011 D332            11      OUT (032H),A
                                
00041A D013 3EEE             7      LD  A,IVRTC/256
00041C D015 ED47             9      LD  I,A
00041E D017 3AB8EF          13      LD  A,(WKE6)
000421 D01A F602             7      OR  2       ;VRTC割り込みマスク
000423 D01C D3E6            11      OUT (0E6H),A    ;割り込みマスク
000425 D01E 32B8EF          13      LD  (WKE6),A
000428 D021 3AB7EF          13      LD  A,(WKE4)
00042B D024 D3E4            11      OUT (0E4H),A    ;割り込みレベル設定 
                                
00042D D026 FB               4      EI
00042E D027 2192EF          10      LD  HL,_KEYD
000431 D02A 3600            10      LD  (HL),0
000433 D02C CD1EDD          17      CALL    CHKEY
000436 D02F CD11D9          17      CALL    KEYBC_IFBREAK
000439 D032 3E04             7      LD  A,4
00043B D034 CD24D9          17      CALL    MSG_A
[EOF:88CCP.ASM:SHIFT_JIS]
                                    INCLUDE "LDCCP.ASM"
                                
                                ;   LSX-Dodgers CCP
                                
       D037                     COMMAND:
00043E D037 CDEAD0          17      CALL    SETDTA1
000441 D03A 3A87EF          13      LD  A,(_DVSW)
000444 D03D C641             7      ADD A,'A'
000446 D03F CD24D9          17      CALL    MSG_A
000449 D042 3E3E             7      LD  A,'>'
00044B D044 CD24D9          17      CALL    MSG_A
00044E D047 3E50             7      LD  A,80
000450 D049 12               7      LD  (DE),A
000451 D04A CD62D9          17      CALL    _SYS0A      ;(BDOS)文字列入力
000454 D04D CD94D2          17      CALL    LTNL
                                
000457 D050 118200          10      LD  DE,DTA1+2
00045A D053 CDFDEF          17      CALL    _COMANL
00045D D056 30DF            12      JR  NC,COMMAND
00045F D058 1179EF          10      LD  DE,COMERM
000462 D05B CD23D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000465 D05E C7              12      RST 0
                                
       D05F                     COMANL:
000466 D05F CD19DE          17      CALL    FILE
000469 D062 3A19EF          13      LD  A,(FNAME+4)
00046C D065 FE20             7      CP  020H
00046E D067 201C            12      JR  NZ,COMB2
000470 D069 D5              11      PUSH    DE
000471 D06A 1115EF          10      LD  DE,FNAME
000474 D06D 1A               7      LD  A,(DE)
000475 D06E FE20             7      CP  020H
000477 D070 2844            12      JR  Z,SDVSW
000479 D072 1B               6      DEC DE
00047A D073 1A               7      LD  A,(DE)
00047B D074 C6FF             7      ADD A,0FFH
00047D D076 3809            12      JR  C,COMB
00047F D078 13               6      INC DE
                                
000480 D079 2175D5          10      LD  HL,COMTB
000483 D07C 0609             7      LD  B,COMS
000485 D07E CD9DE0          17      CALL    CPNAME
       D081                     COMB:
000488 D081 D1              10      POP DE
000489 D082 D20F00          10      JP  NC,JP_HL
       D085                     COMB2:
00048C D085 EB               4      EX  DE,HL
00048D D086 225ED1          16      LD  (COMPAT+1),HL
000490 D089 F5              11      PUSH    AF
000491 D08A CD0AD1          17      CALL    CEXE4
000494 D08D F1              10      POP AF
000495 D08E 2115EF          10      LD  HL,FNAME
000498 D091 116D00          10      LD  DE,FCB2+1   ;COMMAND NAME
00049B D094 010B00          10      LD  BC,11
00049E D097 EDB0                    LDIR
0004A0 D099 1118D5          10      LD  DE,PATHD
       D09C                     CEX1:
0004A3 D09C 1A               7      LD  A,(DE)
0004A4 D09D FE20             7      CP  020H
0004A6 D09F D8              11      RET C
0004A7 D0A0 CD0EDE          17      CALL    FILEC
0004AA D0A3 D5              11      PUSH    DE
0004AB D0A4 216D00          10      LD  HL,FCB2+1   ;COMMAND NAME
0004AE D0A7 1115EF          10      LD  DE,FNAME
0004B1 D0AA 010B00          10      LD  BC,11
0004B4 D0AD EDB0                    LDIR
0004B6 D0AF CD0AD1          17      CALL    CEXE4
0004B9 D0B2 D1              10      POP DE
0004BA D0B3 13               6      INC DE
0004BB D0B4 18E6            12      JR  CEX1
                                
       D0B6                     SDVSW:
0004BD D0B6 F1              10      POP AF
0004BE D0B7 3A14EF          13      LD  A,(FDRV)
0004C1 D0BA 3D               4      DEC A
0004C2 D0BB 5F               4      LD  E,A
0004C3 D0BC 0E0E             7      LD  C,00EH      ;(BDOS)カレントドライブの設定
0004C5 D0BE 1831            12      JR  SYSTEM0
                                
       D0C0                     OPEN1:
0004C7 D0C0 2114EF          10      LD  HL,FDRV
       D0C3                     OPEN:
0004CA D0C3 0E11             7      LD  C,011H      ;(BDOS)ファイルの検索
       D0C5                     OPEN3:
0004CC D0C5 D5              11      PUSH    DE
0004CD D0C6 11F3D4          10      LD  DE,DTA_CCP
0004D0 D0C9 CDE7D0          17      CALL    SETDTA
0004D3 D0CC EB               4      EX  DE,HL
0004D4 D0CD CDF1D0          17      CALL    SYSTEM0
0004D7 D0D0 D1              10      POP DE
0004D8 D0D1 C9              10      RET
                                
       D0D2                     OPEN2:
0004D9 D0D2 0E12             7      LD  C,012H
0004DB D0D4 18EF            12      JR  OPEN3
                                
       D0D6                     DEFCB:              ;Z=Ok NZ=Error
0004DD D0D6 11F3D4          10      LD  DE,DTA_CCP
0004E0 D0D9 CDEFD0          17      CALL    SYSC0F
                                
0004E3 D0DC 1114D5          10      LD  DE,DTA_CCP+33   ;(FCB)ランダムレコード
0004E6 D0DF 0604             7      LD  B,4
0004E8 D0E1 CDD2D3          17      CALL    ZERO_MEMORY_DE
0004EB D0E4 110001          10      LD  DE,00100H
       D0E7                     SETDTA:
0004EE D0E7 C3FDD7          10      JP  _SYS1A      ;(BDOS)DTAの設定
                                
       D0EA                     SETDTA1:
0004F1 D0EA 118000          10      LD  DE,DTA1
0004F4 D0ED 18F8            12      JR  SETDTA
                                
       D0EF                     SYSC0F:
0004F6 D0EF 0E0F             7      LD  C,00FH      ;(BDOS)ファイルのオープン
       D0F1                     SYSTEM0:
0004F8 D0F1 CD0500          17      CALL    SYSTEM
0004FB D0F4 B7               4      OR  A
0004FC D0F5 C9              10      RET
                                
       D0F6                     C_CD:
0004FD D0F6 0E5A             7      LD  C,5AH
0004FF D0F8 18F7            12      JR  SYSTEM0
                                
       D0FA                     S27BUF:
000501 D0FA 3A0700          13      LD  A,(SYSTEM+2)
000504 D0FD 3D               4      DEC A
000505 D0FE E6F8             7      AND 0F8H
000507 D100 67               4      LD  H,A
000508 D101 2E00             7      LD  L,0
       D103                     S27DTA:
00050A D103 11F3D4          10      LD  DE,DTA_CCP
       D106                     S27:
00050D D106 0E27             7      LD  C,027H      ;(BDOS)ランダムブロック読み込み
00050F D108 18E7            12      JR  SYSTEM0
                                
       D10A                     CEXE4:
000511 D10A 3A14EF          13      LD  A,(FDRV)
000514 D10D 325700          13      LD  (00057H),A
000517 D110 2A22EF          16      LD  HL,(FDRV+14)
00051A D113 225800          16      LD  (00058H),HL
                                
00051D D116 211DEF          10      LD  HL,FNAME+8
000520 D119 7E               7      LD  A,(HL)
000521 D11A FE20             7      CP  020H
000523 D11C 2007            12      JR  NZ,CEXE7
000525 D11E 3E3F             7      LD  A,'?'
000527 D120 77               7      LD  (HL),A
000528 D121 23               6      INC HL
000529 D122 77               7      LD  (HL),A
00052A D123 23               6      INC HL
00052B D124 77               7      LD  (HL),A
       D125                     CEXE7:
00052C D125 CDC0D0          17      CALL    OPEN1
       D128                     CEXE5:
00052F D128 C0              11      RET NZ
000530 D129 2AFDD4          16      LD  HL,(DTA_CCP+1+9)
000533 D12C 7C               4      LD  A,H
000534 D12D CD25E1          17      CALL    CAP
000537 D130 67               4      LD  H,A
000538 D131 7D               4      LD  A,L
000539 D132 CD25E1          17      CALL    CAP
00053C D135 6F               4      LD  L,A
00053D D136 3AFCD4          13      LD  A,(DTA_CCP+1+8)
000540 D139 CD25E1          17      CALL    CAP
000543 D13C D642             7      SUB 'B'
000545 D13E 282C            12      JR  Z,C_BAT
000547 D140 3D               4      DEC A       ;'C'
000548 D141 2805            12      JR  Z,C_EXE
       D143                     CEXE6:
00054A D143 CDD2D0          17      CALL    OPEN2
00054D D146 18E0            12      JR  CEXE5
                                
       D148                     C_EXE:
00054F D148 7C               4      LD  A,H
000550 D149 FE4D             7      CP  'M'
000552 D14B 20F6            12      JR  NZ,CEXE6
                                
000554 D14D CDD6D0          17      CALL    DEFCB
000557 D150 CDFAD0          17      CALL    S27BUF
00055A D153 3D               4      DEC A
00055B D154 37               4      SCF
00055C D155 C0              11      RET NZ
00055D D156 7C               4      LD  A,H
00055E D157 B5               4      OR  L
00055F D158 37               4      SCF
000560 D159 C8              11      RET Z
000561 D15A CDEAD0          17      CALL    SETDTA1
000564 D15D 110000          10  COMPAT: LD  DE,0                ; self-modifying code
000567 D160 ED7B0600        20      LD  SP,(SYSTEM+1)
00056B D164 67               4      LD  H,A             ; A=0 in SETDTA1(_SYS1A)
00056C D165 6F               4      LD  L,A
00056D D166 E5              11      PUSH    HL              ; push $0000 (reboot address)
00056E D167 24               4      INC H
00056F D168 E5              11      PUSH    HL              ; push $0100 (TPA address)
000570 D169 C39DD3          10      JP  SETFCB              ; and JP $0100
                                
       D16C                     C_BAT:
000573 D16C 114154          10      LD  DE,'A'+'T'*256
000576 D16F ED52            15      SBC HL,DE
000578 D171 20D0            12      JR  NZ,CEXE6
                                
00057A D173 F1              10      POP AF
00057B D174 F1              10      POP AF
00057C D175 CDD6D0          17      CALL    DEFCB
00057F D178 210002          10      LD  HL,00200H
000582 D17B CD03D1          17      CALL    S27DTA
000585 D17E C6FE             7      ADD A,0FEH
000587 D180 D8              11      RET C
000588 D181 7D               4      LD  A,L
000589 D182 B7               4      OR  A
00058A D183 37               4      SCF
00058B D184 C8              11      RET Z
00058C D185 3C               4      INC A
00058D D186 F5              11      PUSH    AF
                                
00058E D187 CD14D9          17      CALL    KEYBC
000591 D18A 3E06             7      LD  A,6
000593 D18C CD24D9          17      CALL    MSG_A
000596 D18F C1              10      POP BC
000597 D190 210001          10      LD  HL,00100H
       D193                     BAT1:
00059A D193 A7               4      AND A
00059B D194 05               4      DEC B
00059C D195 C8              11      RET Z
00059D D196 7E               7      LD  A,(HL)
00059E D197 FE25             7      CP  '%'
0005A0 D199 280C            12      JR  Z,BAT2
       D19B                     BAT1X:
0005A2 D19B 7E               7      LD  A,(HL)
0005A3 D19C 23               6      INC HL
0005A4 D19D FE1A             7      CP  01AH
0005A6 D19F C8              11      RET Z
0005A7 D1A0 FE0A             7      CP  00AH
0005A9 D1A2 C4F9D8          17      CALL    NZ,KEYBS
0005AC D1A5 18EC            12      JR  BAT1
                                
       D1A7                     BAT2:
0005AE D1A7 23               6      INC HL
0005AF D1A8 7E               7      LD  A,(HL)
0005B0 D1A9 2B               6      DEC HL
0005B1 D1AA D631             7      SUB '1'
0005B3 D1AC 38ED            12      JR  C,BAT1X
0005B5 D1AE FE09             7      CP  9
0005B7 D1B0 30E9            12      JR  NC,BAT1X
0005B9 D1B2 23               6      INC HL
0005BA D1B3 23               6      INC HL
0005BB D1B4 3C               4      INC A
0005BC D1B5 4F               4      LD  C,A
0005BD D1B6 ED5B5ED1        20      LD  DE,(COMPAT+1)
       D1BA                     BAT3:
0005C1 D1BA 1A               7      LD  A,(DE)
0005C2 D1BB B7               4      OR  A
0005C3 D1BC 28D5            12      JR  Z,BAT1
0005C5 D1BE CDF0DE          17      CALL    SPCUT
0005C8 D1C1 0D               4      DEC C
0005C9 D1C2 2808            12      JR  Z,BAT5
       D1C4                     BAT4:
0005CB D1C4 1A               7      LD  A,(DE)
0005CC D1C5 FE21             7      CP  021H
0005CE D1C7 38F1            12      JR  C,BAT3
0005D0 D1C9 13               6      INC DE
0005D1 D1CA 18F8            12      JR  BAT4
       D1CC                     BAT5:
0005D3 D1CC 1A               7      LD  A,(DE)
0005D4 D1CD FE21             7      CP  021H
0005D6 D1CF 38C2            12      JR  C,BAT1
0005D8 D1D1 13               6      INC DE
0005D9 D1D2 CDF9D8          17      CALL    KEYBS
0005DC D1D5 18F5            12      JR  BAT5
                                
       D1D7                     C_DEL:
0005DE D1D7 CD9DD3          17      CALL    SETFCB
0005E1 D1DA CD3AD9          17      CALL    _SYS08      ;(BDOS)エコーなしコンソール入力
                                
0005E4 D1DD 0E13             7      LD  C,013H
0005E6 D1DF 180A            12      JR  CDEL1       ;(BDOS)ファイルの削除
                                
       D1E1                     C_REN:
0005E8 D1E1 CD9DD3          17      CALL    SETFCB
0005EB D1E4 3E10             7      LD  A,010H      ;ディレクトリも対象にする
0005ED D1E6 326900          13      LD  (FCB1+13),A ;属性
0005F0 D1E9 0E17             7      LD  C,017H      ;(BDOS)ファイル名の変更
       D1EB                     CDEL1:
0005F2 D1EB 115C00          10      LD  DE,FCB1
0005F5 D1EE CD0500          17      CALL    SYSTEM
0005F8 D1F1 C6FF             7      ADD A,0FFH
0005FA D1F3 C9              10      RET
                                
       D1F4                     C_DIR:
0005FB D1F4 CD0EDE          17      CALL    FILEC
0005FE D1F7 2115EF          10      LD  HL,FDRV+1
000601 D1FA CDE8D4          17      CALL    CWILD1
000604 D1FD 3EF1             7      LD  A,0F1H
000606 D1FF 3221EF          13      LD  (FDRV+13),A
000609 D202 CDC0D0          17      CALL    OPEN1
       D205                     CDIR1:
00060C D205 B7               4      OR  A
00060D D206 2008            12      JR  NZ,PDSKF
00060F D208 CD53D2          17      CALL    P_NAME
000612 D20B CDD2D0          17      CALL    OPEN2
000615 D20E 18F5            12      JR  CDIR1
                                
       D210                     PDSKF:
000617 D210 3A14EF          13      LD  A,(FDRV)
00061A D213 5F               4      LD  E,A
00061B D214 0E1B             7      LD  C,01BH      ;(BDOS)ディスク情報の獲得
00061D D216 CD0500          17      CALL    SYSTEM
000620 D219 4F               4      LD  C,A     ;C←1クラスタ辺りの論理セクタ数
000621 D21A C601             7      ADD A,001H
000623 D21C D8              11      RET C       ;Aが0FFHだった場合
000624 D21D 3E06             7      LD  A,8-2
       D21F                     PDS1:               ;HL=未使用クラスタの総数
000626 D21F 3C               4      INC A
000627 D220 CB19             8      RR  C
000629 D222 30FB            12      JR  NC,PDS1
       D224                     PDS2:               ;B←論理セクタのサイズの上位8ビット
00062B D224 3C               4      INC A
00062C D225 CB18             8      RR  B
00062E D227 30FB            12      JR  NC,PDS2
000630 D229 47               4      LD  B,A
                                
000631 D22A 110000          10      LD  DE,0
       D22D                     PDS3:
000634 D22D 29              11      ADD HL,HL
000635 D22E EB               4      EX  DE,HL
000636 D22F ED6A            15      ADC HL,HL
000638 D231 EB               4      EX  DE,HL
000639 D232 10F9            13      DJNZ    PDS3
       D234                     PDSKF1:
00063B D234 CDCCD2          17      CALL    PRDEC_DEHL
00063E D237 1159D5          10      LD  DE,FREE
000641 D23A CD23D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000644 D23D CDBBD2          17      CALL    PUTDRV
000647 D240 3E5C             7      LD  A,05CH      ;\
000649 D242 CD24D9          17      CALL    MSG_A
00064C D245 2A22EF          16      LD  HL,(FDRV+14)    ;ディレクトリのクラスタ番号
00064F D248 AF               4      XOR A
000650 D249 11FEFF          10      LD  DE,0-2
000653 D24C 19              11      ADD HL,DE
000654 D24D 23               6      INC HL
000655 D24E DCC8D2          17      CALL    C,PRDEC_HL
000658 D251 1841            12      JR  LTNL
                                
       D253                     P_NAME:
00065A D253 3AF4D4          13      LD  A,(DTA_CCP+1)
00065D D256 FE2E             7      CP  '.'
00065F D258 C8              11      RET Z
000660 D259 1171D5          10      LD  DE,DIRHD
000663 D25C CD23D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000666 D25F 3AFFD4          13      LD  A,(DTA_CCP+1+00BH)
000669 D262 F5              11      PUSH    AF
00066A D263 0F               4      RRCA
00066B D264 9F               4      SBC A,A
00066C D265 E60A             7      AND '*'-020H
00066E D267 C620             7      ADD A,020H
000670 D269 CD24D9          17      CALL    MSG_A
000673 D26C CDBBD2          17      CALL    PUTDRV
000676 D26F 21F4D4          10      LD  HL,DTA_CCP+1
000679 D272 CD0CD3          17      CALL    FPRNT
                                
00067C D275 F1              10      POP AF
00067D D276 CB67             8      BIT 4,A
00067F D278 2808            12      JR  Z,DIR3
000681 D27A 1166D5          10      LD  DE,DIRMES
000684 D27D CD23D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000687 D280 180A            12      JR  DIR6
       D282                     DIR3:
000689 D282 ED5B12D5        20      LD  DE,(DTA_CCP+1+01EH)
00068D D286 2A10D5          16      LD  HL,(DTA_CCP+1+01CH)
000690 D289 CDCCD2          17      CALL    PRDEC_DEHL
       D28C                     DIR6:
000693 D28C 3AB1EF          13      LD  A,(_WIDTH)
000696 D28F FE29             7      CP  40+1
000698 D291 D42ED3          17      CALL    NC,PRTTMS
                                
       D294                     LTNL:
00069B D294 1E03             7      LD  E,3
00069D D296 C3CDEF          10      JP  _PRINT
                                
       D299                     C_PATH:
0006A0 D299 CDF0DE          17      CALL    SPCUT
0006A3 D29C 2118D5          10      LD  HL,PATHD
0006A6 D29F FE21             7      CP  021H
0006A8 D2A1 300C            12      JR  NC,CPATH0
       D2A3                     CPATHP:
0006AA D2A3 7E               7      LD  A,(HL)
0006AB D2A4 23               6      INC HL
0006AC D2A5 FE20             7      CP  020H
0006AE D2A7 3F               4      CCF
0006AF D2A8 30EA            12      JR  NC,LTNL
0006B1 D2AA CD24D9          17      CALL    MSG_A
0006B4 D2AD 18F4            12      JR  CPATHP
       D2AF                     CPATH0:
0006B6 D2AF FE3B             7      CP  ';'
0006B8 D2B1 2001            12      JR  NZ,CPATH1
0006BA D2B3 13               6      INC DE
       D2B4                     CPATH1:
0006BB D2B4 EB               4      EX  DE,HL
0006BC D2B5 014000          10      LD  BC,PATHX
0006BF D2B8 EDB0                    LDIR
0006C1 D2BA C9              10      RET
                                
       D2BB                     PUTDRV:
0006C2 D2BB 3A14EF          13      LD  A,(FDRV)
0006C5 D2BE C640             7      ADD A,'A'-1
0006C7 D2C0 CD24D9          17      CALL    MSG_A
0006CA D2C3 3E3A             7      LD  A,':'
       D2C5                     MSG_AR:
0006CC D2C5 C324D9          10      JP  MSG_A
                                
       D2C8                     PRDEC_HL:
0006CF D2C8 AF               4      XOR A
       D2C9                     PRDEC_AHL:
0006D0 D2C9 5F               4      LD  E,A
0006D1 D2CA 1600             7      LD  D,0
       D2CC                     PRDEC_DEHL:
0006D3 D2CC D5              11      PUSH    DE
0006D4 D2CD 110FEF          10      LD  DE,DECBF
0006D7 D2D0 0605             7      LD  B,5
0006D9 D2D2 CDD2D3          17      CALL    ZERO_MEMORY_DE  ;A=0
0006DC D2D5 D1              10      POP DE
                                
0006DD D2D6 0E20             7      LD  C,32
       D2D8                     DEC1:
0006DF D2D8 29              11      ADD HL,HL
0006E0 D2D9 EB               4      EX  DE,HL
0006E1 D2DA ED6A            15      ADC HL,HL
0006E3 D2DC EB               4      EX  DE,HL
0006E4 D2DD E5              11      PUSH    HL
0006E5 D2DE 2113EF          10      LD  HL,DECBF+4
0006E8 D2E1 0605             7      LD  B,5
       D2E3                     DEC2:
0006EA D2E3 7E               7      LD  A,(HL)
0006EB D2E4 8F               4      ADC A,A
0006EC D2E5 27               4      DAA
0006ED D2E6 77               7      LD  (HL),A
0006EE D2E7 2B               6      DEC HL
0006EF D2E8 10F9            13      DJNZ    DEC2
0006F1 D2EA E1              10      POP HL
0006F2 D2EB 0D               4      DEC C
0006F3 D2EC 20EA            12      JR  NZ,DEC1
                                
0006F5 D2EE 210FEF          10      LD  HL,DECBF
0006F8 D2F1 3E20             7      LD  A,020H
0006FA D2F3 0604             7      LD  B,4
       D2F5                     DEC3:
0006FC D2F5 CD02D3          17      CALL    DEC4
0006FF D2F8 CD02D3          17      CALL    DEC4
000702 D2FB 23               6      INC HL
000703 D2FC 10F7            13      DJNZ    DEC3
       D2FE                     DECX:
000705 D2FE CD02D3          17      CALL    DEC4
000708 D301 AF               4      XOR A
       D302                     DEC4:
000709 D302 ED6F            18      RLD
00070B D304 FE20             7      CP  020H
00070D D306 2802            12      JR  Z,DEC5
00070F D308 F630             7      OR  030H
       D30A                     DEC5:
000711 D30A 18B9            12      JR  MSG_AR
                                
       D30C                     FPRNT:
000713 D30C 0608             7      LD  B,8
000715 D30E CD1FD3          17      CALL    P_N1
000718 D311 7E               7      LD  A,(HL)
000719 D312 C680             7      ADD A,0A0H-020H
00071B D314 FEA0             7      CP  0A0H
00071D D316 2802            12      JR  Z,FPR1
00071F D318 3E2E             7      LD  A,'.'
       D31A                     FPR1:
000721 D31A CD24D9          17      CALL    MSG_A
000724 D31D 0603             7      LD  B,3
                                
       D31F                     P_N1:
000726 D31F C5              11      PUSH    BC
000727 D320 E5              11      PUSH    HL
000728 D321 7E               7      LD  A,(HL)
000729 D322 CD31E1          17      CALL    CAP3
00072C D325 CD24D9          17      CALL    MSG_A
00072F D328 E1              10      POP HL
000730 D329 C1              10      POP BC
000731 D32A 23               6      INC HL
000732 D32B 10F2            13      DJNZ    P_N1
000734 D32D C9              10      RET
                                
       D32E                     PRTTMS:
000735 D32E 3E20             7      LD  A,020H
000737 D330 CD24D9          17      CALL    MSG_A
                                
00073A D333 2A0CD5          16      LD  HL,(DTA_CCP+1+24)
00073D D336 7D               4      LD  A,L
00073E D337 B7               4      OR  A
00073F D338 C8              11      RET Z
000740 D339 CB3C             8      SRL H
000742 D33B 17               4      RLA
000743 D33C 17               4      RLA
000744 D33D 17               4      RLA
000745 D33E 17               4      RLA
000746 D33F E60F             7      AND 00FH
000748 D341 57               4      LD  D,A
000749 D342 7C               4      LD  A,H
00074A D343 C650             7      ADD A,80
00074C D345 CD88D3          17      CALL    PRDEC_A
00074F D348 3E2D             7      LD  A,'-'
000751 D34A CD24D9          17      CALL    MSG_A
000754 D34D 7A               4      LD  A,D
000755 D34E CD88D3          17      CALL    PRDEC_A
000758 D351 3E2D             7      LD  A,'-'
00075A D353 CD24D9          17      CALL    MSG_A
00075D D356 7D               4      LD  A,L
00075E D357 E61F             7      AND 01FH
000760 D359 CD88D3          17      CALL    PRDEC_A
                                
000763 D35C 2A0AD5          16      LD  HL,(DTA_CCP+1+22)
                                
000766 D35F 3E20             7      LD  A,020H
000768 D361 CD24D9          17      CALL    MSG_A
00076B D364 7C               4      LD  A,H
00076C D365 65               4      LD  H,L
00076D D366 0603             7      LD  B,3
       D368                     PRTTMS1:
00076F D368 1F               4      RRA
000770 D369 CB1D             8      RR  L
000772 D36B 10FB            13      DJNZ    PRTTMS1
000774 D36D E61F             7      AND 01FH
000776 D36F CD88D3          17      CALL    PRDEC_A
000779 D372 3E3A             7      LD  A,':'
00077B D374 CD24D9          17      CALL    MSG_A
00077E D377 7D               4      LD  A,L
00077F D378 0F               4      RRCA
000780 D379 0F               4      RRCA
000781 D37A E63F             7      AND 03FH
000783 D37C CD88D3          17      CALL    PRDEC_A
000786 D37F 3E3A             7      LD  A,':'
000788 D381 CD24D9          17      CALL    MSG_A
00078B D384 7C               4      LD  A,H
00078C D385 E61F             7      AND 01FH
00078E D387 87               4      ADD A,A
                                
                                ;   PRINT10
                                
       D388                     PRDEC_A:
00078F D388 E5              11      PUSH    HL
000790 D389 0608             7      LD  B,8
000792 D38B 4F               4      LD  C,A
000793 D38C AF               4      XOR A
       D38D                     PRTA1:
000794 D38D CB01             4      RLC C
000796 D38F 8F               4      ADC A,A
000797 D390 27               4      DAA
000798 D391 10FA            13      DJNZ    PRTA1
00079A D393 210FEF          10      LD  HL,DECBF
00079D D396 77               7      LD  (HL),A
00079E D397 AF               4      XOR A
00079F D398 CDFED2          17      CALL    DECX
0007A2 D39B E1              10      POP HL
0007A3 D39C C9              10      RET
                                
       D39D                     SETFCB:
0007A4 D39D CDF0DE          17      CALL    SPCUT
0007A7 D3A0 1A               7      LD  A,(DE)
0007A8 D3A1 FE20             7      CP  020H
0007AA D3A3 3801            12      JR  C,SETFCBA
0007AC D3A5 1B               6      DEC DE
       D3A6                     SETFCBA:
0007AD D3A6 0624             7      LD  B,36
0007AF D3A8 215C00          10      LD  HL,FCB1
0007B2 D3AB E5              11      PUSH    HL
0007B3 D3AC AF               4      XOR A
0007B4 D3AD CDC5DE          17      CALL    FILL_MEMORY
0007B7 D3B0 E1              10      POP HL
0007B8 D3B1 D5              11      PUSH    DE
0007B9 D3B2 CD63D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007BC D3B5 216C00          10      LD  HL,FCB2
0007BF D3B8 CD63D8          17      CALL    _SYS5C      ;(BDOS)ファイル名の解析
0007C2 D3BB E1              10      POP HL
0007C3 D3BC 010050          10      LD  BC,05000H
0007C6 D3BF 118100          10      LD  DE,00081H
       D3C2                     SETFCB1:
0007C9 D3C2 7E               7      LD  A,(HL)
0007CA D3C3 23               6      INC HL
0007CB D3C4 FE20             7      CP  020H
0007CD D3C6 3805            12      JR  C,SETFCB2
0007CF D3C8 12               7      LD  (DE),A
0007D0 D3C9 13               6      INC DE
0007D1 D3CA 0C               4      INC C
0007D2 D3CB 10F5            13      DJNZ    SETFCB1
       D3CD                     SETFCB2:
0007D4 D3CD 79               4      LD  A,C
0007D5 D3CE 328000          13      LD  (DTA1),A
0007D8 D3D1 04               4      INC B
       D3D2                     ZERO_MEMORY_DE:
0007D9 D3D2 AF               4      XOR A
       D3D3                     FILL_MEMORY_DE:
0007DA D3D3 12               7      LD  (DE),A
0007DB D3D4 13               6      INC DE
0007DC D3D5 10FC            13      DJNZ    FILL_MEMORY_DE
0007DE D3D7 C9              10      RET
                                
       D3D8                     C_COPY:
0007DF D3D8 CD9DD3          17      CALL    SETFCB
                                
0007E2 D3DB 1161EF          10      LD  DE,ZERO
0007E5 D3DE CD11DE          17      CALL    FILEC2
0007E8 D3E1 216C00          10      LD  HL,FCB2
0007EB D3E4 CD6AD8          17      CALL    S29X1
                                
0007EE D3E7 3E10             7      LD  A,010H
0007F0 D3E9 326900          13      LD  (FCB1+13),A
0007F3 D3EC 216D00          10      LD  HL,FCB2+1
0007F6 D3EF CDE8D4          17      CALL    CWILD1
       D3F2                     COPY0:
0007F9 D3F2 CDE5D4          17      CALL    CWILD
0007FC D3F5 215C00          10      LD  HL,FCB1
0007FF D3F8 CDC3D0          17      CALL    OPEN
000802 D3FB 37               4      SCF
       D3FC                     COPY1:
000803 D3FC C0              11      RET NZ
000804 D3FD CDD6D0          17      CALL    DEFCB
                                
000807 D400 3A00D5          13      LD  A,(DTA_CCP+13)
00080A D403 CB67             8      BIT 4,A
00080C D405 2821            12      JR  Z,COPY1A
                                
00080E D407 215D00          10      LD  HL,FCB1+1
000811 D40A CD54E2          17      CALL    CHKWILD
000814 D40D 3814            12      JR  C,COPY9
                                
000816 D40F 3E20             7      LD  A,020H
000818 D411 325D00          13      LD  (FCB1+1),A
00081B D414 2A0DD5          16      LD  HL,(DTA_CCP+26)
00081E D417 23               6      INC HL
00081F D418 226A00          16      LD  (FCB1+14),HL
000822 D41B 18D5            12      JR  COPY0
                                
       D41D                     COPY8:
000824 D41D CD23D6          17      CALL    _SYS09      ;(BDOS)文字列出力
000827 D420 CD94D2          17      CALL    LTNL
       D423                     COPY9:
00082A D423 CDD2D0          17      CALL    OPEN2
00082D D426 18D4            12      JR  COPY1
                                
       D428                     COPY1A:
00082F D428 216C00          10      LD  HL,FCB2
000832 D42B 1114EF          10      LD  DE,FDRV
000835 D42E 01F5D4          10      LD  BC,DTA_CCP+2
000838 D431 EDA0            16      LDI
00083A D433 3E0B             7      LD  A,11
       D435                     COPY2:
00083C D435 F5              11      PUSH    AF
00083D D436 7E               7      LD  A,(HL)
00083E D437 FE3F             7      CP  '?'
000840 D439 2001            12      JR  NZ,COPY3
000842 D43B 0A               7      LD  A,(BC)
       D43C                     COPY3:
000843 D43C 12               7      LD  (DE),A
000844 D43D 03               6      INC BC
000845 D43E 13               6      INC DE
000846 D43F 23               6      INC HL
000847 D440 F1              10      POP AF
000848 D441 3D               4      DEC A
000849 D442 20F1            12      JR  NZ,COPY2
00084B D444 010500          10      LD  BC,16-11
00084E D447 EDB0                    LDIR
       D449                     PUTNAME:
000850 D449 215D00          10      LD  HL,FCB1+1
000853 D44C CD54E2          17      CALL    CHKWILD
000856 D44F 300B            12      JR  NC,PUTN1
000858 D451 2115EF          10      LD  HL,FDRV+1
00085B D454 CD0CD3          17      CALL    FPRNT
00085E D457 3E20             7      LD  A,020H
000860 D459 CD24D9          17      CALL    MSG_A
       D45C                     PUTN1:
000863 D45C 1114EF          10      LD  DE,FDRV
000866 D45F 0E16             7      LD  C,016H      ;(BDOS)ファイルの作成
000868 D461 CDF1D0          17      CALL    SYSTEM0
00086B D464 2048            12      JR  NZ,COPYE2
00086D D466 67               4      LD  H,A     ;A=0
00086E D467 6F               4      LD  L,A
00086F D468 2235EF          16      LD  (FDRV+33),HL    ;(FCB)ランダムレコード
000872 D46B 2237EF          16      LD  (FDRV+35),HL
       D46E                     COPY6:
000875 D46E CDFAD0          17      CALL    S27BUF
000878 D471 47               4      LD  B,A
000879 D472 3C               4      INC A
00087A D473 2831            12      JR  Z,COPYE
00087C D475 7C               4      LD  A,H
00087D D476 B5               4      OR  L
00087E D477 280C            12      JR  Z,COPY7
000880 D479 1114EF          10      LD  DE,FDRV
000883 D47C 0E26             7      LD  C,026H      ;(BDOS)ランダムブロック書き込み
000885 D47E CDF1D0          17      CALL    SYSTEM0
000888 D481 2023            12      JR  NZ,COPYE
00088A D483 10E9            13      DJNZ    COPY6
       D485                     COPY7:
00088C D485 3A00D5          13      LD  A,(DTA_CCP+13)  ;(FCB)属性
00088F D488 3221EF          13      LD  (FDRV+13),A
000892 D48B 2107D5          10      LD  HL,DTA_CCP+20   ;(FCB)タイムスタンプ
000895 D48E 1128EF          10      LD  DE,FDRV+20
000898 D491 010400          10      LD  BC,4
00089B D494 EDB0                    LDIR
                                
00089D D496 1114EF          10      LD  DE,FDRV
0008A0 D499 0E10             7      LD  C,010H      ;(BDOS)ファイルのクローズ
0008A2 D49B CDF1D0          17      CALL    SYSTEM0
0008A5 D49E 2006            12      JR  NZ,COPYE
                                
0008A7 D4A0 1171EF          10      LD  DE,OK
0008AA D4A3 C31DD4          10      JP  COPY8
                                
       D4A6                     COPYE:
0008AD D4A6 1114EF          10      LD  DE,FDRV
0008B0 D4A9 0E13             7      LD  C,013H      ;(BDOS)ファイルの削除
0008B2 D4AB CD0500          17      CALL    SYSTEM
       D4AE                     COPYE2:
0008B5 D4AE 37               4      SCF
0008B6 D4AF C9              10      RET
                                
       D4B0                     C_TYPE:
0008B7 D4B0 CD9DD3          17      CALL    SETFCB
0008BA D4B3 215C00          10      LD  HL,FCB1
0008BD D4B6 CDC3D0          17      CALL    OPEN
0008C0 D4B9 37               4      SCF
       D4BA                     TYPE1:
0008C1 D4BA C0              11      RET NZ
0008C2 D4BB CDD6D0          17      CALL    DEFCB
0008C5 D4BE 3E06             7      LD  A,6
0008C7 D4C0 CD24D9          17      CALL    MSG_A
       D4C3                     TYPE2:
0008CA D4C3 CDFAD0          17      CALL    S27BUF
0008CD D4C6 C6FE             7      ADD A,0FEH
0008CF D4C8 D8              11      RET C
0008D0 D4C9 7C               4      LD  A,H
0008D1 D4CA B5               4      OR  L
0008D2 D4CB 2813            12      JR  Z,TYPEE
0008D4 D4CD 010001          10      LD  BC,00100H
       D4D0                     TYPE3:
0008D7 D4D0 0A               7      LD  A,(BC)
0008D8 D4D1 03               6      INC BC
0008D9 D4D2 FE1A             7      CP  01AH
0008DB D4D4 280A            12      JR  Z,TYPEE
0008DD D4D6 CD24D9          17      CALL    MSG_A
0008E0 D4D9 2B               6      DEC HL
0008E1 D4DA 7C               4      LD  A,H
0008E2 D4DB B5               4      OR  L
0008E3 D4DC 20F2            12      JR  NZ,TYPE3
0008E5 D4DE 18E3            12      JR  TYPE2
       D4E0                     TYPEE:
0008E7 D4E0 CDD2D0          17      CALL    OPEN2
0008EA D4E3 18D5            12      JR  TYPE1
                                
       D4E5                     CWILD:
0008EC D4E5 215D00          10      LD  HL,FCB1+1
       D4E8                     CWILD1:
0008EF D4E8 7E               7      LD  A,(HL)
0008F0 D4E9 FE20             7      CP  020H
0008F2 D4EB C0              11      RET NZ
       D4EC                     CWILD2:
0008F3 D4EC 3E3F             7      LD  A,'?'
0008F5 D4EE 060B             7      LD  B,11
0008F7 D4F0 C3C5DE          10      JP  FILL_MEMORY
                                
       D4F3                     DTA_CCP:
0008FA D4F3                         DS  37
                                
       0040                     PATHX   EQU 64
00091F D518                     PATHD:  DS  PATHX
00095F D558 00                  PATHE:  DB  0
                                
000960 D559 2062797465732066    FREE:   DB  " bytes free",9,'$'
            7265650924          
00096D D566 20202020203C4449    DIRMES: DB  "     <DIR>$"
            523E24              
000978 D571 20203A24            DIRHD:  DB  "  :$"
                                
       D575                     COMTB:
00097C D575 44202020                DB  "D   "  ;1
000980 D579 F4D1                    DW  C_DIR
000982 D57B 44495220                DB  "DIR "  ;2
000986 D57F F4D1                    DW  C_DIR
000988 D581 434F5059                DB  "COPY"  ;3
00098C D585 D8D3                    DW  C_COPY
00098E D587 43442020                DB  "CD  "  ;4
000992 D58B F6D0                    DW  C_CD
000994 D58D 44454C20                DB  "DEL "  ;5
000998 D591 D7D1                    DW  C_DEL
00099A D593 50415448                DB  "PATH"  ;6
00099E D597 99D2                    DW  C_PATH
0009A0 D599 52454E20                DB  "REN "  ;7
0009A4 D59D E1D1                    DW  C_REN
0009A6 D59F 54595045                DB  "TYPE"  ;8
0009AA D5A3 B0D4                    DW  C_TYPE
0009AC D5A5 52454D20                DB  "REM "  ;9
0009B0 D5A9 20D6                    DW  C_REM
[EOF:LDCCP.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK2.ASM"
                                
                                ;   LSX-Dodgers DISK2
                                ;   PC-8801mkIISR
                                
                                ;   BANK RAM DISK DRIVER
                                
       D5AB                     BDWT:
0009B2 D5AB 3E10             7      LD  A,010H  ;ライト可　リード不可
0009B4 D5AD 1802            12  JR  BRW
                                
       D5AF                     BDRD:
0009B6 D5AF 3E01             7      LD  A,001H  ;ライト不可　リード可
       D5B1                     BRW:
0009B8 D5B1 F3               4      DI
0009B9 D5B2 D3E2            11      OUT (0E2H),A    ;拡張RAM リード/ライト制御
0009BB D5B4 ED73EDD5        20      LD  (BANKSP+1),SP
0009BF D5B8 3AEED5          13      LD  A,(BANKSP+2)
0009C2 D5BB 87               4      ADD A,A
0009C3 D5BC 3803            12      JR  C,BRW1
0009C5 D5BE 3130EE          10      LD  SP,EXTSP
       D5C1                     BRW1:
0009C8 D5C1 C5              11      PUSH    BC
0009C9 D5C2 D5              11      PUSH    DE
0009CA D5C3 EB               4      EX  DE,HL
0009CB D5C4 29              11      ADD HL,HL
0009CC D5C5 29              11      ADD HL,HL
0009CD D5C6 7C               4      LD  A,H
0009CE D5C7 DD860C          19      ADD A,(IX+00CH) ;DPB_0C_MAXCYL
0009D1 D5CA E60F             7      AND 00FH        ;バンク
0009D3 D5CC D3E3            11      OUT (0E3H),A    ;拡張RAM バンク選択
0009D5 D5CE 65               4      LD  H,L
0009D6 D5CF CB3C             8      SRL H   ;/2
0009D8 D5D1 2E00             7      LD  L,0
0009DA D5D3 DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009DC D5D5 0F               4      RRCA
0009DD D5D6 3001            12      JR  NC,BRW2
0009DF D5D8 EB               4      EX  DE,HL
       D5D9                     BRW2:
0009E0 D5D9 010002          10      LD  BC,512
0009E3 D5DC EDB0                    LDIR
                                
0009E5 D5DE DBE2            11      IN  A,(0E2H)    ;拡張RAM リード/ライト制御
0009E7 D5E0 0F               4      RRCA
0009E8 D5E1 3801            12      JR  C,BRW3
0009EA D5E3 EB               4      EX  DE,HL
       D5E4                     BRW3:
0009EB D5E4 D1              10      POP DE
0009EC D5E5 C1              10      POP BC
0009ED D5E6 13               6      INC DE
0009EE D5E7 10D8            13      DJNZ    BRW1
                                
0009F0 D5E9 AF               4      XOR A
0009F1 D5EA D3E2            11      OUT (0E2H),A    ;メインメモリに切り替える
0009F3 D5EC 310000          10  BANKSP: LD  SP,0
0009F6 D5EF FB               4      EI
0009F7 D5F0 C9              10      RET
                                
[EOF:88DISK2.ASM:SHIFT_JIS]
                                    INCLUDE "LDOS.ASM"
                                
                                ;   LSX-Dodgers OS
                                
       D5F1                     BDOS0:
0009F8 D5F1 E5              11      PUSH    HL
0009F9 D5F2 79               4      LD  A,C
0009FA D5F3 FE3C             7      CP  03CH
0009FC D5F5 3802            12      JR  C,DOS1
0009FE D5F7 3E3C             7      LD  A,03CH
       D5F9                     DOS1:
000A00 D5F9 87               4      ADD A,A
000A01 D5FA 6F               4      LD  L,A
000A02 D5FB 26F0             7      LD  H,STABLE/256
000A04 D5FD 7E               7      LD  A,(HL)
000A05 D5FE 2C               4      INC L
000A06 D5FF 66               7      LD  H,(HL)
000A07 D600 6F               4      LD  L,A
000A08 D601 E3              19      EX  (SP),HL
000A09 D602 79               4      LD  A,C
                                ;確認用
                                ;   LD  (0050H),A
000A0A D603 C9              10      RET
       D604                     _DOS2:
000A0B D604 FE5A             7      CP  05AH        ;(BDOS)カレントディレクトリの変更(_CHDIR)
000A0D D606 CAA7D8          10      JP  Z,_SYS5A
000A10 D609 FE5C             7      CP  05CH        ;(BDOS)ファイル名の解析(_PFILE)
000A12 D60B CA63D8          10      JP  Z,_SYS5C
000A15 D60E FE5F             7      CP  05FH        ;(BDOS)ディスクバッファのフラッシュ(_FLUSH)
000A17 D610 CA5FEB          10      JP  Z,_SYS5F
000A1A D613 FE6F             7      CP  06FH        ;(BDOS)MSX-DOS のバージョン番号の獲得(_DOSVER)
000A1C D615 200A            12      JR  NZ,_ERROR
000A1E D617 011D01          10      LD  BC,011DH
000A21 D61A 115001          10      LD  DE,VER
000A24 D61D 210201          10      LD  HL,MACD
       D620                     C_REM:
000A27 D620 AF               4      XOR A
       D621                     _ERROR:
000A28 D621 A7               4      AND A
000A29 D622 C9              10      RET
                                
       D623                     _SYS09:     ;文字列出力
000A2A D623 D5              11      PUSH    DE
       D624                     _SX09:
000A2B D624 1A               7      LD  A,(DE)
000A2C D625 13               6      INC DE
000A2D D626 FE24             7      CP  '$'
000A2F D628 2831            12      JR  Z,SX0E2
000A31 D62A CD24D9          17      CALL    MSG_A
000A34 D62D 18F5            12      JR  _SX09
                                
       D62F                     MSX1:
000A36 D62F CD24D9          17      CALL    MSG_A
       D632                     MSX:
000A39 D632 7E               7      LD  A,(HL)
000A3A D633 23               6      INC HL
000A3B D634 B7               4      OR  A
000A3C D635 20F8            12      JR  NZ,MSX1
000A3E D637 C9              10      RET
                                
       D638                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000A3F D638 212200          10      LD  HL,00022H
000A42 D63B 7D               4      LD  A,L
000A43 D63C C9              10      RET
                                
       D63D                     _SYS0D:     ;(BDOS)ディスクリセット
000A44 D63D CDDFEF          17      CALL    _FFLUSH
000A47 D640 E5              11      PUSH    HL
000A48 D641 218000          10      LD  HL,00080H
000A4B D644 228AEF          16      LD  (_DTA),HL
000A4E D647 E1              10      POP HL
000A4F D648 D5              11      PUSH    DE
000A50 D649 1E00             7      LD  E,0
000A52 D64B 3E                      DB  03EH
                                
       D64C                     _SYS0E:     ;(BDOS)カレントドライブの設定
000A53 D64C D5              11      PUSH    DE
000A54 D64D 7B               4      LD  A,E
000A55 D64E DDE5            15      PUSH    IX
000A57 D650 CDDCEF          17      CALL    _GETDPB
000A5A D653 DDE1            14      POP IX
000A5C D655 3804            12      JR  C,SX0E2
000A5E D657 7B               4      LD  A,E
000A5F D658 3287EF          13      LD  (_DVSW),A
       D65B                     SX0E2:
000A62 D65B 3E08             7      LD  A,8
000A64 D65D D1              10      POP DE
000A65 D65E C9              10      RET
                                
       D65F                     _SYS0F:     ;(BDOS)ファイルのオープン
000A66 D65F CD02DF          17      CALL    SETDRV
000A69 D662 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000A6C D665 C602             7      ADD A,002H      ;Write
000A6E D667 2848            12      JR  Z,FEND0F
000A70 D669 CD50E2          17      CALL    CHKWILDX
                                
000A73 D66C D422DF          17      CALL    NC,SOPENX
       D66F                     _S16XX:
000A76 D66F 3840            12      JR  C,FEND0F
                                                ;Directory location
000A78 D671 3A9FEF          13      LD  A,(_FILEN)
000A7B D674 FD7719          19      LD  (IY+25),A   ;(FCB)ディレクトリロケーション
                                ;               _DIRF
000A7E D677 3AA0EF          13      LD  A,(_DIRF)
000A81 D67A FD771D          19      LD  (IY+29),A   ;(FCB)ディレクトリモード
                                ;               _FBPS
000A84 D67D FD731E          19      LD  (IY+30),E   ;(FCB)ディレクトリポジション
000A87 D680 FD721F          19      LD  (IY+31),D
                                ;               Open(Read)
000A8A D683 FD361CFF        19      LD  (IY+28),0FFH    ;(FCB)オープンモード
                                ;               FILENAME
000A8E D687 FDE5            15      PUSH    IY
000A90 D689 D1              10      POP DE
000A91 D68A 13               6      INC DE
000A92 D68B 010B00          10      LD  BC,11
000A95 D68E EDB0                    LDIR
                                ;               Attribute
000A97 D690 7E               7      LD  A,(HL)
000A98 D691 FD770D          19      LD  (IY+13),A   ;(FCB)属性(アトリビュート)
000A9B D694 110B00          10      LD  DE,11       ;Reserved
000A9E D697 19              11      ADD HL,DE
                                                    ;(FCB)ファイルを最後に変更した時刻
000A9F D698 11EAF0          10      LD  DE,SDDATA       ;(FCB)ファイルを最後に変更した日付
000AA2 D69B 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       D69D                     S16LOOP:                ;(FCB)ファイルのサイズ(バイト単位)
000AA4 D69D 1A               7      LD  A,(DE)
000AA5 D69E 13               6      INC DE
000AA6 D69F 32A6D6          13      LD  (S16PAT+2),A
000AA9 D6A2 7E               7      LD  A,(HL)
000AAA D6A3 23               6      INC HL
000AAB D6A4 FD7700          19  S16PAT: LD  (IY+0),A
000AAE D6A7 10F4            13      DJNZ    S16LOOP
                                
000AB0 D6A9 AF               4      XOR A
000AB1 D6AA FD770C          19      LD  (IY+12),A   ;(FCB)カレントブロック
000AB4 D6AD FD2255D7        20      LD  (OFCB+1),IY
       D6B1                     FEND0F:
000AB8 D6B1 1845            12      JR  FEND10
                                
       D6B3                     _SYS10:     ;(BDOS)ファイルのクローズ
000ABA D6B3 CD02DF          17      CALL    SETDRV
000ABD D6B6 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000AC0 D6B9 D6FE             7      SUB 0FEH
000AC2 D6BB 37               4      SCF
000AC3 D6BC 3F               4      CCF
000AC4 D6BD 2039            12      JR  NZ,FEND10
       D6BF                     _S10A:              ;Write
000AC6 D6BF FD770E          19      LD  (IY+14),A   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000AC9 D6C2 FD770F          19      LD  (IY+15),A
                                
000ACC D6C5 FD341C          23      INC (IY+28)     ;0FEH->0FFH ;オープンモード
000ACF D6C8 CD48E3          17      CALL    SETTMS
                                
000AD2 D6CB FD7E1D          19      LD  A,(IY+29)   ;(FCB)ディレクトリモード
000AD5 D6CE 32A0EF          13      LD  (_DIRF),A
000AD8 D6D1 E67F             7      AND 07FH
000ADA D6D3 3291E8          13      LD  (_SECPS+1),A
000ADD D6D6 FD5E1E          19      LD  E,(IY+30)   ;(FCB)ディレクトリポジション
000AE0 D6D9 FD561F          19      LD  D,(IY+31)
000AE3 D6DC CD56E0          17      CALL    READ_DIR
000AE6 D6DF 3817            12      JR  C,FEND10
                                
000AE8 D6E1 3A80DF          13  SDECM1: LD  A,(SDECPAT+1)   ;1セクタ辺りのディレクトリエントリ数
000AEB D6E4 3D               4      DEC A       ;1024=01FH / 512=00FH / 256=7
000AEC D6E5 FDA619          19      AND (IY+25)     ;(FCB)ディレクトリロケーション
000AEF D6E8 6F               4      LD  L,A
000AF0 D6E9 2600             7      LD  H,0
000AF2 D6EB 29              11      ADD HL,HL       ;*2
000AF3 D6EC 29              11      ADD HL,HL       ;*4
000AF4 D6ED 29              11      ADD HL,HL       ;*8
000AF5 D6EE 29              11      ADD HL,HL       ;*16
000AF6 D6EF 29              11      ADD HL,HL       ;*32
000AF7 D6F0 ED4B7EF0        20      LD  BC,(_DTBUF)
000AFB D6F4 09              11      ADD HL,BC
                                
000AFC D6F5 CD60E2          17      CALL    SDIRENT
       D6F8                     FEND10:
000AFF D6F8 1842            12      JR  FEND
                                
       D6FA                     _SYS11:     ;(BDOS)最初のファイルの検索
000B01 D6FA CD02DF          17      CALL    SETDRV
000B04 D6FD CD4FDF          17      CALL    SOPEN
       D700                     _S12X1:
000B07 D700 383A            12      JR  C,FEND
000B09 D702 CDEFDF          17      CALL    SOPENE2
000B0C D705 ED5B8AEF        20      LD  DE,(_DTA)
000B10 D709 3A88EF          13      LD  A,(_DRV)
000B13 D70C 3C               4      INC A
000B14 D70D 12               7      LD  (DE),A
000B15 D70E D5              11      PUSH    DE
000B16 D70F 13               6      INC DE
000B17 D710 012000          10      LD  BC,32
000B1A D713 EDB0                    LDIR
000B1C D715 FD6E0E          19      LD  L,(IY+14)   ;(FCB)レコードサイズ/アクセスするディレクトリのクラスタ番号+1
000B1F D718 FD660F          19      LD  H,(IY+15)
000B22 D71B 22F4F0          16      LD  (SCDIR),HL
000B25 D71E 2A9AEF          16      LD  HL,(_FBPS)
000B28 D721 22F6F0          16      LD  (SFBPS),HL
000B2B D724 2A9FEF          16      LD  HL,(_FILEN)
000B2E D727 7C               4      LD  A,H
000B2F D728 B7               4      OR  A
000B30 D729 2806            12      JR  Z,_S12DIR
000B32 D72B 3A91E8          13      LD  A,(_SECPS+1)
000B35 D72E F680             7      OR  080H
000B37 D730 67               4      LD  H,A
       D731                     _S12DIR:
000B38 D731 22F8F0          16      LD  (SFNDF),HL  ;Directory position and Flags
000B3B D734 E1              10      POP HL
000B3C D735 1139EF          10      LD  DE,SFILE
000B3F D738 0E21             7      LD  C,33
       D73A                     _S11B:
000B41 D73A EDB0                    LDIR
       D73C                     FEND:
000B43 D73C 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       D73D                     FENDE:
000B44 D73D FDE1            14      POP IY
000B46 D73F C1              10      POP BC
000B47 D740 D1              10      POP DE
000B48 D741 E1              10      POP HL
000B49 D742 C9              10      RET
                                
       D743                     _SYS12:     ;(BDOS)次のファイルの検索
000B4A D743 E5              11      PUSH    HL
000B4B D744 D5              11      PUSH    DE
000B4C D745 C5              11      PUSH    BC
000B4D D746 FDE5            15      PUSH    IY
000B4F D748 CDB3DF          17      CALL    NOPEN
000B52 D74B 18B3            12      JR  _S12X1
                                
       D74D                     _S16K:
000B54 D74D FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
000B57 D750 FEFD             7      CP  0FDH        ;Device(0FDH)
000B59 D752 37               4      SCF
000B5A D753 C8              11      RET Z
                                
000B5B D754 110000          10  OFCB:   LD  DE,0
000B5E D757 D5              11      PUSH    DE
000B5F D758 061A             7      LD  B,26        ;First cluster
       D75A                     S16K1:
000B61 D75A 13               6      INC DE
000B62 D75B 23               6      INC HL
000B63 D75C 10FC            13      DJNZ    S16K1
                                
000B65 D75E 1A               7      LD  A,(DE)
000B66 D75F BE               7      CP  (HL)
000B67 D760 2013            12      JR  NZ,S16K2
000B69 D762 13               6      INC DE
000B6A D763 23               6      INC HL
000B6B D764 1A               7      LD  A,(DE)
000B6C D765 BE               7      CP  (HL)
000B6D D766 200D            12      JR  NZ,S16K2
                                
000B6F D768 E1              10      POP HL
000B70 D769 FDE5            15      PUSH    IY
000B72 D76B D1              10      POP DE
000B73 D76C 1A               7      LD  A,(DE)      ;Drive
000B74 D76D BE               7      CP  (HL)
000B75 D76E 2006            12      JR  NZ,S16K3
                                                ;ここはCFが必ず0
000B77 D770 ED52            15      SBC HL,DE       ;CP HL,DE
000B79 D772 37               4      SCF
000B7A D773 C0              11      RET NZ
000B7B D774 E5              11      PUSH    HL
       D775                     S16K2:
000B7C D775 E1              10      POP HL
       D776                     S16K3:
000B7D D776 FDE5            15      PUSH    IY
000B7F D778 D1              10      POP DE
       D779                     _SYS13:     ;(BDOS)ファイルの削除
000B80 D779 CD02DF          17      CALL    SETDRV
000B83 D77C CD80E1          17      CALL    KILL
       D77F                     FEND13:
000B86 D77F 18BB            12      JR  FEND
                                
       D781                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000B88 D781 CD02DF          17      CALL    SETDRV
000B8B D784 CDB4E3          17      CALL    INIT_SEQ
       D787                     SREAD:
000B8E D787 CDFEE3          17      CALL    RB_READ
                                
000B91 D78A C601             7      ADD A,001H
000B93 D78C 38AE            12      JR  C,FEND
                                
000B95 D78E 7D               4      LD  A,L
000B96 D78F D601             7      SUB 001H
       D791                     FENDX:
000B98 D791 9F               4      SBC A,A
000B99 D792 E603             7      AND 3
000B9B D794 1F               4      RRA
000B9C D795 18A6            12      JR  FENDE
                                
       D797                     _SYS15:     ;(BDOS)シーケンシャルな書き込み
000B9E D797 CD02DF          17      CALL    SETDRV
000BA1 D79A CDB4E3          17      CALL    INIT_SEQ
       D79D                     SWRITE:
000BA4 D79D CDF7E3          17      CALL    RB_WRITE
                                
000BA7 D7A0 C6FF             7      ADD A,0FFH
000BA9 D7A2 18ED            12      JR  FENDX
                                
       D7A4                     _SYS17:     ;(BDOS)ファイル名の変更
000BAB D7A4 CD02DF          17      CALL    SETDRV
000BAE D7A7 CDD6E1          17      CALL    NAME
000BB1 D7AA 18D3            12      JR  FEND13
                                
       D7AC                     _SYS16:     ;(BDOS)ファイルの作成
000BB3 D7AC CD02DF          17      CALL    SETDRV
                                
000BB6 D7AF CD50E2          17      CALL    CHKWILDX
000BB9 D7B2 38CB            12      JR  C,FEND13
000BBB D7B4 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
000BBE D7B7 FE05             7      CP  5
000BC0 D7B9 2805            12      JR  Z,_S16X2
000BC2 D7BB FE21             7      CP  021H
000BC4 D7BD DA7FD7          10      JP  C,FEND13
       D7C0                     _S16X2:
                                ;               Clear FCB
000BC7 D7C0 FDE5            15      PUSH    IY
000BC9 D7C2 E1              10      POP HL
000BCA D7C3 011000          10      LD  BC,16
000BCD D7C6 09              11      ADD HL,BC
       D7C7                     _S16X1:
000BCE D7C7 70               7      LD  (HL),B      ;B=0
000BCF D7C8 23               6      INC HL
000BD0 D7C9 0D               4      DEC C
000BD1 D7CA 20FB            12      JR  NZ,_S16X1
                                
000BD3 D7CC CD4DE3          17      CALL    SETTMSX
000BD6 D7CF FD360DFF        19      LD  (IY+13),0FFH    ;(FCB)Attribute
000BDA D7D3 CD22DF          17      CALL    SOPENX
000BDD D7D6 3F               4      CCF
000BDE D7D7 CC4DD7          17      CALL    Z,_S16K
000BE1 D7DA D400E0          17      CALL    NC,COPEN
000BE4 D7DD D460E2          17      CALL    NC,SDIRENT
000BE7 D7E0 C36FD6          10      JP  _S16XX
                                
       D7E3                     _SYS21:     ;(BDOS)ランダムな読み出し
000BEA D7E3 CD02DF          17      CALL    SETDRV
000BED D7E6 CD98E3          17      CALL    INIT_RND
000BF0 D7E9 189C            12      JR  SREAD
                                
       D7EB                     _SYS22:     ;(BDOS)ランダムな書き込み
       D7EB                     _SYS28:     ;(BDOS)ランダムな書き込み・その2
000BF2 D7EB CD02DF          17      CALL    SETDRV
000BF5 D7EE CD98E3          17      CALL    INIT_RND
000BF8 D7F1 18AA            12      JR  SWRITE
                                
       D7F3                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000BFA D7F3 21FF00          10      LD  HL,000FFH
000BFD D7F6 AF               4      XOR A
000BFE D7F7 C9              10      RET
                                
       D7F8                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000BFF D7F8 3A87EF          13      LD  A,(_DVSW)
000C02 D7FB A7               4      AND A
000C03 D7FC C9              10      RET
                                
       D7FD                     _SYS1A:     ;(BDOS)DTAの設定
000C04 D7FD ED538AEF        20      LD  (_DTA),DE
000C08 D801 AF               4      XOR A
000C09 D802 C9              10      RET
                                
       D803                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000C0A D803 7B               4      LD  A,E
000C0B D804 CD15DF          17      CALL    GETDRV
000C0E D807 CDDCEF          17      CALL    _GETDPB
000C11 D80A D4E2EF          17      CALL    NC,_RDFATX
000C14 D80D 210000          10      LD  HL,0
000C17 D810 D426E3          17      CALL    NC,DSKF
                                
000C1A D813 ED5B27E3        20      LD  DE,(MAXCLP+1)   ;DPB_08_MAXCL-1
000C1E D817 1B               6      DEC DE      ;DE←クラスタの総数
000C1F D818 FD2A7CF0        20      LD  IY,(_FATBF) ;IY←メモリ上のFATの先頭アドレス
000C23 D81C 9F               4      SBC A,A
000C24 D81D D8              11      RET C
000C25 D81E 4F               4      LD  C,A     ;C=0
000C26 D81F DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS
000C29 D822 E60F             7      AND 00FH
000C2B D824 47               4      LD  B,A
000C2C D825 DD7E07          19      LD  A,(IX+7)    ;DPB_07_SECPCL
000C2F D828 C9              10      RET
                                
       D829                     _SYS1D:     ;(BDOS)書き込みが禁止されているディスクの調査
000C30 D829 AF               4      XOR A
000C31 D82A 67               4      LD  H,A
000C32 D82B 6F               4      LD  L,A
000C33 D82C C9              10      RET
                                
       D82D                     _SYS1F:     ;(BDOS)ディスク装置のパラメータの読み出し
000C34 D82D 2100F1          10      LD  HL,DEVICE
000C37 D830 7B               4      LD  A,E
000C38 D831 C3DCEF          10      JP  _GETDPB
                                
       D834                     _SYS23:     ;(BDOS)ファイルサイズの獲得
000C3B D834 E5              11      PUSH    HL
000C3C D835 2A1EF0          16      LD  HL,(STABLE+2*00FH)  ;ファイルのオープン
000C3F D838 CD0F00          17      CALL    JP_HL
000C42 D83B 381B            12      JR  C,_S23X1
                                
000C44 D83D D5              11      PUSH    DE      ;EX DE,IY
000C45 D83E FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C47 D840 FD7E10          19      LD  A,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
000C4A D843 FD6E11          19      LD  L,(IY+17)   ;
000C4D D846 FD6612          19      LD  H,(IY+18)   ;
000C50 D849 C5              11      PUSH    BC      ;
000C51 D84A FD4613          19      LD  B,(IY+19)   ;
000C54 D84D CD8AE3          17      CALL    GET_CPM_R_SIZE
000C57 D850 C1              10      POP BC
       D851                     _S24X1:
000C58 D851 CDAAE3          17      CALL    SET_RR_AHL
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000C5B D854 FDE3            23      EX  (SP),IY     ;
000C5D D856 D1              10      POP DE      ;
                                
000C5E D857 AF               4      XOR A
       D858                     _S23X1:
000C5F D858 E1              10      POP HL
000C60 D859 C9              10      RET
                                
       D85A                     _SYS24:     ;(BDOS)ランダムレコードフィールドの設定
000C61 D85A E5              11      PUSH    HL
000C62 D85B D5              11      PUSH    DE      ;EX DE,IY
000C63 D85C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000C65 D85E CDBCE3          17      CALL    GETSEQ
000C68 D861 18EE            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       D863                     _SYS5C:     ;(BDOS)ファイル名の解析
000C6A D863 C5              11      PUSH    BC
000C6B D864 E5              11      PUSH    HL
000C6C D865 CD19DE          17      CALL    FILE
000C6F D868 E1              10      POP HL
000C70 D869 C1              10      POP BC
       D86A                     S29X1:
000C71 D86A C5              11      PUSH    BC
000C72 D86B D5              11      PUSH    DE
000C73 D86C E5              11      PUSH    HL
000C74 D86D EB               4      EX  DE,HL
000C75 D86E 2114EF          10      LD  HL,FDRV
000C78 D871 010D00          10      LD  BC,13
000C7B D874 EDB0                    LDIR
000C7D D876 70               7      LD  (HL),B      ;B=0
000C7E D877 0E03             7      LD  C,3
000C80 D879 EDB0                    LDIR
000C82 D87B E1              10      POP HL
000C83 D87C D1              10      POP DE
000C84 D87D C1              10      POP BC
000C85 D87E AF               4      XOR A
000C86 D87F C9              10      RET
                                
       D880                     _SYS30:     ;(BDOS)論理セクタを用いた書き込み
000C87 D880 C5              11      PUSH    BC
000C88 D881 0103EA          10      LD  BC,DWT24B
000C8B D884 1804            12      JR  S2FX
       D886                     _SYS2F:
000C8D D886 C5              11      PUSH    BC
000C8E D887 01F3E9          10      LD  BC,DRD24B
       D88A                     S2FX:
000C91 D88A ED43A0D8        20      LD  (S2FPAT+1),BC
000C95 D88E CDDFEF          17      CALL    _FFLUSH
                                
000C98 D891 D5              11      PUSH    DE
000C99 D892 E5              11      PUSH    HL
000C9A D893 7D               4      LD  A,L     ;Drive
000C9B D894 CDD9EF          17      CALL    _CHGDRV
000C9E D897 3809            12      JR  C,S30X2
000CA0 D899 44               4      LD  B,H     ;Number of clusters
000CA1 D89A 2A8AEF          16      LD  HL,(_DTA)
                                
000CA4 D89D 0E00             7      LD  C,0
000CA6 D89F CDF3E9          17  S2FPAT: CALL    DRD24B
       D8A2                     S30X2:
000CA9 D8A2 E1              10      POP HL
000CAA D8A3 D1              10      POP DE
000CAB D8A4 C1              10      POP BC
000CAC D8A5 9F               4      SBC A,A
000CAD D8A6 C9              10      RET
                                
       D8A7                     _SYS5A:     ;(BDOS)カレントディレクトリの変更
000CAE D8A7 C5              11      PUSH    BC
000CAF D8A8 D5              11      PUSH    DE
000CB0 D8A9 E5              11      PUSH    HL
000CB1 D8AA CD0EDE          17      CALL    FILEC
000CB4 D8AD 210000          10      LD  HL,0
000CB7 D8B0 1114EF          10      LD  DE,FDRV
000CBA D8B3 2A4EF0          16      LD  HL,(STABLE+2*027H)  ;ランダムブロック読み込み
000CBD D8B6 CD0F00          17      CALL    JP_HL
000CC0 D8B9 18E7            12      JR  S30X2
[EOF:LDOS.ASM:SHIFT_JIS]
                                    INCLUDE "88IO.ASM"
                                
                                ;   LSX-Dodgers IO
                                ;   PC-8801mkIISR
                                
       D621                     _SYS04  EQU _ERROR      ;(BDOS)外部出力
       D621                     _SYS05  EQU _ERROR      ;(BDOS)プリンタ出力
       D621                     _SYS1C  EQU _ERROR      ;(BDOS)ディスクの書き込み禁止化
       D621                     _SYS1E  EQU _ERROR      ;(BDOS)ファイル属性の設定
       D621                     _SYS20  EQU _ERROR      ;(BDOS)利用者番号の設定と読み出し
       D621                     _SYS2E  EQU _ERROR      ;(BDOS)ベリファイ・フラグの設定
                                
       0000                     INT EQU 0
       0000                     INTCTCE EQU 0
       0000                     INTCTC2 EQU 0
                                
       D8BB                     BDOS_RF:
000CC2 D8BB DB32            11      IN  A,(032H)
000CC4 D8BD F610             7      OR  010H        ;高速RAMアクセスモードOFF
000CC6 D8BF D332            11      OUT (032H),A
000CC8 D8C1 C3F1D5          10      JP  BDOS0
                                
       D8C4                     INTVRTC:
000CCB D8C4 F3               4      DI
000CCC D8C5 F5              11      PUSH    AF
000CCD D8C6 CD1EDD          17      CALL    CHKEY
       D8CA                     KEYDT   EQU $+1
000CD0 D8C9 FE00             7      CP  0
000CD2 D8CB 201F            12      JR  NZ,SETKEY1
       D8CE                     KEYAR   EQU $+1
000CD4 D8CD 3E00             7      LD  A,0
000CD6 D8CF B7               4      OR  A
000CD7 D8D0 2014            12      JR  NZ,ARWKEY
       D8D2                     SETKEY:
000CD9 D8D2 32CED8          13      LD  (KEYAR),A
000CDC D8D5 3A92EF          13      LD  A,(_KEYD)
000CDF D8D8 32CAD8          13      LD  (KEYDT),A
000CE2 D8DB CDF9D8          17      CALL    KEYSET
       D8DE                     ENDKEY:
000CE5 D8DE 3AB7EF          13      LD  A,(WKE4)
000CE8 D8E1 D3E4            11      OUT (0E4H),A
000CEA D8E3 F1              10      POP AF
000CEB D8E4 FB               4      EI
000CEC D8E5 C9              10      RET
       D8E6                     ARWKEY:
000CED D8E6 3D               4      DEC A
000CEE D8E7 32CED8          13      LD  (KEYAR),A
000CF1 D8EA 18F2            12      JR  ENDKEY
       D8EC                     SETKEY1:
000CF3 D8EC 3A95EF          13      LD  A,(_KEYSP+1)
000CF6 D8EF 18E1            12      JR  SETKEY
                                
       D8F1                     INTE88:
000CF8 D8F1 F5              11      PUSH    AF
000CF9 D8F2 3AB7EF          13      LD  A,(WKE4)
000CFC D8F5 D3E4            11      OUT (0E4H),A
000CFE D8F7 F1              10      POP AF
000CFF D8F8 C9              10      RET
       D8F9                     KEYSET:
       D8F9                     KEYBS:
000D00 D8F9 B7               4      OR  A
000D01 D8FA C8              11      RET Z
       D8FB                     KEYBS1:
000D02 D8FB CD11D9          17      CALL    KEYBC_IFBREAK
000D05 D8FE E5              11      PUSH    HL
000D06 D8FF F5              11      PUSH    AF
000D07 D900 2A90EF          16      LD  HL,(_KEYPS)
000D0A D903 2C               4      INC L
000D0B D904 7D               4      LD  A,L
000D0C D905 BC               4      CP  H
000D0D D906 2815            12      JR  Z,POP_AF_HL_SCF_RET
000D0F D908 3290EF          13      LD  (_KEYPS),A
000D12 D90B 26FE             7      LD  H,KEYBF/256
000D14 D90D F1              10      POP AF
000D15 D90E 77               7      LD  (HL),A
000D16 D90F E1              10      POP HL
000D17 D910 C9              10      RET
       D911                     KEYBC_IFBREAK:
000D18 D911 FE03             7      CP  3
000D1A D913 C0              11      RET NZ
       D914                     KEYBC:
000D1B D914 E5              11      PUSH    HL
000D1C D915 210000          10      LD  HL,0
000D1F D918 2290EF          16      LD  (_KEYPS),HL
000D22 D91B E1              10      POP HL
000D23 D91C C9              10      RET
                                
       D91D                     POP_AF_HL_SCF_RET:
000D24 D91D F1              10      POP AF
000D25 D91E E1              10      POP HL
000D26 D91F 37               4      SCF
000D27 D920 C9              10      RET
                                
       D921                     _SYS01:     ;(BDOS)コンソール入力
000D28 D921 CD09EF          17      CALL    _SYS07
       D924                     MSG_A:
000D2B D924 F5              11      PUSH    AF
000D2C D925 D5              11      PUSH    DE
000D2D D926 5F               4      LD  E,A
000D2E D927 CD2DD9          17      CALL    _SYS02
000D31 D92A D1              10      POP DE
000D32 D92B F1              10      POP AF
000D33 D92C C9              10      RET
                                
       D92D                     _SYS02:     ;(BDOS)コンソール出力
000D34 D92D CD3FD9          17      CALL    BREAK
000D37 D930 1805            12      JR  PRINTX
                                
       D932                     _SYS06:     ;(BDOS)コンソール直接入出力
000D39 D932 7B               4      LD  A,E
000D3A D933 3C               4      INC A
000D3B D934 CACAEF          10      JP  Z,_INKEY
       D937                     PRINTX:
000D3E D937 C3CDEF          10      JP  _PRINT
                                
       D93A                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D41 D93A CD09EF          17      CALL    _SYS07
000D44 D93D 1804            12      JR  BREAK1
       D93F                     BREAK:
000D46 D93F FB               4      EI
000D47 D940 3A92EF          13      LD  A,(_KEYD)
       D943                     BREAK1:
000D4A D943 FE03             7      CP  3       ;CTRL+C
000D4C D945 CA00EF          10      JP  Z,CPM_BOOT
000D4F D948 FE13             7      CP  013H        ;CTRL+S
000D51 D94A C0              11      RET NZ
                                
       D94B                     PAUSE:
000D52 D94B CD14D9          17      CALL    KEYBC
                                
       D94E                     FLGET:
000D55 D94E CDDFEF          17      CALL    _FFLUSH
000D58 D951 E5              11      PUSH    HL
000D59 D952 2A8EEF          16      LD  HL,(_TXADR)
000D5C D955 CDDFDB          17      CALL    CURSOR_ON
       D958                     FLGET1:
000D5F D958 CDCAEF          17      CALL    _INKEY
000D62 D95B 28FB            12      JR  Z,FLGET1
000D64 D95D CDF0DB          17      CALL    CURSOR_OFF
000D67 D960 E1              10      POP HL
000D68 D961 C9              10      RET
                                
       D962                     _SYS0A:     ;(BDOS)文字列入力
000D69 D962 C5              11      PUSH    BC
000D6A D963 E5              11      PUSH    HL
000D6B D964 D5              11      PUSH    DE
000D6C D965 CDAFDC          17      CALL    GETL
000D6F D968 1100FF          10      LD  DE,KBUF
000D72 D96B E1              10      POP HL
000D73 D96C E5              11      PUSH    HL
000D74 D96D 0E00             7      LD  C,0
000D76 D96F 3004            12      JR  NC,SAX0
000D78 D971 23               6      INC HL
000D79 D972 23               6      INC HL
000D7A D973 1808            12      JR  SAX4
       D975                     SAX0:
000D7C D975 46               7      LD  B,(HL)
000D7D D976 23               6      INC HL
       D977                     SAX1:
000D7E D977 23               6      INC HL
000D7F D978 1A               7      LD  A,(DE)
000D80 D979 13               6      INC DE
000D81 D97A B7               4      OR  A
000D82 D97B 2004            12      JR  NZ,SAX2
       D97D                     SAX4:
000D84 D97D 360D            10      LD  (HL),00DH
000D86 D97F 1804            12      JR  SAX3
       D981                     SAX2:
000D88 D981 77               7      LD  (HL),A
000D89 D982 0C               4      INC C
000D8A D983 10F2            13      DJNZ    SAX1
       D985                     SAX3:
000D8C D985 D1              10      POP DE
000D8D D986 79               4      LD  A,C
000D8E D987 13               6      INC DE
000D8F D988 12               7      LD  (DE),A
000D90 D989 1B               6      DEC DE
000D91 D98A E1              10      POP HL
000D92 D98B C1              10      POP BC
000D93 D98C A7               4      AND A
000D94 D98D C9              10      RET
                                
       D98E                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000D95 D98E CD3FD9          17      CALL    BREAK
000D98 D991 3A92EF          13      LD  A,(_KEYD)
000D9B D994 B7               4      OR  A
000D9C D995 C8              11      RET Z
       D996                     CONSTX:
000D9D D996 CDDFEF          17      CALL    _FFLUSH
000DA0 D999 E5              11      PUSH    HL
000DA1 D99A 2A90EF          16      LD  HL,(_KEYPS)
000DA4 D99D 7C               4      LD  A,H
000DA5 D99E AD               4      XOR L
000DA6 D99F E1              10      POP HL
000DA7 D9A0 C6FF             7      ADD A,0FFH
000DA9 D9A2 9F               4      SBC A,A
000DAA D9A3 C9              10      RET
                                
       D9A4                     _SYS2A:     ;(BDOS)日付の獲得
000DAB D9A4 C5              11      PUSH    BC
000DAC D9A5 CDE4D9          17      CALL    RTCREAD
000DAF D9A8 3A62EF          13      LD  A,(RTC_YY)
000DB2 D9AB CD47DA          17      CALL    BCD
000DB5 D9AE 6F               4      LD  L,A
000DB6 D9AF 2600             7      LD  H,0
                                ;   LD  DE,1900     ;0076CH
                                ;   CP  90      ;90以上は1900年代 1990-1999
                                ;   JR  NC,RDDATE1  ;90未満は2000年代 2000-2089
                                ;   LD  E,0D0H      ;2000 & 0FFH D=007H
000DB8 D9B1 11D007          10      LD  DE,2000     ;すべて2000年代で処理 2000-2099
       D9B4                     RDDATE1:
000DBB D9B4 19              11      ADD HL,DE
000DBC D9B5 3A63EF          13      LD  A,(RTC_MW)
000DBF D9B8 57               4      LD  D,A
000DC0 D9B9 3A64EF          13      LD  A,(RTC_DD)
000DC3 D9BC CD47DA          17      CALL    BCD
000DC6 D9BF 5F               4      LD  E,A
000DC7 D9C0 7A               4      LD  A,D
000DC8 D9C1 0604             7      LD  B,4
       D9C3                     RDDATE2:
000DCA D9C3 CB3A             8      SRL D
000DCC D9C5 10FC            13      DJNZ    RDDATE2
000DCE D9C7 C1              10      POP BC
000DCF D9C8 E607             7      AND 7
000DD1 D9CA C9              10      RET
                                
       D9CB                     _SYS2C:     ;(BDOS)時刻の獲得
000DD2 D9CB C5              11      PUSH    BC
000DD3 D9CC CDE4D9          17      CALL    RTCREAD
000DD6 D9CF 3A65EF          13      LD  A,(RTC_TT)
000DD9 D9D2 CD47DA          17      CALL    BCD
000DDC D9D5 67               4      LD  H,A
000DDD D9D6 3A66EF          13      LD  A,(RTC_MM)
000DE0 D9D9 CD47DA          17      CALL    BCD
000DE3 D9DC 6F               4      LD  L,A
000DE4 D9DD 3A67EF          13      LD  A,(RTC_SS)
000DE7 D9E0 57               4      LD  D,A
000DE8 D9E1 C1              10      POP BC
000DE9 D9E2 AF               4      XOR A
000DEA D9E3 C9              10      RET
                                
       D9E4                     RTCREAD:
000DEB D9E4 0EF9             7      LD  C,0F9H
000DED D9E6 3AB9EF          13      LD  A,(WK40)
000DF0 D9E9 5F               4      LD  E,A
000DF1 D9EA 3E03             7      LD  A,3     ;コマンド３：タイムリードにセット
000DF3 D9EC CD16DA          17      CALL    RTCCMD
000DF6 D9EF 3E01             7      LD  A,1     ;コマンド１：レジスタシフトにセット
000DF8 D9F1 CD16DA          17      CALL    RTCCMD
000DFB D9F4 0606             7      LD  B,6
000DFD D9F6 2167EF          10      LD  HL,RTC_SS
       D9F9                     RTCREAD1:
000E00 D9F9 C5              11      PUSH    BC
000E01 D9FA 0608             7      LD  B,8
       D9FC                     RTCREAD2:
000E03 D9FC DB40            11      IN  A,(40H)     ;システムモードセンス BIT4:CDI
000E05 D9FE 87               4      ADD A,A
000E06 D9FF 87               4      ADD A,A
000E07 DA00 87               4      ADD A,A
000E08 DA01 87               4      ADD A,A
000E09 DA02 CB1E            15      RR  (HL)
000E0B DA04 CD3BDA          17      CALL    RTCCLK
000E0E DA07 10F3            13      DJNZ    RTCREAD2
000E10 DA09 C1              10      POP BC
000E11 DA0A 2B               6      DEC HL
000E12 DA0B 10EC            13      DJNZ    RTCREAD1
000E14 DA0D AF               4      XOR A
000E15 DA0E CD16DA          17      CALL    RTCCMD
000E18 DA11 7B               4      LD  A,E
000E19 DA12 32B9EF          13      LD  (WK40),A
000E1C DA15 C9              10      RET
                                
       DA16                     RTCCMD:
000E1D DA16 0604             7      LD  B,4
000E1F DA18 07               4      RLCA
000E20 DA19 07               4      RLCA
000E21 DA1A 07               4      RLCA
       DA1B                     RTCCMD1:
000E22 DA1B F5              11      PUSH    AF
000E23 DA1C F607             7      OR  7
000E25 DA1E D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E27 DA20 CD3BDA          17      CALL    RTCCLK
000E2A DA23 F1              10      POP AF
000E2B DA24 0F               4      RRCA
000E2C DA25 10F4            13      DJNZ    RTCCMD1
000E2E DA27 3E07             7      LD  A,7
000E30 DA29 D310            11      OUT (10H),A     ;プリンタデータ出力 兼 カレンダクロック(μPD1990AC)出力
000E32 DA2B 7B               4      LD  A,E
000E33 DA2C A1               4      AND C
000E34 DA2D F602             7      OR  2
000E36 DA2F D340            11      OUT (40H),A     ;ストローブポート
000E38 DA31 A1               4      AND C
000E39 DA32 00               4      NOP
000E3A DA33 D340            11      OUT (40H),A     ;ストローブポート
000E3C DA35 5F               4      LD  E,A
000E3D DA36 060D             7      LD  B,13
       DA38                     RTCCMD3:
000E3F DA38 10FE            13      DJNZ    RTCCMD3
000E41 DA3A C9              10      RET
                                
       DA3B                     RTCCLK:
000E42 DA3B 7B               4      LD  A,E
000E43 DA3C A1               4      AND C
000E44 DA3D F604             7      OR  04H
000E46 DA3F D340            11      OUT (40H),A
000E48 DA41 A1               4      AND C
000E49 DA42 00               4      NOP
000E4A DA43 D340            11      OUT (40H),A
000E4C DA45 5F               4      LD  E,A
000E4D DA46 C9              10      RET
                                
                                ;------------------------
                                ;BCDの10進数化
                                ;in
                                ;   A  : BCD
                                ;out
                                ;   A  : 10進数
                                ;------------------------
       DA47                     BCD:
000E4E DA47 4F               4      LD  C,A
000E4F DA48 E6F0             7      AND 0F0H    ;10の位
000E51 DA4A 0F               4      RRCA
000E52 DA4B 47               4      LD  B,A
000E53 DA4C 0F               4      RRCA
000E54 DA4D 0F               4      RRCA
000E55 DA4E 80               4      ADD A,B
000E56 DA4F 47               4      LD  B,A
000E57 DA50 79               4      LD  A,C
000E58 DA51 E60F             7      AND 00FH    ;1の位
000E5A DA53 80               4      ADD A,B
000E5B DA54 C9              10      RET
                                
       DA55                     ESC1:
000E5C DA55 7B               4      LD  A,E
000E5D DA56 FE41             7      CP  'A'
000E5F DA58 CA3ADB          10      JP  Z,CTRL1E
000E62 DA5B FE42             7      CP  'B'
000E64 DA5D CA59DC          10      JP  Z,CTRL1F
000E67 DA60 FE43             7      CP  'C'
000E69 DA62 CA00DB          10      JP  Z,CTRL1C
000E6C DA65 FE44             7      CP  'D'
000E6E DA67 CA25DB          10      JP  Z,CTRL1D
000E71 DA6A FE45             7      CP  'E'
000E73 DA6C 2802            12      JR  Z,CT0CX
000E75 DA6E FE6A             7      CP  'j'
       DA70                     CT0CX:
000E77 DA70 CA26DC          10      JP  Z,CTRL0C
000E7A DA73 FE48             7      CP  'H'
000E7C DA75 CAA5DB          10      JP  Z,CTRL0B
000E7F DA78 FE4A             7      CP  'J'
000E81 DA7A CA29DC          10      JP  Z,CTRL06
000E84 DA7D FE4B             7      CP  'K'
000E86 DA7F CA79DB          10      JP  Z,CTRL05
000E89 DA82 FE4C             7      CP  'L'
000E8B DA84 CA60DC          10      JP  Z,CTRL0E
000E8E DA87 FE54             7      CP  'T'
000E90 DA89 CA79DB          10      JP  Z,CTRL05
000E93 DA8C FE78             7      CP  'x'
000E95 DA8E 2804            12      JR  Z,ESC1X
000E97 DA90 FE79             7      CP  'y'
000E99 DA92 2002            12      JR  NZ,ESC1Y
       DA94                     ESC1X:
000E9B DA94 3601            10      LD  (HL),1
       DA96                     ESC1Y:
000E9D DA96 FE3D             7      CP  '='
000E9F DA98 2804            12      JR  Z,ESC1W
000EA1 DA9A FE59             7      CP  'Y'
000EA3 DA9C 2002            12      JR  NZ,ESC1Z
       DA9E                     ESC1W:
000EA5 DA9E 3602            10      LD  (HL),2
       DAA0                     ESC1Z:
000EA7 DAA0 FE20             7      CP  020H
000EA9 DAA2 3802            12      JR  C,ESC1C
000EAB DAA4 87               4      ADD A,A
000EAC DAA5 D0              11      RET NC
       DAA6                     ESC1C:
000EAD DAA6 E1              10      POP HL
000EAE DAA7 1832            12      JR  ANK
                                
       DAA9                     ESC:
000EB0 DAA9 21ECDA          10      LD  HL,PRINTE5
000EB3 DAAC E5              11      PUSH    HL
000EB4 DAAD 21CFDA          10      LD  HL,ESCFLG
000EB7 DAB0 3600            10      LD  (HL),0
000EB9 DAB2 3D               4      DEC A
000EBA DAB3 28A0            12      JR  Z,ESC1
000EBC DAB5 3D               4      DEC A
000EBD DAB6 2009            12      JR  NZ,ESC2
000EBF DAB8 3603            10      LD  (HL),3
000EC1 DABA 7B               4      LD  A,E
000EC2 DABB D620             7      SUB 020H
000EC4 DABD 32C4DA          13      LD  (ESCYP+1),A
000EC7 DAC0 C9              10      RET
       DAC1                     ESC2:
000EC8 DAC1 3D               4      DEC A
000EC9 DAC2 C0              11      RET NZ
000ECA DAC3 2600             7  ESCYP:  LD  H,0
000ECC DAC5 7B               4      LD  A,E
000ECD DAC6 D620             7      SUB 020H
000ECF DAC8 6F               4      LD  L,A
000ED0 DAC9 C3D6EF          10      JP  _LOC
                                
       DACC                     PRINT:
000ED3 DACC C5              11      PUSH    BC
000ED4 DACD E5              11      PUSH    HL
       DACF                     ESCFLG  EQU $+1
000ED5 DACE 3E00             7      LD  A,000H      ;自己書き換え
000ED7 DAD0 B7               4      OR  A
000ED8 DAD1 20D6            12      JR  NZ,ESC
                                
000EDA DAD3 3E1F             7      LD  A,01FH
000EDC DAD5 BB               4      CP  E
000EDD DAD6 3018            12      JR  NC,CTRL
       DAD8                     INSFLG  EQU $
000EDF DAD8 0108DC          10      LD  BC,INSERT   ;自己書き換え
       DADB                     ANK:
000EE2 DADB CDB2DB          17      CALL    LOC0
000EE5 DADE DB32            11      IN  A,(032H)
000EE7 DAE0 F5              11      PUSH    AF
000EE8 DAE1 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000EEA DAE3 D332            11      OUT (032H),A
000EEC DAE5 73               7      LD  (HL),E
000EED DAE6 F1              10      POP AF
000EEE DAE7 D332            11      OUT (032H),A
000EF0 DAE9 CD00DB          17      CALL    CTRL1C
       DAEC                     PRINTE5:
000EF3 DAEC E1              10      POP HL
000EF4 DAED C1              10      POP BC
000EF5 DAEE AF               4      XOR A
000EF6 DAEF C9              10      RET
                                
       DAF0                     CTRL:
000EF7 DAF0 7B               4      LD  A,E
000EF8 DAF1 87               4      ADD A,A
000EF9 DAF2 F680             7      OR  080H
000EFB DAF4 6F               4      LD  L,A
000EFC DAF5 26F0             7      LD  H,CTRLTB/256
000EFE DAF7 7E               7      LD  A,(HL)
000EFF DAF8 2C               4      INC L
000F00 DAF9 66               7      LD  H,(HL)
000F01 DAFA 6F               4      LD  L,A
000F02 DAFB CD0F00          17      CALL    JP_HL
000F05 DAFE 18EC            12      JR  PRINTE5
                                
       DB00                     CTRL1C:
000F07 DB00 2A8EEF          16      LD  HL,(_TXADR)
000F0A DB03 2C               4      INC L
       DB04                     PRINTE3:
000F0B DB04 3AB1EF          13      LD  A,(_WIDTH)
000F0E DB07 3D               4      DEC A
000F0F DB08 BD               4      CP  L
000F10 DB09 3009            12      JR  NC,SET_TXADR_HL
000F12 DB0B 2E00             7      LD  L,0
000F14 DB0D 24               4      INC H
       DB0E                     PRINTE8:
000F15 DB0E 3A97EF          13      LD  A,(_LINE)
000F18 DB11 BC               4      CP  H
000F19 DB12 2804            12      JR  Z,PRINT2
       DB14                     LOC:
       DB14                     SET_TXADR_HL:
000F1B DB14 228EEF          16      LD  (_TXADR),HL
       DB17                     CTRL00:
000F1E DB17 C9              10      RET
                                
       DB18                     PRINT2:
000F1F DB18 CD66DC          17      CALL    SCR
000F22 DB1B 25               4      DEC H
000F23 DB1C 18F6            12      JR  SET_TXADR_HL
                                
       DB1E                     CTRL08:
000F25 DB1E 3AD8DA          13      LD  A,(INSFLG)
000F28 DB21 FECD             7      CP  0CDH        ;CALL ????
000F2A DB23 2829            12      JR  Z,CTRL02
       DB25                     CTRL1D:
000F2C DB25 2A8EEF          16      LD  HL,(_TXADR)
000F2F DB28 7C               4      LD  A,H
000F30 DB29 B5               4      OR  L
000F31 DB2A C8              11      RET Z
000F32 DB2B 7D               4      LD  A,L
000F33 DB2C B7               4      OR  A
000F34 DB2D 2803            12      JR  Z,CTRL1DX1
000F36 DB2F 2D               4      DEC L
000F37 DB30 18E2            12      JR  SET_TXADR_HL
       DB32                     CTRL1DX1:
000F39 DB32 3AB1EF          13      LD  A,(_WIDTH)
000F3C DB35 3D               4      DEC A
000F3D DB36 6F               4      LD  L,A
000F3E DB37 25               4      DEC H
000F3F DB38 18DA            12      JR  SET_TXADR_HL
       DB3A                     CTRL1E:
000F41 DB3A 2A8EEF          16      LD  HL,(_TXADR)
000F44 DB3D 7C               4      LD  A,H
000F45 DB3E B7               4      OR  A
000F46 DB3F C8              11      RET Z
000F47 DB40 25               4      DEC H
000F48 DB41 18D1            12      JR  SET_TXADR_HL
                                
       DB43                     CTRL09:
000F4A DB43 2A8EEF          16      LD  HL,(_TXADR)
000F4D DB46 7D               4      LD  A,L
000F4E DB47 E6F8             7      AND 0F8H
000F50 DB49 C608             7      ADD A,8
000F52 DB4B 6F               4      LD  L,A
000F53 DB4C 18B6            12      JR  PRINTE3
                                
       DB4E                     CTRL02:
000F55 DB4E 3A8EEF          13      LD  A,(_TXADR)
000F58 DB51 B7               4      OR  A
000F59 DB52 28D1            12      JR  Z,CTRL1D
000F5B DB54 CD25DB          17      CALL    CTRL1D
000F5E DB57 2A8EEF          16      LD  HL,(_TXADR)
000F61 DB5A 3AB1EF          13      LD  A,(_WIDTH)
000F64 DB5D 4F               4      LD  C,A
000F65 DB5E 95               4      SUB L
000F66 DB5F 47               4      LD  B,A
000F67 DB60 79               4      LD  A,C
000F68 DB61 3D               4      DEC A
000F69 DB62 6F               4      LD  L,A
000F6A DB63 CDB5DB          17      CALL    LOC1
                                
000F6D DB66 DB32            11      IN  A,(032H)
000F6F DB68 F5              11      PUSH    AF
000F70 DB69 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F72 DB6B D332            11      OUT (032H),A
                                
000F74 DB6D 3E20             7      LD  A,020H
       DB6F                     C8X1:
000F76 DB6F 4E               7      LD  C,(HL)
000F77 DB70 77               7      LD  (HL),A
000F78 DB71 2B               6      DEC HL
000F79 DB72 79               4      LD  A,C
000F7A DB73 10FA            13      DJNZ    C8X1
                                
000F7C DB75 F1              10      POP AF
000F7D DB76 D332            11      OUT (032H),A
000F7F DB78 C9              10      RET
                                
       DB79                     CTRL05:
000F80 DB79 CDD3EF          17      CALL    _POS
000F83 DB7C 2A8EEF          16      LD  HL,(_TXADR)
000F86 DB7F 3AB1EF          13      LD  A,(_WIDTH)
000F89 DB82 95               4      SUB L
000F8A DB83 47               4      LD  B,A
000F8B DB84 CDB2DB          17      CALL    LOC0
       DB87                     CLLINE:
000F8E DB87 DB32            11      IN  A,(032H)
000F90 DB89 F5              11      PUSH    AF
000F91 DB8A E6EF             7      AND 0EFH        ;高速RAMアクセスモード
000F93 DB8C D332            11      OUT (032H),A
000F95 DB8E 3E20             7      LD  A,020H
       DB90                     CLLINE1:
000F97 DB90 77               7      LD  (HL),A
000F98 DB91 23               6      INC HL
000F99 DB92 10FC            13      DJNZ    CLLINE1
                                
000F9B DB94 F1              10      POP AF
000F9C DB95 D332            11      OUT (032H),A
000F9E DB97 C9              10      RET
                                
       DB98                     CTRL0D:
000F9F DB98 AF               4      XOR A
000FA0 DB99 328EEF          13      LD  (_TXADR),A
000FA3 DB9C C9              10      RET
                                
       DB9D                     CTRL12:
000FA4 DB9D 21D8DA          10      LD  HL,INSFLG
000FA7 DBA0 7E               7      LD  A,(HL)
000FA8 DBA1 EECC             7      XOR 0CCH        ;CD:CALL ???? 1:LD BC,????
000FAA DBA3 77               7      LD  (HL),A
000FAB DBA4 C9              10      RET
                                
       DBA5                     CTRL0B:
000FAC DBA5 210000          10      LD  HL,0
000FAF DBA8 228EEF          16      LD  (_TXADR),HL
000FB2 DBAB C9              10      RET
                                
       DBAC                     CTRL1B:
000FB3 DBAC 3E01             7      LD  A,1
000FB5 DBAE 32CFDA          13      LD  (ESCFLG),A
000FB8 DBB1 C9              10      RET
       DBB2                     LOC0:
000FB9 DBB2 2A8EEF          16      LD  HL,(_TXADR)
       DBB5                     LOC1:
000FBC DBB5 D5              11      PUSH    DE
000FBD DBB6 E5              11      PUSH    HL
000FBE DBB7 6C               4      LD  L,H ;Y
000FBF DBB8 5C               4      LD  E,H
000FC0 DBB9 2600             7      LD  H,0
000FC2 DBBB 54               4      LD  D,H
000FC3 DBBC 29              11      ADD HL,HL   ;*2
000FC4 DBBD 29              11      ADD HL,HL   ;*4
000FC5 DBBE 29              11      ADD HL,HL   ;*8
000FC6 DBBF 29              11      ADD HL,HL   ;*16
000FC7 DBC0 ED52            15      SBC HL,DE   ;*15
000FC9 DBC2 29              11      ADD HL,HL   ;*30
000FCA DBC3 29              11      ADD HL,HL   ;*60
000FCB DBC4 29              11      ADD HL,HL   ;*120
000FCC DBC5 D1              10      POP DE
000FCD DBC6 1600             7      LD  D,0
000FCF DBC8 19              11      ADD HL,DE   ;X
000FD0 DBC9 ED5BB2EF        20      LD  DE,(TVRAMTOP)
000FD4 DBCD 19              11      ADD HL,DE
000FD5 DBCE D1              10      POP DE
000FD6 DBCF C9              10      RET
                                
       DBD0                     CONOUT1:
000FD7 DBD0 59               4      LD  E,C
000FD8 DBD1 CDCDEF          17      CALL    _PRINT
000FDB DBD4 7B               4      LD  A,E
000FDC DBD5 FE0A             7      CP  00AH
000FDE DBD7 2006            12      JR  NZ,CURSOR_ON
000FE0 DBD9 CD98DB          17      CALL    CTRL0D
000FE3 DBDC CD79DB          17      CALL    CTRL05
       DBDF                     CURSOR_ON:
000FE6 DBDF F5              11      PUSH    AF
000FE7 DBE0 3E81             7      LD  A,081H
       DBE2                     CURSOR0:
000FE9 DBE2 D351            11      OUT (051H),A
000FEB DBE4 3A8EEF          13      LD  A,(_TXADR)
000FEE DBE7 D350            11      OUT (050H),A
000FF0 DBE9 3A8FEF          13      LD  A,(_TXADR+1)
000FF3 DBEC D350            11      OUT (050H),A
000FF5 DBEE F1              10      POP AF
000FF6 DBEF C9              10      RET
       DBF0                     CURSOR_OFF:
000FF7 DBF0 F5              11      PUSH    AF
000FF8 DBF1 3E80             7      LD  A,080H
000FFA DBF3 18ED            12      JR  CURSOR0
                                
       DBF5                     CTRL07:
000FFC DBF5 3AB9EF          13      LD  A,(WK40)
000FFF DBF8 F5              11      PUSH    AF
001000 DBF9 F620             7      OR  20H
001002 DBFB D340            11      OUT (040H),A
001004 DBFD 0610             7      LD  B,16
       DBFF                     C07X1:
001006 DBFF CD70DD          17      CALL    VBLANK
001009 DC02 10FB            13      DJNZ    C07X1
00100B DC04 F1              10      POP AF
00100C DC05 D340            11      OUT (040H),A
00100E DC07 C9              10      RET
                                
       DC08                     INSERT:
00100F DC08 2A8EEF          16      LD  HL,(_TXADR)
001012 DC0B 3AB1EF          13      LD  A,(_WIDTH)
001015 DC0E 95               4      SUB L
001016 DC0F 47               4      LD  B,A
                                
001017 DC10 CDB2DB          17      CALL    LOC0
                                
00101A DC13 DB32            11      IN  A,(032H)
00101C DC15 F5              11      PUSH    AF
00101D DC16 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
00101F DC18 D332            11      OUT (032H),A
                                
001021 DC1A 3E20             7      LD  A,020H
       DC1C                     INS1:
001023 DC1C 4E               7      LD  C,(HL)
001024 DC1D 77               7      LD  (HL),A
001025 DC1E 79               4      LD  A,C
001026 DC1F 23               6      INC HL
001027 DC20 10FA            13      DJNZ    INS1
                                
001029 DC22 F1              10      POP AF
00102A DC23 D332            11      OUT (032H),A
00102C DC25 C9              10      RET
                                
       DC26                     CTRL0C:
00102D DC26 CDA5DB          17      CALL    CTRL0B
       DC29                     CTRL06:
001030 DC29 2A8EEF          16      LD  HL,(_TXADR)
       DC2C                     CLS1:
001033 DC2C DB32            11      IN  A,(032H)
001035 DC2E F5              11      PUSH    AF
001036 DC2F E6EF             7      AND 0EFH        ;高速RAMアクセスモード
001038 DC31 D332            11      OUT (032H),A
       DC33                     CLS2:
00103A DC33 E5              11      PUSH    HL
00103B DC34 3AB1EF          13      LD  A,(_WIDTH)
00103E DC37 95               4      SUB L
00103F DC38 47               4      LD  B,A
001040 DC39 CDB5DB          17      CALL    LOC1
001043 DC3C 3E20             7      LD  A,020H
       DC3E                     CLS3:
001045 DC3E 77               7      LD  (HL),A
001046 DC3F 23               6      INC HL
001047 DC40 10FC            13      DJNZ    CLS3
001049 DC42 E1              10      POP HL
00104A DC43 2E00             7      LD  L,0
00104C DC45 24               4      INC H
00104D DC46 3A97EF          13      LD  A,(_LINE)
001050 DC49 BC               4      CP  H
001051 DC4A 20E7            12      JR  NZ,CLS2
001053 DC4C F1              10      POP AF
001054 DC4D D332            11      OUT (032H),A
001056 DC4F C9              10      RET
                                
       DC50                     CTRL04:
001057 DC50 CDD3EF          17      CALL    _POS
00105A DC53 7D               4      LD  A,L
00105B DC54 B7               4      OR  A
00105C DC55 C8              11      RET Z
       DC56                     CTRL03:
00105D DC56 CD98DB          17      CALL    CTRL0D
       DC59                     CTRL0A:
       DC59                     CTRL1F:
001060 DC59 2A8EEF          16      LD  HL,(_TXADR)
001063 DC5C 24               4      INC H
001064 DC5D C30EDB          10      JP  PRINTE8
                                
       DC60                     CTRL0E:
001067 DC60 CDD3EF          17      CALL    _POS
00106A DC63 7C               4      LD  A,H
00106B DC64 1804            12      JR  SCR1
       DC66                     SCR:
00106D DC66 3A97EF          13      LD  A,(_LINE)
001070 DC69 3D               4      DEC A
       DC6A                     SCR1:
001071 DC6A C5              11      PUSH    BC
001072 DC6B D5              11      PUSH    DE
001073 DC6C E5              11      PUSH    HL
001074 DC6D F5              11      PUSH    AF
001075 DC6E 210000          10      LD  HL,0
001078 DC71 CDB5DB          17      CALL    LOC1
00107B DC74 EB               4      EX  DE,HL
00107C DC75 210001          10      LD  HL,0100H
00107F DC78 CDB5DB          17      CALL    LOC1
001082 DC7B C1              10      POP BC
001083 DC7C DB32            11      IN  A,(032H)
001085 DC7E F5              11      PUSH    AF
001086 DC7F E6EF             7      AND 0EFH        ;高速RAMアクセスモード
001088 DC81 D332            11      OUT (032H),A
00108A DC83 78               4      LD  A,B
00108B DC84 B7               4      OR  A
       DC85                     SCRUP1:
00108C DC85 2815            12      JR  Z,SCRCL
00108E DC87 E5              11      PUSH    HL
00108F DC88 D5              11      PUSH    DE
001090 DC89 0608             7      LD  B,8
001092 DC8B 5F               4      LD  E,A
001093 DC8C 210078          10      LD  HL,120*256
001096 DC8F 55               4      LD  D,L
       DC90                     SCRH2:
001097 DC90 29              11      ADD HL,HL
001098 DC91 3001            12      JR  NC,SCRH3
00109A DC93 19              11      ADD HL,DE
       DC94                     SCRH3:
00109B DC94 10FA            13      DJNZ    SCRH2
00109D DC96 4D               4      LD  C,L
00109E DC97 44               4      LD  B,H
00109F DC98 D1              10      POP DE
0010A0 DC99 E1              10      POP HL
0010A1 DC9A EDB0                    LDIR
                                
       DC9C                     SCRCL:
0010A3 DC9C F1              10      POP AF
0010A4 DC9D D332            11      OUT (032H),A
                                
0010A6 DC9F 3AB1EF          13      LD  A,(_WIDTH)
0010A9 DCA2 47               4      LD  B,A
0010AA DCA3 EB               4      EX  DE,HL
0010AB DCA4 CD87DB          17      CALL    CLLINE
0010AE DCA7 E1              10      POP HL
0010AF DCA8 D1              10      POP DE
0010B0 DCA9 C1              10      POP BC
0010B1 DCAA C9              10      RET
       DCAB                     POS:
0010B2 DCAB 2A8EEF          16      LD  HL,(_TXADR)
0010B5 DCAE C9              10      RET
                                
       DCAF                     GETL:
0010B6 DCAF CDD3EF          17      CALL    _POS
0010B9 DCB2 E5              11      PUSH    HL
0010BA DCB3 3ECD             7      LD  A,0CDH      ;CALL ????
0010BC DCB5 32D8DA          13      LD  (INSFLG),A
       DCB8                     GETL1:
0010BF DCB8 CD3AD9          17      CALL    _SYS08
0010C2 DCBB FE09             7      CP  9
0010C4 DCBD 2008            12      JR  NZ,GETL1V
0010C6 DCBF 2100FF          10      LD  HL,KBUF
0010C9 DCC2 CD32D6          17      CALL    MSX
0010CC DCC5 18F1            12      JR  GETL1
       DCC7                     GETL1V:
0010CE DCC7 5F               4      LD  E,A
0010CF DCC8 CDCDEF          17      CALL    _PRINT
                                
0010D2 DCCB 7B               4      LD  A,E
0010D3 DCCC FE0D             7      CP  00DH
0010D5 DCCE 20E8            12      JR  NZ,GETL1
0010D7 DCD0 3E01             7      LD  A,1     ;LD BC,????
0010D9 DCD2 32D8DA          13      LD  (INSFLG),A
0010DC DCD5 1100FF          10      LD  DE,KBUF
0010DF DCD8 3AB1EF          13      LD  A,(_WIDTH)
0010E2 DCDB 47               4      LD  B,A
0010E3 DCDC CDD2D3          17      CALL    ZERO_MEMORY_DE
                                
0010E6 DCDF D1              10      POP DE
0010E7 DCE0 CDD3EF          17      CALL    _POS
0010EA DCE3 6B               4      LD  L,E
0010EB DCE4 3AB1EF          13      LD  A,(_WIDTH)
0010EE DCE7 95               4      SUB L
0010EF DCE8 57               4      LD  D,A
0010F0 DCE9 CDB5DB          17      CALL    LOC1
0010F3 DCEC 4D               4      LD  C,L
0010F4 DCED 7C               4      LD  A,H
0010F5 DCEE F630             7      OR  030H
0010F7 DCF0 47               4      LD  B,A
0010F8 DCF1 5A               4      LD  E,D
0010F9 DCF2 2100FF          10      LD  HL,KBUF
       DCF5                     GETL2:
0010FC DCF5 CDD0EF          17      CALL    _SCRN
0010FF DCF8 03               6      INC BC
001100 DCF9 77               7      LD  (HL),A
001101 DCFA 23               6      INC HL
001102 DCFB 1D               4      DEC E
001103 DCFC 20F7            12      JR  NZ,GETL2
       DCFE                     GETL3:
001105 DCFE 2B               6      DEC HL
001106 DCFF 7E               7      LD  A,(HL)
001107 DD00 FE21             7      CP  021H
001109 DD02 D0              11      RET NC
00110A DD03 3600            10      LD  (HL),0
00110C DD05 15               4      DEC D
00110D DD06 20F6            12      JR  NZ,GETL3
00110F DD08 C9              10      RET
                                
       DD09                     INKEY:
001110 DD09 FB               4      EI
001111 DD0A E5              11      PUSH    HL
001112 DD0B 2A90EF          16      LD  HL,(_KEYPS)
001115 DD0E 7C               4      LD  A,H
001116 DD0F AD               4      XOR L
001117 DD10 2809            12      JR  Z,INKEY1
001119 DD12 7C               4      LD  A,H
00111A DD13 3C               4      INC A
00111B DD14 3291EF          13      LD  (_KEYPS+1),A
00111E DD17 6F               4      LD  L,A
00111F DD18 26FE             7      LD  H,KEYBF/256
001121 DD1A 7E               7      LD  A,(HL)
       DD1B                     INKEY1:
001122 DD1B E1              10      POP HL
001123 DD1C B7               4      OR  A
001124 DD1D C9              10      RET
                                
       DD1E                     CHKEY:
001125 DD1E C5              11      PUSH    BC
001126 DD1F DB08            11      IN  A,(8)       ;6:SHIFT,7:CTRL
001128 DD21 4F               4      LD  C,A
001129 DD22 3A0E00          13      LD  A,(00EH)
00112C DD25 CB5F             8      BIT 3,A
00112E DD27 2002            12      JR  NZ,CHKEYRSHIFT
001130 DD29 CBB1             8      RES 6,C
       DD2B                     CHKEYRSHIFT:
001132 DD2B 79               4      LD  A,C
001133 DD2C 3293EF          13      LD  (_KEYD+1),A
001136 DD2F E5              11      PUSH    HL
001137 DD30 0E00             7      LD  C,0
001139 DD32 2198ED          10      LD  HL,KEY_TABLE
00113C DD35 CB77             8      BIT 6,A
00113E DD37 2003            12      JR  NZ,CHKEY0
001140 DD39 2130EE          10      LD  HL,SHIFT_TABLE
       DD3C                     CHKEY0:
001143 DD3C CB7F             8      BIT 7,A
001145 DD3E 2003            12      JR  NZ,CHKEY1
001147 DD40 2198EE          10      LD  HL,CTRL_TABLE
       DD43                     CHKEY1:
00114A DD43 ED78            12      IN  A,(C)
00114C DD45 0608             7      LD  B,8
       DD47                     CHKEY2:
00114E DD47 0F               4      RRCA
00114F DD48 300B            12      JR  NC,CHKEY4
       DD4A                     CHKEY3:
001151 DD4A 23               6      INC HL
001152 DD4B 10FA            13      DJNZ    CHKEY2
001154 DD4D 0C               4      INC C
001155 DD4E 79               4      LD  A,C
001156 DD4F D60D             7      SUB 00DH
001158 DD51 20F0            12      JR  NZ,CHKEY1
00115A DD53 1804            12      JR  CHKEY5
       DD55                     CHKEY4:
00115C DD55 7E               7      LD  A,(HL)
00115D DD56 B7               4      OR  A
00115E DD57 28F1            12      JR  Z,CHKEY3
       DD59                     CHKEY5:
001160 DD59 E1              10      POP HL
001161 DD5A C1              10      POP BC
001162 DD5B B7               4      OR  A
001163 DD5C 3292EF          13      LD  (_KEYD),A
001166 DD5F C9              10      RET
                                
       DD60                     SCRN:
001167 DD60 E5              11      PUSH    HL
001168 DD61 DB32            11      IN  A,(032H)
00116A DD63 67               4      LD  H,A
00116B DD64 E6EF             7      AND 0EFH        ;高速RAMアクセスモード
00116D DD66 D332            11      OUT (032H),A
00116F DD68 0A               7      LD  A,(BC)
001170 DD69 6F               4      LD  L,A
001171 DD6A 7C               4      LD  A,H
001172 DD6B D332            11      OUT (032H),A
001174 DD6D 7D               4      LD  A,L
001175 DD6E E1              10      POP HL
001176 DD6F C9              10      RET
                                
       DD70                     VBLANK:
001177 DD70 F5              11      PUSH    AF
       DD71                     VBLANK0:
001178 DD71 DB40            11      IN  A,(040H)
00117A DD73 E620             7      AND 020H
00117C DD75 20FA            12      JR  NZ,VBLANK0
       DD77                     VBLANK1:
00117E DD77 DB40            11      IN  A,(040H)
001180 DD79 E620             7      AND 020H
001182 DD7B 28FA            12      JR  Z,VBLANK1
001184 DD7D F1              10      POP AF
001185 DD7E C9              10      RET
                                
       DD7F                     INIT_CRTC:
001186 DD7F 3E03             7      LD  A,3     ;80桁
001188 DD81 D330            11      OUT (030H),A
00118A DD83 32BEEF          13      LD  (WK30),A
                                
00118D DD86 3E22             7      LD  A,022H      ;25行 64K RAM
00118F DD88 D331            11      OUT (031H),A
001191 DD8A 32BFEF          13      LD  (WK31),A
                                
001194 DD8D 3EFF             7      LD  A,0FFH
001196 DD8F D3E4            11      OUT (0E4H),A    ;割り込みレベル設定
001198 DD91 32B7EF          13      LD  (WKE4),A
00119B DD94 3E00             7      LD  A,0
00119D DD96 D3E6            11      OUT (0E6H),A    ;割り込みマスク
                                
00119F DD98 3E19             7      LD  A,019H
0011A1 DD9A D340            11      OUT (040H),A    ;CRT I/F 同期ビットオン
0011A3 DD9C 32B9EF          13      LD  (WK40),A
0011A6 DD9F CD70DD          17      CALL    VBLANK
                                
0011A9 DDA2 AF               4      XOR A
0011AA DDA3 D351            11      OUT (051H),A    ;Reset CRTC
0011AC DDA5 3EA0             7      LD  A,0A0H
0011AE DDA7 D368            11      OUT (068H),A    ;DMAC: Mode Set(Reset)
0011B0 DDA9 21C8F3          10      LD  HL,0F3C8H
0011B3 DDAC 22B2EF          16      LD  (TVRAMTOP),HL
0011B6 DDAF 0E64             7      LD  C,064H
0011B8 DDB1 ED69            12      OUT (C),L       ;TVRAM LOW
0011BA DDB3 ED61            12      OUT (C),H       ;TVRAM HIGH
0011BC DDB5 21B78B          10      LD  HL,08000H+120*25-1
0011BF DDB8 0C               4      INC C       ;65H
0011C0 DDB9 ED69            12      OUT (C),L
0011C2 DDBB ED61            12      OUT (C),H
0011C4 DDBD 3ECE             7      LD  A,080H+80-2
0011C6 DDBF D350            11      OUT (050H),A
0011C8 DDC1 3E98             7      LD  A,080H+25-1
0011CA DDC3 D350            11      OUT (050H),A
0011CC DDC5 DB40            11      IN  A,(040H)
0011CE DDC7 CB4F             8      BIT 1,A
0011D0 DDC9 21DE67          10      LD  HL,067DEH
0011D3 DDCC 2003            12      JR  NZ,RESO1
0011D5 DDCE 21586F          10      LD  HL,06F58H
       DDD1                     RESO1:
0011D8 DDD1 0E50             7      LD  C,050H
0011DA DDD3 ED61            12      OUT (C),H
0011DC DDD5 ED69            12      OUT (C),L
                                
0011DE DDD7 3E53             7      LD  A,053H
0011E0 DDD9 D350            11      OUT (050H),A
                                
0011E2 DDDB 3E43             7      LD  A,043H
0011E4 DDDD D351            11      OUT (051H),A
                                
0011E6 DDDF 3EE4             7      LD  A,0E4H
0011E8 DDE1 D368            11      OUT (068H),A
                                
0011EA DDE3 3E20             7      LD  A,020H
0011EC DDE5 D351            11      OUT (051H),A
                                
0011EE DDE7 CD70DD          17      CALL    VBLANK
       DDEA                     IVBL1:
0011F1 DDEA DB40            11      IN  A,(040H)
0011F3 DDEC CB6F             8      BIT 5,A
0011F5 DDEE 20FA            12      JR  NZ,IVBL1
                                
0011F7 DDF0 3E11             7      LD  A,011H
0011F9 DDF2 D340            11      OUT (040H),A    ;CRT I/F 同期ビットオフ
0011FB DDF4 32B9EF          13      LD  (WK40),A
0011FE DDF7 C9              10      RET
                                
       DDF8                     BIOS:
0011FF DDF8 F3               4      DI
001200 DDF9 F5              11      PUSH    AF
001201 DDFA 3ABFEF          13      LD  A,(WK31)
001204 DDFD CB8F             8      RES 1,A
001206 DDFF D331            11      OUT (031H),A
001208 DE01 F1              10      POP AF
001209 DE02 CD33E4          17      CALL    JP_BC
00120C DE05 F5              11      PUSH    AF
00120D DE06 3ABFEF          13      LD  A,(WK31)
001210 DE09 D331            11      OUT (031H),A
001212 DE0B F1              10      POP AF
001213 DE0C FB               4      EI
001214 DE0D C9              10      RET
[EOF:88IO.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE.ASM"
                                
                                ;   LSX-Dodgers FILE
                                
       DE0E                     FILEC:
001215 DE0E CD19DE          17      CALL    FILE
       DE11                     FILEC2:
001218 DE11 3A15EF          13      LD  A,(FDRV+1)
00121B DE14 FE20             7      CP  020H
00121D DE16 C8              11      RET Z
00121E DE17 1839            12      JR  SETDIR1
                                
       DE19                     FILE:
001220 DE19 AF               4      XOR A
001221 DE1A 3214EF          13      LD  (FDRV),A
001224 DE1D 67               4      LD  H,A
001225 DE1E 6F               4      LD  L,A
001226 DE1F 2222EF          16      LD  (FDRV+14),HL
001229 DE22 CDF0DE          17      CALL    SPCUT
00122C DE25 CDD5DE          17      CALL    CCHK3
00122F DE28 2812            12      JR  Z,DEVI1
001231 DE2A 13               6      INC DE
001232 DE2B 1A               7      LD  A,(DE)
001233 DE2C 1B               6      DEC DE
001234 DE2D FE3A             7      CP  ':'
001236 DE2F 200B            12      JR  NZ,DEVI1
001238 DE31 1A               7      LD  A,(DE)      ;DRIVE
001239 DE32 CD25E1          17      CALL    CAP
00123C DE35 D640             7      SUB '@'
00123E DE37 13               6      INC DE
00123F DE38 13               6      INC DE
001240 DE39 3214EF          13      LD  (FDRV),A
       DE3C                     DEVI1:
001243 DE3C 1A               7      LD  A,(DE)
001244 DE3D D65C             7      SUB 05CH        ;\
001246 DE3F 2009            12      JR  NZ,NOROOT
001248 DE41 6F               4      LD  L,A     ;A=0でH=0のはずなのでHL=0
001249 DE42 222EEF          16      LD  (FDRV+26),HL
00124C DE45 2C               4      INC L
00124D DE46 2222EF          16      LD  (FDRV+14),HL
001250 DE49 13               6      INC DE
       DE4A                     NOROOT:
                                
       DE4A                     SETDIR:
001251 DE4A CD76DE          17      CALL    FILED
001254 DE4D 1A               7      LD  A,(DE)
001255 DE4E FE5C             7      CP  05CH        ;\
001257 DE50 C0              11      RET NZ
001258 DE51 13               6      INC DE
       DE52                     SETDIR1:
001259 DE52 3E10             7      LD  A,010H      ;Directory
00125B DE54 3221EF          13      LD  (FDRV+13),A
00125E DE57 D5              11      PUSH    DE
00125F DE58 1114EF          10      LD  DE,FDRV
001262 DE5B 2A1EF0          16      LD  HL,(STABLE+2*00FH)
001265 DE5E CD0F00          17      CALL    JP_HL
001268 DE61 D1              10      POP DE
001269 DE62 B7               4      OR  A
00126A DE63 C0              11      RET NZ
                                
00126B DE64 3A21EF          13      LD  A,(FDRV+13)
00126E DE67 CB67             8      BIT 4,A
001270 DE69 C8              11      RET Z
                                
001271 DE6A CDBDDE          17      CALL    FILEI
001274 DE6D 2A2EEF          16      LD  HL,(FDRV+26)
001277 DE70 23               6      INC HL
001278 DE71 2222EF          16      LD  (FDRV+14),HL
00127B DE74 18D4            12      JR  SETDIR
                                
       DE76                     FILED:
00127D DE76 CDBDDE          17      CALL    FILEI
001280 DE79 2115EF          10      LD  HL,FNAME
                                
001283 DE7C 0608             7      LD  B,8
       DE7E                     FILE2:
001285 DE7E CDCADE          17      CALL    CCHKF
001288 DE81 C8              11      RET Z
001289 DE82 FE2A             7      CP  '*'
00128B DE84 282E            12      JR  Z,FILE9
00128D DE86 FE2E             7      CP  '.'
00128F DE88 280C            12      JR  Z,FILE4
001291 DE8A 77               7      LD  (HL),A
001292 DE8B 23               6      INC HL
001293 DE8C 10F0            13      DJNZ    FILE2
                                
       DE8E                     FILE3:
001295 DE8E CDCADE          17      CALL    CCHKF
001298 DE91 C8              11      RET Z
001299 DE92 FE2E             7      CP  '.'
00129B DE94 20F8            12      JR  NZ,FILE3
                                
       DE96                     FILE4:
00129D DE96 211DEF          10      LD  HL,FNAME+8
0012A0 DE99 0603             7      LD  B,3
                                
       DE9B                     FILE4L:
0012A2 DE9B CDCADE          17      CALL    CCHKF
0012A5 DE9E C8              11      RET Z
0012A6 DE9F FE2E             7      CP  '.'
0012A8 DEA1 2008            12      JR  NZ,FILE12
0012AA DEA3 3215EF          13      LD  (FNAME),A   ;Parent directory(..)
0012AD DEA6 3216EF          13      LD  (FNAME+1),A
0012B0 DEA9 3E20             7      LD  A,020H
       DEAB                     FILE12:
0012B2 DEAB FE2A             7      CP  '*'
0012B4 DEAD 280A            12      JR  Z,FILE10
0012B6 DEAF 77               7      LD  (HL),A
0012B7 DEB0 23               6      INC HL
0012B8 DEB1 10E8            13      DJNZ    FILE4L
0012BA DEB3 C9              10      RET
                                
       DEB4                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0012BB DEB4 CDB9DE          17      CALL    FILE10
0012BE DEB7 18D5            12      JR  FILE3
                                
       DEB9                     FILE10:
0012C0 DEB9 3E3F             7      LD  A,'?'
0012C2 DEBB 1808            12      JR  FILL_MEMORY
       DEBD                     FILEI:              ;名前＋拡張子をスペースで初期化
0012C4 DEBD 3E20             7      LD  A,020H
0012C6 DEBF 01000B          10      LD  BC,11*256   ;C=0にしておく
0012C9 DEC2 2115EF          10      LD  HL,FNAME
       DEC5                     FILL_MEMORY:            ;HLからBバイトAで埋める
0012CC DEC5 77               7      LD  (HL),A
0012CD DEC6 23               6      INC HL
0012CE DEC7 10FC            13      DJNZ    FILL_MEMORY
0012D0 DEC9 C9              10      RET
                                
       DECA                     CCHKF:
0012D1 DECA 1A               7      LD  A,(DE)
0012D2 DECB CDD2DE          17      CALL    CCHK2
0012D5 DECE C8              11      RET Z
0012D6 DECF C33DE2          10      JP  FKAN
                                
       DED2                     CCHK2:
0012D9 DED2 0C               4      INC C
0012DA DED3 0D               4      DEC C
0012DB DED4 C0              11      RET NZ
       DED5                     CCHK3:              ;ZF=1 で使えない文字
0012DC DED5 FE2B             7      CP  '+'
0012DE DED7 C8              11      RET Z
0012DF DED8 FE2C             7      CP  ','
0012E1 DEDA C8              11      RET Z
0012E2 DEDB FE2F             7      CP  '/'
0012E4 DEDD C8              11      RET Z
0012E5 DEDE FE3A             7      CP  ':'
0012E7 DEE0 C8              11      RET Z
0012E8 DEE1 FE3B             7      CP  ';'
0012EA DEE3 C8              11      RET Z
0012EB DEE4 FE3D             7      CP  '='
0012ED DEE6 C8              11      RET Z
0012EE DEE7 FE5C             7      CP  05CH    ;\
0012F0 DEE9 C8              11      RET Z
0012F1 DEEA FE20             7      CP  020H
0012F3 DEEC D0              11      RET NC
0012F4 DEED BF               4      CP  A       ;Z=1
0012F5 DEEE C9              10      RET
                                
       DEEF                     SS1:
0012F6 DEEF 13               6      INC DE
       DEF0                     SPCUT:              ;スペースをカット
0012F7 DEF0 1A               7      LD  A,(DE)
0012F8 DEF1 FE20             7      CP  020H
0012FA DEF3 28FA            12      JR  Z,SS1
0012FC DEF5 C9              10      RET
                                
       DEF6                     SETDRVF:
0012FD DEF6 1114EF          10      LD  DE,FDRV
       DEF9                     SETDRV0:
001300 DEF9 CD02DF          17      CALL    SETDRV
001303 DEFC FDE1            14      POP IY
001305 DEFE C1              10      POP BC
001306 DEFF D1              10      POP DE
001307 DF00 E1              10      POP HL
001308 DF01 C9              10      RET
                                
       DF02                     SETDRV:
001309 DF02 E3              19      EX  (SP),HL     ;HL=RETRN ADDRESS
00130A DF03 D5              11      PUSH    DE      ;PUSH HL/DE/BC/IY
00130B DF04 C5              11      PUSH    BC
00130C DF05 1A               7      LD  A,(DE)
00130D DF06 D5              11      PUSH    DE
00130E DF07 FDE3            23      EX  (SP),IY
                                
001310 DF09 CD15DF          17      CALL    GETDRV
001313 DF0C 3C               4      INC A
001314 DF0D FD7700          19      LD  (IY+0),A    ;(FCB)ドライブ番号
001317 DF10 3D               4      DEC A
001318 DF11 CDD9EF          17      CALL    _CHGDRV
                                
00131B DF14 E9               4      JP  (HL)
                                
       DF15                     GETDRV:
00131C DF15 E67F             7      AND 07FH
00131E DF17 D601             7      SUB 001H
001320 DF19 3003            12      JR  NC,GETDRV1
001322 DF1B 3A87EF          13      LD  A,(_DVSW)   ;Current Drive
       DF1E                     GETDRV1:
001325 DF1E 3288EF          13      LD  (_DRV),A
001328 DF21 C9              10      RET
                                
       DF22                     SOPENX:
001329 DF22 1139EF          10      LD  DE,SFILE
00132C DF25 1A               7      LD  A,(DE)
00132D DF26 FDBE00           7      CP  (IY+0)      ;(FCB)ドライブ番号
001330 DF29 2024            12      JR  NZ,SOPEN
001332 DF2B 13               6      INC DE
001333 DF2C FDE5            15      PUSH    IY
001335 DF2E E1              10      POP HL
001336 DF2F 23               6      INC HL
001337 DF30 CDBDE0          17      CALL    CPFILE
00133A DF33 201A            12      JR  NZ,SOPEN
                                
00133C DF35 2AF4F0          16      LD  HL,(SCDIR)
00133F DF38 FD750E          19      LD  (IY+14),L   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001342 DF3B FD740F          19      LD  (IY+15),H
                                
001345 DF3E 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
001348 DF41 229FEF          16      LD  (_FILEN),HL
                                
00134B DF44 ED5BF6F0        20      LD  DE,(SFBPS)
00134F DF48 2139EF          10      LD  HL,SFILE
001352 DF4B 36FF            10      LD  (HL),0FFH
001354 DF4D 23               6      INC HL
001355 DF4E C9              10      RET
       DF4F                     SOPEN:
001356 DF4F 2165E0          10      LD  HL,FILESE
       DF52                     SOPENC:
001359 DF52 228BDF          16      LD  (OPENPAT+1),HL
                                
00135C DF55 CDE2EF          17      CALL    _RDFATX     ;Detect Media
00135F DF58 3856            12      JR  C,RDDERR
                                
001361 DF5A AF               4      XOR A
001362 DF5B 329FEF          13      LD  (_FILEN),A
001365 DF5E CD6AE1          17      CALL    LDDIRX1     ;A=0で呼び出す
001368 DF61 2818            12      JR  Z,SDIRX1
                                
00136A DF63 CD56E0          17      CALL    READ_DIR    ;Sub Directory
00136D DF66 3808            12      JR  C,SDIRX0
00136F DF68 2A7EF0          16      LD  HL,(_DTBUF)
001372 DF6B 7E               7      LD  A,(HL)
001373 DF6C FE2E             7      CP  '.'
001375 DF6E 280F            12      JR  Z,SOPEN1
       DF70                     SDIRX0:
001377 DF70 AF               4      XOR A
001378 DF71 32A0EF          13      LD  (_DIRF),A
00137B DF74 FD360E01        19      LD  (IY+14),1   ;(FCB)レコードサイズ
00137F DF78 FD770F          19      LD  (IY+15),A
       DF7B                     SDIRX1:
001382 DF7B ED5BFCF0        20      LD  DE,(_DIRPS) ;Root Directory
       DF7F                     SOPEN1:
001386 DF7F 0E20             7  SDECPAT:LD  C,32        ;自己書き換え 1セクタ辺りのディレクトリエントリ数  1024=32 / 512=16 / 256=8
       DF81                     SOPEN1X:
001388 DF81 CD56E0          17      CALL    READ_DIR    ;FILE SEARCH
00138B DF84 382A            12      JR  C,RDDERR
00138D DF86 2A7EF0          16      LD  HL,(_DTBUF)
       DF89                     SOPEN2:
001390 DF89 D5              11      PUSH    DE
001391 DF8A CD65E0          17  OPENPAT:CALL    FILESE      ;(self-modifying code)
001394 DF8D D1              10      POP DE
001395 DF8E 386E            12      JR  C,SOPENE
001397 DF90 281B            12      JR  Z,SCF_FF_RET
       DF92                     SOPEN3:
001399 DF92 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
00139C DF95 B7               4      OR  A
00139D DF96 200C            12      JR  NZ,SOPEN5
00139F DF98 13               6      INC DE      ;ルートディレクトリ
0013A0 DF99 E5              11      PUSH    HL
0013A1 DF9A 210C00          10  MD_PAT: LD  HL,12       ;(self-modifying code)MAXDIR
0013A4 DF9D ED52            15      SBC HL,DE       ;CF=0 なので SUB HL,DE
0013A6 DF9F E1              10      POP HL
0013A7 DFA0 20DD            12      JR  NZ,SOPEN1
0013A9 DFA2 1807            12      JR  SOPEN6
       DFA4                     SOPEN5:
0013AB DFA4 CD99E8          17      CALL    GNCLX       ;END DIR
0013AE DFA7 D8              11      RET C
0013AF DFA8 CD1DE1          17      CALL    ENDCL
       DFAB                     SOPEN6:
0013B2 DFAB 38D2            12      JR  C,SOPEN1
       DFAD                     SCF_FF_RET:
0013B4 DFAD 37               4      SCF         ;CF=1
0013B5 DFAE 9F               4      SBC A,A     ;A=0FFH
0013B6 DFAF C9              10      RET
                                
       DFB0                     RDDERR:
0013B7 DFB0 BF               4      CP  A       ;READ ERR CF=1 ZF=1
0013B8 DFB1 37               4      SCF
0013B9 DFB2 C9              10      RET
                                
       DFB3                     NOPEN:
0013BA DFB3 2165E0          10      LD  HL,FILESE
0013BD DFB6 228BDF          16      LD  (OPENPAT+1),HL
0013C0 DFB9 FD2A98EF        20      LD  IY,(_FCB)
0013C4 DFBD CD50E2          17      CALL    CHKWILDX
0013C7 DFC0 30EB            12      JR  NC,SCF_FF_RET
0013C9 DFC2 FD7E00          19      LD  A,(IY+0)    ;(FCB)ドライブ番号
0013CC DFC5 3D               4      DEC A
0013CD DFC6 3288EF          13      LD  (_DRV),A
0013D0 DFC9 CDD9EF          17      CALL    _CHGDRV
0013D3 DFCC D8              11      RET C
0013D4 DFCD 2AF8F0          16      LD  HL,(SFNDF)  ;Direcroty location and Flags
0013D7 DFD0 229FEF          16      LD  (_FILEN),HL
                                
0013DA DFD3 CD65E1          17      CALL    LDDIRX
0013DD DFD6 ED5B9AEF        20      LD  DE,(_FBPS)
0013E1 DFDA CD56E0          17      CALL    READ_DIR
0013E4 DFDD 38D1            12      JR  C,RDDERR
0013E6 DFDF 3A9EEF          13      LD  A,(_FBCNT)
0013E9 DFE2 3D               4      DEC A
0013EA DFE3 28AD            12      JR  Z,SOPEN3
       DFE5                     NOPEN2:
0013EC DFE5 2A9CEF          16      LD  HL,(_FBAD)
0013EF DFE8 012000          10      LD  BC,020H
0013F2 DFEB 09              11      ADD HL,BC
0013F3 DFEC 4F               4      LD  C,A
0013F4 DFED 189A            12      JR  SOPEN2
                                
       DFEF                     SOPENE2:
0013F6 DFEF 229CEF          16      LD  (_FBAD),HL
0013F9 DFF2 79               4      LD  A,C
0013FA DFF3 329EEF          13      LD  (_FBCNT),A
0013FD DFF6 ED539AEF        20      LD  (_FBPS),DE
001401 DFFA FD2298EF        20      LD  (_FCB),IY
       DFFE                     SOPENE:
001405 DFFE AF               4      XOR A
001406 DFFF C9              10      RET
                                
       E000                     COPEN:
001407 E000 FD360D20        19      LD  (IY+13),020H    ;(FCB)属性(アトリビュート)
                                
00140B E004 2182E0          10      LD  HL,NEXTSE
00140E E007 CD52DF          17      CALL    SOPENC
001411 E00A D0              11      RET NC
001412 E00B C8              11      RET Z
001413 E00C 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
001416 E00F B7               4      OR  A
001417 E010 37               4      SCF
001418 E011 C8              11      RET Z       ;ルートディレクトリ
001419 E012 0601             7      LD  B,1
00141B E014 CDAEE2          17      CALL    WRDF
00141E E017 D8              11      RET C
00141F E018 ED5BFEF0        20      LD  DE,(_CLPS)
001423 E01C D5              11      PUSH    DE
001424 E01D CDE6E0          17      CALL    DCPAT
001427 E020 CD24E7          17      CALL    DRDNX
00142A E023 2A7EF0          16      LD  HL,(_DTBUF) ;ディレクトリエントリを0クリア
00142D E026 3A22E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001430 E029 47               4      LD  B,A
001431 E02A AF               4      XOR A
001432 E02B 4F               4      LD  C,A
       E02C                     COPENCL:
001433 E02C 77               7      LD  (HL),A
001434 E02D EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001436 E02F EA2CE0          10      JP  PE,COPENCL
                                
001439 E032 3A04E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ数
00143C E035 3D               4      DEC A
00143D E036 2819            12      JR  Z,COPENE
00143F E038 3E01             7      LD  A,1     ;1セクタ辺りのセクタ数が2以上の場合
001441 E03A 3291E8          13      LD  (_SECPS+1),A
001444 E03D D1              10      POP DE      ;DE=(_CLPS)
001445 E03E D5              11      PUSH    DE
       E03F                     COPEN1:
001446 E03F D5              11      PUSH    DE      ;データバッファに入らないセクタもゼロクリア
001447 E040 C5              11      PUSH    BC
001448 E041 2A7EF0          16      LD  HL,(_DTBUF)
00144B E044 CD00E1          17      CALL    CLUSTX
00144E E047 CD01EA          17      CALL    DWT24
001451 E04A C1              10      POP BC
001452 E04B D1              10      POP DE
001453 E04C CD90E8          17      CALL    NEXTX
001456 E04F 20EE            12      JR  NZ,COPEN1
       E051                     COPENE:
001458 E051 2A7EF0          16      LD  HL,(_DTBUF)
00145B E054 D1              10      POP DE
00145C E055 C9              10      RET
                                
       E056                     READ_DIR:
00145D E056 ED53FEF0        20      LD  (_CLPS),DE
001461 E05A C5              11      PUSH    BC
001462 E05B D5              11      PUSH    DE
001463 E05C CDE6E0          17      CALL    DCPAT
001466 E05F CD04E7          17      CALL    DRDX
001469 E062 D1              10      POP DE
00146A E063 C1              10      POP BC
00146B E064 C9              10      RET
                                
       E065                     FILESE:
00146C E065 7E               7      LD  A,(HL)
00146D E066 B7               4      OR  A
00146E E067 C8              11      RET Z       ;END:ZF=1 CF=0
00146F E068 FEE5             7      CP  0E5H
001471 E06A 280E            12      JR  Z,FILESE1
001473 E06C FDE5            15      PUSH    IY
001475 E06E D1              10      POP DE
001476 E06F 13               6      INC DE
001477 E070 E5              11      PUSH    HL
001478 E071 CDBDE0          17      CALL    CPFILE
00147B E074 CCDEE0          17      CALL    Z,CPFILE2
00147E E077 E1              10      POP HL
00147F E078 37               4      SCF
001480 E079 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       E07A                     FILESE1:
001481 E07A CD91E0          17      CALL    FNEXT
001484 E07D 20E6            12      JR  NZ,FILESE
       E07F                     ZF0_CF0_AFF_RET:
001486 E07F F6FF             7      OR  0FFH        ;ZF=0 CF=0
001488 E081 C9              10      RET
                                
       E082                     NEXTSE:
001489 E082 7E               7      LD  A,(HL)
00148A E083 B7               4      OR  A
00148B E084 37               4      SCF
00148C E085 C8              11      RET Z       ;!!!:ZF=1 CF=1
00148D E086 FEE5             7      CP  0E5H
00148F E088 37               4      SCF
001490 E089 C8              11      RET Z       ;!!!:(ZF=1) CF=1
001491 E08A CD91E0          17      CALL    FNEXT
001494 E08D 20F3            12      JR  NZ,NEXTSE
001496 E08F 18EE            12      JR  ZF0_CF0_AFF_RET
                                
       E091                     FNEXT:
001498 E091 E5              11      PUSH    HL
001499 E092 219FEF          10      LD  HL,_FILEN
00149C E095 34              11      INC (HL)
00149D E096 E1              10      POP HL
00149E E097 112000          10      LD  DE,020H
0014A1 E09A 19              11      ADD HL,DE
0014A2 E09B 0D               4      DEC C
0014A3 E09C C9              10      RET
                                
       E09D                     CPNAME:
0014A4 E09D C5              11      PUSH    BC
0014A5 E09E D5              11      PUSH    DE
0014A6 E09F E5              11      PUSH    HL
0014A7 E0A0 CDB7E0          17      CALL    CPFILE4
0014AA E0A3 E1              10      POP HL
0014AB E0A4 23               6      INC HL
0014AC E0A5 23               6      INC HL
0014AD E0A6 23               6      INC HL
0014AE E0A7 23               6      INC HL
0014AF E0A8 D1              10      POP DE
0014B0 E0A9 C1              10      POP BC
0014B1 E0AA 2005            12      JR  NZ,CPNAME1
0014B3 E0AC 7E               7      LD  A,(HL)
0014B4 E0AD 23               6      INC HL
0014B5 E0AE 66               7      LD  H,(HL)
0014B6 E0AF 6F               4      LD  L,A
0014B7 E0B0 C9              10      RET
       E0B1                     CPNAME1:
0014B8 E0B1 23               6      INC HL
0014B9 E0B2 23               6      INC HL
0014BA E0B3 10E8            13      DJNZ    CPNAME
0014BC E0B5 37               4      SCF
0014BD E0B6 C9              10      RET
                                
       E0B7                     CPFILE4:
0014BE E0B7 C5              11      PUSH    BC
0014BF E0B8 010004          10      LD  BC,00400H
0014C2 E0BB 1804            12      JR  CPSTR1
       E0BD                     CPFILE:
0014C4 E0BD C5              11      PUSH    BC
0014C5 E0BE 01000B          10      LD  BC,00B00H
       E0C1                     CPSTR1:
0014C8 E0C1 1A               7      LD  A,(DE)
0014C9 E0C2 FE3F             7      CP  '?'     ;Wild card
0014CB E0C4 2812            12      JR  Z,CPSTR2
0014CD E0C6 7E               7      LD  A,(HL)
0014CE E0C7 CD36E2          17      CALL    FKANC
0014D1 E0CA E5              11      PUSH    HL
0014D2 E0CB 67               4      LD  H,A
0014D3 E0CC 1A               7      LD  A,(DE)
0014D4 E0CD CB01             4      RLC C
0014D6 E0CF CD36E2          17      CALL    FKANC
0014D9 E0D2 CB09             4      RRC C
0014DB E0D4 BC               4      CP  H       ;CP (HL),(DE)
0014DC E0D5 E1              10      POP HL
0014DD E0D6 2004            12      JR  NZ,CPSTR3
       E0D8                     CPSTR2:
0014DF E0D8 13               6      INC DE
0014E0 E0D9 23               6      INC HL
0014E1 E0DA 10E5            13      DJNZ    CPSTR1
       E0DC                     CPSTR3:
0014E3 E0DC C1              10      POP BC
0014E4 E0DD C9              10      RET
                                
       E0DE                     CPFILE2:
0014E5 E0DE FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
0014E8 E0E1 F6E1             7      OR  0E1H
0014EA E0E3 2F               4      CPL
0014EB E0E4 A6               7      AND (HL)
0014EC E0E5 C9              10      RET
                                
       E0E6                     DCPAT:
0014ED E0E6 0E00             7      LD  C,0
0014EF E0E8 2A7EF0          16      LD  HL,(_DTBUF)
0014F2 E0EB 3AA0EF          13      LD  A,(_DIRF)   ;ディレクトリか判別
0014F5 E0EE B7               4      OR  A
0014F6 E0EF C8              11      RET Z       ;ルートディレクトリの場合はCレジスタを0にしておく(CDEがセクタ番号)
0014F7 E0F0 3A04E1          13      LD  A,(SPCPAT+1)
0014FA E0F3 4F               4      LD  C,A
0014FB E0F4 3A91E8          13      LD  A,(_SECPS+1)
0014FE E0F7 B9               4      CP  C
0014FF E0F8 3801            12      JR  C,DC1
001501 E0FA AF               4      XOR A
       E0FB                     DC1:
001502 E0FB F680             7      OR  080H
001504 E0FD 32A0EF          13      LD  (_DIRF),A   ;bit0-6:セクタインデックス
       E100                     CLUSTX:
001507 E100 E5              11      PUSH    HL
001508 E101 EB               4      EX  DE,HL
001509 E102 AF               4      XOR A
00150A E103 0E01             7  SPCPAT: LD  C,1     ;自己書き換え（1クラスタの論理セクタ数）
       E105                     L_CLDBL:
00150C E105 CB19             8      RR  C       ;->CF
00150E E107 3804            12      JR  C,E_CLDBL
001510 E109 29              11      ADD HL,HL       ;*2
001511 E10A 8F               4      ADC A,A
001512 E10B 18F8            12      JR  L_CLDBL
       E10D                     E_CLDBL:
001514 E10D 4F               4      LD  C,A
001515 E10E 3A91E8          13      LD  A,(_SECPS+1)
001518 E111 B5               4      OR  L
001519 E112 6F               4      LD  L,A
00151A E113 110800          10  CLSPAT: LD  DE,8    ;+8 (2D)  !ADDCL (self-modifying code)
00151D E116 AF               4      XOR A
00151E E117 19              11      ADD HL,DE   ;データ格納領域の先頭論理セクタ番号
00151F E118 89               4      ADC A,C
001520 E119 4F               4      LD  C,A
001521 E11A EB               4      EX  DE,HL
001522 E11B E1              10      POP HL
001523 E11C C9              10      RET
                                
       E11D                     ENDCL:
001524 E11D 7A               4      LD  A,D ;END CLUSTER
001525 E11E FE01             7  CLPAT1: CP  1   ;164=356    (self-modifying code)
001527 E120 C0              11      RET NZ
001528 E121 7B               4      LD  A,E
001529 E122 FE64             7  CLPAT2: CP  064H    ;       (self-modifying code)
00152B E124 C9              10      RET
                                
       E125                     CAP:
00152C E125 FE61             7      CP  'a'
00152E E127 D8              11      RET C
00152F E128 FE7B             7      CP  'z'+1
001531 E12A D0              11      RET NC
001532 E12B D620             7      SUB 020H
001534 E12D C9              10      RET
       E12E                     CAP2:
001535 E12E CD25E1          17      CALL    CAP
       E131                     CAP3:
001538 E131 CD3AE1          17      CALL    CAP4
00153B E134 FE21             7      CP  021H
00153D E136 D0              11      RET NC
00153E E137 3EA0             7      LD  A,0A0H
001540 E139 C9              10      RET
       E13A                     CAP4:
001541 E13A FE05             7      CP  5
001543 E13C C0              11      RET NZ
001544 E13D 3EE5             7      LD  A,0E5H
001546 E13F C9              10      RET
                                
       E140                     CHDIR:
001547 E140 CD2FEB          17      CALL    GETDPBD
00154A E143 381D            12      JR  C,CHDIR2
00154C E145 DD751A          19      LD  (IX+01AH),L     ;_SDIR_
00154F E148 DD741B          19      LD  (IX+01BH),H     ;_SDIR_+1
001552 E14B 1815            12      JR  CHDIR2      ;POP_IX_RET
                                
       E14D                     LDDIR:
001554 E14D CD2FEB          17      CALL    GETDPBD
001557 E150 DD5E1A          19      LD  E,(IX+01AH)     ;_SDIR_
00155A E153 DD561B          19      LD  D,(IX+01BH)     ;_SDIR_+1
00155D E156 13               6      INC DE
00155E E157 FD730E          19      LD  (IY+14),E   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001561 E15A FD720F          19      LD  (IY+15),D
001564 E15D 1B               6      DEC DE
001565 E15E AF               4      XOR A
001566 E15F 32A0EF          13      LD  (_DIRF),A
       E162                     CHDIR2:
001569 E162 DDE1            14      POP IX
00156B E164 C9              10      RET
                                
       E165                     LDDIRX:
00156C E165 3AA0EF          13      LD  A,(_DIRF)   ;(FCB)アクセスするディレクトリのセクタインデックス
00156F E168 E67F             7      AND 07FH
       E16A                     LDDIRX1:
001571 E16A 3291E8          13      LD  (_SECPS+1),A
001574 E16D FD5E0E          19      LD  E,(IY+14)   ;(FCB)アクセスするディレクトリのクラスタ番号+1
001577 E170 FD560F          19      LD  D,(IY+15)
00157A E173 1B               6      DEC DE
00157B E174 CD1DE1          17      CALL    ENDCL
00157E E177 D44DE1          17      CALL    NC,LDDIR
       E17A                     LDDIRS:
001581 E17A 7A               4      LD  A,D
001582 E17B B3               4      OR  E
001583 E17C 32A0EF          13      LD  (_DIRF),A   ;ディレクトリか判別
001586 E17F C9              10      RET
                                
       E180                     KILL:
001587 E180 CD50E2          17      CALL    CHKWILDX
00158A E183 3834            12      JR  C,KILLW
00158C E185 CD22DF          17      CALL    SOPENX
       E188                     KILLS:
00158F E188 3E1F             7      LD  A,01FH
001591 E18A D4CCE1          17      CALL    NC,CHKATT
001594 E18D D8              11      RET C
       E18E                     KILLSX:
001595 E18E 36E5            10      LD  (HL),0E5H   ;DIR
001597 E190 CD2AE2          17      CALL    WTDB
00159A E193 111A00          10      LD  DE,01AH
00159D E196 19              11      ADD HL,DE
00159E E197 5E               7      LD  E,(HL)
00159F E198 23               6      INC HL
0015A0 E199 56               7      LD  D,(HL)
       E19A                     KILLS1:
0015A1 E19A CD1DE1          17      CALL    ENDCL
0015A4 E19D D0              11      RET NC      ;CF=0
0015A5 E19E 21FEFF          10      LD  HL,0-2
0015A8 E1A1 19              11      ADD HL,DE
0015A9 E1A2 D0              11      RET NC      ;DE= 0 or 1
0015AA E1A3 D5              11      PUSH    DE
0015AB E1A4 CDF7EF          17      CALL    _GNCL
0015AE E1A7 ED53FEF0        20      LD  (_CLPS),DE
0015B2 E1AB D1              10      POP DE
0015B3 E1AC 210000          10      LD  HL,0
0015B6 E1AF D4FAEF          17      CALL    NC,_SNCL
0015B9 E1B2 D8              11      RET C
0015BA E1B3 ED5BFEF0        20      LD  DE,(_CLPS)  ;FAT
0015BE E1B7 18E1            12      JR  KILLS1
                                
       E1B9                     KILLW:
0015C0 E1B9 CD4FDF          17      CALL    SOPEN
       E1BC                     KILLW1:
0015C3 E1BC 380B            12      JR  C,KILLW2
0015C5 E1BE CDEFDF          17      CALL    SOPENE2
0015C8 E1C1 CD88E1          17      CALL    KILLS
0015CB E1C4 CDB3DF          17      CALL    NOPEN
0015CE E1C7 18F3            12      JR  KILLW1
       E1C9                     KILLW2:
0015D0 E1C9 C8              11      RET Z
0015D1 E1CA 3F               4      CCF
0015D2 E1CB C9              10      RET
                                
       E1CC                     CHKATT:
0015D3 E1CC E5              11      PUSH    HL
0015D4 E1CD 110B00          10      LD  DE,00BH
0015D7 E1D0 19              11      ADD HL,DE
0015D8 E1D1 A6               7      AND (HL)
0015D9 E1D2 E1              10      POP HL
0015DA E1D3 C8              11      RET Z
0015DB E1D4 37               4      SCF
0015DC E1D5 C9              10      RET
                                
       E1D6                     NAME:
0015DD E1D6 CD50E2          17      CALL    CHKWILDX
0015E0 E1D9 D8              11      RET C
0015E1 E1DA 110400          10      LD  DE,4
0015E4 E1DD 19              11      ADD HL,DE
0015E5 E1DE 22F6E1          16      LD  (NAMEP+2),HL
0015E8 E1E1 23               6      INC HL
0015E9 E1E2 CD54E2          17      CALL    CHKWILD
0015EC E1E5 D8              11      RET C
                                
0015ED E1E6 CD22DF          17      CALL    SOPENX
0015F0 E1E9 3E0F             7      LD  A,00FH
0015F2 E1EB D4CCE1          17      CALL    NC,CHKATT
0015F5 E1EE D8              11      RET C
                                
0015F6 E1EF FD7E00          19      LD  A,(IY+0)
0015F9 E1F2 FDE5            15      PUSH    IY
0015FB E1F4 FD210000        14  NAMEP:  LD  IY,0        ;自己書き換え
0015FF E1F8 FD7700          19      LD  (IY+0),A
001602 E1FB CD22DF          17      CALL    SOPENX
001605 E1FE FDE3            23      EX  (SP),IY
001607 E200 3F               4      CCF
001608 E201 D44FDF          17      CALL    NC,SOPEN
00160B E204 EB               4      EX  DE,HL
00160C E205 E1              10      POP HL
00160D E206 D8              11      RET C
                                
       E207                     SETNAME:
00160E E207 01000B          10      LD  BC,11*256
001611 E20A 23               6      INC HL
001612 E20B 7E               7      LD  A,(HL)
001613 E20C FEE5             7      CP  0E5H
001615 E20E 2004            12      JR  NZ,SNAME1
001617 E210 3E05             7      LD  A,5
001619 E212 180E            12      JR  SNAME3
       E214                     SNAME1:
00161B E214 7E               7      LD  A,(HL)
00161C E215 0C               4      INC C
00161D E216 0D               4      DEC C
00161E E217 2009            12      JR  NZ,SNAME3
001620 E219 CD25E1          17      CALL    CAP
001623 E21C FEA0             7      CP  0A0H
001625 E21E 2002            12      JR  NZ,SNAME3
001627 E220 3E20             7      LD  A,020H
       E222                     SNAME3:
001629 E222 12               7      LD  (DE),A
00162A E223 7E               7      LD  A,(HL)
00162B E224 23               6      INC HL
00162C E225 CD3DE2          17      CALL    FKAN
00162F E228 10EA            13      DJNZ    SNAME1
       E22A                     WTDB:
001631 E22A 3EFF             7      LD  A,0FFH
001633 E22C 3239EF          13      LD  (SFILE),A
       E22F                     SWTDBF:
001636 E22F 3E01             7      LD  A,1
001638 E231 32A4EF          13      LD  (_WTDBF),A
00163B E234 AF               4      XOR A
00163C E235 C9              10      RET
                                
       E236                     FKANC:
00163D E236 CB41             8      BIT 0,C
00163F E238 CC2EE1          17      CALL    Z,CAP2
001642 E23B 1801            12      JR  FKANX
       E23D                     FKAN:           ;漢字チェック
001644 E23D 13               6      INC DE
       E23E                     FKANX:
001645 E23E CB41             8      BIT 0,C
001647 E240 CB81             8      RES 0,C
001649 E242 C0              11      RET NZ
00164A E243 FE80             7      CP  080H
00164C E245 D8              11      RET C
00164D E246 FEA0             7      CP  0A0H
00164F E248 3803            12      JR  C,FKAN1
001651 E24A FEE0             7      CP  0E0H
001653 E24C D8              11      RET C
       E24D                     FKAN1:
001654 E24D 0C               4      INC C
001655 E24E A7               4      AND A
001656 E24F C9              10      RET
                                
       E250                     CHKWILDX:
001657 E250 FDE5            15      PUSH    IY
001659 E252 E1              10      POP HL
00165A E253 23               6      INC HL
       E254                     CHKWILD:
00165B E254 060B             7      LD  B,11
00165D E256 3E3F             7      LD  A,'?'
       E258                     CHKWIL1:
00165F E258 BE               7      CP  (HL)
001660 E259 23               6      INC HL
001661 E25A 37               4      SCF
001662 E25B C8              11      RET Z
001663 E25C 10FA            13      DJNZ    CHKWIL1
001665 E25E AF               4      XOR A
001666 E25F C9              10      RET
                                
       E260                     SDIRENT:        ;IY=FCB HL=DIR
001667 E260 D5              11      PUSH    DE
001668 E261 E5              11      PUSH    HL
001669 E262 FDE5            15      PUSH    IY
00166B E264 D1              10      POP DE
00166C E265 EB               4      EX  DE,HL
00166D E266 CD07E2          17      CALL    SETNAME
                                ;               Attribute
001670 E269 FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001673 E26C 12               7      LD  (DE),A
001674 E26D 13               6      INC DE
                                ;               Reserved
001675 E26E AF               4      XOR A
001676 E26F 060A             7      LD  B,10
       E271                     SDE1:
001678 E271 12               7      LD  (DE),A
001679 E272 13               6      INC DE
00167A E273 10FC            13      DJNZ    SDE1
                                                    ;(FCB)更新時刻
00167C E275 21EAF0          10      LD  HL,SDDATA       ;(FCB)更新年月日
00167F E278 060A             7      LD  B,SDDATAE-SDDATA    ;(FCB)ファイルの先頭クラスタ
       E27A                     SDLOOP:                 ;(FCB)ファイルのサイズ(バイト単位)
001681 E27A 7E               7      LD  A,(HL)
001682 E27B 23               6      INC HL
001683 E27C 3281E2          13      LD  (SDPAT+2),A
001686 E27F FD7E00          19  SDPAT:  LD  A,(IY+0)    ;LD A,(IY+A)
001689 E282 12               7      LD  (DE),A
00168A E283 13               6      INC DE
00168B E284 10F4            13      DJNZ    SDLOOP
                                
00168D E286 AF               4      XOR A
00168E E287 E1              10      POP HL
00168F E288 D1              10      POP DE
001690 E289 C9              10      RET
                                
       E28A                     WOPEN:
001691 E28A FD7E0D          19      LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
001694 E28D E61F             7      AND 01FH
001696 E28F 37               4      SCF
001697 E290 C0              11      RET NZ
001698 E291 FD361CFE        19      LD  (IY+28),0FEH    ;(FCB)オープンモード
       E295                     TOPEN2:
00169C E295 AF               4      XOR A
       E296                     TOPEN:              ;Initializes the time stamp
00169D E296 FD3617FF        19      LD  (IY+23),0FFH    ;(FCB)更新時刻
0016A1 E29A C9              10      RET
                                
       E29B                     WRDFX:
0016A2 E29B 3A04E1          13      LD  A,(SPCPAT+1)    ;1クラスタの論理セクタ
       E29E                     L_WRFX:
0016A5 E29E 1F               4      RRA         ;->CF
0016A6 E29F 3806            12      JR  C,E_WRFX
0016A8 E2A1 CB39             8      SRL C
0016AA E2A3 CB1C             8      RR  H       ;CH=CH/2
0016AC E2A5 18F7            12      JR  L_WRFX
       E2A7                     E_WRFX:
0016AE E2A7 44               4      LD  B,H
0016AF E2A8 04               4      INC B
0016B0 E2A9 3E37             7      LD  A,037H      ;SCF
0016B2 E2AB 3221E7          13      LD  (DRDN1),A
                                
       E2AE                     WRDF:               ;Bクラスタ分FATを確保する
0016B5 E2AE 110200          10      LD  DE,2
0016B8 E2B1 AF               4      XOR A
0016B9 E2B2 3291E8          13      LD  (_SECPS+1),A
       E2B5                     WRDF1:
0016BC E2B5 C5              11      PUSH    BC
0016BD E2B6 D5              11      PUSH    DE
0016BE E2B7 CDF7EF          17      CALL    _GNCL
0016C1 E2BA 381C            12      JR  C,WRDF3
0016C3 E2BC 7A               4      LD  A,D     ;空いているかチェック
0016C4 E2BD B3               4      OR  E
0016C5 E2BE 2027            12      JR  NZ,WRDF4
0016C7 E2C0 E1              10      POP HL      ;HL=空いているクラスタ
0016C8 E2C1 E5              11      PUSH    HL
0016C9 E2C2 ED5BFEF0        20      LD  DE,(_CLPS)  ;DE=元の(_CLPS)
0016CD E2C6 22FEF0          16      LD  (_CLPS),HL
0016D0 E2C9 7A               4      LD  A,D     ;元の(_CLPS)が 0 か?
0016D1 E2CA B3               4      OR  E
0016D2 E2CB 2008            12      JR  NZ,WRDF2
0016D4 E2CD FD751A          19      LD  (IY+26),L   ;(FCB)ファイルの先頭クラスタ
0016D7 E2D0 FD741B          19      LD  (IY+27),H   ;元が空の場合はFCBにクラスタをセットする
0016DA E2D3 1803            12      JR  WRDF3
       E2D5                     WRDF2:
0016DC E2D5 CDFAEF          17      CALL    _SNCL
       E2D8                     WRDF3:
0016DF E2D8 D1              10      POP DE
0016E0 E2D9 C1              10      POP BC
0016E1 E2DA D8              11      RET C
0016E2 E2DB 100C            13      DJNZ    WRDF5       ;ここでループカウンタチェック
0016E4 E2DD ED5BFEF0        20      LD  DE,(_CLPS)
0016E8 E2E1 21FFFF          10      LD  HL,0FFFFH   ;FATエントリ終了(EOCマーク)
0016EB E2E4 C3FAEF          10      JP  _SNCL
                                
       E2E7                     WRDF4:              ;DEクラスタが空じゃないので次に移動する
0016EE E2E7 D1              10      POP DE
0016EF E2E8 C1              10      POP BC
       E2E9                     WRDF5:
0016F0 E2E9 13               6      INC DE
0016F1 E2EA CD1DE1          17      CALL    ENDCL
0016F4 E2ED 38C6            12      JR  C,WRDF1
0016F6 E2EF 37               4      SCF
0016F7 E2F0 C9              10      RET
                                
       E2F1                     RWXR:
0016F8 E2F1 3A22E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E2F4                     L_RWX:
0016FB E2F4 1F               4      RRA     ;->CF
0016FC E2F5 3808            12      JR  C,E_RWX
0016FE E2F7 CB38             8      SRL B   ;BCH=BCH/2
001700 E2F9 CB19             8      RR  C   ;
001702 E2FB CB1C             8      RR  H   ;
001704 E2FD 18F5            12      JR  L_RWX
       E2FF                     E_RWX:
001706 E2FF FD5E1A          19      LD  E,(IY+26)   ;(FCB)ファイルの先頭クラスタ
001709 E302 FD561B          19      LD  D,(IY+27)
00170C E305 AF               4      XOR A
00170D E306 3291E8          13      LD  (_SECPS+1),A
       E309                     RWX1:
001710 E309 ED53FEF0        20      LD  (_CLPS),DE
001714 E30D 7A               4      LD  A,D
001715 E30E B3               4      OR  E
001716 E30F 2813            12      JR  Z,SCF_RET   ;RET DE==0 => CF=1
                                
001718 E311 78               4      LD  A,B
001719 E312 B1               4      OR  C
00171A E313 B4               4      OR  H
00171B E314 C8              11      RET Z       ;RET BCH==0 => CF=0
                                
00171C E315 CD99E8          17      CALL    GNCLX
00171F E318 D8              11      RET C
001720 E319 7C               4      LD  A,H     ;
001721 E31A 25               4      DEC H       ;
001722 E31B B7               4      OR  A       ;DEC BCH
001723 E31C 2001            12      JR  NZ,RWX2     ;
001725 E31E 0B               6      DEC BC      ;
       E31F                     RWX2:
001726 E31F CD1DE1          17      CALL    ENDCL
001729 E322 38E5            12      JR  C,RWX1
       E324                     SCF_RET:
00172B E324 37               4      SCF
00172C E325 C9              10      RET
                                
       E326                     DSKF:
00172D E326 110000          10  MAXCLP: LD  DE,0
001730 E329 2AACEF          16      LD  HL,(_FAKEFREE)
001733 E32C 7C               4      LD  A,H
001734 E32D B5               4      OR  L
001735 E32E 2803            12      JR  Z,DSKF1
001737 E330 110100          10      LD  DE,1
       E333                     DSKF1:
00173A E333 D5              11      PUSH    DE
00173B E334 CDF7EF          17      CALL    _GNCL
00173E E337 380C            12      JR  C,POPSCF
001740 E339 7A               4      LD  A,D
001741 E33A B3               4      OR  E
001742 E33B 2001            12      JR  NZ,DSKF2
001744 E33D 23               6      INC HL
       E33E                     DSKF2:
001745 E33E D1              10      POP DE
001746 E33F 1B               6      DEC DE
001747 E340 7A               4      LD  A,D
001748 E341 B3               4      OR  E
001749 E342 20EF            12      JR  NZ,DSKF1
00174B E344 C9              10      RET
                                
       E345                     POPSCF:
00174C E345 F1              10      POP AF
00174D E346 37               4      SCF
00174E E347 C9              10      RET
                                
       E348                     SETTMS:
00174F E348 FD7E17          19      LD  A,(IY+23)   ;(FCB)ファイルを最後に変更した時刻
001752 E34B 3C               4      INC A
001753 E34C C0              11      RET NZ      ;ファイルが更新されていない
       E34D                     SETTMSX:            ;FCBに日付時刻をセットする
001754 E34D CDCBD9          17      CALL    _SYS2C      ;(BDOS)時刻の獲得
                                                ;H←時  L←分  D←秒
001757 E350 CB25             8      SLA L       ;   *2
001759 E352 CB25             8      SLA L       ;   *4
00175B E354 29              11      ADD HL,HL       ;*2 *8
00175C E355 29              11      ADD HL,HL       ;*4 *16
00175D E356 29              11      ADD HL,HL       ;*8 *32
00175E E357 7A               4      LD  A,D
00175F E358 0F               4      RRCA            ;bit.0->7->->->0->C
001760 E359 E61F             7      AND 01FH
001762 E35B B5               4      OR  L
001763 E35C FD7716          19      LD  (IY+22),A   ;(FCB)ファイルを最後に変更した時刻
001766 E35F FD7417          19      LD  (IY+23),H
                                
001769 E362 CDA4D9          17      CALL    _SYS2A      ;(BDOS)日付の獲得
                                                ;HL←年  D←月  E←日
00176C E365 0144F8          10      LD  BC,0-1980
00176F E368 09              11      ADD HL,BC
001770 E369 65               4      LD  H,L
                                
001771 E36A 7A               4      LD  A,D
001772 E36B 87               4      ADD A,A     ;*2
001773 E36C 87               4      ADD A,A     ;*4
001774 E36D 87               4      ADD A,A     ;*8
001775 E36E 87               4      ADD A,A     ;*16
001776 E36F 6F               4      LD  L,A
001777 E370 29              11      ADD HL,HL       ;*32
001778 E371 7D               4      LD  A,L
001779 E372 B3               4      OR  E
00177A E373 FD7714          19      LD  (IY+20),A   ;(FCB)ファイルを最後に変更した日付
00177D E376 FD7415          19      LD  (IY+21),H
001780 E379 C9              10      RET
                                
       E37A                     PUSHRR:
001781 E37A 3219E4          13      LD  (SETSEQ_SWC_RND),A
001784 E37D 222BE4          16      LD  (SETSEQ_SWC_SEQ_RR),HL
001787 E380 CDA0E3          17      CALL    GET_RR_AHL
00178A E383 225AEF          16      LD  (HLBUF),HL
00178D E386 325CEF          13      LD  (HLBUF+2),A
001790 E389 C9              10      RET
                                
       E38A                     GET_CPM_R_SIZE:     ;バイト単位からCP/Mのレコード単位を求める（1レコード=128バイト）
001791 E38A 87               4      ADD A,A     ;in BHLA => out AHL
001792 E38B ED6A            15      ADC HL,HL
001794 E38D CB18             8      RR  B
001796 E38F B7               4      OR  A
001797 E390 78               4      LD  A,B     ;ここでフラグは変化しない
001798 E391 C8              11      RET Z
001799 E392 2C               4      INC L       ;INC AHL
00179A E393 C0              11      RET NZ      ;
00179B E394 24               4      INC H       ;
00179C E395 C0              11      RET NZ      ;
00179D E396 3C               4      INC A       ;
00179E E397 C9              10      RET
                                
       E398                     INIT_RND:
00179F E398 3ECD             7      LD  A,0CDH      ;CALL ????
0017A1 E39A 21E9E3          10      LD  HL,POPRR
0017A4 E39D CD7AE3          17      CALL    PUSHRR
       E3A0                     GET_RR_AHL:
0017A7 E3A0 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0017AA E3A3 FD6622          19      LD  H,(IY+34)   ;
0017AD E3A6 FD7E23          19      LD  A,(IY+35)   ;
0017B0 E3A9 C9              10      RET
       E3AA                     SET_RR_AHL:
0017B1 E3AA FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0017B4 E3AD FD7422          19      LD  (IY+34),H
0017B7 E3B0 FD7723          19      LD  (IY+35),A
0017BA E3B3 C9              10      RET
       E3B4                     INIT_SEQ:
0017BB E3B4 3E01             7      LD  A,1     ;LD BC,????
0017BD E3B6 21E6E3          10      LD  HL,SETSEQ
0017C0 E3B9 CD7AE3          17      CALL    PUSHRR
       E3BC                     GETSEQ:
0017C3 E3BC FD6E20          19      LD  L,(IY+32)   ;(FCB)カレントレコード
0017C6 E3BF FD660C          19      LD  H,(IY+12)   ;(FCB)カレントブロック
0017C9 E3C2 AF               4      XOR A
                                
0017CA E3C3 CB25             8      SLA L   ;L=L*2
                                
0017CC E3C5 CB3C             8      SRL H   ;HL=HL/2
0017CE E3C7 CB1D             8      RR  L   ;
0017D0 E3C9 C9              10      RET
                                
       E3CA                     SETSEQ1:
0017D1 E3CA F5              11      PUSH    AF      
0017D2 E3CB E5              11      PUSH    HL      ;AHL=Random record
0017D3 E3CC FD7E21          19      LD  A,(IY+33)   ;(FCB)ランダムレコード
0017D6 E3CF FD6E22          19      LD  L,(IY+34)
0017D9 E3D2 FD6623          19      LD  H,(IY+35)
0017DC E3D5 0600             7      LD  B,0
                                
0017DE E3D7 CD8AE3          17      CALL    GET_CPM_R_SIZE
                                
0017E1 E3DA 29              11      ADD HL,HL
0017E2 E3DB CB3D             8      SRL L       ;L=L/2
0017E4 E3DD FD7520          19      LD  (IY+32),L   ;(FCB)カレントレコード
0017E7 E3E0 FD740C          19      LD  (IY+12),H   ;(FCB)カレントブロック
0017EA E3E3 E1              10      POP HL
0017EB E3E4 F1              10      POP AF
0017EC E3E5 C9              10      RET
       E3E6                     SETSEQ:
0017ED E3E6 CDCAE3          17      CALL    SETSEQ1
       E3E9                     POPRR:
0017F0 E3E9 F5              11      PUSH    AF
0017F1 E3EA E5              11      PUSH    HL
0017F2 E3EB 2A5AEF          16      LD  HL,(HLBUF)
0017F5 E3EE 3A5CEF          13      LD  A,(HLBUF+2)
0017F8 E3F1 CDAAE3          17      CALL    SET_RR_AHL
0017FB E3F4 E1              10      POP HL
0017FC E3F5 F1              10      POP AF
0017FD E3F6 C9              10      RET
                                
       E3F7                     RB_WRITE:
0017FE E3F7 C5              11      PUSH    BC
0017FF E3F8 ED4B4CF0        20      LD  BC,(STABLE+2*026H)  ;(BDOS)ランダムブロック書き込み
001803 E3FC 1805            12      JR  RBRW
       E3FE                     RB_READ:
001805 E3FE C5              11      PUSH    BC
001806 E3FF ED4B4EF0        20      LD  BC,(STABLE+2*027H)  ;(BDOS)ランダムブロック読み込み
       E403                     RBRW:
00180A E403 CB3F             8      SRL A   ;AHLA' = HL*128
00180C E405 CB1C             8      RR  H   ;AHL=AHL/2
00180E E407 CB1D             8      RR  L   ;
001810 E409 3E00             7      LD  A,0
001812 E40B 1F               4      RRA     ;A'HLA
001813 E40C FD7721          19      LD  (IY+33),A   ;(FCB)ランダムレコード
001816 E40F FD7522          19      LD  (IY+34),L
001819 E412 FD7423          19      LD  (IY+35),H
00181C E415 218000          10      LD  HL,128
00181F E418 C5              11      PUSH    BC
       E419                     SETSEQ_SWC_RND:
001820 E419 CDCAE3          17      CALL    SETSEQ1
001823 E41C C1              10      POP BC
001824 E41D FDCB20FE        23      SET 7,(IY+32)   ;(FCB)カレントレコード
001828 E421 FDE5            15      PUSH    IY
00182A E423 D1              10      POP DE
00182B E424 D5              11      PUSH    DE
00182C E425 CD33E4          17      CALL    JP_BC
00182F E428 FDE1            14      POP IY
       E42B                     SETSEQ_SWC_SEQ_RR   EQU $+1
001831 E42A CDE6E3          17      CALL    SETSEQ
001834 E42D FDCB20BE        23      RES 7,(IY+32)   ;(FCB)カレントレコード
                                
001838 E431 C1              10      POP BC
001839 E432 C9              10      RET
       E433                     JP_BC:
00183A E433 C5              11      PUSH    BC
00183B E434 C9              10      RET
                                
       DFAD                     _SYS03  EQU SCF_FF_RET  ;(BDOS)外部入力
       DFAD                     _SYS2B  EQU SCF_FF_RET  ;(BDOS)日付の設定
       DFAD                     _SYS2D  EQU SCF_FF_RET  ;(BDOS)時刻の設定
       DFAD                     _SYS39  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの作成
       DFAD                     _SYS3A  EQU SCF_FF_RET  ;(BDOS)サブディレクトリの削除
                                
[EOF:LDFILE.ASM:SHIFT_JIS]
                                    INCLUDE "LDFILE2.ASM"
                                
                                ;   LSX-Dodgers FILE2
                                
                                                ;Write random block
       E435                     _SYS26:     ;(BDOS)ランダムブロック書き込み
00183C E435 AF               4      XOR A
00183D E436 3221E7          13      LD  (DRDN1),A   ;NOP
001840 E439 2265E6          16      LD  (LEFT+1),HL ;HL←書き込むレコード数
001843 E43C 225DEF          16      LD  (LEFTX),HL
001846 E43F CD02DF          17      CALL    SETDRV
                                
001849 E442 CDBCE5          17      CALL    RBX0
00184C E445 DADFE4          10      JP  C,RBWERR
00184F E448 CD8AE2          17      CALL    WOPEN
001852 E44B DADFE4          10      JP  C,RBWERR
001855 E44E 7C               4      LD  A,H
001856 E44F B5               4      OR  L
001857 E450 CAD8E4          10      JP  Z,RBW1
                                
00185A E453 2B               6      DEC HL
                                
00185B E454 CD87E6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
00185E E457 19              11      ADD HL,DE       ;BCHL=HL+BCDE
00185F E458 3001            12      JR  NC,S26X1    ;
001861 E45A 03               6      INC BC      ;
       E45B                     S26X1:
001862 E45B CDF1E2          17      CALL    RWXR
001865 E45E DC9BE2          17      CALL    C,WRDFX
001868 E461 DADFE4          10      JP  C,RBWERR
                                
00186B E464 CDEBE5          17      CALL    RBX2
00186E E467 281A            12      JR  Z,RBWB      ;NZ=セクタ以下の端数がある
001870 E469 CD0AE6          17      CALL    RBXA
001873 E46C 3871            12      JR  C,RBWERR
001875 E46E EB               4      EX  DE,HL
001876 E46F C5              11      PUSH    BC
001877 E470 EDB0                    LDIR
001879 E472 225FEF          16      LD  (DTAX),HL
                                
00187C E475 CD2FE2          17      CALL    SWTDBF      ;バッファデータは更新された
                                
00187F E478 2A5DEF          16      LD  HL,(LEFTX)
001882 E47B D1              10      POP DE
001883 E47C ED52            15      SBC HL,DE
001885 E47E 225DEF          16      LD  (LEFTX),HL
001888 E481 2833            12      JR  Z,RBWEND
                                
       E483                     RBWB:
00188A E483 CD40E6          17      CALL    RBXB
00188D E486 2816            12      JR  Z,RBWC
       E488                     RBWB1:
00188F E488 C5              11      PUSH    BC
001890 E489 D5              11      PUSH    DE
001891 E48A CD00E1          17      CALL    CLUSTX
001894 E48D CD9BE6          17      CALL    DWTC
001897 E490 D1              10      POP DE
001898 E491 C1              10      POP BC
001899 E492 384B            12      JR  C,RBWERR
00189B E494 CD99E8          17      CALL    GNCLX
00189E E497 3846            12      JR  C,RBWERR
0018A0 E499 10ED            13      DJNZ    RBWB1
0018A2 E49B CDEBE6          17      CALL    DRW_FLUSH
       E49E                     RBWC:
0018A5 E49E CD58E6          17      CALL    RBXC
0018A8 E4A1 2813            12      JR  Z,RBWEND
0018AA E4A3 C5              11      PUSH    BC
0018AB E4A4 CD00E1          17      CALL    CLUSTX
0018AE E4A7 CD20E7          17      CALL    DRDN
0018B1 E4AA C1              10      POP BC
0018B2 E4AB 3832            12      JR  C,RBWERR
0018B4 E4AD ED5B7EF0        20      LD  DE,(_DTBUF)
0018B8 E4B1 EDB0                    LDIR
0018BA E4B3 CD2FE2          17      CALL    SWTDBF      ;バッファデータは更新された
       E4B6                     RBWEND:
0018BD E4B6 CD64E6          17      CALL    RBXEND
                                
0018C0 E4B9 CDCBE5          17      CALL    RBX1
0018C3 E4BC 301A            12      JR  NC,RBW1
0018C5 E4BE 2A65E6          16      LD  HL,(LEFT+1)
0018C8 E4C1 FD5E10          19      LD  E,(IY+16)   ;(FCB)ファイルのサイズ(バイト単位)
0018CB E4C4 FD5611          19      LD  D,(IY+17)   ;DE=File size
0018CE E4C7 19              11      ADD HL,DE
0018CF E4C8 FD7510          19      LD  (IY+16),L   ;(FCB)ファイルのサイズ(バイト単位)
0018D2 E4CB FD7411          19      LD  (IY+17),H
0018D5 E4CE 3008            12      JR  NC,RBW1
0018D7 E4D0 FD3412          23      INC (IY+18)
0018DA E4D3 2003            12      JR  NZ,RBW1
0018DC E4D5 FD3413          23      INC (IY+19)
       E4D8                     RBW1:
0018DF E4D8 FDE1            14      POP IY
0018E1 E4DA C1              10      POP BC
0018E2 E4DB D1              10      POP DE
0018E3 E4DC E1              10      POP HL
       E4DD                     DD_NUL:
0018E4 E4DD AF               4      XOR A
       E4DE                     DRDF0:
       E4DE                     DWTF0:
0018E5 E4DE C9              10      RET
                                
       E4DF                     RBWERR:
0018E6 E4DF FDE5            15      PUSH    IY
0018E8 E4E1 D1              10      POP DE
0018E9 E4E2 2A20F0          16      LD  HL,(STABLE+2*010H)
0018EC E4E5 CD0F00          17      CALL    JP_HL
       E4E8                     RBRERR1:
0018EF E4E8 3E01             7      LD  A,001H
       E4EA                     RBRERR2:
0018F1 E4EA FDE1            14      POP IY
0018F3 E4EC C1              10      POP BC
0018F4 E4ED D1              10      POP DE
0018F5 E4EE E1              10      POP HL
0018F6 E4EF 37               4      SCF
0018F7 E4F0 210000          10      LD  HL,0
0018FA E4F3 C9              10      RET
                                
       E4F4                     RBRERR:
0018FB E4F4 3EFF             7      LD  A,0FFH
0018FD E4F6 18F2            12      JR  RBRERR2
                                
       E4F8                     RBRFL:
0018FF E4F8 3E00             7  RBRFLP: LD  A,000H
001901 E4FA FE0D             7      CP  00DH
001903 E4FC 2005            12      JR  NZ,RBRFL1
001905 E4FE D5              11      PUSH    DE
001906 E4FF 1E0A             7      LD  E,00AH
001908 E501 1805            12      JR  RBRFL2
       E503                     RBRFL1:
00190A E503 D5              11      PUSH    DE
00190B E504 CD09EF          17      CALL    _SYS07
00190E E507 5F               4      LD  E,A
       E508                     RBRFL2:
00190F E508 CDCDEF          17      CALL    _PRINT
001912 E50B 7B               4      LD  A,E
001913 E50C D1              10      POP DE
001914 E50D 32F9E4          13      LD  (RBRFLP+1),A
001917 E510 C9              10      RET
       E511                     DDX:
001918 E511 FD7E01          19      LD  A,(IY+1)    ;(FCB)主ファイル名
00191B E514 CD25E1          17      CALL    CAP
00191E E517 FE41             7      CP  'A'
001920 E519 C9              10      RET
                                
                                                ;Read random block
       E51A                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001921 E51A 225DEF          16      LD  (LEFTX),HL
001924 E51D CD02DF          17      CALL    SETDRV
                                
001927 E520 FDCB0D66        20      BIT 4,(IY+13)   ;(FCB)属性(アトリビュート)
00192B E524 C2AAE5          10      JP  NZ,RBRDIR   ;ディレクトリ
00192E E527 CDBCE5          17      CALL    RBX0
001931 E52A DAF4E4          10      JP  C,RBRERR
001934 E52D CDCBE5          17      CALL    RBX1
001937 E530 DAE8E4          10      JP  C,RBRERR1
00193A E533 EB               4      EX  DE,HL
00193B E534 ED52            15      SBC HL,DE       ;CP 00HL,BCDE
00193D E536 19              11      ADD HL,DE
00193E E537 79               4      LD  A,C
00193F E538 DE00             7      SBC A,0
001941 E53A 78               4      LD  A,B
001942 E53B DE00             7      SBC A,0
001944 E53D 3801            12      JR  C,RBR1
001946 E53F EB               4      EX  DE,HL
       E540                     RBR1:
001947 E540 9F               4      SBC A,A
001948 E541 E601             7      AND 1
00194A E543 32A8E5          13      LD  (RBRAP+1),A
                                
00194D E546 7C               4      LD  A,H
00194E E547 B5               4      OR  L
00194F E548 2857            12      JR  Z,RBREND0
                                
001951 E54A 2265E6          16      LD  (LEFT+1),HL ;Read record byte
001954 E54D 225DEF          16      LD  (LEFTX),HL
                                
001957 E550 CDEBE5          17      CALL    RBX2
00195A E553 2819            12      JR  Z,RBRB
00195C E555 CD0AE6          17      CALL    RBXA
00195F E558 DAF4E4          10      JP  C,RBRERR
001962 E55B C5              11      PUSH    BC
001963 E55C EDB0                    LDIR
001965 E55E ED535FEF        20      LD  (DTAX),DE
001969 E562 2A5DEF          16      LD  HL,(LEFTX)
00196C E565 D1              10      POP DE
00196D E566 A7               4      AND A
00196E E567 ED52            15      SBC HL,DE
001970 E569 225DEF          16      LD  (LEFTX),HL
001973 E56C 2830            12      JR  Z,RBREND
                                
       E56E                     RBRB:
001975 E56E CD40E6          17      CALL    RBXB
001978 E571 2815            12      JR  Z,RBRC
       E573                     RBRB1:
00197A E573 C5              11      PUSH    BC
00197B E574 D5              11      PUSH    DE
00197C E575 CD00E1          17      CALL    CLUSTX
00197F E578 CDA1E6          17      CALL    DRDC
001982 E57B D1              10      POP DE
001983 E57C C1              10      POP BC
001984 E57D D499E8          17      CALL    NC,GNCLX
001987 E580 DAF4E4          10      JP  C,RBRERR
00198A E583 10EE            13      DJNZ    RBRB1
00198C E585 CDEBE6          17      CALL    DRW_FLUSH
       E588                     RBRC:
00198F E588 CD58E6          17      CALL    RBXC
001992 E58B 2811            12      JR  Z,RBREND
001994 E58D C5              11      PUSH    BC
001995 E58E CD00E1          17      CALL    CLUSTX
001998 E591 CD04E7          17      CALL    DRDX
00199B E594 C1              10      POP BC
00199C E595 DAF4E4          10      JP  C,RBRERR
00199F E598 EB               4      EX  DE,HL
0019A0 E599 2A7EF0          16      LD  HL,(_DTBUF)
0019A3 E59C EDB0                    LDIR
       E59E                     RBREND:
0019A5 E59E CD64E6          17      CALL    RBXEND
       E5A1                     RBREND0:
0019A8 E5A1 FDE1            14      POP IY
0019AA E5A3 C1              10      POP BC
0019AB E5A4 D1              10      POP DE
0019AC E5A5 F1              10      POP AF  ;(HL)
0019AD E5A6 AF               4      XOR A
0019AE E5A7 3E00             7  RBRAP:  LD  A,000H
0019B0 E5A9 C9              10      RET
                                
       E5AA                     RBRDIR:
0019B1 E5AA FD6E1A          19      LD  L,(IY+26)   ;(FCB)ファイルの先頭クラスタ
0019B4 E5AD FD661B          19      LD  H,(IY+27)
0019B7 E5B0 CD40E1          17      CALL    CHDIR
0019BA E5B3 AF               4      XOR A
0019BB E5B4 67               4      LD  H,A
0019BC E5B5 6F               4      LD  L,A
0019BD E5B6 3C               4      INC A
0019BE E5B7 32A8E5          13      LD  (RBRAP+1),A
0019C1 E5BA 18E5            12      JR  RBREND0
                                
       E5BC                     RBX0:
0019C3 E5BC 2A8AEF          16      LD  HL,(_DTA)
0019C6 E5BF 225FEF          16      LD  (DTAX),HL
0019C9 E5C2 2A5DEF          16      LD  HL,(LEFTX)
0019CC E5C5 FD7E1C          19      LD  A,(IY+28)   ;(FCB)オープンモード
0019CF E5C8 D6FD             7      SUB 0FDH
0019D1 E5CA C9              10      RET
                                
       E5CB                     RBX1:
0019D2 E5CB E5              11      PUSH    HL      ;Record byte
                                                ;AHL=File size
0019D3 E5CC FD6E10          19      LD  L,(IY+16)   ;ファイルのサイズ(バイト単位)
0019D6 E5CF FD6611          19      LD  H,(IY+17)   ;
0019D9 E5D2 FD7E12          19      LD  A,(IY+18)   ;
                                
0019DC E5D5 CD87E6          17      CALL    GET_RR_BCDE ;BCDE=Random record
                                
0019DF E5D8 A7               4      AND A
0019E0 E5D9 ED52            15      SBC HL,DE
0019E2 E5DB 99               4      SBC A,C
0019E3 E5DC 4F               4      LD  C,A
0019E4 E5DD FD7E13          19      LD  A,(IY+19)   ;ファイルのサイズ
0019E7 E5E0 98               4      SBC A,B
0019E8 E5E1 D1              10      POP DE
                                
0019E9 E5E2 D8              11      RET C
0019EA E5E3 47               4      LD  B,A
0019EB E5E4 B1               4      OR  C
0019EC E5E5 EB               4      EX  DE,HL   ;BCDE=File byte HL=Record byte
0019ED E5E6 B2               4      OR  D
0019EE E5E7 B3               4      OR  E
0019EF E5E8 C0              11      RET NZ
0019F0 E5E9 37               4      SCF
0019F1 E5EA C9              10      RET
                                
       E5EB                     RBX2:               ;Cluster settings
0019F2 E5EB FD6622          19      LD  H,(IY+34)   ;(+33)(FCB)ランダムレコード
0019F5 E5EE FD4E23          19      LD  C,(IY+35)
0019F8 E5F1 0600             7      LD  B,0
0019FA E5F3 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
0019FE E5F7 2003            12      JR  NZ,RBX3
001A00 E5F9 FD4624          19      LD  B,(IY+36)
       E5FC                     RBX3:
001A03 E5FC CDF1E2          17      CALL    RWXR
001A06 E5FF 3A22E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A09 E602 3D               4      DEC A
001A0A E603 FDA622          19      AND (IY+34)
001A0D E606 FDB621          19      OR  (IY+33)
001A10 E609 C9              10      RET
                                
       E60A                     RBXA:
001A11 E60A C5              11      PUSH    BC
001A12 E60B D5              11      PUSH    DE
001A13 E60C CD00E1          17      CALL    CLUSTX
001A16 E60F CD04E7          17      CALL    DRDX
001A19 E612 D1              10      POP DE
001A1A E613 C1              10      POP BC
001A1B E614 D8              11      RET C
001A1C E615 CD99E8          17      CALL    GNCLX
001A1F E618 D8              11      RET C
001A20 E619 ED53FEF0        20      LD  (_CLPS),DE
                                
001A24 E61D FD4E21          19      LD  C,(IY+33)   ;(FCB)ランダムレコード
001A27 E620 210004          10  SECSZ:  LD  HL,0400H    ;自己書き換え 1024=0400H / 512=0200H ここに1セクタのサイズが格納される
001A2A E623 7C               4      LD  A,H
001A2B E624 3D               4      DEC A       ;1024=3 / 512=1
001A2C E625 FDA622          19      AND (IY+34)     ;(FCB)ランダムレコード
001A2F E628 47               4      LD  B,A     ;BCに1セクタ以下の端数が入る
001A30 E629 ED42            15      SBC HL,BC       ;残りを計算
                                
001A32 E62B ED5B5DEF        20      LD  DE,(LEFTX)
001A36 E62F ED52            15      SBC HL,DE       ;CP HL,DE
001A38 E631 19              11      ADD HL,DE       ;
001A39 E632 3801            12      JR  C,RBXA1     ;DEとHLを比較して大きい方をHLに
001A3B E634 EB               4      EX  DE,HL
       E635                     RBXA1:
001A3C E635 E5              11      PUSH    HL
001A3D E636 2A7EF0          16      LD  HL,(_DTBUF)
001A40 E639 09              11      ADD HL,BC
001A41 E63A ED5B5FEF        20      LD  DE,(DTAX)
001A45 E63E C1              10      POP BC
001A46 E63F C9              10      RET
                                
       E640                     RBXB:
001A47 E640 2A5FEF          16      LD  HL,(DTAX)
001A4A E643 ED5BFEF0        20      LD  DE,(_CLPS)
001A4E E647 3A5EEF          13      LD  A,(LEFTX+1)
001A51 E64A 47               4      LD  B,A
001A52 E64B 3A22E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
       E64E                     RBXB1:
001A55 E64E 1F               4      RRA     ;->CF
001A56 E64F 3804            12      JR  C,RBXB2
001A58 E651 CB38             8      SRL B   ;B=B/2
001A5A E653 18F9            12      JR  RBXB1
       E655                     RBXB2:
001A5C E655 78               4      LD  A,B
001A5D E656 B7               4      OR  A
001A5E E657 C9              10      RET
                                
       E658                     RBXC:
001A5F E658 ED4B5DEF        20      LD  BC,(LEFTX)
001A63 E65C 3A22E6          13      LD  A,(SECSZ+2) ;1024=4 / 512=2 / 256=1
001A66 E65F 3D               4      DEC A
001A67 E660 A0               4      AND B
001A68 E661 47               4      LD  B,A     ;1セクタ以下の端数がない場合はZ
001A69 E662 B1               4      OR  C
001A6A E663 C9              10      RET
                                
       E664                     RBXEND:
001A6B E664 110000          10  LEFT:   LD  DE,0
001A6E E667 AF               4      XOR A
001A6F E668 FD6E21          19      LD  L,(IY+33)   ;(FCB)ランダムレコード
001A72 E66B FD6622          19      LD  H,(IY+34)
001A75 E66E 19              11      ADD HL,DE
001A76 E66F FD7521          19      LD  (IY+33),L   ;(FCB)ランダムレコード
001A79 E672 FD7422          19      LD  (IY+34),H
001A7C E675 300E            12      JR  NC,RBXEND1
001A7E E677 FD3423          23      INC (IY+35)
001A81 E67A 2009            12      JR  NZ,RBXEND1
001A83 E67C FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A87 E680 2003            12      JR  NZ,RBXEND1
001A89 E682 FD3424          23      INC (IY+36)
       E685                     RBXEND1:
001A8C E685 EB               4      EX  DE,HL       ;HL=Read byte
001A8D E686 C9              10      RET
                                
       E687                     GET_RR_BCDE:            ;BCDE=Random record
001A8E E687 FD5E21          19      LD  E,(IY+33)   ;(FCB)ランダムレコード
001A91 E68A FD5622          19      LD  D,(IY+34)
001A94 E68D FD4E23          19      LD  C,(IY+35)
001A97 E690 FD4624          19      LD  B,(IY+36)
001A9A E693 FDCB207E        20      BIT 7,(IY+32)   ;(FCB)カレントレコード
001A9E E697 C8              11      RET Z
001A9F E698 0600             7      LD  B,0     ;CP/M互換のアクセスの場合はFCBは36バイト
001AA1 E69A C9              10      RET
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめる
                                
       E69B                     DWTC:
001AA2 E69B E5              11      PUSH    HL
001AA3 E69C 2103EA          10      LD  HL,DWT24B
001AA6 E69F 1804            12      JR  DWTC1
       E6A1                     DRDC:
001AA8 E6A1 E5              11      PUSH    HL
001AA9 E6A2 21F3E9          10      LD  HL,DRD24B
       E6A5                     DWTC1:
001AAC E6A5 22FFE6          16      LD  (DRWF_MODE),HL
001AAF E6A8 E1              10      POP HL
001AB0 E6A9 3AEFE6          13      LD  A,(DRWF_B)
001AB3 E6AC B7               4      OR  A
001AB4 E6AD 200F            12      JR  NZ,DRDC1
       E6AF                     SAVE_DRWC:
001AB6 E6AF 0601             7      LD  B,1
001AB8 E6B1 ED43EEE6        20      LD  (DRWF_C),BC
001ABC E6B5 ED53F5E6        20      LD  (DRWF_E),DE
001AC0 E6B9 22F8E6          16      LD  (DRWF_HL),HL
001AC3 E6BC 1820            12      JR  INC_HL_DRWC
       E6BE                     DRDC1:
001AC5 E6BE E5              11      PUSH    HL
001AC6 E6BF 21F5E6          10      LD  HL,DRWF_E
001AC9 E6C2 86               7      ADD A,(HL)
001ACA E6C3 F5              11      PUSH    AF
001ACB E6C4 BB               4      CP  E
001ACC E6C5 201D            12      JR  NZ,DRDC2
001ACE E6C7 F1              10      POP AF
001ACF E6C8 23               6      INC HL
001AD0 E6C9 7E               7      LD  A,(HL)
001AD1 E6CA CE00             7      ADC A,0
001AD3 E6CC F5              11      PUSH    AF
001AD4 E6CD BA               4      CP  D
001AD5 E6CE 2014            12      JR  NZ,DRDC2
001AD7 E6D0 F1              10      POP AF
001AD8 E6D1 3AEEE6          13      LD  A,(DRWF_C)
001ADB E6D4 CE00             7      ADC A,0
001ADD E6D6 B9               4      CP  C
001ADE E6D7 200C            12      JR  NZ,DRDC3
001AE0 E6D9 21EFE6          10      LD  HL,DRWF_B
001AE3 E6DC 34              11      INC (HL)
001AE4 E6DD E1              10      POP HL
       E6DE                     INC_HL_DRWC:
001AE5 E6DE 3A22E6          13      LD  A,(SECSZ+2)     ;1セクタのサイズの上位1バイト
001AE8 E6E1 84               4      ADD A,H
001AE9 E6E2 67               4      LD  H,A
001AEA E6E3 C9              10      RET
       E6E4                     DRDC2:
001AEB E6E4 F1              10      POP AF
       E6E5                     DRDC3:
001AEC E6E5 CDEBE6          17      CALL    DRW_FLUSH
001AEF E6E8 E1              10      POP HL
001AF0 E6E9 18C4            12      JR  SAVE_DRWC
                                
                                ;   ランダムブロックアクセスの連続したセクタをまとめたものをフラッシュする
       E6EB                     DRW_FLUSH:
001AF2 E6EB C5              11      PUSH    BC
001AF3 E6EC D5              11      PUSH    DE
       E6EE                     DRWF_C  EQU $+1
       E6EF                     DRWF_B  EQU $+2
001AF4 E6ED 010000          10      LD  BC,0
001AF7 E6F0 78               4      LD  A,B
001AF8 E6F1 B7               4      OR  A
001AF9 E6F2 280D            12      JR  Z,DRDF1
       E6F5                     DRWF_E  EQU $+1
       E6F6                     DRWF_D  EQU $+2
001AFB E6F4 110000          10      LD  DE,0
       E6F8                     DRWF_HL EQU $+1
001AFE E6F7 210000          10      LD  HL,0
001B01 E6FA AF               4      XOR A
001B02 E6FB 32EFE6          13      LD  (DRWF_B),A
       E6FF                     DRWF_MODE   EQU $+1
001B05 E6FE CDF3E9          17      CALL    DRD24B
       E701                     DRDF1:
001B08 E701 D1              10      POP DE
001B09 E702 C1              10      POP BC
001B0A E703 C9              10      RET
[EOF:LDFILE2.ASM:SHIFT_JIS]
                                    INCLUDE "LDDIO.ASM"
                                
                                ;   LSX-Dodgers DIO
                                
       E704                     DRDX:
001B0B E704 CD42E7          17      CALL    DRDY
001B0E E707 C8              11      RET Z
001B0F E708 CD28E7          17      CALL    DRDX1       ;データバッファの情報を保存
001B12 E70B D8              11      RET C
001B13 E70C E5              11      PUSH    HL
001B14 E70D C5              11      PUSH    BC
001B15 E70E D5              11      PUSH    DE
001B16 E70F 2A7EF0          16      LD  HL,(_DTBUF)
001B19 E712 3A6BE7          13      LD  A,(_DBS24+1)
001B1C E715 4F               4      LD  C,A
001B1D E716 CDF1E9          17      CALL    DRD24
001B20 E719 DC3DE7          17      CALL    C,DRDNE
       E71C                     POP_DE_BC_HL_RET:
001B23 E71C D1              10      POP DE
001B24 E71D C1              10      POP BC
001B25 E71E E1              10      POP HL
001B26 E71F C9              10      RET
                                
                                ;   CDE:セクタ番号
       E720                     DRDN:
001B27 E720 AF               4      XOR A
001B28 E721 00               4  DRDN1:  NOP         ;自己書き換え NOP / SCF
001B29 E722 30E0            12      JR  NC,DRDX
       E724                     DRDNX:
001B2B E724 CD42E7          17      CALL    DRDY
001B2E E727 C8              11      RET Z
       E728                     DRDX1:
001B2F E728 CD58E7          17      CALL    DWTX
                                                ;データバッファの読み込んだドライブ・セクタ情報を保存
001B32 E72B ED53A6EF        20      LD  (_DBSEC),DE
001B36 E72F 79               4      LD  A,C
001B37 E730 326BE7          13      LD  (_DBS24+1),A
                                
001B3A E733 3A88EF          13      LD  A,(_DRV)
001B3D E736 32A5EF          13      LD  (_DBDRV),A
001B40 E739 CDD9EF          17      CALL    _CHGDRV
001B43 E73C D0              11      RET NC
       E73D                     DRDNE:
001B44 E73D 9F               4      SBC A,A     ;CF=1ならばA=0FFH
001B45 E73E 32A5EF          13      LD  (_DBDRV),A
001B48 E741 C9              10      RET
                                
                                ;   CDE:セクタ番号
       E742                     DRDY:
001B49 E742 3A6BE7          13      LD  A,(_DBS24+1)
001B4C E745 B9               4      CP  C
001B4D E746 C0              11      RET NZ
                                
001B4E E747 E5              11      PUSH    HL
001B4F E748 3A88EF          13      LD  A,(_DRV)
001B52 E74B 21A5EF          10      LD  HL,_DBDRV
001B55 E74E AE               7      XOR (HL)
001B56 E74F 2005            12      JR  NZ,POP_HL_RET
                                
001B58 E751 2AA6EF          16      LD  HL,(_DBSEC)
001B5B E754 ED52            15      SBC HL,DE       ;CF=0
       E756                     POP_HL_RET:
001B5D E756 E1              10      POP HL
001B5E E757 C9              10      RET
                                
       E758                     DWTX:
001B5F E758 3AA4EF          13      LD  A,(_WTDBF)
001B62 E75B B7               4      OR  A
001B63 E75C C8              11      RET Z
001B64 E75D AF               4      XOR A
001B65 E75E 32A4EF          13      LD  (_WTDBF),A
                                
001B68 E761 E5              11      PUSH    HL
001B69 E762 C5              11      PUSH    BC
001B6A E763 D5              11      PUSH    DE
001B6B E764 3AA5EF          13      LD  A,(_DBDRV)
001B6E E767 CDD9EF          17      CALL    _CHGDRV
001B71 E76A 0E00             7  _DBS24: LD  C,0
001B73 E76C ED5BA6EF        20      LD  DE,(_DBSEC)
001B77 E770 2A7EF0          16      LD  HL,(_DTBUF)
001B7A E773 D401EA          17      CALL    NC,DWT24
       E776                     POP_DE_BC_HL_RET2:
001B7D E776 18A4            12      JR  POP_DE_BC_HL_RET
                                
       E778                     RDFATX:
001B7F E778 E5              11      PUSH    HL
001B80 E779 3A88EF          13      LD  A,(_DRV)
001B83 E77C 21AAEF          10      LD  HL,_FATDRV
001B86 E77F AE               7      XOR (HL)
001B87 E780 28D4            12      JR  Z,POP_HL_RET
                                
001B89 E782 C5              11      PUSH    BC
001B8A E783 D5              11      PUSH    DE
001B8B E784 DDE5            15      PUSH    IX
001B8D E786 CDA2E7          17      CALL    WTFATX
001B90 E789 3813            12      JR  C,POP_IX_DE_BC_HL_RET
                                
001B92 E78B AF               4      XOR A
001B93 E78C 32ABEF          13      LD  (_FATIX),A
001B96 E78F 3A88EF          13      LD  A,(_DRV)
001B99 E792 32AAEF          13      LD  (_FATDRV),A
001B9C E795 CDE5EF          17      CALL    _RDFAT
       E798                     RDFATE2:
001B9F E798 3004            12      JR  NC,POP_IX_DE_BC_HL_RET
001BA1 E79A 9F               4      SBC A,A     ;A=0xFF
001BA2 E79B 32AAEF          13      LD  (_FATDRV),A
       E79E                     POP_IX_DE_BC_HL_RET:
001BA5 E79E DDE1            14      POP IX
001BA7 E7A0 18D4            12      JR  POP_DE_BC_HL_RET2
                                
       E7A2                     WTFATX:
001BA9 E7A2 3AA2EF          13      LD  A,(_WTFATF)
001BAC E7A5 B7               4      OR  A
001BAD E7A6 C8              11      RET Z
001BAE E7A7 E5              11      PUSH    HL
001BAF E7A8 3AAAEF          13      LD  A,(_FATDRV)
001BB2 E7AB 21A5EF          10      LD  HL,_DBDRV
001BB5 E7AE AE               7      XOR (HL)
001BB6 E7AF CC58E7          17      CALL    Z,DWTX
001BB9 E7B2 38A2            12      JR  C,POP_HL_RET
001BBB E7B4 C5              11      PUSH    BC
001BBC E7B5 D5              11      PUSH    DE
001BBD E7B6 DDE5            15      PUSH    IX
001BBF E7B8 CD0EEA          17      CALL    WTFAT
001BC2 E7BB AF               4      XOR A
001BC3 E7BC 32A2EF          13      LD  (_WTFATF),A
001BC6 E7BF 18DD            12      JR  POP_IX_DE_BC_HL_RET
                                
       E7C1                     NCL1:
001BC8 E7C1 7A               4      LD  A,D
001BC9 E7C2 B3               4      OR  E
001BCA E7C3 37               4      SCF
001BCB E7C4 C8              11      RET Z
                                
001BCC E7C5 7A               4      LD  A,D
001BCD E7C6 CB3F             8      SRL A   ;/2
001BCF E7C8 CB3F             8      SRL A   ;/2
                                
001BD1 E7CA E5              11      PUSH    HL
001BD2 E7CB 32EAE7          13      LD  (NCLPAT+2),A    ;_FATIX
001BD5 E7CE 2AAAEF          16      LD  HL,(_FATDRV)    ;L=_FATDRV H=_FATIX
001BD8 E7D1 BC               4      CP  H
001BD9 E7D2 3A88EF          13      LD  A,(_DRV)    ;この間でフラグは変化しない
001BDC E7D5 32E9E7          13      LD  (NCLPAT+1),A    ;_FATDRV
001BDF E7D8 2005            12      JR  NZ,NCL2     ;FATIXが違う
001BE1 E7DA BD               4      CP  L
001BE2 E7DB 2002            12      JR  NZ,NCL2     ;ドライブが違う
001BE4 E7DD E1              10      POP HL
001BE5 E7DE C9              10      RET
       E7DF                     NCL2:
001BE6 E7DF C5              11      PUSH    BC
001BE7 E7E0 D5              11      PUSH    DE
001BE8 E7E1 DDE5            15      PUSH    IX
001BEA E7E3 CDA2E7          17      CALL    WTFATX
001BED E7E6 38B6            12      JR  C,POP_IX_DE_BC_HL_RET
001BEF E7E8 010000          10  NCLPAT: LD  BC,0        ;自己書き換え C=_FATDRV B=_FATIX
001BF2 E7EB ED43AAEF        20      LD  (_FATDRV),BC
001BF6 E7EF CDE3E9          17      CALL    RDFATS
001BF9 E7F2 18A4            12      JR  RDFATE2
                                
       E7F4                     NCL3:
001BFB E7F4 CB9A             8      RES 3,D
001BFD E7F6 CB92             8      RES 2,D
001BFF E7F8 6B               4      LD  L,E
001C00 E7F9 62               4      LD  H,D
001C01 E7FA CB3C             8      SRL H   ;
001C03 E7FC CB1D             8      RR  L   ;HLA=HLA/2
001C05 E7FE 1F               4      RRA     ;
001C06 E7FF F5              11      PUSH    AF
001C07 E800 3AABEF          13      LD  A,(_FATIX)
001C0A E803 0F               4      RRCA
001C0B E804 300B            12      JR  NC,NCL3X1
001C0D E806 3A22E6          13      LD  A,(SECSZ+2)
001C10 E809 FE04             7      CP  4       ;1セクタ1024バイトの場合は奇数インデックスの場合に先頭を512バイトずらす
001C12 E80B 2004            12      JR  NZ,NCL3X1
001C14 E80D 010002          10      LD  BC,512
001C17 E810 09              11      ADD HL,BC
       E811                     NCL3X1:
001C18 E811 F1              10      POP AF
001C19 E812 ED4B7CF0        20      LD  BC,(_FATBF)
001C1D E816 19              11      ADD HL,DE
001C1E E817 09              11      ADD HL,BC
001C1F E818 17               4      RLA
001C20 E819 C9              10      RET
                                
       E81A                     GNCL:
001C21 E81A CDC1E7          17      CALL    NCL1        ;GET NEXT CLUSTER
001C24 E81D D8              11      RET C
001C25 E81E C5              11      PUSH    BC
001C26 E81F E5              11      PUSH    HL
001C27 E820 CDF4E7          17      CALL    NCL3
001C2A E823 3809            12      JR  C,GNC1
001C2C E825 5E               7      LD  E,(HL)
001C2D E826 23               6      INC HL
001C2E E827 7E               7      LD  A,(HL)
001C2F E828 E60F             7      AND 00FH
001C31 E82A 57               4      LD  D,A
001C32 E82B E1              10      POP HL
001C33 E82C C1              10      POP BC
001C34 E82D C9              10      RET
       E82E                     GNC1:
001C35 E82E 7E               7      LD  A,(HL)
001C36 E82F 23               6      INC HL
001C37 E830 56               7      LD  D,(HL)
001C38 E831 0604             7      LD  B,4
       E833                     GNC1L:
001C3A E833 CB3A             8      SRL D   ;DA=DA/2
001C3C E835 1F               4      RRA     ;
001C3D E836 10FB            13      DJNZ    GNC1L
                                
001C3F E838 5F               4      LD  E,A
001C40 E839 E1              10      POP HL
001C41 E83A C1              10      POP BC
001C42 E83B A7               4      AND A
001C43 E83C C9              10      RET
                                
       E83D                     SNCL:
001C44 E83D CDC1E7          17      CALL    NCL1
001C47 E840 D8              11      RET C
                                ;               SET NEXT CLUSTER
001C48 E841 E5              11      PUSH    HL
001C49 E842 C5              11      PUSH    BC
001C4A E843 D5              11      PUSH    DE
001C4B E844 E5              11      PUSH    HL
001C4C E845 CDF4E7          17      CALL    NCL3
001C4F E848 D1              10      POP DE
                                ;CF=ODD
001C50 E849 7E               7      LD  A,(HL)
001C51 E84A 73               7      LD  (HL),E
001C52 E84B 3806            12      JR  C,SNC1
                                ;EVEN
                                ;M[0] = E
                                ;M[1] = (M[1] & 0xF0) | (D & 0x0F)
001C54 E84D 23               6      INC HL
001C55 E84E ED67            18      RRD     ;M={A[3:0],E[3:0]}
001C57 E850 7A               4      LD  A,D
001C58 E851 1804            12      JR  SNC11
       E853                     SNC1:
                                ;ODD
                                ;HL[0] = (HL[0]&0x0F) | (E<<4)
                                ;HL[1] = DE>>4
001C5A E853 ED6F            18      RLD     ;M={D[3:0],E[7:4]}
001C5C E855 23               6      INC HL
001C5D E856 72               7      LD  (HL),D  ;M={D[3:0],E[7:4]}
       E857                     SNC11:
001C5E E857 ED6F            18      RLD     ;M={M[7:4],D[3:0]}
001C60 E859 B7               4      OR  A
001C61 E85A D1              10      POP DE
001C62 E85B C1              10      POP BC
001C63 E85C E1              10      POP HL
       E85D                     FAT_CHANGED:
001C64 E85D 3E01             7      LD  A,1
001C66 E85F 32A2EF          13      LD  (_WTFATF),A
001C69 E862 C9              10      RET
                                
       E863                     N16CL3:
001C6A E863 C5              11      PUSH    BC
001C6B E864 6B               4      LD  L,E
001C6C E865 7A               4      LD  A,D
001C6D E866 E603             7      AND 3
001C6F E868 67               4      LD  H,A
001C70 E869 29              11      ADD HL,HL
001C71 E86A ED4B7CF0        20      LD  BC,(_FATBF)
001C75 E86E 09              11      ADD HL,BC
001C76 E86F C1              10      POP BC
001C77 E870 C9              10      RET
                                
       E871                     GNCL16:
001C78 E871 CDC1E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C7B E874 D8              11      RET C
001C7C E875 E5              11      PUSH    HL
001C7D E876 CD63E8          17      CALL    N16CL3
001C80 E879 5E               7      LD  E,(HL)
001C81 E87A 23               6      INC HL
001C82 E87B 56               7      LD  D,(HL)
001C83 E87C E1              10      POP HL
001C84 E87D C9              10      RET
                                
       E87E                     SNCL16:
001C85 E87E CDC1E7          17      CALL    NCL1        ;GET NEXT CLUSTER for FAT16
001C88 E881 D8              11      RET C
001C89 E882 D5              11      PUSH    DE
001C8A E883 E5              11      PUSH    HL
001C8B E884 CD63E8          17      CALL    N16CL3
001C8E E887 D1              10      POP DE      ;HL
001C8F E888 73               7      LD  (HL),E
001C90 E889 23               6      INC HL
001C91 E88A 72               7      LD  (HL),D
001C92 E88B 6B               4      LD  L,E
001C93 E88C 62               4      LD  H,D
001C94 E88D D1              10      POP DE
001C95 E88E 18CD            12      JR  FAT_CHANGED
                                
                                ;------------------------
                                ;次のセクタを探す際に_SECPSの値をチェック
                                ;in
                                ;   DE : セクタ番号
                                ;out
                                ;   DE : 次のセクタ番号
                                ;note
                                ;
                                ;------------------------
       E890                     NEXTX:
001C97 E890 3E00             7  _SECPS: LD  A,0 ;自己書き換え
001C99 E892 3C               4      INC A
001C9A E893 E600             7  NCPAT:  AND 0   ;自己書き換え　1クラスタの論理セクタ数-1
001C9C E895 3291E8          13      LD  (_SECPS+1),A
001C9F E898 C9              10      RET
                                
       E899                     GNCLX:
001CA0 E899 CD90E8          17      CALL    NEXTX
001CA3 E89C C0              11      RET NZ  ;1クラスタのセクタ未満の場合は戻る
001CA4 E89D C3F7EF          10      JP  _GNCL   ;次のクラスタを探す
                                
       E8A0                     RDFAT:
001CA7 E8A0 3E80             7      LD  A,080H
001CA9 E8A2 3270EF          13      LD  (CHECK),A
       E8A5                     RDFAT1:
001CAC E8A5 3A88EF          13      LD  A,(_DRV)
001CAF E8A8 CD38EB          17      CALL    CHGDRVR
001CB2 E8AB D8              11      RET C
001CB3 E8AC DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001CB6 E8AF CB6F             8      BIT 5,A
001CB8 E8B1 2843            12      JR  Z,RDFAT0X
001CBA E8B3 2170EF          10      LD  HL,CHECK
001CBD E8B6 A6               7      AND (HL)
001CBE E8B7 77               7      LD  (HL),A
001CBF E8B8 110000          10      LD  DE,0        ;BPB
001CC2 E8BB 2A7CF0          16      LD  HL,(_FATBF)
001CC5 E8BE CDEFE9          17      CALL    DRD16
001CC8 E8C1 3024            12      JR  NC,GETBPB
001CCA E8C3 2170EF          10      LD  HL,CHECK
001CCD E8C6 CB06            15      RLC (HL)
001CCF E8C8 3F               4      CCF
001CD0 E8C9 D8              11      RET C
001CD1 E8CA DDCB0A1E        23      RR  (IX+00AH)   ;DPB_0A_FDMODE
001CD5 E8CE 3F               4      CCF         ;フロッピーディスクのMFMモードを切り替える
001CD6 E8CF DDCB0A16        23      RL  (IX+00AH)   ;DPB_0A_FDMODE
001CDA E8D3 3EFF             7      LD  A,0FFH
001CDC E8D5 3289EF          13      LD  (_DSK),A
001CDF E8D8 3A84EF          13      LD  A,(_DRIVE)
001CE2 E8DB E603             7      AND 3
001CE4 E8DD F680             7      OR  080H
001CE6 E8DF 6F               4      LD  L,A
001CE7 E8E0 26EF             7      LD  H,_CYL0/256
001CE9 E8E2 3EFF             7      LD  A,0FFH
001CEB E8E4 77               7      LD  (HL),A
001CEC E8E5 18BE            12      JR  RDFAT1
       E8E7                     GETBPB:
001CEE E8E7 FDE5            15      PUSH    IY
001CF0 E8E9 FD2A7CF0        20      LD  IY,(_FATBF) ;BPB
001CF4 E8ED CDF1EF          17      CALL    _BPB2DPB
001CF7 E8F0 FDE1            14      POP IY
001CF9 E8F2 D8              11      RET C
001CFA E8F3 CD97EA          17      CALL    CHGDRV2
       E8F6                     RDFAT0X:
001CFD E8F6 CDE3E9          17      CALL    RDFATS
001D00 E8F9 D8              11      RET C
001D01 E8FA DDBE06           7      CP  (IX+6)      ;DPB_06_FATID
001D04 E8FD C8              11      RET Z
001D05 E8FE DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001D09 E902 C0              11      RET NZ      ;BPBを取得している場合はFATIDをチェックしない
001D0A E903 37               4      SCF
001D0B E904 C9              10      RET
                                
       E905                     BPB2DPB:
001D0C E905 FD7E0B          19      LD  A,(IY+11)   ;BPB_BytsPerSec
001D0F E908 B7               4      OR  A
001D10 E909 37               4      SCF
001D11 E90A C0              11      RET NZ
       E90B                     BPBOK:
001D12 E90B FD7E0D          19      LD  A,(IY+13)   ;BPB_SecPerClus
001D15 E90E DD7707          19      LD  (IX+7),A    ;DPB_07_SECPCL
                                
001D18 E911 FD7E16          19      LD  A,(IY+22)   ;BPB_FATSz16
001D1B E914 DD7700          19      LD  (IX+0),A    ;DPB_00_FATLN
001D1E E917 FD7E17          19      LD  A,(IY+23)   ;BPB_FATSz16
001D21 E91A DD7701          19      LD  (IX+1),A    ;DPB_00_FATLN
                                
001D24 E91D FD6E0E          19      LD  L,(IY+14)   ;BPB_RsvdSecCnt
001D27 E920 FD660F          19      LD  H,(IY+15)
001D2A E923 DD750E          19      LD  (IX+00EH),L ;DPB_0E_FATPS
001D2D E926 FD5E16          19      LD  E,(IY+22)   ;BPB_FATSz16
001D30 E929 FD5617          19      LD  D,(IY+23)
001D33 E92C FD4610          19      LD  B,(IY+16)   ;BPB_NumFATs
       E92F                     BPBDP1:             ;BPB_FATSz16 * BPB_NumFATs
001D36 E92F 19              11      ADD HL,DE
001D37 E930 10FD            13      DJNZ    BPBDP1
       E932                     BPBDP2:
001D39 E932 DD7510          19      LD  (IX+010H),L ;DPB_10_DIRPS
001D3C E935 DD7411          19      LD  (IX+011H),H
001D3F E938 E5              11      PUSH    HL
                                
001D40 E939 FD6E11          19      LD  L,(IY+17)   ;BPB_RootEntCnt
001D43 E93C FD6612          19      LD  H,(IY+18)
001D46 E93F FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001D49 E942 B7               4      OR  A
001D4A E943 37               4      SCF
001D4B E944 C8              11      RET Z
001D4C E945 0606             7      LD  B,6
       E947                     BPBBPS1:
001D4E E947 05               4      DEC B
001D4F E948 0F               4      RRCA
001D50 E949 30FC            12      JR  NC,BPBBPS1
       E94B                     BPBDE1:
001D52 E94B 29              11      ADD HL,HL
001D53 E94C 10FD            13      DJNZ    BPBDE1
                                
001D55 E94E 7C               4      LD  A,H
001D56 E94F DD770B          19      LD  (IX+00BH),A ;DPB_0B_DIRSCNT
                                
001D59 E952 D1              10      POP DE      ;DPB_10_DIRPS
001D5A E953 6C               4      LD  L,H
001D5B E954 2600             7      LD  H,0
001D5D E956 19              11      ADD HL,DE       ;MAXDIR
001D5E E957 E5              11      PUSH    HL
001D5F E958 FD4E0D          19      LD  C,(IY+13)   ;BPB_SecPerClus
001D62 E95B CB21             8      SLA C       ;*2
001D64 E95D AF               4      XOR A
001D65 E95E 47               4      LD  B,A
001D66 E95F ED42            15      SBC HL,BC
001D68 E961 DD7514          19      LD  (IX+014H),L ;DPB_14_ADDCL16
001D6B E964 DD7415          19      LD  (IX+015H),H
                                
001D6E E967 D1              10      POP DE      ;DE=DPB_0B_MAXDIR
001D6F E968 FD6E13          19      LD  L,(IY+19)   ;BPB_TotSec16
001D72 E96B FD6614          19      LD  H,(IY+20)
                                
001D75 E96E DD7E12          19      LD  A,(IX+012H) ;DPB_12_DEVICE
001D78 E971 E60F             7      AND 00FH
001D7A E973 FE07             7      CP  7       ;フロッピー
001D7C E975 2019            12      JR  NZ,NOT_FD
001D7E E977 E5              11      PUSH    HL
001D7F E978 FD4E18          19      LD  C,(IY+24)   ;BPB_SecPerTr
001D82 E97B DD710D          19      LD  (IX+00DH),C ;DPB_0D_MAXSEC
001D85 E97E AF               4      XOR A
001D86 E97F CB21             8      SLA C       ;両面なのでセクタ数を２倍
001D88 E981 0610             7      LD  B,16
       E983                     DIVSEC:             ;MAXCYL = BPB_TotSec16 / (BPB_SecPerTr * 2)
001D8A E983 29              11      ADD HL,HL
001D8B E984 17               4      RLA
001D8C E985 B9               4      CP  C
001D8D E986 3802            12      JR  C,DIVSEC1
001D8F E988 91               4      SUB C
001D90 E989 2C               4      INC L
       E98A                     DIVSEC1:
001D91 E98A 10F7            13      DJNZ    DIVSEC
001D93 E98C DD750C          19      LD  (IX+00CH),L ;DPB_0C_MAXCYL
001D96 E98F E1              10      POP HL  ;ここまでフロッピー専用
       E990                     NOT_FD:
001D97 E990 7C               4      LD  A,H
001D98 E991 B5               4      OR  L
001D99 E992 3E00             7      LD  A,0     ;LDでフラグは変化しない。BPB_TotSec16を AHL で扱う為、Aに0を入れる
001D9B E994 2010            12      JR  NZ,BPB16BIT ;BPB_TotSec16が「0」の場合はBPB_TotSec32で計算
001D9D E996 FD7E23          19      LD  A,(IY+35)   ;念のために総セクタ数が24ビットを超える場合はエラーを返す
001DA0 E999 B7               4      OR  A
001DA1 E99A 37               4      SCF
001DA2 E99B C0              11      RET NZ
001DA3 E99C FD6E20          19      LD  L,(IY+32)   ;BPB_TotSec32 は AHL の24ビットで扱う
001DA6 E99F FD6621          19      LD  H,(IY+33)   ;1クラスタの論理セクタ数(DPB_07_SECPCL)が最大128なので
001DA9 E9A2 FD7E22          19      LD  A,(IY+34)   ;24ビットを超えると必ずクラスタ数が16ビットを超えてしまうのでこれで十分
001DAC E9A5 A7               4      AND A       ;CF=0
       E9A6                     BPB16BIT:
001DAD E9A6 ED52            15      SBC HL,DE
001DAF E9A8 DE00             7      SBC A,0
001DB1 E9AA FD460D          19      LD  B,(IY+13)   ;BPB_SecPerClus
       E9AD                     BPBTC1:             ;総クラスタ数(AHL) = 総セクタ数(AHL) / セクタサイズ(B)
001DB4 E9AD CB18             8      RR  B       ;->CY
001DB6 E9AF 3808            12      JR  C,BPBTC2
001DB8 E9B1 CB3F             8      SRL A
001DBA E9B3 CB1C             8      RR  H       ;AHL=AHL/2
001DBC E9B5 CB1D             8      RR  L
001DBE E9B7 18F4            12      JR  BPBTC1
       E9B9                     BPBTC2:
001DC0 E9B9 B7               4      OR  A
001DC1 E9BA 37               4      SCF
001DC2 E9BB C0              11      RET NZ      ;念のため(クラスタ数が16ビットを超える場合)
001DC3 E9BC 23               6      INC HL
001DC4 E9BD 23               6      INC HL
001DC5 E9BE DD7508          19      LD  (IX+8),L    ;DPB_08_MAXCL
001DC8 E9C1 DD7409          19      LD  (IX+9),H
                                
001DCB E9C4 FD7E15          19      LD  A,(IY+21)   ;BPB_Media
001DCE E9C7 DD7706          19      LD  (IX+6),A    ;DPB_06_FATID
                                
001DD1 E9CA FD7E10          19      LD  A,(IY+16)   ;BPB_NumFATs
001DD4 E9CD C6FE             7      ADD A,0-2       ;>2:CF=1
001DD6 E9CF FD7E0C          19      LD  A,(IY+12)   ;BPB_BytsPerSec
001DD9 E9D2 6F               4      LD  L,A
001DDA E9D3 3002            12      JR  NC,BPBFAT1
001DDC E9D5 F680             7      OR  080H
       E9D7                     BPBFAT1:
001DDE E9D7 DD770F          19      LD  (IX+00FH),A ;DPB_0F_BPS
001DE1 E9DA 2D               4      DEC L       ;以下のセクタサイズに合致しない場合はCF=1でエラーにする
001DE2 E9DB C8              11      RET Z       ;1セクタ256バイト
001DE3 E9DC 2D               4      DEC L
001DE4 E9DD C8              11      RET Z       ;1セクタ512バイト
001DE5 E9DE 2D               4      DEC L
001DE6 E9DF 2D               4      DEC L
001DE7 E9E0 C8              11      RET Z       ;1セクタ1024バイト
001DE8 E9E1 37               4      SCF
001DE9 E9E2 C9              10      RET
                                
       E9E3                     RDFATS:
001DEA E9E3 CD29EA          17      CALL    FATSETUP
001DED E9E6 D8              11      RET C
001DEE E9E7 CDF3E9          17      CALL    DRD24B
001DF1 E9EA 2A7CF0          16      LD  HL,(_FATBF)
001DF4 E9ED 7E               7      LD  A,(HL)
001DF5 E9EE C9              10      RET
                                
       E9EF                     DRD16:
001DF6 E9EF 0E00             7      LD  C,0
       E9F1                     DRD24:
001DF8 E9F1 0601             7      LD  B,1
       E9F3                     DRD24B:
001DFA E9F3 DDE5            15      PUSH    IX
001DFC E9F5 DD2AA8EF        20      LD  IX,(_DPB)
001E00 E9F9 CDCDEC          17  DRDPAT: CALL    FDRD        ;自己書き換え（ディスク読み込み）
       E9FC                     POP_IX_RET:
001E03 E9FC DDE1            14      POP IX
001E05 E9FE C9              10      RET
                                
       E9FF                     DWT16:
001E06 E9FF 0E00             7      LD  C,0
       EA01                     DWT24:
001E08 EA01 0601             7      LD  B,1
       EA03                     DWT24B:
001E0A EA03 DDE5            15      PUSH    IX
001E0C EA05 DD2AA8EF        20      LD  IX,(_DPB)
001E10 EA09 CD31EC          17  DWTPAT: CALL    FDWT        ;自己書き換え（ディスク書き込み）
001E13 EA0C 18EE            12      JR  POP_IX_RET
                                
       EA0E                     WTFAT:
001E15 EA0E CD29EA          17      CALL    FATSETUP
001E18 EA11 D403EA          17      CALL    NC,DWT24B
001E1B EA14 D8              11      RET C
001E1C EA15 DDCB0F7E        20      BIT 7,(IX+00FH) ;DPB_0F_BPS
001E20 EA19 C8              11      RET Z       ;予備FATが無い
001E21 EA1A CD30EA          17      CALL    FATS2
001E24 EA1D E5              11      PUSH    HL      ;予備FAT
001E25 EA1E DD6E00          19      LD  L,(IX+0)    ;DPB_00_FATLN
001E28 EA21 DD6601          19      LD  H,(IX+1)
001E2B EA24 19              11      ADD HL,DE
001E2C EA25 EB               4      EX  DE,HL
001E2D EA26 E1              10      POP HL
001E2E EA27 18DA            12      JR  DWT24B
                                ;------------------------
                                ;FATのセットアップ
                                ;out
                                ;   B  : FATセクタ数
                                ;   DE : FAT先頭セクタ番号
                                ;   HL : FATバッファポインタ
                                ;   CF : 1=ドライブ切り替えエラー
                                ;note
                                ;   FATサイズがFATバッファを超える場合は
                                ;   対象クラスタ領域==(_FATIX)によって
                                ;   FAT12:対象クラスタ1024毎に1.5KBを切り替える
                                ;   FAT16:対象クラスタ1024毎に2KBを切り替える
                                ;------------------------
       EA29                     FATSETUP:
001E30 EA29 3AAAEF          13      LD  A,(_FATDRV)
001E33 EA2C CD38EB          17      CALL    CHGDRVR     ;ドライブ切り替え
001E36 EA2F D8              11      RET C
       EA30                     FATS2:
001E37 EA30 DD7E0F          19      LD  A,(IX+00FH) ;DPB_0F_BPS 512=2 1024=4
001E3A EA33 0F               4      RRCA
001E3B EA34 CD5DEA          17  FATSX:  CALL    FATSETUP12  ;自己書き換え
001E3E EA37 210000          10      LD  HL,0
001E41 EA3A 4A               4      LD  C,D
001E42 EA3B 54               4      LD  D,H
001E43 EA3C 3AABEF          13      LD  A,(_FATIX)  ;範囲FAT12:0-3/FAT16:0-63(0-03FH):65535*2/2048
001E46 EA3F 47               4      LD  B,A
001E47 EA40 04               4      INC B
001E48 EA41 DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
       EA44                     FAT_SKP:
001E4B EA44 05               4      DEC B
001E4C EA45 2805            12      JR  Z,FAT1
001E4E EA47 19              11      ADD HL,DE
001E4F EA48 93               4      SUB E
001E50 EA49 30F9            12      JR  NC,FAT_SKP
001E52 EA4B C9              10      RET
       EA4C                     FAT1:
001E53 EA4C EB               4      EX  DE,HL
001E54 EA4D B9               4      CP  C       ;C=FATバッファに読み込めるセクタ数
001E55 EA4E 3801            12      JR  C,FAT2
001E57 EA50 79               4      LD  A,C
       EA51                     FAT2:
001E58 EA51 47               4      LD  B,A
                                
001E59 EA52 2AFAF0          16      LD  HL,(_FATPS) ;fat sector pos
001E5C EA55 19              11      ADD HL,DE
001E5D EA56 EB               4      EX  DE,HL
001E5E EA57 2A7CF0          16      LD  HL,(_FATBF)
001E61 EA5A AF               4      XOR A       ;CF=0
001E62 EA5B 4F               4      LD  C,A
001E63 EA5C C9              10      RET
                                ;
                                ;   FATバッファに読み込める最大のセクタ数と_FATIXで進めるセクタ数
                                ;   FATSETUP* (FAT12/FAT16)
                                ;out
                                ;   D : FATバッファに読み込める最大のセクタ数
                                ;   E : _FATIXで進めるセクタ数
       EA5D                     FATSETUP12:
001E64 EA5D 110606          10      LD  DE,0606H    ;256
001E67 EA60 D8              11      RET C
001E68 EA61 110303          10      LD  DE,0303H    ;512
001E6B EA64 0F               4      RRCA
001E6C EA65 D8              11      RET C
001E6D EA66 110102          10      LD  DE,0201H    ;1024
001E70 EA69 C9              10      RET
                                
       EA6A                     FATSETUP16:
001E71 EA6A 110808          10      LD  DE,0808H    ;256
001E74 EA6D D8              11      RET C
001E75 EA6E 110404          10      LD  DE,0404H
001E78 EA71 0F               4      RRCA            ;512
001E79 EA72 D8              11      RET C
001E7A EA73 110202          10      LD  DE,0202H    ;1024
001E7D EA76 C9              10      RET
                                
       EA77                     CHGDRV:
001E7E EA77 E5              11      PUSH    HL
001E7F EA78 2189EF          10      LD  HL,_DSK
001E82 EA7B BE               7      CP  (HL)
001E83 EA7C 280A            12      JR  Z,CHGDRVE
       EA7E                     CHGDRV1:
001E85 EA7E DDE5            15      PUSH    IX
001E87 EA80 CD8AEA          17      CALL    CHGDRV0
001E8A EA83 3A89EF          13      LD  A,(_DSK)
001E8D EA86 DDE1            14      POP IX
       EA88                     CHGDRVE:
001E8F EA88 E1              10      POP HL
001E90 EA89 C9              10      RET
                                
       EA8A                     CHGDRV0:
001E91 EA8A 6F               4      LD  L,A
001E92 EA8B CDDCEF          17      CALL    _GETDPB
001E95 EA8E D8              11      RET C
001E96 EA8F DD22A8EF        20      LD  (_DPB),IX
001E9A EA93 7D               4      LD  A,L
001E9B EA94 3289EF          13      LD  (_DSK),A
       EA97                     CHGDRV2:
001E9E EA97 C5              11      PUSH    BC
001E9F EA98 D5              11      PUSH    DE
001EA0 EA99 ED73EEEA        20      LD  (SPPAT2+1),SP
001EA4 EA9D F3               4      DI
001EA5 EA9E DDF9            10      LD  SP,IX
                                
001EA7 EAA0 E1              10      POP HL      ;DPB_00_FATLN
001EA8 EAA1 E1              10      POP HL      ;DPB_02_DRD
001EA9 EAA2 22FAE9          16      LD  (DRDPAT+1),HL
                                
001EAC EAA5 E1              10      POP HL
001EAD EAA6 220AEA          16      LD  (DWTPAT+1),HL   ;DPB_04_DWT
                                
001EB0 EAA9 E1              10      POP HL      ;L=DPB_06_FATID H=DPB_07_SECPCL
001EB1 EAAA 7C               4      LD  A,H
001EB2 EAAB 3204E1          13      LD  (SPCPAT+1),A    ;1クラスタの論理セクタ数
001EB5 EAAE 3D               4      DEC A
001EB6 EAAF 3294E8          13      LD  (NCPAT+1),A
                                
001EB9 EAB2 E1              10      POP HL      ;DPB_08_MAXCL
001EBA EAB3 7D               4      LD  A,L
001EBB EAB4 3223E1          13      LD  (CLPAT2+1),A
001EBE EAB7 7C               4      LD  A,H
001EBF EAB8 321FE1          13      LD  (CLPAT1+1),A
001EC2 EABB 2B               6      DEC HL
001EC3 EABC 2227E3          16      LD  (MAXCLP+1),HL
                                
001EC6 EABF E1              10      POP HL      ;L=DPB_0A_FDMODE H=DPB_0B_DIRSCNT
001EC7 EAC0 7D               4      LD  A,L
001EC8 EAC1 F6FE             7      OR  0FEH
001ECA EAC3 32FCEC          13      LD  (FDMODE+1),A
001ECD EAC6 07               4      RLCA
001ECE EAC7 E603             7      AND 3
001ED0 EAC9 326BEF          13      LD  (FSPAT+1),A
001ED3 EACC 4C               4      LD  C,H
                                
001ED4 EACD E1              10      POP HL      ;L=DPB_0C_MAXCYL H=DPB_0D_MAXSEC
                                
001ED5 EACE E1              10      POP HL      ;L=DPB_0E_FATPS H=DPB_0F_BPS
001ED6 EACF 7C               4      LD  A,H     ;DPB_0F_BPS
001ED7 EAD0 E607             7      AND 7
001ED9 EAD2 3222E6          13      LD  (SECSZ+2),A ;1セクタのサイズの上位1バイト 0x400 - 0x200 - 0x100
                                                ;1セクタ512 2D/2DD/2HC/2HQ(2HD1.44MB)/EMM/BRAM/EMEM等
                                                ;1セクタ1024 2HD/2HDE98
                                                ;1セクタ256 GRAM/RAMF/CMOS/等
                                                ;1024   512 256
                                                ;4  2   1
001EDC EAD5 87               4      ADD A,A     ;8  4   2
001EDD EAD6 87               4      ADD A,A     ;010H   8   4
001EDE EAD7 87               4      ADD A,A     ;020H   010H    8
001EDF EAD8 3280DF          13      LD  (SDECPAT+1),A   ;1セクタ辺りのディレクトリエントリ数
                                
001EE2 EADB 2600             7      LD  H,0
001EE4 EADD 22FAF0          16      LD  (_FATPS),HL
                                
001EE7 EAE0 E1              10      POP HL      ;DPB_10_DIRPS
001EE8 EAE1 22FCF0          16      LD  (_DIRPS),HL
                                
001EEB EAE4 E1              10      POP HL      ;L=DPB_12_DEVICE H=DPB_13_UNITNO
001EEC EAE5 7C               4      LD  A,H
001EED EAE6 3284EF          13      LD  (_DRIVE),A
                                
001EF0 EAE9 E1              10      POP HL      ;DPB_14_ADDCL16
001EF1 EAEA 2214E1          16      LD  (CLSPAT+1),HL
                                
001EF4 EAED 310000          10  SPPAT2: LD  SP,0        ;元のSPを復元
001EF7 EAF0 FB               4      EI
001EF8 EAF1 2AFCF0          16      LD  HL,(_DIRPS)
001EFB EAF4 0600             7      LD  B,0
001EFD EAF6 09              11      ADD HL,BC       ;C=DPB_0B_DIRSCNT
001EFE EAF7 229BDF          16      LD  (MD_PAT+1),HL
                                
001F01 EAFA 2A27E3          16      LD  HL,(MAXCLP+1);
001F04 EAFD 11F60F          10      LD  DE,4086     ;クラスタ数が4086未満:FAT12 4086以上:FAT16
001F07 EB00 ED52            15      SBC HL,DE       ;CF=0のはず
001F09 EB02 300F            12      JR  NC,SETFAT16
001F0B EB04 211AE8          10      LD  HL,GNCL     ;FAT12
001F0E EB07 113DE8          10      LD  DE,SNCL
001F11 EB0A 015DEA          10      LD  BC,FATSETUP12
001F14 EB0D DDCB0FAE        23      RES 5,(IX+00FH) ;DPB_0F_BPS(FAT12)
001F18 EB11 180D            12      JR  EXTRA1
       EB13                     SETFAT16:
001F1A EB13 2171E8          10      LD  HL,GNCL16   ;FAT16
001F1D EB16 117EE8          10      LD  DE,SNCL16
001F20 EB19 016AEA          10      LD  BC,FATSETUP16
001F23 EB1C DDCB0FEE        23      SET 5,(IX+00FH) ;DPB_0F_BPS(FAT16)
       EB20                     EXTRA1:
001F27 EB20 22F8EF          16      LD  (GNCPAT+1),HL
001F2A EB23 ED53FBEF        20      LD  (SNCPAT+1),DE
001F2E EB27 ED4335EA        20      LD  (FATSX+1),BC
001F32 EB2B D1              10      POP DE
001F33 EB2C C1              10      POP BC
001F34 EB2D AF               4      XOR A
001F35 EB2E C9              10      RET
                                
       EB2F                     GETDPBD:
001F36 EB2F DDE3            23      EX  (SP),IX
001F38 EB31 DDE5            15      PUSH    IX
001F3A EB33 3A88EF          13      LD  A,(_DRV)
001F3D EB36 1807            12      JR  GETDPB1
                                
       EB38                     CHGDRVR:
001F3F EB38 CDD9EF          17      CALL    _CHGDRV
001F42 EB3B D8              11      RET C
001F43 EB3C 3A89EF          13      LD  A,(_DSK)
       EB3F                     GETDPB1:
001F46 EB3F C3DCEF          10      JP  _GETDPB
                                
       EB42                     GETDPB:
001F49 EB42 FE08             7      CP  8
001F4B EB44 3F               4      CCF
001F4C EB45 D8              11      RET C
001F4D EB46 0F               4      RRCA
001F4E EB47 0F               4      RRCA
001F4F EB48 0F               4      RRCA
001F50 EB49 DD                      DB  0DDH        ;Z80未定義命令
001F51 EB4A 6F               4      LD  L,A     ;LD IXL,A
001F52 EB4B DD                      DB  0DDH        ;Z80未定義命令
001F53 EB4C 26F1             7      LD  H,DEVICE/256    ;LD IXH,DEVICE/256
001F55 EB4E DD7E00          19      LD  A,(IX+0)    ;DPB_00_FATLN
001F58 EB51 A7               4      AND A       ;CF=0の為
001F59 EB52 DDCB0F6E        20      BIT 5,(IX+00FH) ;DPB_0F_BPS
001F5D EB56 C0              11      RET NZ      ;FAT16
001F5E EB57 DDCB126E        20      BIT 5,(IX+012H) ;DPB_12_DEVICE
001F62 EB5B C0              11      RET NZ      ;BPB
001F63 EB5C FE01             7      CP  001H        ;A=0 THEN CF=1
001F65 EB5E C9              10      RET
                                
       EB5F                     _SYS5F:
001F66 EB5F AF               4      XOR A
       EB60                     FFLUSH:
001F67 EB60 F5              11      PUSH    AF
001F68 EB61 3EFF             7      LD  A,0FFH
001F6A EB63 3239EF          13      LD  (SFILE),A
001F6D EB66 CD58E7          17      CALL    DWTX
001F70 EB69 3EFF             7      LD  A,0FFH
001F72 EB6B 32A5EF          13      LD  (_DBDRV),A
001F75 EB6E CDA2E7          17      CALL    WTFATX
001F78 EB71 AF               4      XOR A
001F79 EB72 32ABEF          13      LD  (_FATIX),A
001F7C EB75 2F               4      CPL         ;0FFH
001F7D EB76 32AAEF          13      LD  (_FATDRV),A
001F80 EB79 F1              10      POP AF
001F81 EB7A C9              10      RET
                                
[EOF:LDDIO.ASM:SHIFT_JIS]
                                    INCLUDE "88DISK.ASM"
                                
                                ;   LSX-Dodgers DISK
                                ;   PC-8801mkIISR
                                
                                ;   FLOPPY DISK DRIVER
                                ;
                                ;   コマンド送信
       EB7B                     PUTCOM:
001F82 EB7B F5              11      PUSH    AF
001F83 EB7C 3E0F             7      LD  A,00FH
001F85 EB7E D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F87 EB80 F1              10      POP AF
                                ;   通常ハンドシェイク（ホストが送信）
       EB81                     PUTDAT:
001F88 EB81 F5              11      PUSH    AF
       EB82                     PUTDAT1:
001F89 EB82 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F8B EB84 E602             7      AND 2       ;RFD
001F8D EB86 28FA            12      JR  Z,PUTDAT1
001F8F EB88 3E0E             7      LD  A,00EH      ;ATN=0
001F91 EB8A D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
001F93 EB8C F1              10      POP AF
001F94 EB8D D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
001F96 EB8F F5              11      PUSH    AF
001F97 EB90 3E09             7      LD  A,9     ;DAV=1
001F99 EB92 D3FF            11      OUT (0FFH),A
       EB94                     PUTDAT2:
001F9B EB94 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001F9D EB96 E604             7      AND 4       ;DAC
001F9F EB98 28FA            12      JR  Z,PUTDAT2
                                
001FA1 EB9A 3E08             7      LD  A,8     ;DAV=0
001FA3 EB9C D3FF            11      OUT (0FFH),A
       EB9E                     PUTDAT3:
001FA5 EB9E DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FA7 EBA0 E604             7      AND 4       ;DAC
001FA9 EBA2 20FA            12      JR  NZ,PUTDAT3
001FAB EBA4 F1              10      POP AF
001FAC EBA5 C9              10      RET
                                
                                ;   通常ハンドシェイク（ホストが受信）
       EBA6                     GETDAT:
001FAD EBA6 3E0B             7      LD  A,00BH      ;RFD=1
001FAF EBA8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBAA                     GETDAT1:
001FB1 EBAA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FB3 EBAC 0F               4      RRCA            ;DAV
001FB4 EBAD 30FB            12      JR  NC,GETDAT1
                                    
001FB6 EBAF 3E0A             7      LD  A,00AH      ;RFD=0
001FB8 EBB1 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
001FBA EBB3 DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
001FBC EBB5 F5              11      PUSH    AF
001FBD EBB6 3E0D             7      LD  A,00DH      ;DAC=1
001FBF EBB8 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
       EBBA                     GETDAT2:
001FC1 EBBA DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FC3 EBBC 0F               4      RRCA            ;DAV
001FC4 EBBD 38FB            12      JR  C,GETDAT2
                                
001FC6 EBBF 3E0C             7      LD  A,00CH      ;DAC=0
001FC8 EBC1 D3FF            11      OUT (0FFH),A
001FCA EBC3 F1              10      POP AF
001FCB EBC4 C9              10      RET
                                
                                ;   高速ハンドシェイク（ホストが送信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBC5                     FPUTDAT:
       EBC5                     FPUTDAT1:
001FCC EBC5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FCE EBC7 E602             7      AND 2       ;RFD
001FD0 EBC9 28FA            12      JR  Z,FPUTDAT1
001FD2 EBCB 3E0E             7      LD  A,00EH      ;ATN=0
001FD4 EBCD D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                
001FD6 EBCF 7E               7      LD  A,(HL)
001FD7 EBD0 D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FD9 EBD2 3E09             7      LD  A,9     ;DAV=1
001FDB EBD4 D3FF            11      OUT (0FFH),A
001FDD EBD6 23               6      INC HL
001FDE EBD7 0B               6      DEC BC
       EBD8                     FPUTDAT2:
001FDF EBD8 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FE1 EBDA E604             7      AND 4       ;DAC
001FE3 EBDC 28FA            12      JR  Z,FPUTDAT2
                                
001FE5 EBDE 7E               7      LD  A,(HL)
001FE6 EBDF D3FD            11      OUT (0FDH),A    ;標準状態ではサブシステムへのデータ送信ポート
                                
001FE8 EBE1 3E08             7      LD  A,8     ;DAV=0
001FEA EBE3 D3FF            11      OUT (0FFH),A
       EBE5                     FPUTDAT3:
001FEC EBE5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FEE EBE7 E604             7      AND 4       ;DAC
001FF0 EBE9 20FA            12      JR  NZ,FPUTDAT3
                                
001FF2 EBEB EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
001FF4 EBED EAC5EB          10      JP  PE,FPUTDAT
001FF7 EBF0 C9              10      RET
                                
                                
                                ;   高速ハンドシェイク（ホストが受信）
                                ;   HL:アドレス BC:受信サイズ（必ず偶数にする）
       EBF1                     FGETDAT:
001FF8 EBF1 3E0B             7      LD  A,00BH      ;RFD=1
001FFA EBF3 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
       EBF5                     FGETDAT1:
001FFC EBF5 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
001FFE EBF7 0F               4      RRCA            ;DAV
001FFF EBF8 30FB            12      JR  NC,FGETDAT1
                                    
002001 EBFA 3E0A             7      LD  A,00AH      ;RFD=0
002003 EBFC D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
                                    
002005 EBFE DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
002007 EC00 77               7      LD  (HL),A
                                
002008 EC01 3E0D             7      LD  A,00DH      ;DAC=1
00200A EC03 D3FF            11      OUT (0FFH),A    ;ディスクサブシステムI/F 8255 コントロール
00200C EC05 23               6      INC HL
00200D EC06 0B               6      DEC BC
       EC07                     FGETDAT2:
00200E EC07 DBFE            11      IN  A,(0FEH)    ;ディスクサブシステムI/F 8255 ポートC
002010 EC09 0F               4      RRCA            ;DAV
002011 EC0A 38FB            12      JR  C,FGETDAT2
                                
002013 EC0C DBFC            11      IN  A,(0FCH)    ;標準状態ではサブシステムからのデータ受信ポート
002015 EC0E 77               7      LD  (HL),A
                                
002016 EC0F 3E0C             7      LD  A,00CH      ;DAC=0
002018 EC11 D3FF            11      OUT (0FFH),A
                                
00201A EC13 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00201C EC15 EAF1EB          10      JP  PE,FGETDAT
00201F EC18 C9              10      RET
                                
                                ;   論理セクタ番号からトラック番号とセクタ番号を得る
                                ;   in 
                                ;   DE:論理セクタ
       EC19                     CALC_SECTOR:
002020 EC19 C5              11      PUSH    BC
002021 EC1A DD4E0D          19      LD  C,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002024 EC1D 0610             7      LD  B,16
002026 EC1F AF               4      XOR A
002027 EC20 EB               4      EX  DE,HL
       EC21                     DIV1:
002028 EC21 29              11      ADD HL,HL
002029 EC22 8F               4      ADC A,A
00202A EC23 B9               4      CP  C
00202B EC24 3802            12      JR  C,DIV2
00202D EC26 91               4      SUB C
00202E EC27 2C               4      INC L
       EC28                     DIV2:
00202F EC28 10F7            13      DJNZ    DIV1
                                
002031 EC2A 3C               4      INC A   ;最小のセクタは１固定
002032 EC2B 55               4      LD  D,L ;TRACK
       EC2C                     DIV3:
002033 EC2C 5F               4      LD  E,A ;SECTOR
002034 EC2D C1              10      POP BC
002035 EC2E C9              10      RET
                                
       EC2F                     WTTRK:
002036 EC2F 37               4      SCF
002037 EC30 C9              10      RET
       EC31                     FDWT:
002038 EC31 E5              11      PUSH    HL
002039 EC32 D5              11      PUSH    DE
00203A EC33 CD19EC          17      CALL    CALC_SECTOR
00203D EC36 7A               4      LD  A,D     ;トラック
00203E EC37 3297EC          13      LD  (FDWT_TRACK),A
002041 EC3A 7B               4      LD  A,E     ;セクタ
002042 EC3B 3292EC          13      LD  (FDWT_SECTOR),A
002045 EC3E DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002048 EC41 93               4      SUB E
002049 EC42 3C               4      INC A
00204A EC43 67               4      LD  H,A
00204B EC44 D1              10      POP DE
00204C EC45 3A22E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
00204F EC48 4F               4      LD  C,A
002050 EC49 AF               4      XOR A
       EC4A                     FDWT2:
002051 EC4A 81               4      ADD A,C
002052 EC4B 13               6      INC DE
002053 EC4C 05               4      DEC B
002054 EC4D 2807            12      JR  Z,FDWT3
002056 EC4F 25               4      DEC H       ;トラック、ヘッドを跨がない
002057 EC50 2804            12      JR  Z,FDWT3
002059 EC52 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
00205B EC54 38F4            12      JR  C,FDWT2
       EC56                     FDWT3:
00205D EC56 4F               4      LD  C,A
00205E EC57 E1              10      POP HL
00205F EC58 3E16             7      LD  A,16H       ;高速レシーブメモリ
002061 EC5A CD7BEB          17      CALL    PUTCOM
002064 EC5D 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002066 EC5F CD81EB          17      CALL    PUTDAT
002069 EC62 AF               4      XOR A       ;開始アドレスL
00206A EC63 CD81EB          17      CALL    PUTDAT
00206D EC66 79               4      LD  A,C     ;バイト数H
00206E EC67 CD81EB          17      CALL    PUTDAT
002071 EC6A AF               4      XOR A       ;バイト数L
002072 EC6B CD81EB          17      CALL    PUTDAT
002075 EC6E C5              11      PUSH    BC
002076 EC6F 41               4      LD  B,C
002077 EC70 0E00             7      LD  C,0
002079 EC72 CDC5EB          17      CALL    FPUTDAT
00207C EC75 C1              10      POP BC
00207D EC76 3E0D             7      LD  A,0DH       ;エグゼキュート
00207F EC78 CD7BEB          17      CALL    PUTCOM
002082 EC7B 3E7C             7      LD  A,WRITEDISKEX/256
002084 EC7D CD81EB          17      CALL    PUTDAT
002087 EC80 3E78             7      LD  A,WRITEDISKEX%256
002089 EC82 CD81EB          17      CALL    PUTDAT
00208C EC85 DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
00208F EC88 CD81EB          17      CALL    PUTDAT
002092 EC8B DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
002095 EC8E CD81EB          17      CALL    PUTDAT
       EC92                     FDWT_SECTOR EQU $+1
002098 EC91 3E00             7      LD  A,0     ;セクタ
00209A EC93 CD81EB          17      CALL    PUTDAT
       EC97                     FDWT_TRACK  EQU $+1
00209D EC96 3E00             7      LD  A,0     ;トラック
00209F EC98 CD81EB          17      CALL    PUTDAT
0020A2 EC9B 3AFCEC          13      LD  A,(FDMODE+1)    ;フロッピーディスクのモード(DPB_0A_FDMODE)
0020A5 EC9E CD81EB          17      CALL    PUTDAT
0020A8 ECA1 3A22E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
0020AB ECA4 CD81EB          17      CALL    PUTDAT
0020AE ECA7 79               4      LD  A,C
0020AF ECA8 CD81EB          17      CALL    PUTDAT      ;バイト数H
0020B2 ECAB DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
0020B5 ECAE CD81EB          17      CALL    PUTDAT
                                
0020B8 ECB1 3E0D             7      LD  A,0DH       ;エグゼキュート
0020BA ECB3 CD7BEB          17      CALL    PUTCOM
0020BD ECB6 3E7D             7      LD  A,RESULTEX/256
0020BF ECB8 CD81EB          17      CALL    PUTDAT
0020C2 ECBB 3EE8             7      LD  A,RESULTEX%256
0020C4 ECBD CD81EB          17      CALL    PUTDAT
                                
0020C7 ECC0 CDA6EB          17      CALL    GETDAT
0020CA ECC3 4F               4      LD  C,A
0020CB ECC4 FE01             7      CP  1
0020CD ECC6 D8              11      RET C
                                
0020CE ECC7 78               4      LD  A,B
0020CF ECC8 B7               4      OR  A
0020D0 ECC9 C231EC          10      JP  NZ,FDWT
0020D3 ECCC C9              10      RET
                                
       ECCD                     FDRD:
0020D4 ECCD 3E0D             7      LD  A,0DH       ;エグゼキュート
0020D6 ECCF CD7BEB          17      CALL    PUTCOM
0020D9 ECD2 3E7C             7      LD  A,READDISKEX/256
0020DB ECD4 CD81EB          17      CALL    PUTDAT
0020DE ECD7 AF               4      XOR A
0020DF ECD8 CD81EB          17      CALL    PUTDAT
0020E2 ECDB DD7E13          19      LD  A,(IX+013H) ;デバイスドライバ内におけるユニット番号(DPB_13_UNITNO)
0020E5 ECDE CD81EB          17      CALL    PUTDAT
0020E8 ECE1 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020EB ECE4 CD81EB          17      CALL    PUTDAT
0020EE ECE7 E5              11      PUSH    HL
0020EF ECE8 D5              11      PUSH    DE
0020F0 ECE9 CD19EC          17      CALL    CALC_SECTOR
0020F3 ECEC 7B               4      LD  A,E     ;セクタ
0020F4 ECED CD81EB          17      CALL    PUTDAT
0020F7 ECF0 7A               4      LD  A,D     ;トラック
0020F8 ECF1 CD81EB          17      CALL    PUTDAT
0020FB ECF4 DD7E0D          19      LD  A,(IX+00DH) ;フロッピーディスクの1トラックのセクタ数(DPB_0D_MAXSEC)
0020FE ECF7 93               4      SUB E
0020FF ECF8 3C               4      INC A
002100 ECF9 67               4      LD  H,A
002101 ECFA D1              10      POP DE
002102 ECFB 3EFF             7  FDMODE: LD  A,0FFH      ;フロッピーディスクのモード(DPB_0A_FDMODE)
002104 ECFD CD81EB          17      CALL    PUTDAT
002107 ED00 3A22E6          13      LD  A,(SECSZ+2) ;1セクタのサイズの上位1バイト
00210A ED03 CD81EB          17      CALL    PUTDAT
00210D ED06 4F               4      LD  C,A
00210E ED07 AF               4      XOR A
       ED08                     FDRD2:
00210F ED08 81               4      ADD A,C
002110 ED09 13               6      INC DE
002111 ED0A 05               4      DEC B
002112 ED0B 2807            12      JR  Z,FDRD3
002114 ED0D 25               4      DEC H       ;トラック、ヘッドを跨がない
002115 ED0E 2804            12      JR  Z,FDRD3
002117 ED10 FE3A             7      CP  03AH        ;バッファとして04000H-07BFFHまで使える
002119 ED12 38F4            12      JR  C,FDRD2
       ED14                     FDRD3:
00211B ED14 E1              10      POP HL
00211C ED15 4F               4      LD  C,A
00211D ED16 CD81EB          17      CALL    PUTDAT      ;バイト数H
002120 ED19 DD7E0C          19      LD  A,(IX+$0C)  ;フロッピーディスクのシリンダ数(DPB_0C_MAXCYL)
002123 ED1C CD81EB          17      CALL    PUTDAT
                                
002126 ED1F 3E0D             7      LD  A,0DH       ;エグゼキュート
002128 ED21 CD7BEB          17      CALL    PUTCOM
00212B ED24 3E7D             7      LD  A,RESULTEX/256
00212D ED26 CD81EB          17      CALL    PUTDAT
002130 ED29 3EE8             7      LD  A,RESULTEX%256
002132 ED2B CD81EB          17      CALL    PUTDAT
                                
002135 ED2E CDA6EB          17      CALL    GETDAT
002138 ED31 4F               4      LD  C,A
002139 ED32 FE01             7      CP  1
00213B ED34 D8              11      RET C
                                
00213C ED35 3E15             7      LD  A,15H       ;高速センドメモリ
00213E ED37 CD7BEB          17      CALL    PUTCOM
002141 ED3A 3E40             7      LD  A,DSS_DATA/256  ;開始アドレスH
002143 ED3C CD81EB          17      CALL    PUTDAT
002146 ED3F AF               4      XOR A       ;開始アドレスL
002147 ED40 CD81EB          17      CALL    PUTDAT
00214A ED43 79               4      LD  A,C     ;バイト数H
00214B ED44 CD81EB          17      CALL    PUTDAT
00214E ED47 AF               4      XOR A       ;バイト数L
00214F ED48 CD81EB          17      CALL    PUTDAT
002152 ED4B C5              11      PUSH    BC
002153 ED4C 41               4      LD  B,C
002154 ED4D 0E00             7      LD  C,0
002156 ED4F CDF1EB          17      CALL    FGETDAT
002159 ED52 C1              10      POP BC
00215A ED53 78               4      LD  A,B
00215B ED54 B7               4      OR  A
00215C ED55 C2CDEC          10      JP  NZ,FDRD
00215F ED58 C9              10      RET
                                
       EF6A                     FSPAT   EQU BEEPD+9
                                
[EOF:88DISK.ASM:UTF_8]
                                
                                    INCLUDE "88TABLE.ASM"
                                
                                ;   LSX-Dodgers TABLE キーのテーブル
                                
       ED59                     AT_TABLE:
002160 ED59                         DS  TABLEAD-AT_TABLE
                                
       ED98                     KEY_TABLE:
00219F ED98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0021A7 EDA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0021AF EDA8 4061626364656667        DB  '@','a','b','c','d','e','f','g' ;2
0021B7 EDB0 68696A6B6C6D6E6F        DB  'h','i','j','k','l','m','n','o' ;3
0021BF EDB8 7071727374757677        DB  'p','q','r','s','t','u','v','w' ;4
0021C7 EDC0 78797A5B5C5D5E2D        DB  'x','y','z','[',5CH,']','^','-' ;5
0021CF EDC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0021D7 EDD0 38393A3B2C2E2F5C        DB  '8','9',':',';',',','.','/',5CH ;7
0021DF EDD8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0021E7 EDE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0021EF EDE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0021F7 EDF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0021FF EDF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                ;
                                ;   割り込みベクタ:アドレス下位1バイトが0になるように
                                ;
002207 EE00 F1D8                I232C:  DW  INTE88
002209 EE02 C4D8                IVRTC:  DW  INTVRTC
00220B EE04 F1D8                I1D600: DW  INTE88
00220D EE06 F1D8                    DW  INTE88
00220F EE08 F1D8                    DW  INTE88
002211 EE0A                     IFM:    DS  030H-10
       EE30                     EXTSP:
                                
       EE30                     SHIFT_TABLE:
002237 EE30 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
00223F EE38 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
002247 EE40 4041424344454647        DB  '@','A','B','C','D','E','F','G' ;2
00224F EE48 48494A4B4C4D4E4F        DB  'H','I','J','K','L','M','N','O' ;3
002257 EE50 5051525354555657        DB  'P','Q','R','S','T','U','V','W' ;4
00225F EE58 58595A7B7C7D7E3D        DB  'X','Y','Z','{','|','}','~','=' ;5
002267 EE60 3021222324252627        DB  '0','!','"','#','$','%','&',27H ;6
00226F EE68 28292A2B3C3E3F5F        DB  '(',')','*','+','<','>','?','_' ;7
002277 EE70 0B1E1C0800000000        DB  0BH,1EH,1CH,08H,00H,00H,00H,00H ;8
00227F EE78 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
002287 EE80 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
00228F EE88 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
002297 EE90 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
                                
       EE98                     CTRL_TABLE:
00229F EE98 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;0
0022A7 EEA0 38392A2B3D2E2C0D        DB  '8','9','*','+','=','.',',',0DH ;1
0022AF EEA8 4001020304050607        DB  '@',01H,02H,03H,04H,05H,06H,07H ;2
0022B7 EEB0 08090A0B0C0D0E0F        DB  08H,09H,0AH,0BH,0CH,0DH,0EH,0FH ;3
0022BF EEB8 1011121314151617        DB  10H,11H,12H,13H,14H,15H,16H,17H ;4
0022C7 EEC0 18191A5B5C5D5E2D        DB  18H,19H,1AH,'[',5CH,']','^','-' ;5
0022CF EEC8 3031323334353637        DB  '0','1','2','3','4','5','6','7' ;6
0022D7 EED0 38393A3B2C2E2F5F        DB  '8','9',':',';',',','.','/','_' ;7
0022DF EED8 0C1E1C0800000000        DB  0CH,1EH,1CH,08H,00H,00H,00H,00H ;8
0022E7 EEE0 030000000000201B        DB  03H,00H,00H,00H,00H,00H,' ',1BH ;9
0022EF EEE8 091F1D00002D2F00        DB  09H,1FH,1DH,00H,00H,'-','/',00H ;A
0022F7 EEF0 0000000000000000        DB  00H,00H,00H,00H,00H,00H,00H,00H ;B
0022FF EEF8 0000000000081208        DB  00H,00H,00H,00H,00H,08H,12H,08H ;C
[EOF:88TABLE.ASM:SHIFT_JIS]
                                    INCLUDE "LDWORK.ASM"
                                
                                ;   LSX-Dodgers WORK0
                                ;
                                ;   CP/M互換BIOS
                                ;   BOOT:アドレス下位1バイトが0になるように
       EF00                     AT_WORK:
002307 EF00                         DS  WORKAD-AT_WORK
                                
       EF00                     CPM_BOOT:
002307 EF00 C30000          10      JP  0
       EF03                     _SYS00:     ;(BDOS)プログラム終了
       EF03                     CPM_WBOOT:
00230A EF03 C309D0          10      JP  WBOOT1
       EF06                     CPM_CONST:
00230D EF06 C396D9          10      JP  CONSTX
       EF09                     _SYS07:     ;(BDOS)コンソール直接入力
       EF09                     CPM_CONIN:
002310 EF09 C34ED9          10      JP  FLGET
       EF0C                     CPM_CONOUT:
002313 EF0C C3D0DB          10      JP  CONOUT1
                                
       EF0F                     DECBF:
002316 EF0F                         DS  5
00231B EF14 00                  FDRV    DB  0
00231C EF15                     FNAME   DS  36
002340 EF39                     SFILE:  DS  33      ;DRV FILENAME
002361 EF5A                     HLBUF:  DS  3       ;Random record buffer
                                
002364 EF5D 0000                LEFTX:  DW  0
002366 EF5F 0000                DTAX:   DW  0
                                
       EF61                     ZERO:
       EF61                     BEEPD:
002368 EF61 008E01000B000C10        DB  0,08EH,1,0,00BH,0,00CH,010H
002370 EF69 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
       EF62                     RTC_YY  EQU BEEPD+1
       EF63                     RTC_MW  EQU BEEPD+2
       EF64                     RTC_DD  EQU BEEPD+3
       EF65                     RTC_TT  EQU BEEPD+4
       EF66                     RTC_MM  EQU BEEPD+5
       EF67                     RTC_SS  EQU BEEPD+6
                                
002377 EF70 00                  CHECK:  DB  0
                                
002378 EF71 4F4B24              OK: DB  "OK$"
00237B EF74                         DS  5
002380 EF79 4572726F722124      COMERM: DB  "Error!$"
                                ;   システムワークエリア
                                ;   _CYL0:アドレス下位1バイトが080Hになるように
002387 EF80 FF                  _CYL0:  DB  0FFH    ;Cylinder
002388 EF81 FF                  _CYL1:  DB  0FFH    ;Cylinder
002389 EF82 FF                  _CYL2:  DB  0FFH    ;Cylinder
00238A EF83 FF                  _CYL3:  DB  0FFH    ;Cylinder
00238B EF84 00                  _DRIVE: DB  0   ;unit number
00238C EF85 00                  _SEEKSP:DB  0   ;Seek speed
00238D EF86 FF                  _ISEEK: DB  0FFH    ;
00238E EF87 00                  _DVSW:  DB  0
00238F EF88 00                  _DRV:   DB  0
002390 EF89 FF                  _DSK:   DB  0FFH
002391 EF8A 8000                _DTA:   DW  00080H
002393 EF8C 0000                _CTC:   DW  0
002395 EF8E 0000                _TXADR: DW  0
002397 EF90 0000                _KEYPS: DW  0
002399 EF92 00FF                _KEYD:  DW  0FF00H  ;キーデータ
00239B EF94 0010                _KEYSP: DB  KEYSP_L,KEYSP_H ;オートリピートの速度
00239D EF96 00                  _COLORF:DB  COLORF  ;色
00239E EF97 18                  _LINE:  DB  LINE
                                
00239F EF98 0000                _FCB:   DW  0   ;SEARCH FILES
0023A1 EF9A 0000                _FBPS:  DW  0   ;    //
0023A3 EF9C 0000                _FBAD:  DW  0   ;    //
0023A5 EF9E 00                  _FBCNT: DB  0   ;    //
0023A6 EF9F 00                  _FILEN: DB  0   ;    //
0023A7 EFA0 00                  _DIRF:  DB  0   ;bit7:ディレクトリ bit0-6:セクタインデックス
0023A8 EFA1                         DS  1
0023A9 EFA2 00                  _WTFATF:DB  0   ;FATバッファの更新フラグ
0023AA EFA3                         DS  1
0023AB EFA4 00                  _WTDBF: DB  0   ;データバッファの更新フラグ
0023AC EFA5 FF                  _DBDRV: DB  0FFH    ;データバッファにあるデータを読み込んだドライブ
0023AD EFA6 0000                _DBSEC: DW  0   ;データバッファにあるデータを読み込んだセクタ番号
0023AF EFA8 0000                _DPB:   DW  0
       EFAA                     _FATDRV:
0023B1 EFAA FF                      DB  0FFH    ;FATバッファに読み込んでいるドライブ
0023B2 EFAB 00                  _FATIX: DB  0   ;FATバッファに読み込んでいるインデックス
       EFAC                     _FAKEFREE:
0023B3 EFAC 0000                    DW  0   ;偽の残量（FATサイズが大きくなると重くなるのでその対策）
                                
0023B5 EFAE                         DS  2
                                
       EFB0                     CRTCD:  
0023B7 EFB0 6F                      DB  06FH
       EFB1                     _WIDTH: 
0023B8 EFB1 50                      DB  WIDTH
       EFB2                     TVRAMTOP:
0023B9 EFB2 5938                    DB  059H,038H
0023BB EFB4 1F02                    DB  01FH,002H
       EFB6                     _LINE2:
0023BD EFB6 19                      DB  019H
       EFB7                     WKE4:
0023BE EFB7 1C                      DB  01CH
       EFB8                     WKE6:
0023BF EFB8 00                      DB  000H
       EFB9                     WK40:
0023C0 EFB9 07                      DB  007H
       EFBA                     _PAGE_MINUS:
0023C1 EFBA 80F8                    DW  0-WIDTH*LINE
       EFBC                     _WIDTH_MINUS:
0023C3 EFBC B0FF                    DW  0-WIDTH
       EFBE                     WK30:
0023C5 EFBE 0C                      DB  00CH
       EFBF                     WK31:
       EFBF                     WK1FD0:
0023C6 EFBF 20                      DB  020H
                                
0023C7 EFC0 0000                CTC0:   DW  INTCTCE
0023C9 EFC2 0000                CTC1:   DW  INTCTCE
0023CB EFC4 0000                CTC2:   DW  INTCTC2
0023CD EFC6 0000                CTC3:   DW  INTCTCE
0023CF EFC8 0000                INTVEC: DW  INT
                                
                                ;   LSX-Dodgers 独自BIOS
                                
0023D1 EFCA C309DD          10  _INKEY: JP  INKEY
0023D4 EFCD C3CCDA          10  _PRINT: JP  PRINT
0023D7 EFD0 C360DD          10  _SCRN:  JP  SCRN
0023DA EFD3 C3ABDC          10  _POS:   JP  POS
0023DD EFD6 C314DB          10  _LOC:   JP  LOC
       EFD9                     _CHGDRV:
0023E0 EFD9 C377EA          10      JP  CHGDRV
       EFDC                     _GETDPB:
0023E3 EFDC C342EB          10      JP  GETDPB
       EFDF                     _FFLUSH:
0023E6 EFDF C360EB          10      JP  FFLUSH
       EFE2                     _RDFATX:
0023E9 EFE2 C378E7          10      JP  RDFATX
0023EC EFE5 C3A0E8          10  _RDFAT: JP  RDFAT
0023EF EFE8 C32FEC          10  _WTTRK: JP  WTTRK
0023F2 EFEB C3CDEC          10  _FDRD:  JP  FDRD
0023F5 EFEE C331EC          10  _FDWT:  JP  FDWT
       EFF1                     _BPB2DPB:
0023F8 EFF1 C305E9          10      JP  BPB2DPB
0023FB EFF4                         DS  3
       EFF7                     _GNCL:
0023FE EFF7 C31AE8          10  GNCPAT: JP  GNCL        ; self-modifying code
       EFFA                     _SNCL:
002401 EFFA C33DE8          10  SNCPAT: JP  SNCL        ; self-modifying code
002404 EFFD C35FD0          10  _COMANL:JP  COMANL
                                
       F000                     _WE:
[EOF:LDWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LDCALL.ASM"
                                
                                ;   LSX-Dodgers システムコール(BDOS)
                                ;
                                ;   LSX-Dodgers SYSTEM CALL
                                ;   STABLE:アドレス下位1バイトが0になるように
                                
       F000                     STABLE:
                                ;0
002407 F000 03EF21D92DD9ADDF        DW  _SYS00,_SYS01,_SYS02,_SYS03
00240F F008 21D621D632D909EF        DW  _SYS04,_SYS05,_SYS06,_SYS07
002417 F010 3AD923D662D98ED9        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
00241F F018 38D63DD64CD65FD6        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
002427 F020 B3D6FAD643D779D7        DW  _SYS10,_SYS11,_SYS12,_SYS13
00242F F028 81D797D7ACD7A4D7        DW  _SYS14,_SYS15,_SYS16,_SYS17
002437 F030 F3D7F8D7FDD703D8        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
00243F F038 21D629D821D62DD8        DW  _SYS1C,_SYS1D,_SYS1E,_SYS1F
                                ;2
002447 F040 21D6E3D7EBD734D8        DW  _SYS20,_SYS21,_SYS22,_SYS23
00244F F048 5AD821D635E41AE5        DW  _SYS24,_ERROR,_SYS26,_SYS27
002457 F050 EBD763D8A4D9ADDF        DW  _SYS28,_SYS5C,_SYS2A,_SYS2B
00245F F058 CBD9ADDF21D686D8        DW  _SYS2C,_SYS2D,_SYS2E,_SYS2F
                                ;3
002467 F060 80D821D621D621D6        DW  _SYS30,_ERROR,_ERROR,_ERROR
00246F F068 21D621D621D621D6        DW  _ERROR,_ERROR,_ERROR,_ERROR
002477 F070 21D6ADDFADDFA7D8        DW  _ERROR,_SYS39,_SYS3A,_SYS5A
                                ;DOS2
00247F F078 04D6                    DW  _DOS2
                                
002481 F07A                         DS  2
002483 F07C 00F2                _FATBF: DW  FATBF
002485 F07E 00FA                _DTBUF: DW  DTBUF
                                
                                ;   コントロールコードテーブル
                                ;   CTRLTB:アドレス下位1バイトが080Hになるように
                                
       F080                     CTRLTB:
002487 F080 17DB17DB4EDB56DC        DW  CTRL00,CTRL00,CTRL02,CTRL03 ;  A,B,C
00248F F088 50DC79DB29DCF5DB        DW  CTRL04,CTRL05,CTRL06,CTRL07 ;D,E,F,G
002497 F090 1EDB43DB59DCA5DB        DW  CTRL08,CTRL09,CTRL0A,CTRL0B ;H,I,J,K
00249F F098 26DC98DB60DC17DB        DW  CTRL0C,CTRL0D,CTRL0E,CTRL00 ;L,M,N,O
0024A7 F0A0 17DB17DB9DDB17DB        DW  CTRL00,CTRL00,CTRL12,CTRL00 ;P,Q,R,S
0024AF F0A8 17DB17DB17DB17DB        DW  CTRL00,CTRL00,CTRL00,CTRL00 ;T,U,V,W
0024B7 F0B0 17DB17DB26DCACDB        DW  CTRL00,CTRL00,CTRL0C,CTRL1B ;X,Y,Z,ESC
0024BF F0B8 00DB25DB3ADB59DC        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F ;→,←,↑,↓
                                
0024C7 F0C0                         DS  02AH
                                
0024F1 F0EA 1617                SDDATA: DB  22,23       ;(FCB)ファイルを最後に変更した時刻
0024F3 F0EC 1415                    DB  20,21       ;(FCB)ファイルを最後に変更した日付
0024F5 F0EE 1A1B                    DB  26,27       ;(FCB)ファイルの先頭クラスタ
0024F7 F0F0 10111213                DB  16,17,18,19 ;(FCB)ファイルのサイズ(バイト単位)
       F0F4                     SDDATAE:
                                
0024FB F0F4                     SCDIR:  DS  2       ;+14 +15
0024FD F0F6                     SFBPS:  DS  2       ;FBPS
0024FF F0F8                     SFNDF:  DS  2       ;FILEN DIRF
                                
002501 F0FA 0000                _FATPS: DW  0
002503 F0FC 0000                _DIRPS: DW  0
002505 F0FE 0000                _CLPS:  DW  0
                                
       F100                     _PE:
[EOF:LDCALL.ASM:SHIFT_JIS]
                                    INCLUDE "88DPB.ASM"
                                
                                ;   LSX-Dodgers DPB
                                ;   PC-8801mkIISR
                                
       F100                     DEVICE:
                                
                                ;   A:
                                
002507 F100 0200                    DW  2   ;DPB_00_FATLN
002509 F102 EBEF                    DW  _FDRD   ;DPB_02_DRD
00250B F104 EEEF                    DW  _FDWT   ;DPB_04_DWT
00250D F106 FD                      DB  0FDH    ;DPB_06_FATID
00250E F107 02                      DB  2   ;DPB_07_SECPCL
00250F F108 6401                    DW  356 ;DPB_08_MAXCL
002511 F10A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002512 F10B 07                      DB  7   ;DPB_0B_DIRSCNT
002513 F10C 28                      DB  40  ;DPB_0C_MAXCYL
002514 F10D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002515 F10E 01                      DB  1   ;DPB_0E_FATPS
002516 F10F 82                      DB  082H    ;DPB_0F_BPS
002517 F110 0500                    DW  5   ;DPB_10_DIRPS
002519 F112 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00251A F113 00                      DB  0   ;DPB_13_UNITNO
00251B F114 0800                    DW  8   ;DPB_14_ADDCL16
00251D F116 0000                    DW  0   ;DPB_16
00251F F118 0000                    DW  0   ;DPB_18
002521 F11A 0000                    DW  0   ;DPB_1A_SDIR
002523 F11C 46444430                DB  "FDD0"  ;DPB_1C_NAME
                                
                                ;   B:
                                
002527 F120 0200                    DW  2   ;DPB_00_FATLN
002529 F122 EBEF                    DW  _FDRD   ;DPB_02_DRD
00252B F124 EEEF                    DW  _FDWT   ;DPB_04_DWT
00252D F126 FD                      DB  0FDH    ;DPB_06_FATID
00252E F127 02                      DB  2   ;DPB_07_SECPCL
00252F F128 6401                    DW  356 ;DPB_08_MAXCL
002531 F12A FF                      DB  0FFH    ;DPB_0A_FDMODE  0FFH=2D / 0FEH=2HD
002532 F12B 07                      DB  7   ;DPB_0B_DIRSCNT
002533 F12C 28                      DB  40  ;DPB_0C_MAXCYL
002534 F12D 09                      DB  9   ;DPB_0D_MAXSEC  Number of sectors
002535 F12E 01                      DB  1   ;DPB_0E_FATPS
002536 F12F 82                      DB  082H    ;DPB_0F_BPS
002537 F130 0500                    DW  5   ;DPB_10_DIRPS
002539 F132 A7                      DB  0A7H    ;DPB_12_DEVICE  Device Number
00253A F133 01                      DB  1   ;DPB_13_UNITNO
00253B F134 0800                    DW  8   ;DPB_14_ADDCL16
00253D F136 0000                    DW  0   ;DPB_16
00253F F138 0000                    DW  0   ;DPB_18
002541 F13A 0000                    DW  0   ;DPB_1A_SDIR
002543 F13C 46444431                DB  "FDD1"  ;DPB_1C_NAME
                                
                                ;   C:
                                
002547 F140                         DS  32
                                
                                ;   D:
                                
002567 F160                         DS  32
                                
                                ;   E:
                                
002587 F180                         DS  32
                                
                                ;   F:
                                
0025A7 F1A0 0000                BANKFL: DW  0   ;DPB_00_FATLN
0025A9 F1A2 AFD5                    DW  BDRD    ;DPB_02_DRD
0025AB F1A4 ABD5                    DW  BDWT    ;DPB_04_DWT
0025AD F1A6 F9                      DB  0F9H    ;DPB_06_FATID
0025AE F1A7 02                      DB  2   ;DPB_07_SECPCL
0025AF F1A8 0000                BANKCL: DW  0   ;DPB_08_MAXCL
0025B1 F1AA 00                      DB  0   ;DPB_0A_FDMODE
0025B2 F1AB 08                      DB  8   ;DPB_0B_DIRSCNT
0025B3 F1AC 00                      DB  0   ;DPB_0C_MAXCYL
0025B4 F1AD 01                      DB  1   ;DPB_0D_MAXSEC
0025B5 F1AE 00                      DB  0   ;DPB_0E_FATPS
0025B6 F1AF 02                      DB  2   ;DPB_0F_BPS
0025B7 F1B0 0200                    DW  2   ;DPB_10_DIRPS
0025B9 F1B2 0B                  BANKDV: DB  00BH    ;DPB_12_DEVICE
0025BA F1B3 00                      DB  0   ;DPB_13_UNITNO
0025BB F1B4 0600                    DW  6   ;DPB_14_ADDCL16
0025BD F1B6 0000                    DW  0   ;DPB_16
0025BF F1B8 0000                    DW  0   ;DPB_18
0025C1 F1BA 0000                    DW  0   ;DPB_1A_SDIR
0025C3 F1BC 454D454D                DB  "EMEM"  ;DPB_1C_NAME
                                
                                ;   G:
                                
0025C7 F1C0                         DS  32
                                
                                ;   H:
0025E7 F1E0                         DS  32-8
0025FF F1F8 00                      DB  0
[EOF:88DPB.ASM:UTF_8]
                                
       F1F9                     LAST_ADR:
                                
                                    END
[EOF:88.ASM:UTF_8]
